(()=>{var _=(t,o)=>()=>(t&&(o=t(t=0)),o);var Ut=(t,o)=>()=>(o||t((o={exports:{}}).exports,o),o.exports);function it(){try{let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=`
      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */
      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }
      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }

      /* Contornos de enfoque claros para accesibilidad */
      .navbar .nav-link:focus,
      .navbar .dropdown-item:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* Espaciado entre botones en el offcanvas del carrito */
      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }
    `,document.head.appendChild(t)}catch(t){console.warn("[modules/enhancements] injectEnhancementStyles error:",t)}}var ct=_(()=>{});function st(){try{document.addEventListener("keydown",o=>{o.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=".keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }",document.head.appendChild(t)}catch(t){console.warn("[modules/a11y] setupNavigationAccessibility error:",t)}}var lt=_(()=>{});function dt(){try{"loading"in HTMLImageElement.prototype&&document.querySelectorAll("img:not([loading])").forEach(t=>{t.loading="lazy"})}catch(t){console.warn("[modules/perf] setupPerformanceOptimizations error:",t)}}var ut=_(()=>{});async function Ft(){try{let t=localStorage.getItem("productDataVersion"),o=t?`/data/product_data.json?v=${encodeURIComponent(t)}`:"/data/product_data.json",c=await fetch(o,{cache:"no-store",headers:{Accept:"application/json"}});if(!c.ok)return null;let d=await c.json(),u=Array.isArray(d?.products)?d.products:Array.isArray(d)?d:[],f={};return u.forEach(g=>{let y=g.id||String(g.name)+"-"+String(g.category);f[y]=g}),f}catch(t){return console.error("[modules/seo] Error loading product data:",t),null}}async function mt(){try{if(document.querySelector('script[type="application/ld+json"]'))return;let t=await Ft();if(!t)return;let c=Object.values(t).slice(0,20).map(f=>({"@type":"Product",name:f.name,image:f.image_path,description:f.description,brand:f.brand||"Gen\xE9rico",offers:{"@type":"Offer",price:f.price,priceCurrency:"CLP",availability:f.stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}})),d={"@context":"https://schema.org","@graph":[{"@type":"Store",name:"El Rinc\xF3n de \xC9bano",image:"https://elrincondeebano.com/assets/images/web/logo.webp",description:"Un minimarket en la puerta de tu departamento",address:{"@type":"PostalAddress",addressCountry:"CL"},telephone:"+56951118901",url:"http://www.elrincondeebano.com/",contactPoint:{"@type":"ContactPoint",telephone:"+56-951118901",contactType:"customer service"}},...c]},u=document.createElement("script");u.type="application/ld+json",window&&window.__CSP_NONCE__&&u.setAttribute("nonce",window.__CSP_NONCE__),u.textContent=JSON.stringify(d),document.head.appendChild(u)}catch(t){console.error("[modules/seo] Error generating structured data:",t)}}function pt(){try{if(!document.querySelector('link[rel="canonical"]')){let t=document.createElement("link");t.rel="canonical",t.href=location.origin+location.pathname,document.head.appendChild(t)}if(!document.querySelector('meta[name="description"]')){let t=document.createElement("meta");t.name="description",t.content="El Rinc\xF3n de \xC9bano - Minimarket con delivery instant\xE1neo.",document.head.appendChild(t)}}catch(t){console.warn("[modules/seo] injectSeoMetadata error:",t)}}var ft=_(()=>{});function yt(){try{if(!document.querySelector('link[rel="manifest"]')){let t=document.createElement("link");t.rel="manifest",t.href="/app.webmanifest",document.head.appendChild(t)}}catch(t){console.warn("[modules/pwa] injectPwaManifest error:",t)}}var gt=_(()=>{});function ht(){try{window?.console?.debug&&console.debug("[modules/checkout] setupCheckoutProgress: no-op")}catch{}}var wt=_(()=>{});function R(t,o={}){let c=t.startsWith("/")?t:"/"+t,d=Object.entries(o).map(([f,g])=>`${f}=${g}`).join(","),u=c.split("/").map(encodeURIComponent).join("/");return`/cdn-cgi/image/${d}${u}`}var U,bt=_(()=>{U={fit:"cover",quality:82,format:"auto"}});function vt(){return`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function k(t,o,c={}){let d={level:t,message:o,...c},u=JSON.stringify(d);typeof console[t]=="function"?console[t](u):console.log(u)}var Ct=_(()=>{});function Lt(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}if(Et)return;Et=!0;let t=async()=>{if(document.readyState==="complete"){window.removeEventListener("load",t);try{await Ht()}catch(o){console.error("Service Worker initialization failed:",o),Gt("Failed to initialize service worker. Some features may not work offline.")}}};window.addEventListener("load",t),t()}async function Ht(){try{let t=await navigator.serviceWorker.register(Z.path,{scope:Z.scope});console.log("ServiceWorker registered successfully:",t.scope),Wt(t),Kt(t),Qt(),Vt()}catch(t){throw console.error("ServiceWorker registration failed:",t),t}}function Wt(t){t.addEventListener("updatefound",()=>{let o=t.installing;o.addEventListener("statechange",()=>{o.state==="installed"&&navigator.serviceWorker.controller&&o.postMessage({type:"SKIP_WAITING"})})})}function Kt(t){St(t),setInterval(()=>{St(t)},Z.updateCheckInterval)}async function St(t){try{await t.update();let o=await fetch("/data/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(o.ok){let d=(await o.json()).version,u=localStorage.getItem("productDataVersion");d!==u&&(t.active?.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",d),Jt(null,"New product data available"))}}catch(o){console.warn("Update check failed:",o)}}function Qt(){let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}function Vt(){let t=document.getElementById("offline-indicator");if(!t)return;let o=()=>{let c=navigator.onLine;t.classList.toggle("is-hidden",c),t.style.display=c?"none":"block",c||Yt("You are currently offline. Some features may be limited.")};window.addEventListener("online",o),window.addEventListener("offline",o),navigator.onLine||o()}function Jt(t,o="Una versi\xF3n est\xE1 disponible"){let c=X(o,"Actualizar ahora","Despu\xE9s",()=>{t?t.postMessage({type:"SKIP_WAITING"}):window.location.reload()});tt(c)}function Gt(t){let o=X(t,"Reload","Dismiss",()=>window.location.reload());tt(o)}function Yt(t){let o=X(t,"Retry","Dismiss",()=>window.location.reload());tt(o)}function X(t,o,c,d){let u=document.createElement("div");return u.className="notification-toast",u.setAttribute("role","alert"),u.setAttribute("aria-live","polite"),u.innerHTML=`
        <div class="notification-content">
            <p>${t}</p>
            <div class="notification-actions">
                <button class="primary-action">${o}</button>
                <button class="secondary-action">${c}</button>
            </div>
        </div>
    `,u.querySelector(".primary-action").addEventListener("click",()=>{try{d()}catch(f){console.error("Primary action failed:",f)}u.remove()}),u.querySelector(".secondary-action").addEventListener("click",()=>{u.remove()}),u}function tt(t){let o=document.querySelector(".notification-toast");o&&o.remove(),document.body.appendChild(t),setTimeout(()=>{document.body.contains(t)&&t.remove()},300*1e3)}var Z,Et,Zt,Xt,K,te,G,ee,ne,Y,re,oe,It,F,ae,ie,p,v,_t,Pt,qt=_(()=>{bt();Ct();Z={path:"/service-worker.js",scope:"/",updateCheckInterval:300*1e3},Et=!1;typeof navigator<"u"&&"serviceWorker"in navigator&&Lt();Zt=(t,o=100)=>{let c=new Map;return(...d)=>{let u=JSON.stringify(d);if(c.has(u))return c.get(u);let f=t(...d);if(c.size>=o){let g=c.keys().next().value;c.delete(g)}return c.set(u,f),f}},Xt=(t,o)=>{let c;return(...d)=>{clearTimeout(c),c=setTimeout(()=>t(...d),o)}},K=t=>{if(!t)return"";try{return String(t).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}catch{return String(t).toLowerCase()}},te=t=>{let o=`${t.name}-${t.category}`.toLowerCase(),c=0;for(let d=0;d<o.length;d++){let u=o.charCodeAt(d);c=(c<<5)-c+u,c=c&c}return`pid-${Math.abs(c)}`},G=t=>{let o=document.createElement("div");return o.textContent=t,o.innerHTML},ee="product-data",ne=()=>{try{return typeof localStorage>"u"?null:localStorage.getItem("productDataVersion")}catch(t){return console.warn("Unable to read stored product data version:",t),null}},Y=t=>{if(t)try{if(typeof localStorage>"u")return;localStorage.setItem("productDataVersion",t)}catch(o){console.warn("Unable to persist product data version:",o)}},re=()=>{if(typeof document>"u")return null;try{let t=document.getElementById(ee);if(!t||!t.textContent)return null;let o=t.textContent.trim();if(!o)return null;let c=JSON.parse(o);return!c||!Array.isArray(c.products)?null:c}catch(t){return k("warn","inline_product_parse_failure",{error:t.message}),null}},oe=(t,o)=>{let c=t.id||te(t),d=typeof t.originalIndex=="number"?t.originalIndex:typeof t.order=="number"?t.order:o;return{...t,id:c,name:G(t.name),description:G(t.description),category:G(t.category),categoryKey:t.categoryKey||K(t.category),originalIndex:d}},It=(t=[])=>t.map((o,c)=>oe(o,c)),F=class extends Error{constructor(o,{cause:c,correlationId:d}){super(o),this.name="ProductDataError",this.correlationId=d,c&&(this.cause=c)}},ae=async(t,o,c,d,u)=>{let f=new URL(t,window.location.origin);if(f.origin!==window.location.origin||f.protocol!=="https:")throw new Error("Invalid request URL: only same-origin HTTPS requests are allowed");let g=f.toString(),y=0,h;for(;y<=c;)try{let I=Date.now(),L=await fetch(g,o),x=Date.now()-I;if(k("info","fetch_products_attempt",{correlationId:u,attempt:y+1,durationMs:x}),!L.ok)throw new Error(`HTTP error. Status: ${L.status}`);return L}catch(I){if(h=I,y++,y>c)break;k("warn","fetch_products_retry",{correlationId:u,attempt:y,error:I.message,runbook:"RUNBOOK.md#product-data"}),await new Promise(L=>setTimeout(L,d*y))}throw new F(`Failed to fetch products: ${h.message}`,{cause:h,correlationId:u})},ie=async()=>{let t=vt(),o=re(),c=o?It(o.products):null,d=o?.version||null,u=ne(),f=Array.isArray(c),g=f?c.length:0;if(f&&(!d||!u||u===d))return d&&Y(d),k("info","fetch_products_inline",{correlationId:t,count:g}),c;try{let h=u||d||null,I=h?`/data/product_data.json?v=${encodeURIComponent(h)}`:"/data/product_data.json",x=await(await ae(I,{cache:"no-store",headers:{Accept:"application/json"}},2,300,t)).json(),H=It(x.products||[]);return x.version&&Y(x.version),k("info","fetch_products_success",{correlationId:t,count:H.length,source:"network"}),H}catch(h){if(f)return d&&Y(d),k("warn","fetch_products_network_fallback_inline",{correlationId:t,error:h.message,runbook:"RUNBOOK.md#product-data"}),c;throw k("error","fetch_products_failure",{correlationId:t,error:h.message,runbook:"RUNBOOK.md#product-data"}),v(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${h.message})`),h instanceof F?h:new F(h.message,{cause:h,correlationId:t})}},p=(t,o={},c=[])=>{let d=document.createElement(t);return Object.entries(o).forEach(([u,f])=>{u==="text"?d.textContent=f:d.setAttribute(u,f)}),c.forEach(u=>{typeof u=="string"?d.appendChild(document.createTextNode(u)):d.appendChild(u)}),d},v=t=>{let o=p("div",{class:"error-message",role:"alert"},[p("p",{},[t]),p("button",{class:"retry-button"},["Intentar nuevamente"])]),c=document.getElementById("product-container");c?(c.innerHTML="",c.appendChild(o),o.querySelector(".retry-button").addEventListener("click",Pt)):console.error("Contenedor de productos no encontrado")},_t=[];try{_t=JSON.parse(globalThis.localStorage?.getItem("cart"))||[]}catch{_t=[]}typeof window<"u"&&(window.__APP_READY__=!1,window.addEventListener("error",t=>{let o=t.target||t.srcElement,c=!!(o&&(o.tagName==="IMG"||o.tagName==="SCRIPT"||o.tagName==="LINK")),d=!!t.error;if(c||!d){console.warn("Ignored non-fatal error:",{tag:o&&o.tagName,src:o&&(o.src||o.href||o.currentSrc)});return}if(!window.__APP_READY__){console.error("Runtime error before app ready:",t.error);return}console.error("Unhandled JS error:",t.error),v("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")}),window.addEventListener("securitypolicyviolation",t=>{console.warn("CSP violation (logged only):",{blockedURI:t.blockedURI,violatedDirective:t.violatedDirective,sourceFile:t.sourceFile})}));Pt=async()=>{if(console.log("Initializing app..."),typeof DOMPurify>"u")try{await new Promise((e,n)=>{let a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.8/purify.min.js",a.integrity="sha384-AsiVBlzbaNOq8OOKcXm2ZVjjKJwiQ9UmzLwfetDjC74OMQdkb6vBHH5QRJH3x1SE",a.crossOrigin="anonymous",a.onload=e,a.onerror=n,document.head.appendChild(a)})}catch{console.warn("DOMPurify CDN blocked; using noop sanitizer"),window.DOMPurify={sanitize:n=>n}}let t=document.getElementById("navbar-container"),o=document.getElementById("footer-container"),c=document.getElementById("product-container"),d=document.getElementById("sort-options"),u=document.getElementById("filter-keyword"),f=()=>{let e=document.getElementById("filter-discount");if(e)return e;let n=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),a=n?n.querySelector(".row"):null;if(!a)return null;let i=p("div",{class:"col-12 mt-2"}),r=p("div",{class:"form-check form-switch"}),l=p("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),s=p("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return r.appendChild(l),r.appendChild(s),i.appendChild(r),a.appendChild(i),l},g=[],y=JSON.parse(localStorage.getItem("cart"))||[],h=()=>{let e=document.getElementById("offline-indicator");if(e){let n=navigator.onLine;e.classList.toggle("is-hidden",n),e.style.display=n?"none":"block"}navigator.onLine||console.log("App is offline. Using cached data if available.")},I=async(e,n)=>{if(!e){console.warn(`Contenedor no encontrado para el componente: ${n}`);return}try{let a=await fetch(n);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);let i=await a.text(),r=DOMPurify.sanitize(i,{USE_PROFILES:{html:!0},ALLOWED_TAGS:["div","span","p","h1","h2","h3","h4","h5","h6","ul","ol","li","a","img","br","strong","em","button","nav","footer","header","main","section"],ALLOWED_ATTR:["href","src","alt","class","id","style","aria-label","role","type","data-bs-toggle","data-bs-target","aria-controls","aria-expanded"]});e.innerHTML="";let s=new DOMParser().parseFromString(r,"text/html");Array.from(s.body.children).forEach(m=>{e.appendChild(m.cloneNode(!0))})}catch(a){throw console.error("Error al cargar componente:",{component:n,message:a.message}),a}};function L(){let e=document.getElementById("current-year");e&&(e.textContent=new Date().getFullYear())}let x=async()=>{try{await Promise.all([I(t,"/pages/navbar.html"),I(o,"/pages/footer.html")]),console.log("Components loaded successfully"),L()}catch(e){console.error("Error al cargar componentes:",e),v("Error al cargar los componentes de la p\xE1gina. Por favor, actualice la p\xE1gina o verifique su conexi\xF3n a internet.")}},H=(e,n,a="CLP")=>{let i=new Intl.NumberFormat("es-CL",{style:"currency",currency:a,minimumFractionDigits:0}),r=i.format(e);if(n){let l=e-n,s=i.format(l);return p("div",{class:"precio-container"},[p("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[s]),p("span",{class:"precio-original","aria-label":"Precio original"},[p("span",{class:"tachado"},[r])])])}return p("div",{class:"precio-container"},[p("span",{class:"precio","aria-label":"Precio"},[r])])},xt=e=>{let n=p("div",{class:"quantity-control",style:"display:none;"}),a=p("button",{class:"quantity-btn","data-action":"decrease","aria-label":"Decrease quantity"},["-"]),i=p("button",{class:"quantity-btn","data-action":"increase","aria-label":"Increase quantity"},["+"]),r=p("input",{type:"number",class:"quantity-input",value:Math.max($(e.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":e.id});return n.appendChild(a),n.appendChild(r),n.appendChild(i),n};function et(e,n){if(!e)return;let a=e.querySelector(".add-to-cart-btn"),i=e.querySelector(".quantity-control"),r=i?.querySelector(".quantity-input"),l=i?.querySelector('.quantity-btn[data-action="decrease"]')||i?.querySelector(".quantity-btn"),s=i?.querySelector('.quantity-btn[data-action="increase"]')||i?.querySelectorAll(".quantity-btn")?.[1],m=(b,P,q)=>{b&&b.dataset.listenerAttached!=="true"&&(b.addEventListener(P,q),b.dataset.listenerAttached="true")};m(a,"click",()=>{nt(n,1),D(a,i,!0)}),m(l,"click",()=>N(n,-1)),m(s,"click",()=>N(n,1)),m(r,"change",b=>{let P=parseInt(b.target.value,10);if(!Number.isFinite(P)){b.target.value=Math.max($(n.id),1);return}let q=$(n.id);N(n,P-q)});let w=$(n.id);r&&(r.value=w>0?w:1),D(a,i,w>0)}let $=e=>{let n=y.find(a=>a.id===e);return n?n.quantity:0},At=e=>{let n=document.createDocumentFragment();e.forEach(i=>{let{id:r,name:l,description:s,image_path:m,price:w,discount:b,stock:P}=i,q=p("div",{class:`producto col-12 col-sm-6 col-md-4 col-lg-3 mb-4 ${P?"":"agotado"}`,"aria-label":`Product: ${l}`,"data-product-id":r}),T=p("div",{class:"card"});if(b&&Number(b)>0){let S=Math.round(Number(b)/Number(w)*100),E=p("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(S)?S:0}%`]);T.appendChild(E)}let O=`/${m.replace(/^\//,"")}`,B=p("img",{src:R(O,{...U,width:400}),srcset:[`${R(O,{...U,width:200})} 200w`,`${R(O,{...U,width:400})} 400w`,`${R(O,{...U,width:800})} 800w`].join(", "),sizes:"(max-width: 640px) 200px, 400px",alt:l,class:"card-img-top product-thumb",loading:"lazy",decoding:"async",width:"400",height:"400"});T.appendChild(B);let C=p("div",{class:"card-body"});C.appendChild(p("h3",{class:"card-title"},[l])),C.appendChild(p("p",{class:"card-text"},[s])),C.appendChild(H(w,b));let z=p("div",{class:"action-area","data-pid":r}),j=p("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":r,"aria-label":`Add ${l} to cart`},["Agregar al carrito"]),J=xt(i);z.appendChild(j),z.appendChild(J),C.appendChild(z),et(z,i),T.appendChild(C),q.appendChild(T),n.appendChild(q)});let a=document.getElementById("product-container");a.innerHTML="",a.appendChild(n),Ot()},Tt=e=>{if(!c)return!1;let n=c.querySelectorAll("[data-product-id]");if(!n.length)return!1;let a=new Map(e.map(i=>[i.id,i]));return n.forEach(i=>{let r=i.getAttribute("data-product-id");if(!r||!a.has(r))return;let l=a.get(r),s=i.querySelector(".action-area");et(s,l)}),!0},Ot=()=>{let e=new IntersectionObserver((n,a)=>{n.forEach(i=>{if(i.isIntersecting){let r=i.target;r.src=r.dataset.src,r.dataset.srcset&&(r.srcset=r.dataset.srcset),r.dataset.sizes&&(r.sizes=r.dataset.sizes),r.classList.remove("lazyload"),a.unobserve(r)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(n=>e.observe(n))};function $t(e,n){if(!e||!n||e.length<3)return!1;let a=l=>l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),i=a(e),r=a(n);return r.includes(i)?!0:i.length>=4?Mt(i,r):!1}function Mt(e,n){return n.split(/\s+/).some(i=>{if(Math.abs(i.length-e.length)>1)return!1;let r=0,l=Math.max(i.length,e.length);if(Math.min(i.length,e.length)<4)return!1;if(i.length===e.length){for(let m=0;m<i.length;m++)if(i[m]!==e[m]&&r++,r>1)return!1;return r===1}else return Nt(e,i)})}function Nt(e,n){let a=e.length>n.length?e:n,i=e.length>n.length?n:e;if(a.length-i.length!==1)return!1;let r=0,l=0,s=0;for(;l<i.length&&s<a.length;)if(i[l]===a[s])l++,s++;else{if(r++,r>1)return!1;s++}return!0}let Dt=(e,n,a,i=!1)=>{let r=n.trim();return e.filter(l=>!l.stock||i&&!(l.discount&&Number(l.discount)>0)?!1:!r||l.name.toLowerCase().includes(r.toLowerCase())||l.description.toLowerCase().includes(r.toLowerCase())?!0:r.length>=4?$t(r,l.name):!1).sort((l,s)=>Bt(l,s,a))},Bt=(e,n,a)=>{if(!a||a==="original")return e.originalIndex-n.originalIndex;let[i,r]=a.split("-"),l=i==="price"?e.price-(e.discount||0):e.name.toLowerCase(),s=i==="price"?n.price-(n.discount||0):n.name.toLowerCase();return r==="asc"?l<s?-1:l>s?1:0:s<l?-1:s>l?1:0},zt=Zt(Dt),Q=()=>{try{let e=d.value||"original",n=u.value.trim(),a=document.getElementById("filter-discount")?.checked||!1,i=zt(g,n,e,a);At(i)}catch(e){console.error("Error al actualizar visualizaci\xF3n de productos:",e),v("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},V=Xt(Q,300),M=()=>{let e=document.getElementById("cart-count"),n=y.reduce((a,i)=>a+i.quantity,0);e.textContent=n,e.setAttribute("aria-label",`${n} items in cart`)},nt=(e,n)=>{try{let a=y.find(r=>r.id===e.id);a?a.quantity=Math.min(a.quantity+n,50):y.push({id:e.id,name:e.name,description:e.description,price:e.price,discount:e.discount,image_path:e.image_path,quantity:Math.min(n,50),category:e.category,stock:e.stock}),W(),M(),A();let i=document.querySelector(`[data-id="${e.id}"].quantity-input`);i&&(i.value=Math.max($(e.id),1))}catch(a){console.error("Error al agregar al carrito:",a),v("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},rt=e=>{try{y=y.filter(a=>a.id!==e),W(),M(),A();let n=document.querySelector(`.action-area[data-pid="${e}"]`);if(n){let a=n.querySelector(".add-to-cart-btn"),i=n.querySelector(".quantity-control");D(a,i,!1)}}catch(n){console.error("Error al eliminar del carrito:",n),v("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},N=(e,n)=>{try{let a=y.find(m=>m.id===e.id),i=a?a.quantity+n:1,r=document.querySelector(`.action-area[data-pid="${e.id}"]`),l=r?.querySelector(".add-to-cart-btn"),s=r?.querySelector(".quantity-control");if(i<=0)rt(e.id),D(l,s,!1);else if(i<=50){a?a.quantity=i:(nt(e,1),D(l,s,!0)),W(),M(),A();let m=document.querySelector(`[data-id="${e.id}"].quantity-input`);m&&(m.value=i,m.classList.add("quantity-changed"),setTimeout(()=>m.classList.remove("quantity-changed"),300))}}catch(a){console.error("Error al actualizar cantidad:",a),v("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},jt=()=>{try{y=[],W(),M(),A(),Q()}catch(e){console.error("Error al vaciar el carrito:",e),v("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},D=(e,n,a)=>{!e||!n||(a?(e.style.display="none",n.style.display="flex"):(n.style.display="none",e.style.display="flex"))},W=()=>{try{localStorage.setItem("cart",JSON.stringify(y))}catch(e){console.error("Error al guardar el carrito:",e),v("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},A=()=>{let e=document.getElementById("cart-items"),n=document.getElementById("cart-total");e.innerHTML="";let a=0;y.forEach(r=>{let l=r.price-(r.discount||0),s=p("div",{class:"cart-item mb-3 d-flex align-items-start","aria-label":`Cart item: ${r.name}`}),m=p("div",{class:"cart-item-content flex-grow-1"});m.appendChild(p("div",{class:"fw-bold mb-1"},[r.name]));let w=p("div",{class:"mb-2"}),b=p("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":r.id,"aria-label":`Disminuir cantidad de ${r.name}`},["-"]),P=p("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":r.id,"aria-label":`Aumentar cantidad de ${r.name}`},["+"]),q=p("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${r.name}`},[r.quantity.toString()]);w.appendChild(b),w.appendChild(q),w.appendChild(P),m.appendChild(w),m.appendChild(p("div",{class:"text-muted small"},[`Precio: $${l.toLocaleString("es-CL")}`])),m.appendChild(p("div",{class:"fw-bold"},[`Subtotal: $${(l*r.quantity).toLocaleString("es-CL")}`]));let T=p("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":r.id,"aria-label":`Eliminar ${r.name} del carrito`},["Eliminar"]);m.appendChild(T);let O=window.location.pathname.includes("/pages/"),B;O?B=`../${r.image_path.replace(/^\//,"")}`:B=r.image_path;let C=p("div",{class:"cart-item-thumb ms-3 flex-shrink-0"}),j={src:r.thumbnail_path||B,alt:r.name,class:"cart-item-thumb-img",loading:"lazy",decoding:"async",width:"100",height:"100"};if(Array.isArray(r.thumbnail_variants)){let S=r.thumbnail_variants.filter(E=>E&&E.url&&E.width).map(E=>`${E.url} ${E.width}w`);S.length&&(j.srcset=S.join(", "),j.sizes="100px")}let J=p("img",j);if(C.appendChild(J),s.appendChild(m),s.appendChild(C),e.appendChild(s),window.__DEBUG_CART__)try{let S=window.getComputedStyle(s),E=window.getComputedStyle(C),se=window.getComputedStyle(m),ot=C.getBoundingClientRect(),at=m.getBoundingClientRect();console.debug("[cart] item",{name:r.name,order:{firstIsContent:s.firstChild===m,lastIsThumb:s.lastChild===C},container:{display:S.display,flexDirection:S.flexDirection,flexWrap:S.flexWrap},thumb:{width:E.width,height:E.height,rect:{w:ot.width,h:ot.height}},content:{rect:{w:at.width,h:at.height}}})}catch{}a+=l*r.quantity}),n.textContent=`Total: $${a.toLocaleString("es-CL")}`,n.setAttribute("aria-label",`Total: $${a.toLocaleString("es-CL")}`);let i=document.getElementById("payment-credit-container");if(i)if(a>=3e4)i.classList.remove("d-none");else{i.classList.add("d-none");let r=i.querySelector("input");r&&(r.checked=!1)}},Rt=()=>{let e=document.querySelector('input[name="paymentMethod"]:checked');if(!e){alert("Por favor seleccione un m\xE9todo de pago");return}let n=`Mi pedido:

`;y.forEach(r=>{let l=r.price-(r.discount||0);n+=`${r.name}
`,n+=`Cantidad: ${r.quantity}
`,n+=`Precio unitario: $${l.toLocaleString("es-CL")}
`,n+=`Subtotal: $${(l*r.quantity).toLocaleString("es-CL")}

`});let a=y.reduce((r,l)=>r+(l.price-(l.discount||0))*l.quantity,0);n+=`Total: $${a.toLocaleString("es-CL")}
`,n+=`M\xE9todo de pago: ${e.value}`;let i=encodeURIComponent(n);window.open(`https://wa.me/56951118901?text=${i}`,"_blank")};try{if(await x(),g=await ie(),g.length===0){v("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}g=g.map((s,m)=>({...s,originalIndex:typeof s.originalIndex=="number"?s.originalIndex:m,categoryKey:s.categoryKey||K(s.category)}));let e=document.querySelector("main").dataset.category;if(e){let s=K(e);g=g.filter(m=>(m.categoryKey||K(m.category))===s).map((m,w)=>({...m,originalIndex:typeof m.originalIndex=="number"?m.originalIndex:w}))}d.addEventListener("change",V),u.addEventListener("input",V);let n=f();n&&n.addEventListener("change",V),Tt(g)||Q(),typeof window<"u"&&(window.__APP_READY__=!0),window.addEventListener("online",h),window.addEventListener("offline",h),h();let i=document.getElementById("cart-icon"),r=document.getElementById("empty-cart"),l=document.getElementById("submit-cart");i.addEventListener("click",()=>{if(typeof window.bootstrap<"u"&&window.bootstrap.Offcanvas){let s=new window.bootstrap.Offcanvas(document.getElementById("cartOffcanvas"));A(),s.show()}else{console.error("Bootstrap Offcanvas no est\xE1 disponible"),A();let s=document.getElementById("cartOffcanvas");s&&s.classList.add("show")}}),r.addEventListener("click",jt),l.addEventListener("click",Rt),document.getElementById("cart-items").addEventListener("click",s=>{let m=s.target,w=m.closest("[data-id]")?.dataset.id;w&&(m.classList.contains("decrease-quantity")?N({id:w},-1):m.classList.contains("increase-quantity")?N({id:w},1):m.classList.contains("remove-item")&&rt(w))}),M(),"performance"in window&&window.addEventListener("load",()=>{let s=performance.getEntriesByType("paint"),m=performance.getEntriesByType("navigation")[0];console.log("First Contentful Paint:",s[0].startTime),console.log("DOM Content Loaded:",m.domContentLoadedEventEnd),console.log("Load Time:",m.loadEventEnd)})}catch(e){console.error("Error al inicializar productos:",e),v("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document<"u"&&document.addEventListener("DOMContentLoaded",function(){Lt(),Pt().catch(t=>{console.error("Error al inicializar la aplicaci\xF3n:",t),v("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})})});var ce=Ut(()=>{ct();lt();ut();ft();gt();wt();qt();function kt(){let t=document.documentElement;try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-defer]').forEach(o=>{o.media="all",o.removeAttribute("data-defer")})}catch{}t.dataset.enhancementsInit!=="1"&&(t.dataset.enhancementsInit="1",it(),ht(),st(),dt(),pt(),mt(),yt())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",kt):kt()});ce();})();
