import{a as q,b as Oe}from"./chunks/chunk-UEKKBUIS.js";function Nt(){try{let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=`
      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */
      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }
      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }

      /* Contornos de enfoque claros para accesibilidad */
      .navbar .nav-link:focus,
      .navbar .dropdown-item:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* Espaciado entre botones en el offcanvas del carrito */
      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }
    `,document.head.appendChild(t)}catch(t){console.warn("[modules/enhancements] injectEnhancementStyles error:",t)}}var $t=q(()=>{});function jt(){try{document.addEventListener("keydown",e=>{e.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=".keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }",document.head.appendChild(t)}catch(t){console.warn("[modules/a11y] setupNavigationAccessibility error:",t)}}var zt=q(()=>{});function Ut(){try{"loading"in HTMLImageElement.prototype&&document.querySelectorAll("img:not([loading])").forEach(t=>{t.loading="lazy"})}catch(t){console.warn("[modules/perf] setupPerformanceOptimizations error:",t)}}var Rt=q(()=>{});function Te(){try{if(typeof window=="undefined")return null;let t=window[F];if(t&&Array.isArray(t.products))return t.products}catch(t){console.warn("[modules/seo] Unable to read shared product data:",t)}return null}function Be(t,e={}){var s,d;if(typeof window=="undefined"||!Array.isArray(t))return;let o=window[F]||{};window[F]={...o,products:t,version:(d=(s=e.version)!=null?s:o.version)!=null?d:null,updatedAt:e.updatedAt||Date.now(),source:e.source||o.source||"seo"}}function Ft(t=[]){let e={};return t.forEach(o=>{let s=o.id||String(o.name)+"-"+String(o.category);e[s]=o}),e}function Wt(){if(typeof window=="undefined")return;let t=window[F]||{};t.structuredDataInjected||(window[F]={...t,structuredDataInjected:!0})}async function Me(){try{let t=Te();if(t)return Ft(t);let e=localStorage.getItem("productDataVersion"),o=e?`/data/product_data.json?v=${encodeURIComponent(e)}`:"/data/product_data.json",s=await fetch(o,{cache:"no-store",headers:{Accept:"application/json"}});if(!s.ok)return null;let d=await s.json(),u=Array.isArray(d==null?void 0:d.products)?d.products:Array.isArray(d)?d:[];return Be(u,{version:(d==null?void 0:d.version)||e||null,source:"seo-fallback"}),Ft(u)}catch(t){return console.error("[modules/seo] Error loading product data:",t),null}}async function Vt(){try{if(document.querySelector('script[type="application/ld+json"]')){Wt();return}let t=typeof window!="undefined"?window[F]:null;if(t!=null&&t.structuredDataInjected)return;let e=await Me();if(!e)return;let s=Object.values(e).slice(0,20).map(b=>({"@type":"Product",name:b.name,image:b.image_path,description:b.description,brand:b.brand||"Gen\xE9rico",offers:{"@type":"Offer",price:b.price,priceCurrency:"CLP",availability:b.stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}})),d={"@context":"https://schema.org","@graph":[{"@type":"Store",name:"El Rinc\xF3n de \xC9bano",image:"https://elrincondeebano.com/assets/images/web/logo.webp",description:"Un minimarket en la puerta de tu departamento",address:{"@type":"PostalAddress",addressCountry:"CL"},telephone:"+56951118901",url:"http://www.elrincondeebano.com/",contactPoint:{"@type":"ContactPoint",telephone:"+56-951118901",contactType:"customer service"}},...s]},u=document.createElement("script");u.type="application/ld+json",window&&window.__CSP_NONCE__&&u.setAttribute("nonce",window.__CSP_NONCE__),u.textContent=JSON.stringify(d),document.head.appendChild(u),Wt()}catch(t){console.error("[modules/seo] Error generating structured data:",t)}}function Ht(){try{if(!document.querySelector('link[rel="canonical"]')){let t=document.createElement("link");t.rel="canonical",t.href=location.origin+location.pathname,document.head.appendChild(t)}if(!document.querySelector('meta[name="description"]')){let t=document.createElement("meta");t.name="description",t.content="El Rinc\xF3n de \xC9bano - Minimarket con delivery instant\xE1neo.",document.head.appendChild(t)}}catch(t){console.warn("[modules/seo] injectSeoMetadata error:",t)}}var F,Kt=q(()=>{F="__PRODUCT_DATA__"});function Gt(){try{if(!document.querySelector('link[rel="manifest"]')){let t=document.createElement("link");t.rel="manifest",t.href="/app.webmanifest",document.head.appendChild(t)}}catch(t){console.warn("[modules/pwa] injectPwaManifest error:",t)}}var Qt=q(()=>{});function Jt(){var t;try{(t=window==null?void 0:window.console)!=null&&t.debug&&console.debug("[modules/checkout] setupCheckoutProgress: no-op")}catch(e){}}var Yt=q(()=>{});function ut(t){if(t&&typeof t=="object"){if(t.default)return t.default;let e=Object.keys(t);if(e.length===1)return t[e[0]]}return t}function ft(t,e){return!t||!e?null:typeof t.getOrCreateInstance=="function"?t.getOrCreateInstance(e):new t(e)}function De(t){return t?typeof t=="string"?document.querySelector(t):t:null}function pt(t,e){return Xt.has(t)?Xt.get(t)():e()}async function Ne(){st||(st=pt("collapse",()=>import("./chunks/collapse-WPMC5TZR.js")));let t=await st;return ut(t)}async function $e(){lt||(lt=pt("dropdown",()=>import("./chunks/dropdown-R2NJQXAD.js")));let t=await lt;return ut(t)}async function je(){dt||(dt=pt("offcanvas",()=>import("./chunks/offcanvas-DDZSWNE5.js")));let t=await dt;return ut(t)}function ze(){document.querySelectorAll('[data-bs-toggle="collapse"][data-bs-target]').forEach(e=>{e.addEventListener("click",()=>{Ue(e)})})}async function Ue(t){var e;try{let o=t.getAttribute("data-bs-target");if(!o)return;let s=document.querySelector(o);if(!s)return;let d=await Ne(),u=ft(d,s);(e=u==null?void 0:u.toggle)==null||e.call(u)}catch(o){console.error("No se pudo inicializar el Collapse de Bootstrap",o)}}function Re(){document.querySelectorAll('[data-bs-toggle="dropdown"]').forEach(e=>{e.addEventListener("click",o=>{o.preventDefault(),Fe(e)})})}async function Fe(t){var e;try{let o=await $e(),s=ft(o,t);(e=s==null?void 0:s.toggle)==null||e.call(s)}catch(o){console.error("No se pudo inicializar el Dropdown de Bootstrap",o)}}function te(){Zt||(Zt=!0,typeof document!="undefined"&&(ze(),Re()))}async function ee(t){if(typeof document=="undefined")throw new Error("Offcanvas no disponible en este entorno");let e=De(t);if(!e)throw new Error("No se encontr\xF3 el elemento de Offcanvas");let o=await je(),s=ft(o,e);if(!s||typeof s.show!="function")throw new Error("Instancia de Offcanvas inv\xE1lida");return s.show(),s}var Zt,Xt,st,lt,dt,mt=q(()=>{Zt=!1,Xt=new Map,st=null,lt=null,dt=null});function Q(t,e={}){let o=t.startsWith("/")?t:"/"+t,s=Object.entries(e).map(([u,b])=>`${u}=${b}`).join(","),d=o.split("/").map(encodeURIComponent).join("/");return`/cdn-cgi/image/${s}${d}`}var J,ne=q(()=>{J={fit:"cover",quality:82,format:"auto"}});function re(){return`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function M(t,e,o={}){let s={level:t,message:e,...o},d=JSON.stringify(s);typeof console[t]=="function"?console[t](d):console.log(d)}var oe=q(()=>{});function Ct(){if(typeof window!="undefined"){let t=window[de];if(t&&Array.isArray(t.products))return t}return nt&&Array.isArray(nt.products)?nt:null}function ue(t,e={},{force:o=!1}={}){if(!Array.isArray(t))return null;let s={products:t,version:e.version||null,source:e.source||null,updatedAt:e.updatedAt||Date.now(),isPartial:!!e.isPartial,total:typeof e.total=="number"?e.total:null},d=Ct();if(d&&!o){let u=d.version||null,b=s.version||null;if(!b&&u||!b&&!u||b&&u===b)return d}return nt=s,typeof window!="undefined"&&(window[de]={...s}),s}function wt(t,e={}){return ue(t,e,{force:!1})}function We(t,e={}){return ue(t,e,{force:!0})}function fe(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}if(ae)return;ae=!0;let t=async()=>{if(document.readyState==="complete"){window.removeEventListener("load",t);try{await Ve()}catch(e){console.error("Service Worker initialization failed:",e),Ye("Failed to initialize service worker. Some features may not work offline.")}}};window.addEventListener("load",t),t()}async function Ve(){try{let t=await navigator.serviceWorker.register(vt.path,{scope:vt.scope});console.log("ServiceWorker registered successfully:",t.scope),He(t),Ke(t),Ge(),Qe()}catch(t){throw console.error("ServiceWorker registration failed:",t),t}}function He(t){t.addEventListener("updatefound",()=>{let e=t.installing;e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&e.postMessage({type:"SKIP_WAITING"})})})}function Ke(t){ie(t),setInterval(()=>{ie(t)},vt.updateCheckInterval)}async function ie(t){var e;try{await t.update();let o=await fetch("/data/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(o.ok){let d=(await o.json()).version,u=localStorage.getItem("productDataVersion");d!==u&&((e=t.active)==null||e.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",d),Je(null,"New product data available"))}}catch(o){console.warn("Update check failed:",o)}}function Ge(){let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}function Qe(){let t=document.getElementById("offline-indicator");if(!t)return;let e=()=>{let o=navigator.onLine;t.classList.toggle(P.hidden,o),t.classList.toggle(P.block,!o),o||Ze("You are currently offline. Some features may be limited.")};window.addEventListener("online",e),window.addEventListener("offline",e),navigator.onLine||e()}function Et(){return gt||(gt=import("./chunks/notifications-TB3YOT4W.js")),gt}function Je(t,e="Una versi\xF3n est\xE1 disponible"){Et().then(o=>o.showUpdateNotification(t,e))}function Ye(t){Et().then(e=>e.showServiceWorkerError(t))}function Ze(t){Et().then(e=>e.showConnectivityNotification(t))}function cn(){let t=Ct();if(t)return t;let e=pe();if(!e||!Array.isArray(e.initialProducts))return null;let o=bt(e.initialProducts);return wt(o,{version:e.version||null,source:"inline",isPartial:!0,total:typeof e.totalProducts=="number"?e.totalProducts:o.length})}var de,nt,P,vt,ae,gt,Xe,ht,tn,en,z,nn,yt,rn,on,ce,pe,an,bt,Y,sn,ln,f,A,se,le,me,ge=q(()=>{ne();oe();mt();de="__PRODUCT_DATA__",nt=null,P=Object.freeze({hidden:"is-hidden",flex:"is-flex",block:"is-block",contentVisible:"has-content-visibility",containIntrinsic:"has-contain-intrinsic"});vt={path:"/service-worker.js",scope:"/",updateCheckInterval:300*1e3},ae=!1;gt=null;typeof navigator!="undefined"&&"serviceWorker"in navigator&&fe();Xe=t=>typeof t=="object"&&t!==null||typeof t=="function",ht=()=>({map:new Map,weakMap:new WeakMap,hasValue:!1,value:void 0}),tn=(t,e=100)=>{if(typeof t!="function")throw new TypeError("Expected a function to memoize");(!Number.isFinite(e)||e<0)&&(e=0);let o=ht(),s=[],d=y=>{let w=s.indexOf(y);w!==-1&&s.splice(w,1),e>0&&s.push(y)},u=()=>{if(e!==0)for(;s.length>e;){let y=s.shift();y&&(y.hasValue=!1,y.value=void 0)}},b=(y,w)=>{if(Xe(w)){let v=y.weakMap.get(w);return v||(v=ht(),y.weakMap.set(w,v)),v}return y.map.has(w)||y.map.set(w,ht()),y.map.get(w)};return(...y)=>{if(e===0)return t(...y);let w=o;for(let v=0;v<y.length;v+=1)w=b(w,y[v]);if(w.hasValue)return d(w),w.value;let _=t(...y);return w.value=_,w.hasValue=!0,d(w),u(),_}},en=(t,e)=>{let o;return(...s)=>{clearTimeout(o),o=setTimeout(()=>t(...s),e)}},z=t=>{if(!t)return"";try{return String(t).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}catch(e){return String(t).toLowerCase()}},nn=t=>{let e=`${t.name}-${t.category}`.toLowerCase(),o=0;for(let s=0;s<e.length;s++){let d=e.charCodeAt(s);o=(o<<5)-o+d,o=o&o}return`pid-${Math.abs(o)}`},yt=t=>{let e=document.createElement("div");return e.textContent=t,e.innerHTML},rn="product-data",on=()=>{try{return typeof localStorage=="undefined"?null:localStorage.getItem("productDataVersion")}catch(t){return console.warn("Unable to read stored product data version:",t),null}},ce=t=>{if(t)try{if(typeof localStorage=="undefined")return;localStorage.setItem("productDataVersion",t)}catch(e){console.warn("Unable to persist product data version:",e)}},pe=()=>{if(typeof document=="undefined")return null;try{let t=document.getElementById(rn);if(!t||!t.textContent)return null;let e=t.textContent.trim();if(!e)return null;let o=JSON.parse(e);return o?Array.isArray(o.initialProducts)?o:Array.isArray(o.products)?{...o,initialProducts:o.products}:null:null}catch(t){return M("warn","inline_product_parse_failure",{error:t.message}),null}},an=(t,e)=>{let o=t.id||nn(t),s=typeof t.originalIndex=="number"?t.originalIndex:typeof t.order=="number"?t.order:e;return{...t,id:o,name:yt(t.name),description:yt(t.description),category:yt(t.category),categoryKey:t.categoryKey||z(t.category),originalIndex:s}},bt=(t=[])=>t.map((e,o)=>an(e,o));cn();Y=class extends Error{constructor(e,{cause:o,correlationId:s}){super(e),this.name="ProductDataError",this.correlationId=s,o&&(this.cause=o)}},sn=async(t,e,o,s,d)=>{let u=new URL(t,window.location.origin);if(u.origin!==window.location.origin||u.protocol!=="https:")throw new Error("Invalid request URL: only same-origin HTTPS requests are allowed");let b=u.toString(),y=0,w;for(;y<=o;)try{let _=Date.now(),v=await fetch(b,e),E=Date.now()-_;if(M("info","fetch_products_attempt",{correlationId:d,attempt:y+1,durationMs:E}),!v.ok)throw new Error(`HTTP error. Status: ${v.status}`);return v}catch(_){if(w=_,y++,y>o)break;M("warn","fetch_products_retry",{correlationId:d,attempt:y,error:_.message,runbook:"RUNBOOK.md#product-data"}),await new Promise(v=>setTimeout(v,s*y))}throw new Y(`Failed to fetch products: ${w.message}`,{cause:w,correlationId:d})},ln=async()=>{let t=re(),e=pe(),o=(e==null?void 0:e.initialProducts)||null,s=(e==null?void 0:e.version)||null,d=typeof(e==null?void 0:e.totalProducts)=="number"?e.totalProducts:null,u=Array.isArray(o)?bt(o):null,b=Array.isArray(u),y=on();b&&(s&&ce(s),wt(u,{version:s||null,source:"inline",isPartial:!0,total:d!=null?d:u.length}),M("info","fetch_products_inline_bootstrap",{correlationId:t,count:u.length}));let w=y||s||null,_=w?`/data/product_data.json?v=${encodeURIComponent(w)}`:"/data/product_data.json";try{let E=await(await sn(_,{cache:"no-store",headers:{Accept:"application/json"}},2,300,t)).json(),S=bt(E.products||[]);return We(S,{version:E.version||null,source:"network",isPartial:!1,total:S.length}),E.version&&ce(E.version),M("info","fetch_products_success",{correlationId:t,count:S.length,source:"network"}),S}catch(v){if(b)return wt(u,{version:s||null,source:"inline-fallback",isPartial:!0,total:d!=null?d:u.length}),M("warn","fetch_products_network_fallback_inline",{correlationId:t,error:v.message,runbook:"RUNBOOK.md#product-data"}),u;throw M("error","fetch_products_failure",{correlationId:t,error:v.message,runbook:"RUNBOOK.md#product-data"}),A(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${v.message})`),v instanceof Y?v:new Y(v.message,{cause:v,correlationId:t})}},f=(t,e={},o=[])=>{let s=document.createElement(t);return Object.entries(e).forEach(([d,u])=>{d==="text"?s.textContent=u:s.setAttribute(d,u)}),o.forEach(d=>{typeof d=="string"?s.appendChild(document.createTextNode(d)):s.appendChild(d)}),s},A=t=>{let e=f("div",{class:"error-message",role:"alert"},[f("p",{},[t]),f("button",{class:"retry-button"},["Intentar nuevamente"])]),o=document.getElementById("product-container");o?(o.innerHTML="",o.appendChild(e),e.querySelector(".retry-button").addEventListener("click",me)):console.error("Contenedor de productos no encontrado")},se=[];try{se=JSON.parse((le=globalThis.localStorage)==null?void 0:le.getItem("cart"))||[]}catch(t){se=[]}typeof window!="undefined"&&(window.__APP_READY__=!1,window.addEventListener("error",t=>{let e=t.target||t.srcElement,o=!!(e&&(e.tagName==="IMG"||e.tagName==="SCRIPT"||e.tagName==="LINK")),s=!!t.error;if(o||!s){console.warn("Ignored non-fatal error:",{tag:e&&e.tagName,src:e&&(e.src||e.href||e.currentSrc)});return}if(!window.__APP_READY__){console.error("Runtime error before app ready:",t.error);return}console.error("Unhandled JS error:",t.error),A("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")}),window.addEventListener("securitypolicyviolation",t=>{console.warn("CSP violation (logged only):",{blockedURI:t.blockedURI,violatedDirective:t.violatedDirective,sourceFile:t.sourceFile})}));me=async()=>{var qt,Ot,Tt;console.log("Initializing app...");let t=document.getElementById("product-container"),e=document.getElementById("sort-options"),o=document.getElementById("filter-keyword"),s=document.getElementById("cart-count"),d=document.getElementById("cart-items"),u=document.getElementById("cart-total"),y=Object.entries({"#product-container":t,"#sort-options":e,"#filter-keyword":o,"#cart-count":s,"#cart-items":d,"#cart-total":u}).filter(([,n])=>!n).map(([n])=>n);if(y.length){M("warn","init_app_missing_dom",{missingSelectors:y,location:typeof window!="undefined"?(qt=window.location)==null?void 0:qt.pathname:"unknown"});return}let w=()=>{let n=document.getElementById("filter-discount");if(n)return n;let a=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),c=a?a.querySelector(".row"):null;if(!c)return null;let i=f("div",{class:"col-12 mt-2"}),r=f("div",{class:"form-check form-switch"}),l=f("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),p=f("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return r.appendChild(l),r.appendChild(p),i.appendChild(r),c.appendChild(i),l},_=12,v=12,E=[],S=[],D=0,St=_,U=null,Z=null,X=null,tt=!1,L=JSON.parse(localStorage.getItem("cart"))||[],rt=()=>{let n=document.getElementById("offline-indicator");if(n){let a=navigator.onLine;n.classList.toggle(P.hidden,a),n.classList.toggle(P.block,!a)}navigator.onLine||console.log("App is offline. Using cached data if available.")};function ye(){let n=document.getElementById("current-year");n&&(n.textContent=new Date().getFullYear())}let we=(n,a,c="CLP")=>{let i=new Intl.NumberFormat("es-CL",{style:"currency",currency:c,minimumFractionDigits:0}),r=i.format(n);if(a){let l=n-a,p=i.format(l);return f("div",{class:"precio-container"},[f("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[p]),f("span",{class:"precio-original","aria-label":"Precio original"},[f("span",{class:"tachado"},[r])])])}return f("div",{class:"precio-container"},[f("span",{class:"precio","aria-label":"Precio"},[r])])},ve=n=>{let a=f("div",{class:`quantity-control ${P.hidden}`}),c=f("button",{class:"quantity-btn","data-action":"decrease","aria-label":"Decrease quantity"},["-"]),i=f("button",{class:"quantity-btn","data-action":"increase","aria-label":"Increase quantity"},["+"]),r=f("input",{type:"number",class:"quantity-input",value:Math.max(W(n.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":n.id});return a.appendChild(c),a.appendChild(r),a.appendChild(i),a};function It(n,a){var k;if(!n)return;let c=n.querySelector(".add-to-cart-btn"),i=n.querySelector(".quantity-control"),r=i==null?void 0:i.querySelector(".quantity-input"),l=(i==null?void 0:i.querySelector('.quantity-btn[data-action="decrease"]'))||(i==null?void 0:i.querySelector(".quantity-btn")),p=(i==null?void 0:i.querySelector('.quantity-btn[data-action="increase"]'))||((k=i==null?void 0:i.querySelectorAll(".quantity-btn"))==null?void 0:k[1]),g=(h,m,C)=>{h&&h.dataset.listenerAttached!=="true"&&(h.addEventListener(m,C),h.dataset.listenerAttached="true")};g(c,"click",()=>{xt(a,1),K(c,i,!0)}),g(l,"click",()=>H(a,-1)),g(p,"click",()=>H(a,1)),g(r,"change",h=>{let m=parseInt(h.target.value,10);if(!Number.isFinite(m)){h.target.value=Math.max(W(a.id),1);return}let C=W(a.id);H(a,m-C)});let I=W(a.id);r&&(r.value=I>0?I:1),K(c,i,I>0)}let W=n=>{let a=L.find(c=>c.id===n);return a?a.quantity:0},be=(n,{reset:a=!1}={})=>{if(!t)return 0;a&&(t.innerHTML="");let c=document.createDocumentFragment();return n.forEach(i=>{let{id:r,name:l,description:p,image_path:g,price:I,discount:k,stock:h}=i,m=["producto","col-12","col-sm-6","col-md-4","col-lg-3","mb-4",h?"":"agotado",P.contentVisible,P.containIntrinsic].filter(Boolean).join(" "),C=f("div",{class:m,"aria-label":`Product: ${l}`,"data-product-id":r}),T=f("div",{class:"card"});if(k&&Number(k)>0){let x=Math.round(Number(k)/Number(I)*100),Bt=f("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(x)?x:0}%`]);T.appendChild(Bt)}let N=`/${g.replace(/^\//,"")}`,j=f("img",{src:Q(N,{...J,width:400}),srcset:[`${Q(N,{...J,width:200})} 200w`,`${Q(N,{...J,width:400})} 400w`,`${Q(N,{...J,width:800})} 800w`].join(", "),sizes:"(min-width: 1200px) 25vw, (min-width: 992px) 33vw, (min-width: 576px) 50vw, 100vw",alt:l,class:"card-img-top product-thumb",loading:"lazy",fetchpriority:"auto",decoding:"async",width:"400",height:"400"});T.appendChild(j);let R=f("div",{class:"card-body"});R.appendChild(f("h3",{class:"card-title"},[l])),R.appendChild(f("p",{class:"card-text"},[p])),R.appendChild(we(I,k));let $=f("div",{class:"action-area","data-pid":r}),ct=f("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":r,"aria-label":`Add ${l} to cart`},["Agregar al carrito"]),B=ve(i);$.appendChild(ct),$.appendChild(B),R.appendChild($),It($,i),T.appendChild(R),C.appendChild(T),c.appendChild(C)}),t.appendChild(c),Se(),n.length},Ce=n=>{if(!t)return 0;let a=t.querySelectorAll("[data-product-id]");if(!a.length)return 0;let c=new Map(n.map(r=>[r.id,r])),i=0;return a.forEach(r=>{let l=r.getAttribute("data-product-id");if(!l||!c.has(l))return;let p=c.get(l);r.classList.add(P.contentVisible,P.containIntrinsic);let g=r.querySelector(".action-area");It(g,p),i+=1}),i},_t=()=>{t&&(t.innerHTML=""),D=0},ot=()=>{var i,r,l;let n=(e==null?void 0:e.value)||"original",a=((r=(i=o==null?void 0:o.value)==null?void 0:i.trim)==null?void 0:r.call(i))||"",c=((l=document.getElementById("filter-discount"))==null?void 0:l.checked)||!1;S=xe(E,a,n,c)},Pt=n=>{if(!Array.isArray(S)||S.length===0)return O(),!1;let a=D;if(a>=S.length)return O(),!1;let c=S.slice(a,a+n);return c.length?(be(c),D+=c.length,O(),!0):(O(),!1)},at=()=>Pt(St||_),Lt=()=>Pt(v),O=()=>{let n=D<S.length;U&&(U.classList.toggle("d-none",!n),U.disabled=!n),X&&Z&&(X.disconnect(),n&&X.observe(Z))},Ee=()=>{U=document.getElementById("catalog-load-more"),Z=document.getElementById("catalog-sentinel"),U&&U.addEventListener("click",()=>{Lt()}),Z&&(X=new IntersectionObserver(n=>{n.forEach(a=>{a.isIntersecting&&Lt()})},{rootMargin:"200px"})),O()},Se=()=>{let n=new IntersectionObserver((a,c)=>{a.forEach(i=>{if(i.isIntersecting){let r=i.target;r.src=r.dataset.src,r.dataset.srcset&&(r.srcset=r.dataset.srcset),r.dataset.sizes&&(r.sizes=r.dataset.sizes),r.classList.remove("lazyload"),c.unobserve(r)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(a=>n.observe(a))};function Ie(n,a){if(!n||!a||n.length<3)return!1;let c=l=>l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),i=c(n),r=c(a);return r.includes(i)?!0:i.length>=4?_e(i,r):!1}function _e(n,a){return a.split(/\s+/).some(i=>{if(Math.abs(i.length-n.length)>1)return!1;let r=0,l=Math.max(i.length,n.length);if(Math.min(i.length,n.length)<4)return!1;if(i.length===n.length){for(let g=0;g<i.length;g++)if(i[g]!==n[g]&&r++,r>1)return!1;return r===1}else return Pe(n,i)})}function Pe(n,a){let c=n.length>a.length?n:a,i=n.length>a.length?a:n;if(c.length-i.length!==1)return!1;let r=0,l=0,p=0;for(;l<i.length&&p<c.length;)if(i[l]===c[p])l++,p++;else{if(r++,r>1)return!1;p++}return!0}let Le=(n,a,c,i=!1)=>{let r=a.trim();return n.filter(l=>!l.stock||i&&!(l.discount&&Number(l.discount)>0)?!1:!r||l.name.toLowerCase().includes(r.toLowerCase())||l.description.toLowerCase().includes(r.toLowerCase())?!0:r.length>=4?Ie(r,l.name):!1).sort((l,p)=>ke(l,p,c))},ke=(n,a,c)=>{if(!c||c==="original")return n.originalIndex-a.originalIndex;let[i,r]=c.split("-"),l=i==="price"?n.price-(n.discount||0):n.name.toLowerCase(),p=i==="price"?a.price-(a.discount||0):a.name.toLowerCase();return r==="asc"?l<p?-1:l>p?1:0:p<l?-1:p>l?1:0},xe=tn(Le),kt=()=>{try{if(ot(),_t(),!S.length){O();return}at()}catch(n){console.error("Error al actualizar visualizaci\xF3n de productos:",n),A("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},it=en(kt,300),V=()=>{let n=document.getElementById("cart-count"),a=L.reduce((c,i)=>c+i.quantity,0);n.textContent=a,n.setAttribute("aria-label",`${a} items in cart`)},xt=(n,a)=>{try{let c=L.find(r=>r.id===n.id);c?c.quantity=Math.min(c.quantity+a,50):L.push({id:n.id,name:n.name,description:n.description,price:n.price,discount:n.discount,image_path:n.image_path,quantity:Math.min(a,50),category:n.category,stock:n.stock}),et(),V(),G();let i=document.querySelector(`[data-id="${n.id}"].quantity-input`);i&&(i.value=Math.max(W(n.id),1))}catch(c){console.error("Error al agregar al carrito:",c),A("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},At=n=>{try{L=L.filter(c=>c.id!==n),et(),V(),G();let a=document.querySelector(`.action-area[data-pid="${n}"]`);if(a){let c=a.querySelector(".add-to-cart-btn"),i=a.querySelector(".quantity-control");K(c,i,!1)}}catch(a){console.error("Error al eliminar del carrito:",a),A("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},H=(n,a)=>{try{let c=L.find(g=>g.id===n.id),i=c?c.quantity+a:1,r=document.querySelector(`.action-area[data-pid="${n.id}"]`),l=r==null?void 0:r.querySelector(".add-to-cart-btn"),p=r==null?void 0:r.querySelector(".quantity-control");if(i<=0)At(n.id),K(l,p,!1);else if(i<=50){c?c.quantity=i:(xt(n,1),K(l,p,!0)),et(),V(),G();let g=document.querySelector(`[data-id="${n.id}"].quantity-input`);g&&(g.value=i,g.classList.add("quantity-changed"),setTimeout(()=>g.classList.remove("quantity-changed"),300))}}catch(c){console.error("Error al actualizar cantidad:",c),A("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},Ae=()=>{try{L=[],et(),V(),G(),kt()}catch(n){console.error("Error al vaciar el carrito:",n),A("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},K=(n,a,c)=>{if(!n||!a)return;let i=!c;n.classList.toggle(P.hidden,!i),n.classList.toggle(P.flex,i),a.classList.toggle(P.hidden,!c),a.classList.toggle(P.flex,c)},et=()=>{try{localStorage.setItem("cart",JSON.stringify(L))}catch(n){console.error("Error al guardar el carrito:",n),A("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},G=()=>{let n=document.getElementById("cart-items"),a=document.getElementById("cart-total");n.innerHTML="";let c=0;L.forEach(r=>{let l=r.price-(r.discount||0),p=f("div",{class:"cart-item mb-3 d-flex align-items-start","aria-label":`Cart item: ${r.name}`}),g=f("div",{class:"cart-item-content flex-grow-1"});g.appendChild(f("div",{class:"fw-bold mb-1"},[r.name]));let I=f("div",{class:"mb-2"}),k=f("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":r.id,"aria-label":`Disminuir cantidad de ${r.name}`},["-"]),h=f("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":r.id,"aria-label":`Aumentar cantidad de ${r.name}`},["+"]),m=f("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${r.name}`},[r.quantity.toString()]);I.appendChild(k),I.appendChild(m),I.appendChild(h),g.appendChild(I),g.appendChild(f("div",{class:"text-muted small"},[`Precio: $${l.toLocaleString("es-CL")}`])),g.appendChild(f("div",{class:"fw-bold"},[`Subtotal: $${(l*r.quantity).toLocaleString("es-CL")}`]));let C=f("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":r.id,"aria-label":`Eliminar ${r.name} del carrito`},["Eliminar"]);g.appendChild(C);let T=window.location.pathname.includes("/pages/"),N;T?N=`../${r.image_path.replace(/^\//,"")}`:N=r.image_path;let j=f("div",{class:"cart-item-thumb ms-3 flex-shrink-0"}),$={src:r.thumbnail_path||N,alt:r.name,class:"cart-item-thumb-img",loading:"lazy",decoding:"async",width:"100",height:"100"};if(Array.isArray(r.thumbnail_variants)){let B=r.thumbnail_variants.filter(x=>x&&x.url&&x.width).map(x=>`${x.url} ${x.width}w`);B.length&&($.srcset=B.join(", "),$.sizes="100px")}let ct=f("img",$);if(j.appendChild(ct),p.appendChild(g),p.appendChild(j),n.appendChild(p),window.__DEBUG_CART__)try{let B=window.getComputedStyle(p),x=window.getComputedStyle(j),Bt=window.getComputedStyle(g),Mt=j.getBoundingClientRect(),Dt=g.getBoundingClientRect();console.debug("[cart] item",{name:r.name,order:{firstIsContent:p.firstChild===g,lastIsThumb:p.lastChild===j},container:{display:B.display,flexDirection:B.flexDirection,flexWrap:B.flexWrap},thumb:{width:x.width,height:x.height,rect:{w:Mt.width,h:Mt.height}},content:{rect:{w:Dt.width,h:Dt.height}}})}catch(B){}c+=l*r.quantity}),a.textContent=`Total: $${c.toLocaleString("es-CL")}`,a.setAttribute("aria-label",`Total: $${c.toLocaleString("es-CL")}`);let i=document.getElementById("payment-credit-container");if(i)if(c>=3e4)i.classList.remove("d-none");else{i.classList.add("d-none");let r=i.querySelector("input");r&&(r.checked=!1)}},qe=()=>{let n=document.querySelector('input[name="paymentMethod"]:checked');if(!n){alert("Por favor seleccione un m\xE9todo de pago");return}let a=`Mi pedido:

`;L.forEach(r=>{let l=r.price-(r.discount||0);a+=`${r.name}
`,a+=`Cantidad: ${r.quantity}
`,a+=`Precio unitario: $${l.toLocaleString("es-CL")}
`,a+=`Subtotal: $${(l*r.quantity).toLocaleString("es-CL")}

`});let c=L.reduce((r,l)=>r+(l.price-(l.discount||0))*l.quantity,0);a+=`Total: $${c.toLocaleString("es-CL")}
`,a+=`M\xE9todo de pago: ${n.value}`;let i=encodeURIComponent(a);window.open(`https://wa.me/56951118901?text=${i}`,"_blank")};try{ye();let n=Ct();(Ot=n==null?void 0:n.products)!=null&&Ot.length&&(E=n.products.map((h,m)=>({...h,originalIndex:typeof h.originalIndex=="number"?h.originalIndex:m,categoryKey:h.categoryKey||z(h.category)})));let a=document.querySelector("main"),c=((Tt=a==null?void 0:a.dataset)==null?void 0:Tt.category)||"";if(c){let h=z(c);E=E.filter(m=>(m.categoryKey||z(m.category))===h).map((m,C)=>({...m,originalIndex:typeof m.originalIndex=="number"?m.originalIndex:C}))}let i=Ce(E);i>0?(D=i,St=i):D=0,Ee(),ot(),O(),D===0&&S.length&&at();let r=ln();e.addEventListener("change",()=>{tt=!0,it()}),o.addEventListener("input",()=>{tt=!0,it()});let l=w();l&&l.addEventListener("change",()=>{tt=!0,it()});let p=await r;if(!Array.isArray(p)||p.length===0){if(!E.length){A("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}}else if(E=p.map((h,m)=>({...h,originalIndex:typeof h.originalIndex=="number"?h.originalIndex:m,categoryKey:h.categoryKey||z(h.category)})),c){let h=z(c);E=E.filter(m=>(m.categoryKey||z(m.category))===h).map((m,C)=>({...m,originalIndex:typeof m.originalIndex=="number"?m.originalIndex:C}))}ot(),tt||D===0?(_t(),S.length?at():O()):O(),typeof window!="undefined"&&(window.__APP_READY__=!0),window.addEventListener("online",rt),window.addEventListener("offline",rt),rt();let g=document.getElementById("cart-icon"),I=document.getElementById("empty-cart"),k=document.getElementById("submit-cart");g&&g.addEventListener("click",async()=>{G();try{await ee("#cartOffcanvas")}catch(h){console.error("Bootstrap Offcanvas no est\xE1 disponible",h);let m=document.getElementById("cartOffcanvas");m&&m.classList.add("show")}}),I&&I.addEventListener("click",Ae),k&&k.addEventListener("click",qe),d&&d.addEventListener("click",h=>{var T;let m=h.target,C=(T=m.closest("[data-id]"))==null?void 0:T.dataset.id;C&&(m.classList.contains("decrease-quantity")?H({id:C},-1):m.classList.contains("increase-quantity")?H({id:C},1):m.classList.contains("remove-item")&&At(C))}),V(),"performance"in window&&window.addEventListener("load",()=>{let h=performance.getEntriesByType("paint"),m=performance.getEntriesByType("navigation")[0];console.log("First Contentful Paint:",h[0].startTime),console.log("DOM Content Loaded:",m.domContentLoadedEventEnd),console.log("Load Time:",m.loadEventEnd)})}catch(n){console.error("Error al inicializar productos:",n),A("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document!="undefined"&&document.addEventListener("DOMContentLoaded",function(){fe(),me().catch(t=>{console.error("Error al inicializar la aplicaci\xF3n:",t),A("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})})});var dn=Oe(()=>{$t();zt();Rt();Kt();Qt();Yt();mt();ge();function he(){let t=document.documentElement;try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-defer]').forEach(e=>{e.media="all",e.removeAttribute("data-defer")})}catch(e){}t.dataset.enhancementsInit!=="1"&&(t.dataset.enhancementsInit="1",Nt(),Jt(),jt(),Ut(),Ht(),Vt(),Gt(),te())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",he):he()});export default dn();
