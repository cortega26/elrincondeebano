(()=>{var q=(t,n)=>()=>(t&&(n=t(t=0)),n);var Dt=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);function ot(){try{let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=`
      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */
      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }
      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }

      /* Contornos de enfoque claros para accesibilidad */
      .navbar .nav-link:focus,
      .navbar .dropdown-item:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* Espaciado entre botones en el offcanvas del carrito */
      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }
    `,document.head.appendChild(t)}catch(t){console.warn("[modules/enhancements] injectEnhancementStyles error:",t)}}var at=q(()=>{});function it(){try{document.addEventListener("keydown",n=>{n.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=".keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }",document.head.appendChild(t)}catch(t){console.warn("[modules/a11y] setupNavigationAccessibility error:",t)}}var ct=q(()=>{});function st(){try{"loading"in HTMLImageElement.prototype&&document.querySelectorAll("img:not([loading])").forEach(t=>{t.loading="lazy"})}catch(t){console.warn("[modules/perf] setupPerformanceOptimizations error:",t)}}var lt=q(()=>{});async function zt(){try{let t=localStorage.getItem("productDataVersion"),n=t?`/data/product_data.json?v=${encodeURIComponent(t)}`:"/data/product_data.json",i=await fetch(n,{cache:"no-store",headers:{Accept:"application/json"}});if(!i.ok)return null;let u=await i.json(),s=Array.isArray(u?.products)?u.products:Array.isArray(u)?u:[],p={};return s.forEach(g=>{let v=g.id||String(g.name)+"-"+String(g.category);p[v]=g}),p}catch(t){return console.error("[modules/seo] Error loading product data:",t),null}}async function dt(){try{if(document.querySelector('script[type="application/ld+json"]'))return;let t=await zt();if(!t)return;let i=Object.values(t).slice(0,20).map(p=>({"@type":"Product",name:p.name,image:p.image_path,description:p.description,brand:p.brand||"Gen\xE9rico",offers:{"@type":"Offer",price:p.price,priceCurrency:"CLP",availability:p.stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}})),u={"@context":"https://schema.org","@graph":[{"@type":"Store",name:"El Rinc\xF3n de \xC9bano",image:"https://elrincondeebano.com/assets/images/web/logo.webp",description:"Un minimarket en la puerta de tu departamento",address:{"@type":"PostalAddress",addressCountry:"CL"},telephone:"+56951118901",url:"http://www.elrincondeebano.com/",contactPoint:{"@type":"ContactPoint",telephone:"+56-951118901",contactType:"customer service"}},...i]},s=document.createElement("script");s.type="application/ld+json",window&&window.__CSP_NONCE__&&s.setAttribute("nonce",window.__CSP_NONCE__),s.textContent=JSON.stringify(u),document.head.appendChild(s)}catch(t){console.error("[modules/seo] Error generating structured data:",t)}}function ut(){try{if(!document.querySelector('link[rel="canonical"]')){let t=document.createElement("link");t.rel="canonical",t.href=location.origin+location.pathname,document.head.appendChild(t)}if(!document.querySelector('meta[name="description"]')){let t=document.createElement("meta");t.name="description",t.content="El Rinc\xF3n de \xC9bano - Minimarket con delivery instant\xE1neo.",document.head.appendChild(t)}}catch(t){console.warn("[modules/seo] injectSeoMetadata error:",t)}}var mt=q(()=>{});function pt(){try{if(!document.querySelector('link[rel="manifest"]')){let t=document.createElement("link");t.rel="manifest",t.href="/app.webmanifest",document.head.appendChild(t)}}catch(t){console.warn("[modules/pwa] injectPwaManifest error:",t)}}var ft=q(()=>{});function yt(){try{window?.console?.debug&&console.debug("[modules/checkout] setupCheckoutProgress: no-op")}catch{}}var gt=q(()=>{});function R(t,n={}){let i=t.startsWith("/")?t:"/"+t,u=Object.entries(n).map(([p,g])=>`${p}=${g}`).join(","),s=i.split("/").map(encodeURIComponent).join("/");return`/cdn-cgi/image/${u}${s}`}var j,ht=q(()=>{j={fit:"cover",quality:82,format:"auto"}});function wt(){return`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function x(t,n,i={}){let u={level:t,message:n,...i},s=JSON.stringify(u);typeof console[t]=="function"?console[t](s):console.log(s)}var vt=q(()=>{});function It(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}if(bt)return;bt=!0;let t=async()=>{if(document.readyState==="complete"){window.removeEventListener("load",t);try{await Rt()}catch(n){console.error("Service Worker initialization failed:",n),Kt("Failed to initialize service worker. Some features may not work offline.")}}};window.addEventListener("load",t),t()}async function Rt(){try{let t=await navigator.serviceWorker.register(Y.path,{scope:Y.scope});console.log("ServiceWorker registered successfully:",t.scope),jt(t),Ut(t),Ft(),Wt()}catch(t){throw console.error("ServiceWorker registration failed:",t),t}}function jt(t){t.addEventListener("updatefound",()=>{let n=t.installing;n.addEventListener("statechange",()=>{n.state==="installed"&&navigator.serviceWorker.controller&&n.postMessage({type:"SKIP_WAITING"})})})}function Ut(t){Ct(t),setInterval(()=>{Ct(t)},Y.updateCheckInterval)}async function Ct(t){try{await t.update();let n=await fetch("/data/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(n.ok){let u=(await n.json()).version,s=localStorage.getItem("productDataVersion");u!==s&&(t.active?.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",u),Ht(null,"New product data available"))}}catch(n){console.warn("Update check failed:",n)}}function Ft(){let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}function Wt(){let t=document.getElementById("offline-indicator");if(!t)return;let n=()=>{let i=navigator.onLine;t.classList.toggle("is-hidden",i),t.style.display=i?"none":"block",i||Vt("You are currently offline. Some features may be limited.")};window.addEventListener("online",n),window.addEventListener("offline",n),navigator.onLine||n()}function Ht(t,n="Una versi\xF3n est\xE1 disponible"){let i=Z(n,"Actualizar ahora","Despu\xE9s",()=>{t?t.postMessage({type:"SKIP_WAITING"}):window.location.reload()});X(i)}function Kt(t){let n=Z(t,"Reload","Dismiss",()=>window.location.reload());X(n)}function Vt(t){let n=Z(t,"Retry","Dismiss",()=>window.location.reload());X(n)}function Z(t,n,i,u){let s=document.createElement("div");return s.className="notification-toast",s.setAttribute("role","alert"),s.setAttribute("aria-live","polite"),s.innerHTML=`
        <div class="notification-content">
            <p>${t}</p>
            <div class="notification-actions">
                <button class="primary-action">${n}</button>
                <button class="secondary-action">${i}</button>
            </div>
        </div>
    `,s.querySelector(".primary-action").addEventListener("click",()=>{try{u()}catch(p){console.error("Primary action failed:",p)}s.remove()}),s.querySelector(".secondary-action").addEventListener("click",()=>{s.remove()}),s}function X(t){let n=document.querySelector(".notification-toast");n&&n.remove(),document.body.appendChild(t),setTimeout(()=>{document.body.contains(t)&&t.remove()},300*1e3)}var Y,bt,Qt,Jt,H,Gt,J,Yt,Zt,G,Xt,te,Et,U,ee,ne,f,S,St,_t,qt=q(()=>{ht();vt();Y={path:"/service-worker.js",scope:"/",updateCheckInterval:300*1e3},bt=!1;typeof navigator<"u"&&"serviceWorker"in navigator&&It();Qt=(t,n=100)=>{let i=new Map;return(...u)=>{let s=JSON.stringify(u);if(i.has(s))return i.get(s);let p=t(...u);if(i.size>=n){let g=i.keys().next().value;i.delete(g)}return i.set(s,p),p}},Jt=(t,n)=>{let i;return(...u)=>{clearTimeout(i),i=setTimeout(()=>t(...u),n)}},H=t=>{if(!t)return"";try{return String(t).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}catch{return String(t).toLowerCase()}},Gt=t=>{let n=`${t.name}-${t.category}`.toLowerCase(),i=0;for(let u=0;u<n.length;u++){let s=n.charCodeAt(u);i=(i<<5)-i+s,i=i&i}return`pid-${Math.abs(i)}`},J=t=>{let n=document.createElement("div");return n.textContent=t,n.innerHTML},Yt="product-data",Zt=()=>{try{return typeof localStorage>"u"?null:localStorage.getItem("productDataVersion")}catch(t){return console.warn("Unable to read stored product data version:",t),null}},G=t=>{if(t)try{if(typeof localStorage>"u")return;localStorage.setItem("productDataVersion",t)}catch(n){console.warn("Unable to persist product data version:",n)}},Xt=()=>{if(typeof document>"u")return null;try{let t=document.getElementById(Yt);if(!t||!t.textContent)return null;let n=t.textContent.trim();if(!n)return null;let i=JSON.parse(n);return!i||!Array.isArray(i.products)?null:i}catch(t){return x("warn","inline_product_parse_failure",{error:t.message}),null}},te=(t,n)=>{let i=t.id||Gt(t),u=typeof t.originalIndex=="number"?t.originalIndex:typeof t.order=="number"?t.order:n;return{...t,id:i,name:J(t.name),description:J(t.description),category:J(t.category),categoryKey:t.categoryKey||H(t.category),originalIndex:u}},Et=(t=[])=>t.map((n,i)=>te(n,i)),U=class extends Error{constructor(n,{cause:i,correlationId:u}){super(n),this.name="ProductDataError",this.correlationId=u,i&&(this.cause=i)}},ee=async(t,n,i,u,s)=>{let p=new URL(t,window.location.origin);if(p.origin!==window.location.origin||p.protocol!=="https:")throw new Error("Invalid request URL: only same-origin HTTPS requests are allowed");let g=p.toString(),v=0,h;for(;v<=i;)try{let L=Date.now(),_=await fetch(g,n),b=Date.now()-L;if(x("info","fetch_products_attempt",{correlationId:s,attempt:v+1,durationMs:b}),!_.ok)throw new Error(`HTTP error. Status: ${_.status}`);return _}catch(L){if(h=L,v++,v>i)break;x("warn","fetch_products_retry",{correlationId:s,attempt:v,error:L.message,runbook:"RUNBOOK.md#product-data"}),await new Promise(_=>setTimeout(_,u*v))}throw new U(`Failed to fetch products: ${h.message}`,{cause:h,correlationId:s})},ne=async()=>{let t=wt(),n=Xt(),i=n?Et(n.products):null,u=n?.version||null,s=Zt(),p=Array.isArray(i),g=p?i.length:0;if(p&&(!u||!s||s===u))return u&&G(u),x("info","fetch_products_inline",{correlationId:t,count:g}),i;try{let h=s||u||null,L=h?`/data/product_data.json?v=${encodeURIComponent(h)}`:"/data/product_data.json",b=await(await ee(L,{cache:"no-store",headers:{Accept:"application/json"}},2,300,t)).json(),F=Et(b.products||[]);return b.version&&G(b.version),x("info","fetch_products_success",{correlationId:t,count:F.length,source:"network"}),F}catch(h){if(p)return u&&G(u),x("warn","fetch_products_network_fallback_inline",{correlationId:t,error:h.message,runbook:"RUNBOOK.md#product-data"}),i;throw x("error","fetch_products_failure",{correlationId:t,error:h.message,runbook:"RUNBOOK.md#product-data"}),S(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${h.message})`),h instanceof U?h:new U(h.message,{cause:h,correlationId:t})}},f=(t,n={},i=[])=>{let u=document.createElement(t);return Object.entries(n).forEach(([s,p])=>{s==="text"?u.textContent=p:u.setAttribute(s,p)}),i.forEach(s=>{typeof s=="string"?u.appendChild(document.createTextNode(s)):u.appendChild(s)}),u},S=t=>{let n=f("div",{class:"error-message",role:"alert"},[f("p",{},[t]),f("button",{class:"retry-button"},["Intentar nuevamente"])]),i=document.getElementById("product-container");i?(i.innerHTML="",i.appendChild(n),n.querySelector(".retry-button").addEventListener("click",_t)):console.error("Contenedor de productos no encontrado")},St=[];try{St=JSON.parse(globalThis.localStorage?.getItem("cart"))||[]}catch{St=[]}typeof window<"u"&&(window.__APP_READY__=!1,window.addEventListener("error",t=>{let n=t.target||t.srcElement,i=!!(n&&(n.tagName==="IMG"||n.tagName==="SCRIPT"||n.tagName==="LINK")),u=!!t.error;if(i||!u){console.warn("Ignored non-fatal error:",{tag:n&&n.tagName,src:n&&(n.src||n.href||n.currentSrc)});return}if(!window.__APP_READY__){console.error("Runtime error before app ready:",t.error);return}console.error("Unhandled JS error:",t.error),S("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")}),window.addEventListener("securitypolicyviolation",t=>{console.warn("CSP violation (logged only):",{blockedURI:t.blockedURI,violatedDirective:t.violatedDirective,sourceFile:t.sourceFile})}));_t=async()=>{console.log("Initializing app...");let t=document.getElementById("product-container"),n=document.getElementById("sort-options"),i=document.getElementById("filter-keyword"),u=()=>{let e=document.getElementById("filter-discount");if(e)return e;let o=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),c=o?o.querySelector(".row"):null;if(!c)return null;let a=f("div",{class:"col-12 mt-2"}),r=f("div",{class:"form-check form-switch"}),l=f("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),d=f("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return r.appendChild(l),r.appendChild(d),a.appendChild(r),c.appendChild(a),l},s=[],p=JSON.parse(localStorage.getItem("cart"))||[],g=()=>{let e=document.getElementById("offline-indicator");if(e){let o=navigator.onLine;e.classList.toggle("is-hidden",o),e.style.display=o?"none":"block"}navigator.onLine||console.log("App is offline. Using cached data if available.")};function v(){let e=document.getElementById("current-year");e&&(e.textContent=new Date().getFullYear())}let h=(e,o,c="CLP")=>{let a=new Intl.NumberFormat("es-CL",{style:"currency",currency:c,minimumFractionDigits:0}),r=a.format(e);if(o){let l=e-o,d=a.format(l);return f("div",{class:"precio-container"},[f("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[d]),f("span",{class:"precio-original","aria-label":"Precio original"},[f("span",{class:"tachado"},[r])])])}return f("div",{class:"precio-container"},[f("span",{class:"precio","aria-label":"Precio"},[r])])},L=e=>{let o=f("div",{class:"quantity-control",style:"display:none;"}),c=f("button",{class:"quantity-btn","data-action":"decrease","aria-label":"Decrease quantity"},["-"]),a=f("button",{class:"quantity-btn","data-action":"increase","aria-label":"Increase quantity"},["+"]),r=f("input",{type:"number",class:"quantity-input",value:Math.max(b(e.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":e.id});return o.appendChild(c),o.appendChild(r),o.appendChild(a),o};function _(e,o){if(!e)return;let c=e.querySelector(".add-to-cart-btn"),a=e.querySelector(".quantity-control"),r=a?.querySelector(".quantity-input"),l=a?.querySelector('.quantity-btn[data-action="decrease"]')||a?.querySelector(".quantity-btn"),d=a?.querySelector('.quantity-btn[data-action="increase"]')||a?.querySelectorAll(".quantity-btn")?.[1],m=(w,P,k)=>{w&&w.dataset.listenerAttached!=="true"&&(w.addEventListener(P,k),w.dataset.listenerAttached="true")};m(c,"click",()=>{tt(o,1),N(c,a,!0)}),m(l,"click",()=>M(o,-1)),m(d,"click",()=>M(o,1)),m(r,"change",w=>{let P=parseInt(w.target.value,10);if(!Number.isFinite(P)){w.target.value=Math.max(b(o.id),1);return}let k=b(o.id);M(o,P-k)});let y=b(o.id);r&&(r.value=y>0?y:1),N(c,a,y>0)}let b=e=>{let o=p.find(c=>c.id===e);return o?o.quantity:0},F=e=>{let o=document.createDocumentFragment();e.forEach(a=>{let{id:r,name:l,description:d,image_path:m,price:y,discount:w,stock:P}=a,k=f("div",{class:`producto col-12 col-sm-6 col-md-4 col-lg-3 mb-4 ${P?"":"agotado"}`,"aria-label":`Product: ${l}`,"data-product-id":r}),T=f("div",{class:"card"});if(w&&Number(w)>0){let I=Math.round(Number(w)/Number(y)*100),E=f("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(I)?I:0}%`]);T.appendChild(E)}let $=`/${m.replace(/^\//,"")}`,B=f("img",{src:R($,{...j,width:400}),srcset:[`${R($,{...j,width:200})} 200w`,`${R($,{...j,width:400})} 400w`,`${R($,{...j,width:800})} 800w`].join(", "),sizes:"(max-width: 640px) 200px, 400px",alt:l,class:"card-img-top product-thumb",loading:"lazy",decoding:"async",width:"400",height:"400"});T.appendChild(B);let C=f("div",{class:"card-body"});C.appendChild(f("h3",{class:"card-title"},[l])),C.appendChild(f("p",{class:"card-text"},[d])),C.appendChild(h(y,w));let D=f("div",{class:"action-area","data-pid":r}),z=f("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":r,"aria-label":`Add ${l} to cart`},["Agregar al carrito"]),Q=L(a);D.appendChild(z),D.appendChild(Q),C.appendChild(D),_(D,a),T.appendChild(C),k.appendChild(T),o.appendChild(k)});let c=document.getElementById("product-container");c.innerHTML="",c.appendChild(o),kt()},Pt=e=>{if(!t)return!1;let o=t.querySelectorAll("[data-product-id]");if(!o.length)return!1;let c=new Map(e.map(a=>[a.id,a]));return o.forEach(a=>{let r=a.getAttribute("data-product-id");if(!r||!c.has(r))return;let l=c.get(r),d=a.querySelector(".action-area");_(d,l)}),!0},kt=()=>{let e=new IntersectionObserver((o,c)=>{o.forEach(a=>{if(a.isIntersecting){let r=a.target;r.src=r.dataset.src,r.dataset.srcset&&(r.srcset=r.dataset.srcset),r.dataset.sizes&&(r.sizes=r.dataset.sizes),r.classList.remove("lazyload"),c.unobserve(r)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(o=>e.observe(o))};function xt(e,o){if(!e||!o||e.length<3)return!1;let c=l=>l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),a=c(e),r=c(o);return r.includes(a)?!0:a.length>=4?At(a,r):!1}function At(e,o){return o.split(/\s+/).some(a=>{if(Math.abs(a.length-e.length)>1)return!1;let r=0,l=Math.max(a.length,e.length);if(Math.min(a.length,e.length)<4)return!1;if(a.length===e.length){for(let m=0;m<a.length;m++)if(a[m]!==e[m]&&r++,r>1)return!1;return r===1}else return Tt(e,a)})}function Tt(e,o){let c=e.length>o.length?e:o,a=e.length>o.length?o:e;if(c.length-a.length!==1)return!1;let r=0,l=0,d=0;for(;l<a.length&&d<c.length;)if(a[l]===c[d])l++,d++;else{if(r++,r>1)return!1;d++}return!0}let $t=(e,o,c,a=!1)=>{let r=o.trim();return e.filter(l=>!l.stock||a&&!(l.discount&&Number(l.discount)>0)?!1:!r||l.name.toLowerCase().includes(r.toLowerCase())||l.description.toLowerCase().includes(r.toLowerCase())?!0:r.length>=4?xt(r,l.name):!1).sort((l,d)=>Ot(l,d,c))},Ot=(e,o,c)=>{if(!c||c==="original")return e.originalIndex-o.originalIndex;let[a,r]=c.split("-"),l=a==="price"?e.price-(e.discount||0):e.name.toLowerCase(),d=a==="price"?o.price-(o.discount||0):o.name.toLowerCase();return r==="asc"?l<d?-1:l>d?1:0:d<l?-1:d>l?1:0},Mt=Qt($t),K=()=>{try{let e=n.value||"original",o=i.value.trim(),c=document.getElementById("filter-discount")?.checked||!1,a=Mt(s,o,e,c);F(a)}catch(e){console.error("Error al actualizar visualizaci\xF3n de productos:",e),S("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},V=Jt(K,300),O=()=>{let e=document.getElementById("cart-count"),o=p.reduce((c,a)=>c+a.quantity,0);e.textContent=o,e.setAttribute("aria-label",`${o} items in cart`)},tt=(e,o)=>{try{let c=p.find(r=>r.id===e.id);c?c.quantity=Math.min(c.quantity+o,50):p.push({id:e.id,name:e.name,description:e.description,price:e.price,discount:e.discount,image_path:e.image_path,quantity:Math.min(o,50),category:e.category,stock:e.stock}),W(),O(),A();let a=document.querySelector(`[data-id="${e.id}"].quantity-input`);a&&(a.value=Math.max(b(e.id),1))}catch(c){console.error("Error al agregar al carrito:",c),S("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},et=e=>{try{p=p.filter(c=>c.id!==e),W(),O(),A();let o=document.querySelector(`.action-area[data-pid="${e}"]`);if(o){let c=o.querySelector(".add-to-cart-btn"),a=o.querySelector(".quantity-control");N(c,a,!1)}}catch(o){console.error("Error al eliminar del carrito:",o),S("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},M=(e,o)=>{try{let c=p.find(m=>m.id===e.id),a=c?c.quantity+o:1,r=document.querySelector(`.action-area[data-pid="${e.id}"]`),l=r?.querySelector(".add-to-cart-btn"),d=r?.querySelector(".quantity-control");if(a<=0)et(e.id),N(l,d,!1);else if(a<=50){c?c.quantity=a:(tt(e,1),N(l,d,!0)),W(),O(),A();let m=document.querySelector(`[data-id="${e.id}"].quantity-input`);m&&(m.value=a,m.classList.add("quantity-changed"),setTimeout(()=>m.classList.remove("quantity-changed"),300))}}catch(c){console.error("Error al actualizar cantidad:",c),S("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},Nt=()=>{try{p=[],W(),O(),A(),K()}catch(e){console.error("Error al vaciar el carrito:",e),S("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},N=(e,o,c)=>{!e||!o||(c?(e.style.display="none",o.style.display="flex"):(o.style.display="none",e.style.display="flex"))},W=()=>{try{localStorage.setItem("cart",JSON.stringify(p))}catch(e){console.error("Error al guardar el carrito:",e),S("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},A=()=>{let e=document.getElementById("cart-items"),o=document.getElementById("cart-total");e.innerHTML="";let c=0;p.forEach(r=>{let l=r.price-(r.discount||0),d=f("div",{class:"cart-item mb-3 d-flex align-items-start","aria-label":`Cart item: ${r.name}`}),m=f("div",{class:"cart-item-content flex-grow-1"});m.appendChild(f("div",{class:"fw-bold mb-1"},[r.name]));let y=f("div",{class:"mb-2"}),w=f("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":r.id,"aria-label":`Disminuir cantidad de ${r.name}`},["-"]),P=f("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":r.id,"aria-label":`Aumentar cantidad de ${r.name}`},["+"]),k=f("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${r.name}`},[r.quantity.toString()]);y.appendChild(w),y.appendChild(k),y.appendChild(P),m.appendChild(y),m.appendChild(f("div",{class:"text-muted small"},[`Precio: $${l.toLocaleString("es-CL")}`])),m.appendChild(f("div",{class:"fw-bold"},[`Subtotal: $${(l*r.quantity).toLocaleString("es-CL")}`]));let T=f("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":r.id,"aria-label":`Eliminar ${r.name} del carrito`},["Eliminar"]);m.appendChild(T);let $=window.location.pathname.includes("/pages/"),B;$?B=`../${r.image_path.replace(/^\//,"")}`:B=r.image_path;let C=f("div",{class:"cart-item-thumb ms-3 flex-shrink-0"}),z={src:r.thumbnail_path||B,alt:r.name,class:"cart-item-thumb-img",loading:"lazy",decoding:"async",width:"100",height:"100"};if(Array.isArray(r.thumbnail_variants)){let I=r.thumbnail_variants.filter(E=>E&&E.url&&E.width).map(E=>`${E.url} ${E.width}w`);I.length&&(z.srcset=I.join(", "),z.sizes="100px")}let Q=f("img",z);if(C.appendChild(Q),d.appendChild(m),d.appendChild(C),e.appendChild(d),window.__DEBUG_CART__)try{let I=window.getComputedStyle(d),E=window.getComputedStyle(C),oe=window.getComputedStyle(m),nt=C.getBoundingClientRect(),rt=m.getBoundingClientRect();console.debug("[cart] item",{name:r.name,order:{firstIsContent:d.firstChild===m,lastIsThumb:d.lastChild===C},container:{display:I.display,flexDirection:I.flexDirection,flexWrap:I.flexWrap},thumb:{width:E.width,height:E.height,rect:{w:nt.width,h:nt.height}},content:{rect:{w:rt.width,h:rt.height}}})}catch{}c+=l*r.quantity}),o.textContent=`Total: $${c.toLocaleString("es-CL")}`,o.setAttribute("aria-label",`Total: $${c.toLocaleString("es-CL")}`);let a=document.getElementById("payment-credit-container");if(a)if(c>=3e4)a.classList.remove("d-none");else{a.classList.add("d-none");let r=a.querySelector("input");r&&(r.checked=!1)}},Bt=()=>{let e=document.querySelector('input[name="paymentMethod"]:checked');if(!e){alert("Por favor seleccione un m\xE9todo de pago");return}let o=`Mi pedido:

`;p.forEach(r=>{let l=r.price-(r.discount||0);o+=`${r.name}
`,o+=`Cantidad: ${r.quantity}
`,o+=`Precio unitario: $${l.toLocaleString("es-CL")}
`,o+=`Subtotal: $${(l*r.quantity).toLocaleString("es-CL")}

`});let c=p.reduce((r,l)=>r+(l.price-(l.discount||0))*l.quantity,0);o+=`Total: $${c.toLocaleString("es-CL")}
`,o+=`M\xE9todo de pago: ${e.value}`;let a=encodeURIComponent(o);window.open(`https://wa.me/56951118901?text=${a}`,"_blank")};try{if(v(),s=await ne(),s.length===0){S("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}s=s.map((d,m)=>({...d,originalIndex:typeof d.originalIndex=="number"?d.originalIndex:m,categoryKey:d.categoryKey||H(d.category)}));let e=document.querySelector("main").dataset.category;if(e){let d=H(e);s=s.filter(m=>(m.categoryKey||H(m.category))===d).map((m,y)=>({...m,originalIndex:typeof m.originalIndex=="number"?m.originalIndex:y}))}n.addEventListener("change",V),i.addEventListener("input",V);let o=u();o&&o.addEventListener("change",V),Pt(s)||K(),typeof window<"u"&&(window.__APP_READY__=!0),window.addEventListener("online",g),window.addEventListener("offline",g),g();let a=document.getElementById("cart-icon"),r=document.getElementById("empty-cart"),l=document.getElementById("submit-cart");a.addEventListener("click",()=>{if(typeof window.bootstrap<"u"&&window.bootstrap.Offcanvas){let d=new window.bootstrap.Offcanvas(document.getElementById("cartOffcanvas"));A(),d.show()}else{console.error("Bootstrap Offcanvas no est\xE1 disponible"),A();let d=document.getElementById("cartOffcanvas");d&&d.classList.add("show")}}),r.addEventListener("click",Nt),l.addEventListener("click",Bt),document.getElementById("cart-items").addEventListener("click",d=>{let m=d.target,y=m.closest("[data-id]")?.dataset.id;y&&(m.classList.contains("decrease-quantity")?M({id:y},-1):m.classList.contains("increase-quantity")?M({id:y},1):m.classList.contains("remove-item")&&et(y))}),O(),"performance"in window&&window.addEventListener("load",()=>{let d=performance.getEntriesByType("paint"),m=performance.getEntriesByType("navigation")[0];console.log("First Contentful Paint:",d[0].startTime),console.log("DOM Content Loaded:",m.domContentLoadedEventEnd),console.log("Load Time:",m.loadEventEnd)})}catch(e){console.error("Error al inicializar productos:",e),S("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document<"u"&&document.addEventListener("DOMContentLoaded",function(){It(),_t().catch(t=>{console.error("Error al inicializar la aplicaci\xF3n:",t),S("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})})});var re=Dt(()=>{at();ct();lt();mt();ft();gt();qt();function Lt(){let t=document.documentElement;try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-defer]').forEach(n=>{n.media="all",n.removeAttribute("data-defer")})}catch{}t.dataset.enhancementsInit!=="1"&&(t.dataset.enhancementsInit="1",ot(),yt(),it(),st(),ut(),dt(),pt())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Lt):Lt()});re();})();
