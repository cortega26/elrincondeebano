import{a as Nt,b as D}from"./chunks/chunk-TXIFLR42.js";import"./chunks/chunk-72ZECFVW.js";function $t(){try{let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=`
      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */
      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }
      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }

      /* Contornos de enfoque claros para accesibilidad */
      .navbar .nav-link:focus,
      .navbar .dropdown-item:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* Espaciado entre botones en el offcanvas del carrito */
      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }
    `,document.head.appendChild(t)}catch(t){console.warn("[modules/enhancements] injectEnhancementStyles error:",t)}}function zt(){try{document.addEventListener("keydown",e=>{e.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=".keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }",document.head.appendChild(t)}catch(t){console.warn("[modules/a11y] setupNavigationAccessibility error:",t)}}function jt(){try{"loading"in HTMLImageElement.prototype&&document.querySelectorAll("img:not([loading])").forEach(t=>{t.loading="lazy"})}catch(t){console.warn("[modules/perf] setupPerformanceOptimizations error:",t)}}var U="__PRODUCT_DATA__";function Se(){try{if(typeof window=="undefined")return null;let t=window[U];if(t&&Array.isArray(t.products))return t.products}catch(t){console.warn("[modules/seo] Unable to read shared product data:",t)}return null}function _e(t,e={}){var s,d;if(typeof window=="undefined"||!Array.isArray(t))return;let a=window[U]||{};window[U]={...a,products:t,version:(d=(s=e.version)!=null?s:a.version)!=null?d:null,updatedAt:e.updatedAt||Date.now(),source:e.source||a.source||"seo"}}function Ut(t=[]){let e={};return t.forEach(a=>{let s=a.id||String(a.name)+"-"+String(a.category);e[s]=a}),e}function Rt(){if(typeof window=="undefined")return;let t=window[U]||{};t.structuredDataInjected||(window[U]={...t,structuredDataInjected:!0})}async function Ie(){try{let t=Se();if(t)return Ut(t);let e=localStorage.getItem("productDataVersion"),a=e?`/data/product_data.json?v=${encodeURIComponent(e)}`:"/data/product_data.json",s=await fetch(a,{cache:"no-store",headers:{Accept:"application/json"}});if(!s.ok)return null;let d=await s.json(),u=Array.isArray(d==null?void 0:d.products)?d.products:Array.isArray(d)?d:[];return _e(u,{version:(d==null?void 0:d.version)||e||null,source:"seo-fallback"}),Ut(u)}catch(t){return console.error("[modules/seo] Error loading product data:",t),null}}async function Ft(){try{if(document.querySelector('script[type="application/ld+json"]')){Rt();return}let t=typeof window!="undefined"?window[U]:null;if(t!=null&&t.structuredDataInjected)return;let e=await Ie();if(!e)return;let s=Object.values(e).slice(0,20).map(b=>({"@type":"Product",name:b.name,image:b.image_path,description:b.description,brand:b.brand||"Gen\xE9rico",offers:{"@type":"Offer",price:b.price,priceCurrency:"CLP",availability:b.stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}})),d={"@context":"https://schema.org","@graph":[{"@type":"Store",name:"El Rinc\xF3n de \xC9bano",image:"https://elrincondeebano.com/assets/images/web/logo.webp",description:"Un minimarket en la puerta de tu departamento",address:{"@type":"PostalAddress",addressCountry:"CL"},telephone:"+56951118901",url:"http://www.elrincondeebano.com/",contactPoint:{"@type":"ContactPoint",telephone:"+56-951118901",contactType:"customer service"}},...s]},u=document.createElement("script");u.type="application/ld+json",window&&window.__CSP_NONCE__&&u.setAttribute("nonce",window.__CSP_NONCE__),u.textContent=JSON.stringify(d),document.head.appendChild(u),Rt()}catch(t){console.error("[modules/seo] Error generating structured data:",t)}}function Wt(){try{if(!document.querySelector('link[rel="canonical"]')){let t=document.createElement("link");t.rel="canonical",t.href=location.origin+location.pathname,document.head.appendChild(t)}if(!document.querySelector('meta[name="description"]')){let t=document.createElement("meta");t.name="description",t.content="El Rinc\xF3n de \xC9bano - Minimarket con delivery instant\xE1neo.",document.head.appendChild(t)}}catch(t){console.warn("[modules/seo] injectSeoMetadata error:",t)}}function Vt(){try{if(!document.querySelector('link[rel="manifest"]')){let t=document.createElement("link");t.rel="manifest",t.href="/app.webmanifest",document.head.appendChild(t)}}catch(t){console.warn("[modules/pwa] injectPwaManifest error:",t)}}function Ht(){var t;try{(t=window==null?void 0:window.console)!=null&&t.debug&&console.debug("[modules/checkout] setupCheckoutProgress: no-op")}catch(e){}}var Kt=!1,Gt=new Map,st=null,lt=null,dt=null;function ut(t){if(t&&typeof t=="object"){if(t.default)return t.default;let e=Object.keys(t);if(e.length===1)return t[e[0]]}return t}function ft(t,e){return!t||!e?null:typeof t.getOrCreateInstance=="function"?t.getOrCreateInstance(e):new t(e)}function Le(t){return t?typeof t=="string"?document.querySelector(t):t:null}function pt(t,e){return Gt.has(t)?Gt.get(t)():e()}async function Pe(){st||(st=pt("collapse",()=>import("./chunks/collapse-NY5MXN7U.js")));let t=await st;return ut(t)}async function ke(){lt||(lt=pt("dropdown",()=>import("./chunks/dropdown-3RTH4GTX.js")));let t=await lt;return ut(t)}async function Ae(){dt||(dt=pt("offcanvas",()=>import("./chunks/offcanvas-HI6BCH6F.js")));let t=await dt;return ut(t)}function xe(){document.querySelectorAll('[data-bs-toggle="collapse"][data-bs-target]').forEach(e=>{e.addEventListener("click",()=>{qe(e)})})}async function qe(t){var e;try{let a=t.getAttribute("data-bs-target");if(!a)return;let s=document.querySelector(a);if(!s)return;let d=await Pe(),u=ft(d,s);(e=u==null?void 0:u.toggle)==null||e.call(u)}catch(a){console.error("No se pudo inicializar el Collapse de Bootstrap",a)}}function Te(){document.querySelectorAll('[data-bs-toggle="dropdown"]').forEach(e=>{e.addEventListener("click",a=>{a.preventDefault(),Oe(e)})})}async function Oe(t){var e;try{let a=await ke(),s=ft(a,t);(e=s==null?void 0:s.toggle)==null||e.call(s)}catch(a){console.error("No se pudo inicializar el Dropdown de Bootstrap",a)}}function Qt(){Kt||(Kt=!0,typeof document!="undefined"&&(xe(),Te()))}async function Yt(t){if(typeof document=="undefined")throw new Error("Offcanvas no disponible en este entorno");let e=Le(t);if(!e)throw new Error("No se encontr\xF3 el elemento de Offcanvas");let a=await Ae(),s=ft(a,e);if(!s||typeof s.show!="function")throw new Error("Instancia de Offcanvas inv\xE1lida");return s.show(),s}function G(t,e={}){let a=t.startsWith("/")?t:"/"+t,s=Object.entries(e).map(([u,b])=>`${u}=${b}`).join(","),d=a.split("/").map(encodeURIComponent).join("/");return`/cdn-cgi/image/${s}${d}`}var Q={fit:"cover",quality:82,format:"auto"};var R=t=>{if(t==null)return"";try{return String(t).normalize("NFD").replace(/\p{Diacritic}+/gu,"").toLowerCase().replace(/[^a-z0-9]+/g,"").replace(/^(?:-|_)+|(?:-|_)+$/g,"").trim()}catch(e){return String(t).toLowerCase().replace(/[^a-z0-9]+/g,"").trim()}};var ne="__PRODUCT_DATA__",nt=null,P=Object.freeze({hidden:"is-hidden",flex:"is-flex",block:"is-block",contentVisible:"has-content-visibility",containIntrinsic:"has-contain-intrinsic"});function bt(){if(typeof window!="undefined"){let t=window[ne];if(t&&Array.isArray(t.products))return t}return nt&&Array.isArray(nt.products)?nt:null}function re(t,e={},{force:a=!1}={}){if(!Array.isArray(t))return null;let s={products:t,version:e.version||null,source:e.source||null,updatedAt:e.updatedAt||Date.now(),isPartial:!!e.isPartial,total:typeof e.total=="number"?e.total:null},d=bt();if(d&&!a){let u=d.version||null,b=s.version||null;if(!b&&u||!b&&!u||b&&u===b)return d}return nt=s,typeof window!="undefined"&&(window[ne]={...s}),s}function yt(t,e={}){return re(t,e,{force:!1})}function Be(t,e={}){return re(t,e,{force:!0})}var wt={path:"/service-worker.js",scope:"/",updateCheckInterval:300*1e3},Jt=!1;function oe(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}if(Jt)return;Jt=!0;let t=async()=>{if(document.readyState==="complete"){window.removeEventListener("load",t);try{await Me()}catch(e){console.error("Service Worker initialization failed:",e),Ue("Failed to initialize service worker. Some features may not work offline.")}}};window.addEventListener("load",t),t()}async function Me(){try{let t=await navigator.serviceWorker.register(wt.path,{scope:wt.scope});console.log("ServiceWorker registered successfully:",t.scope),De(t),Ne(t),$e(),ze()}catch(t){throw console.error("ServiceWorker registration failed:",t),t}}function De(t){t.addEventListener("updatefound",()=>{let e=t.installing;e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&e.postMessage({type:"SKIP_WAITING"})})})}function Ne(t){Zt(t),setInterval(()=>{Zt(t)},wt.updateCheckInterval)}async function Zt(t){var e;try{await t.update();let a=await fetch("/data/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(a.ok){let d=(await a.json()).version,u=localStorage.getItem("productDataVersion");d!==u&&((e=t.active)==null||e.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",d),je(null,"New product data available"))}}catch(a){console.warn("Update check failed:",a)}}function $e(){let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}function ze(){let t=document.getElementById("offline-indicator");if(!t)return;let e=()=>{let a=navigator.onLine;t.classList.toggle(P.hidden,a),t.classList.toggle(P.block,!a),a||Re("You are currently offline. Some features may be limited.")};window.addEventListener("online",e),window.addEventListener("offline",e),navigator.onLine||e()}var mt=null;function Ct(){return mt||(mt=import("./chunks/notifications-533VS4FV.js")),mt}function je(t,e="Una versi\xF3n est\xE1 disponible"){Ct().then(a=>a.showUpdateNotification(t,e))}function Ue(t){Ct().then(e=>e.showServiceWorkerError(t))}function Re(t){Ct().then(e=>e.showConnectivityNotification(t))}typeof navigator!="undefined"&&"serviceWorker"in navigator&&oe();var Fe=t=>typeof t=="object"&&t!==null||typeof t=="function",gt=()=>({map:new Map,weakMap:new WeakMap,hasValue:!1,value:void 0}),We=(t,e=100)=>{if(typeof t!="function")throw new TypeError("Expected a function to memoize");(!Number.isFinite(e)||e<0)&&(e=0);let a=gt(),s=[],d=m=>{let h=s.indexOf(m);h!==-1&&s.splice(h,1),e>0&&s.push(m)},u=()=>{if(e!==0)for(;s.length>e;){let m=s.shift();m&&(m.hasValue=!1,m.value=void 0)}},b=(m,h)=>{if(Fe(h)){let y=m.weakMap.get(h);return y||(y=gt(),m.weakMap.set(h,y)),y}return m.map.has(h)||m.map.set(h,gt()),m.map.get(h)};return(...m)=>{if(e===0)return t(...m);let h=a;for(let y=0;y<m.length;y+=1)h=b(h,m[y]);if(h.hasValue)return d(h),h.value;let E=t(...m);return h.value=E,h.hasValue=!0,d(h),u(),E}},Ve=(t,e)=>{let a;return(...s)=>{clearTimeout(a),a=setTimeout(()=>t(...s),e)}},He=t=>{let e=`${t.name}-${t.category}`.toLowerCase(),a=0;for(let s=0;s<e.length;s++){let d=e.charCodeAt(s);a=(a<<5)-a+d,a=a&a}return`pid-${Math.abs(a)}`},ht=t=>{let e=document.createElement("div");return e.textContent=t,e.innerHTML},Ke="product-data",Ge=()=>{try{return typeof localStorage=="undefined"?null:localStorage.getItem("productDataVersion")}catch(t){return console.warn("Unable to read stored product data version:",t),null}},Xt=t=>{if(t)try{if(typeof localStorage=="undefined")return;localStorage.setItem("productDataVersion",t)}catch(e){console.warn("Unable to persist product data version:",e)}},ae=()=>{if(typeof document=="undefined")return null;try{let t=document.getElementById(Ke);if(!t||!t.textContent)return null;let e=t.textContent.trim();if(!e)return null;let a=JSON.parse(e);return a?Array.isArray(a.initialProducts)?a:Array.isArray(a.products)?{...a,initialProducts:a.products}:null:null}catch(t){return D("warn","inline_product_parse_failure",{error:t.message}),null}},Y=(t,e)=>{var C;let a=t.id||He(t),s=typeof t.originalIndex=="number"?t.originalIndex:typeof t.order=="number"?t.order:e,d=(C=t.category)!=null?C:"",u=ht(d),b=R(t.categorySlug),m=R(t.categoryKey),h=R(d),E=b||m||h,y=m||E;return{...t,id:a,name:ht(t.name),description:ht(t.description),category:u,categorySlug:E,categoryKey:y,originalIndex:s}},vt=(t=[])=>t.map((e,a)=>Y(e,a));function Qe(){let t=bt();if(t)return t;let e=ae();if(!e||!Array.isArray(e.initialProducts))return null;let a=vt(e.initialProducts);return yt(a,{version:e.version||null,source:"inline",isPartial:!0,total:typeof e.totalProducts=="number"?e.totalProducts:a.length})}Qe();var J=class extends Error{constructor(e,{cause:a,correlationId:s}){super(e),this.name="ProductDataError",this.correlationId=s,a&&(this.cause=a)}},Ye=async(t,e,a,s,d)=>{let u=new URL(t,window.location.origin);if(u.origin!==window.location.origin||u.protocol!=="https:")throw new Error("Invalid request URL: only same-origin HTTPS requests are allowed");let b=u.toString(),m=0,h;for(;m<=a;)try{let E=Date.now(),y=await fetch(b,e),C=Date.now()-E;if(D("info","fetch_products_attempt",{correlationId:d,attempt:m+1,durationMs:C}),!y.ok)throw new Error(`HTTP error. Status: ${y.status}`);return y}catch(E){if(h=E,m++,m>a)break;D("warn","fetch_products_retry",{correlationId:d,attempt:m,error:E.message,runbook:"RUNBOOK.md#product-data"}),await new Promise(y=>setTimeout(y,s*m))}throw new J(`Failed to fetch products: ${h.message}`,{cause:h,correlationId:d})},Je=async()=>{let t=Nt(),e=ae(),a=(e==null?void 0:e.initialProducts)||null,s=(e==null?void 0:e.version)||null,d=typeof(e==null?void 0:e.totalProducts)=="number"?e.totalProducts:null,u=Array.isArray(a)?vt(a):null,b=Array.isArray(u),m=Ge();b&&(s&&Xt(s),yt(u,{version:s||null,source:"inline",isPartial:!0,total:d!=null?d:u.length}),D("info","fetch_products_inline_bootstrap",{correlationId:t,count:u.length}));let h=m||s||null,E=h?`/data/product_data.json?v=${encodeURIComponent(h)}`:"/data/product_data.json";try{let C=await(await Ye(E,{cache:"no-store",headers:{Accept:"application/json"}},2,300,t)).json(),_=vt(C.products||[]);return Be(_,{version:C.version||null,source:"network",isPartial:!1,total:_.length}),C.version&&Xt(C.version),D("info","fetch_products_success",{correlationId:t,count:_.length,source:"network"}),_}catch(y){if(b)return yt(u,{version:s||null,source:"inline-fallback",isPartial:!0,total:d!=null?d:u.length}),D("warn","fetch_products_network_fallback_inline",{correlationId:t,error:y.message,runbook:"RUNBOOK.md#product-data"}),u;throw D("error","fetch_products_failure",{correlationId:t,error:y.message,runbook:"RUNBOOK.md#product-data"}),T(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${y.message})`),y instanceof J?y:new J(y.message,{cause:y,correlationId:t})}},f=(t,e={},a=[])=>{let s=document.createElement(t);return Object.entries(e).forEach(([d,u])=>{d==="text"?s.textContent=u:s.setAttribute(d,u)}),a.forEach(d=>{typeof d=="string"?s.appendChild(document.createTextNode(d)):s.appendChild(d)}),s},T=t=>{let e=f("div",{class:"error-message",role:"alert"},[f("p",{},[t]),f("button",{class:"retry-button"},["Intentar nuevamente"])]),a=document.getElementById("product-container");a?(a.innerHTML="",a.appendChild(e),e.querySelector(".retry-button").addEventListener("click",ie)):console.error("Contenedor de productos no encontrado")},te=[],ee;try{te=JSON.parse((ee=globalThis.localStorage)==null?void 0:ee.getItem("cart"))||[]}catch(t){te=[]}typeof window!="undefined"&&(window.__APP_READY__=!1,window.addEventListener("error",t=>{let e=t.target||t.srcElement,a=!!(e&&(e.tagName==="IMG"||e.tagName==="SCRIPT"||e.tagName==="LINK")),s=!!t.error;if(a||!s){console.warn("Ignored non-fatal error:",{tag:e&&e.tagName,src:e&&(e.src||e.href||e.currentSrc)});return}if(!window.__APP_READY__){console.error("Runtime error before app ready:",t.error);return}console.error("Unhandled JS error:",t.error),T("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")}),window.addEventListener("securitypolicyviolation",t=>{console.warn("CSP violation (logged only):",{blockedURI:t.blockedURI,violatedDirective:t.violatedDirective,sourceFile:t.sourceFile})}));var ie=async()=>{var xt,qt,Tt,Ot;console.log("Initializing app...");let t=document.getElementById("product-container"),e=document.getElementById("sort-options"),a=document.getElementById("filter-keyword"),s=document.getElementById("cart-count"),d=document.getElementById("cart-items"),u=document.getElementById("cart-total"),m=Object.entries({"#product-container":t,"#sort-options":e,"#filter-keyword":a,"#cart-count":s,"#cart-items":d,"#cart-total":u}).filter(([,n])=>!n).map(([n])=>n);if(m.length){D("warn","init_app_missing_dom",{missingSelectors:m,location:typeof window!="undefined"?(xt=window.location)==null?void 0:xt.pathname:"unknown"});return}let h=()=>{let n=document.getElementById("filter-discount");if(n)return n;let o=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),c=o?o.querySelector(".row"):null;if(!c)return null;let i=f("div",{class:"col-12 mt-2"}),r=f("div",{class:"form-check form-switch"}),l=f("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),p=f("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return r.appendChild(l),r.appendChild(p),i.appendChild(r),c.appendChild(i),l},E=12,y=12,C=[],_=[],N=0,Et=E,z=null,Z=null,X=null,tt=!1,k=JSON.parse(localStorage.getItem("cart"))||[],rt=()=>{let n=document.getElementById("offline-indicator");if(n){let o=navigator.onLine;n.classList.toggle(P.hidden,o),n.classList.toggle(P.block,!o)}navigator.onLine||console.log("App is offline. Using cached data if available.")};function se(){let n=document.getElementById("current-year");n&&(n.textContent=new Date().getFullYear())}let le=(n,o,c="CLP")=>{let i=new Intl.NumberFormat("es-CL",{style:"currency",currency:c,minimumFractionDigits:0}),r=i.format(n);if(o){let l=n-o,p=i.format(l);return f("div",{class:"precio-container"},[f("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[p]),f("span",{class:"precio-original","aria-label":"Precio original"},[f("span",{class:"tachado"},[r])])])}return f("div",{class:"precio-container"},[f("span",{class:"precio","aria-label":"Precio"},[r])])},de=n=>{let o=f("div",{class:`quantity-control ${P.hidden}`}),c=f("button",{class:"quantity-btn","data-action":"decrease","aria-label":"Decrease quantity"},["-"]),i=f("button",{class:"quantity-btn","data-action":"increase","aria-label":"Increase quantity"},["+"]),r=f("input",{type:"number",class:"quantity-input",value:Math.max(F(n.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":n.id});return o.appendChild(c),o.appendChild(r),o.appendChild(i),o};function St(n,o){var A;if(!n)return;let c=n.querySelector(".add-to-cart-btn"),i=n.querySelector(".quantity-control"),r=i==null?void 0:i.querySelector(".quantity-input"),l=(i==null?void 0:i.querySelector('.quantity-btn[data-action="decrease"]'))||(i==null?void 0:i.querySelector(".quantity-btn")),p=(i==null?void 0:i.querySelector('.quantity-btn[data-action="increase"]'))||((A=i==null?void 0:i.querySelectorAll(".quantity-btn"))==null?void 0:A[1]),g=(I,q,v)=>{I&&I.dataset.listenerAttached!=="true"&&(I.addEventListener(q,v),I.dataset.listenerAttached="true")};g(c,"click",()=>{kt(o,1),H(c,i,!0)}),g(l,"click",()=>V(o,-1)),g(p,"click",()=>V(o,1)),g(r,"change",I=>{let q=parseInt(I.target.value,10);if(!Number.isFinite(q)){I.target.value=Math.max(F(o.id),1);return}let v=F(o.id);V(o,q-v)});let S=F(o.id);r&&(r.value=S>0?S:1),H(c,i,S>0)}let F=n=>{let o=k.find(c=>c.id===n);return o?o.quantity:0},ue=(n,{reset:o=!1}={})=>{if(!t)return 0;o&&(t.innerHTML="");let c=document.createDocumentFragment();return n.forEach(i=>{let{id:r,name:l,description:p,image_path:g,price:S,discount:A,stock:I}=i,q=["producto","col-12","col-sm-6","col-md-4","col-lg-3","mb-4",I?"":"agotado",P.contentVisible,P.containIntrinsic].filter(Boolean).join(" "),v=f("div",{class:q,"aria-label":`Product: ${l}`,"data-product-id":r}),w=f("div",{class:"card"});if(A&&Number(A)>0){let x=Math.round(Number(A)/Number(S)*100),Bt=f("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(x)?x:0}%`]);w.appendChild(Bt)}let L=`/${g.replace(/^\//,"")}`,O=f("img",{src:G(L,{...Q,width:400}),srcset:[`${G(L,{...Q,width:200})} 200w`,`${G(L,{...Q,width:400})} 400w`,`${G(L,{...Q,width:800})} 800w`].join(", "),sizes:"(min-width: 1200px) 25vw, (min-width: 992px) 33vw, (min-width: 576px) 50vw, 100vw",alt:l,class:"card-img-top product-thumb",loading:"lazy",fetchpriority:"auto",decoding:"async",width:"400",height:"400"});w.appendChild(O);let j=f("div",{class:"card-body"});j.appendChild(f("h3",{class:"card-title"},[l])),j.appendChild(f("p",{class:"card-text"},[p])),j.appendChild(le(S,A));let $=f("div",{class:"action-area","data-pid":r}),ct=f("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":r,"aria-label":`Add ${l} to cart`},["Agregar al carrito"]),M=de(i);$.appendChild(ct),$.appendChild(M),j.appendChild($),St($,i),w.appendChild(j),v.appendChild(w),c.appendChild(v)}),t.appendChild(c),me(),n.length},fe=n=>{if(!t)return 0;let o=t.querySelectorAll("[data-product-id]");if(!o.length)return 0;let c=new Map(n.map(r=>[r.id,r])),i=0;return o.forEach(r=>{let l=r.getAttribute("data-product-id");if(!l||!c.has(l))return;let p=c.get(l);r.classList.add(P.contentVisible,P.containIntrinsic);let g=r.querySelector(".action-area");St(g,p),i+=1}),i},_t=()=>{t&&(t.innerHTML=""),N=0},ot=()=>{var i,r,l;let n=(e==null?void 0:e.value)||"original",o=((r=(i=a==null?void 0:a.value)==null?void 0:i.trim)==null?void 0:r.call(i))||"",c=((l=document.getElementById("filter-discount"))==null?void 0:l.checked)||!1;_=be(C,o,n,c)},It=n=>{if(!Array.isArray(_)||_.length===0)return B(),!1;let o=N;if(o>=_.length)return B(),!1;let c=_.slice(o,o+n);return c.length?(ue(c),N+=c.length,B(),!0):(B(),!1)},at=()=>It(Et||E),Lt=()=>It(y),B=()=>{let n=N<_.length;z&&(z.classList.toggle("d-none",!n),z.disabled=!n),X&&Z&&(X.disconnect(),n&&X.observe(Z))},pe=()=>{z=document.getElementById("catalog-load-more"),Z=document.getElementById("catalog-sentinel"),z&&z.addEventListener("click",()=>{Lt()}),Z&&typeof window!="undefined"&&"IntersectionObserver"in window&&(X=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting&&Lt()})},{rootMargin:"200px"})),B()},me=()=>{if(typeof window!="undefined"&&"IntersectionObserver"in window){let n=new IntersectionObserver((o,c)=>{o.forEach(i=>{if(i.isIntersecting){let r=i.target;r.src=r.dataset.src,r.dataset.srcset&&(r.srcset=r.dataset.srcset),r.dataset.sizes&&(r.sizes=r.dataset.sizes),r.classList.remove("lazyload"),c.unobserve(r)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(o=>n.observe(o))}else document.querySelectorAll("img.lazyload").forEach(n=>{n.dataset.src&&(n.src=n.dataset.src),n.dataset.srcset&&(n.srcset=n.dataset.srcset),n.dataset.sizes&&(n.sizes=n.dataset.sizes),n.classList.remove("lazyload")})};function ge(n,o){if(!n||!o||n.length<3)return!1;let c=l=>l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),i=c(n),r=c(o);return r.includes(i)?!0:i.length>=4?he(i,r):!1}function he(n,o){return o.split(/\s+/).some(i=>{if(Math.abs(i.length-n.length)>1)return!1;let r=0,l=Math.max(i.length,n.length);if(Math.min(i.length,n.length)<4)return!1;if(i.length===n.length){for(let g=0;g<i.length;g++)if(i[g]!==n[g]&&r++,r>1)return!1;return r===1}else return ye(n,i)})}function ye(n,o){let c=n.length>o.length?n:o,i=n.length>o.length?o:n;if(c.length-i.length!==1)return!1;let r=0,l=0,p=0;for(;l<i.length&&p<c.length;)if(i[l]===c[p])l++,p++;else{if(r++,r>1)return!1;p++}return!0}let we=(n,o,c,i=!1)=>{let r=o.trim();return n.filter(l=>!l.stock||i&&!(l.discount&&Number(l.discount)>0)?!1:!r||l.name.toLowerCase().includes(r.toLowerCase())||l.description.toLowerCase().includes(r.toLowerCase())?!0:r.length>=4?ge(r,l.name):!1).sort((l,p)=>ve(l,p,c))},ve=(n,o,c)=>{if(!c||c==="original")return n.originalIndex-o.originalIndex;let[i,r]=c.split("-"),l=i==="price"?n.price-(n.discount||0):n.name.toLowerCase(),p=i==="price"?o.price-(o.discount||0):o.name.toLowerCase();return r==="asc"?l<p?-1:l>p?1:0:p<l?-1:p>l?1:0},be=We(we),Pt=()=>{try{if(ot(),_t(),!_.length){B();return}at()}catch(n){console.error("Error al actualizar visualizaci\xF3n de productos:",n),T("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},it=Ve(Pt,300),W=()=>{let n=document.getElementById("cart-count"),o=k.reduce((c,i)=>c+i.quantity,0);n.textContent=o,n.setAttribute("aria-label",`${o} items in cart`)},kt=(n,o)=>{try{let c=k.find(r=>r.id===n.id);c?c.quantity=Math.min(c.quantity+o,50):k.push({id:n.id,name:n.name,description:n.description,price:n.price,discount:n.discount,image_path:n.image_path,quantity:Math.min(o,50),category:n.category,stock:n.stock}),et(),W(),K();let i=document.querySelector(`[data-id="${n.id}"].quantity-input`);i&&(i.value=Math.max(F(n.id),1))}catch(c){console.error("Error al agregar al carrito:",c),T("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},At=n=>{try{k=k.filter(c=>c.id!==n),et(),W(),K();let o=document.querySelector(`.action-area[data-pid="${n}"]`);if(o){let c=o.querySelector(".add-to-cart-btn"),i=o.querySelector(".quantity-control");H(c,i,!1)}}catch(o){console.error("Error al eliminar del carrito:",o),T("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},V=(n,o)=>{try{let c=k.find(g=>g.id===n.id),i=c?c.quantity+o:1,r=document.querySelector(`.action-area[data-pid="${n.id}"]`),l=r==null?void 0:r.querySelector(".add-to-cart-btn"),p=r==null?void 0:r.querySelector(".quantity-control");if(i<=0)At(n.id),H(l,p,!1);else if(i<=50){c?c.quantity=i:(kt(n,1),H(l,p,!0)),et(),W(),K();let g=document.querySelector(`[data-id="${n.id}"].quantity-input`);g&&(g.value=i,g.classList.add("quantity-changed"),setTimeout(()=>g.classList.remove("quantity-changed"),300))}}catch(c){console.error("Error al actualizar cantidad:",c),T("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},Ce=()=>{try{k=[],et(),W(),K(),Pt()}catch(n){console.error("Error al vaciar el carrito:",n),T("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},H=(n,o,c)=>{if(!n||!o)return;let i=!c;n.classList.toggle(P.hidden,!i),n.classList.toggle(P.flex,i),o.classList.toggle(P.hidden,!c),o.classList.toggle(P.flex,c)},et=()=>{try{localStorage.setItem("cart",JSON.stringify(k))}catch(n){console.error("Error al guardar el carrito:",n),T("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},K=()=>{let n=document.getElementById("cart-items"),o=document.getElementById("cart-total");n.innerHTML="";let c=0;k.forEach(r=>{let l=r.price-(r.discount||0),p=f("div",{class:"cart-item mb-3 d-flex align-items-start","aria-label":`Cart item: ${r.name}`}),g=f("div",{class:"cart-item-content flex-grow-1"});g.appendChild(f("div",{class:"fw-bold mb-1"},[r.name]));let S=f("div",{class:"mb-2"}),A=f("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":r.id,"aria-label":`Disminuir cantidad de ${r.name}`},["-"]),I=f("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":r.id,"aria-label":`Aumentar cantidad de ${r.name}`},["+"]),q=f("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${r.name}`},[r.quantity.toString()]);S.appendChild(A),S.appendChild(q),S.appendChild(I),g.appendChild(S),g.appendChild(f("div",{class:"text-muted small"},[`Precio: $${l.toLocaleString("es-CL")}`])),g.appendChild(f("div",{class:"fw-bold"},[`Subtotal: $${(l*r.quantity).toLocaleString("es-CL")}`]));let v=f("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":r.id,"aria-label":`Eliminar ${r.name} del carrito`},["Eliminar"]);g.appendChild(v);let w=window.location.pathname.includes("/pages/"),L;w?L=`../${r.image_path.replace(/^\//,"")}`:L=r.image_path;let O=f("div",{class:"cart-item-thumb ms-3 flex-shrink-0"}),$={src:r.thumbnail_path||L,alt:r.name,class:"cart-item-thumb-img",loading:"lazy",decoding:"async",width:"100",height:"100"};if(Array.isArray(r.thumbnail_variants)){let M=r.thumbnail_variants.filter(x=>x&&x.url&&x.width).map(x=>`${x.url} ${x.width}w`);M.length&&($.srcset=M.join(", "),$.sizes="100px")}let ct=f("img",$);if(O.appendChild(ct),p.appendChild(g),p.appendChild(O),n.appendChild(p),window.__DEBUG_CART__)try{let M=window.getComputedStyle(p),x=window.getComputedStyle(O),Bt=window.getComputedStyle(g),Mt=O.getBoundingClientRect(),Dt=g.getBoundingClientRect();console.debug("[cart] item",{name:r.name,order:{firstIsContent:p.firstChild===g,lastIsThumb:p.lastChild===O},container:{display:M.display,flexDirection:M.flexDirection,flexWrap:M.flexWrap},thumb:{width:x.width,height:x.height,rect:{w:Mt.width,h:Mt.height}},content:{rect:{w:Dt.width,h:Dt.height}}})}catch(M){}c+=l*r.quantity}),o.textContent=`Total: $${c.toLocaleString("es-CL")}`,o.setAttribute("aria-label",`Total: $${c.toLocaleString("es-CL")}`);let i=document.getElementById("payment-credit-container");if(i)if(c>=3e4)i.classList.remove("d-none");else{i.classList.add("d-none");let r=i.querySelector("input");r&&(r.checked=!1)}},Ee=()=>{let n=document.querySelector('input[name="paymentMethod"]:checked');if(!n){alert("Por favor seleccione un m\xE9todo de pago");return}let o=`Mi pedido:

`;k.forEach(r=>{let l=r.price-(r.discount||0);o+=`${r.name}
`,o+=`Cantidad: ${r.quantity}
`,o+=`Precio unitario: $${l.toLocaleString("es-CL")}
`,o+=`Subtotal: $${(l*r.quantity).toLocaleString("es-CL")}

`});let c=k.reduce((r,l)=>r+(l.price-(l.discount||0))*l.quantity,0);o+=`Total: $${c.toLocaleString("es-CL")}
`,o+=`M\xE9todo de pago: ${n.value}`;let i=encodeURIComponent(o);window.open(`https://wa.me/56951118901?text=${i}`,"_blank")};try{se();let n=bt();(qt=n==null?void 0:n.products)!=null&&qt.length&&(C=n.products.map((v,w)=>Y(v,w)));let o=document.querySelector("main"),c=((Tt=o==null?void 0:o.dataset)==null?void 0:Tt.category)||"",i=((Ot=o==null?void 0:o.dataset)==null?void 0:Ot.categorySlug)||R(c),r=v=>i?(v.categorySlug||R(v.category))===i:!0;i&&(C=C.filter(r).map((v,w)=>Y(v,w)));let l=fe(C);l>0?(N=l,Et=l):N=0,pe(),ot(),B(),N===0&&_.length&&at();let p=Je();e.addEventListener("change",()=>{tt=!0,it()}),a.addEventListener("input",()=>{tt=!0,it()});let g=h();g&&g.addEventListener("change",()=>{tt=!0,it()});let S=await p;if(!Array.isArray(S)||S.length===0){if(!C.length){T("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}}else C=S.map((v,w)=>Y(v,w)),i&&(C=C.filter(r).map((v,w)=>Y(v,w)));ot(),tt||N===0?(_t(),_.length?at():B()):B(),typeof window!="undefined"&&(window.__APP_READY__=!0),window.addEventListener("online",rt),window.addEventListener("offline",rt),rt();let A=document.getElementById("cart-icon"),I=document.getElementById("empty-cart"),q=document.getElementById("submit-cart");A&&A.addEventListener("click",async()=>{K();try{await Yt("#cartOffcanvas")}catch(v){console.error("Bootstrap Offcanvas no est\xE1 disponible",v);let w=document.getElementById("cartOffcanvas");w&&w.classList.add("show")}}),I&&I.addEventListener("click",Ce),q&&q.addEventListener("click",Ee),d&&d.addEventListener("click",v=>{var O;let w=v.target,L=(O=w.closest("[data-id]"))==null?void 0:O.dataset.id;L&&(w.classList.contains("decrease-quantity")?V({id:L},-1):w.classList.contains("increase-quantity")?V({id:L},1):w.classList.contains("remove-item")&&At(L))}),W(),"performance"in window&&window.addEventListener("load",()=>{let v=performance.getEntriesByType("paint"),w=performance.getEntriesByType("navigation")[0];console.log("First Contentful Paint:",v[0].startTime),console.log("DOM Content Loaded:",w.domContentLoadedEventEnd),console.log("Load Time:",w.loadEventEnd)})}catch(n){console.error("Error al inicializar productos:",n),T("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document!="undefined"&&document.addEventListener("DOMContentLoaded",function(){oe(),ie().catch(t=>{console.error("Error al inicializar la aplicaci\xF3n:",t),T("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})});function ce(){let t=document.documentElement;try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-defer]').forEach(e=>{e.media="all",e.removeAttribute("data-defer")})}catch(e){}t.dataset.enhancementsInit!=="1"&&(t.dataset.enhancementsInit="1",$t(),Ht(),zt(),jt(),Wt(),Ft(),Vt(),Qt())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ce):ce();try{typeof window!="undefined"&&window.__ANALYTICS_ENABLE__===!0&&import("./chunks/analytics-O2RU3SL6.js").then(t=>{t.initAnalytics({enabled:!0,consentRequired:!0,sampleRate:1}),window.__analyticsTrack=(e,a)=>{try{return t.track(e,a)}catch(s){return!1}},t.track("page_view",{path:location.pathname})}).catch(()=>{})}catch(t){}export{ce as __initEnhancementsOnceForTest};
