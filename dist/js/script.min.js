import{a as Mt,b as B}from"./chunks/chunk-TXIFLR42.js";import"./chunks/chunk-72ZECFVW.js";function Dt(){try{let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=`
      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */
      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }
      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }

      /* Contornos de enfoque claros para accesibilidad */
      .navbar .nav-link:focus,
      .navbar .dropdown-item:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* Espaciado entre botones en el offcanvas del carrito */
      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }
    `,document.head.appendChild(t)}catch(t){console.warn("[modules/enhancements] injectEnhancementStyles error:",t)}}function Nt(){try{document.addEventListener("keydown",e=>{e.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=".keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }",document.head.appendChild(t)}catch(t){console.warn("[modules/a11y] setupNavigationAccessibility error:",t)}}function $t(){try{"loading"in HTMLImageElement.prototype&&document.querySelectorAll("img:not([loading])").forEach(t=>{t.loading="lazy"})}catch(t){console.warn("[modules/perf] setupPerformanceOptimizations error:",t)}}var R="__PRODUCT_DATA__";function Ee(){try{if(typeof window=="undefined")return null;let t=window[R];if(t&&Array.isArray(t.products))return t.products}catch(t){console.warn("[modules/seo] Unable to read shared product data:",t)}return null}function Ce(t,e={}){var s,l;if(typeof window=="undefined"||!Array.isArray(t))return;let o=window[R]||{};window[R]={...o,products:t,version:(l=(s=e.version)!=null?s:o.version)!=null?l:null,updatedAt:e.updatedAt||Date.now(),source:e.source||o.source||"seo"}}function zt(t=[]){let e={};return t.forEach(o=>{let s=o.id||String(o.name)+"-"+String(o.category);e[s]=o}),e}function jt(){if(typeof window=="undefined")return;let t=window[R]||{};t.structuredDataInjected||(window[R]={...t,structuredDataInjected:!0})}async function _e(){try{let t=Ee();if(t)return zt(t);let e=localStorage.getItem("productDataVersion"),o=e?`/data/product_data.json?v=${encodeURIComponent(e)}`:"/data/product_data.json",s=await fetch(o,{cache:"no-store",headers:{Accept:"application/json"}});if(!s.ok)return null;let l=await s.json(),u=Array.isArray(l==null?void 0:l.products)?l.products:Array.isArray(l)?l:[];return Ce(u,{version:(l==null?void 0:l.version)||e||null,source:"seo-fallback"}),zt(u)}catch(t){return console.error("[modules/seo] Error loading product data:",t),null}}async function Ut(){try{if(document.querySelector('script[type="application/ld+json"]')){jt();return}let t=typeof window!="undefined"?window[R]:null;if(t!=null&&t.structuredDataInjected)return;let e=await _e();if(!e)return;let s=Object.values(e).slice(0,20).map(v=>({"@type":"Product",name:v.name,image:v.image_path,description:v.description,brand:v.brand||"Gen\xE9rico",offers:{"@type":"Offer",price:v.price,priceCurrency:"CLP",availability:v.stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}})),l={"@context":"https://schema.org","@graph":[{"@type":"Store",name:"El Rinc\xF3n de \xC9bano",image:"https://elrincondeebano.com/assets/images/web/logo.webp",description:"Un minimarket en la puerta de tu departamento",address:{"@type":"PostalAddress",addressCountry:"CL"},telephone:"+56951118901",url:"http://www.elrincondeebano.com/",contactPoint:{"@type":"ContactPoint",telephone:"+56-951118901",contactType:"customer service"}},...s]},u=document.createElement("script");u.type="application/ld+json",window&&window.__CSP_NONCE__&&u.setAttribute("nonce",window.__CSP_NONCE__),u.textContent=JSON.stringify(l),document.head.appendChild(u),jt()}catch(t){console.error("[modules/seo] Error generating structured data:",t)}}function Rt(){try{if(!document.querySelector('link[rel="canonical"]')){let t=document.createElement("link");t.rel="canonical",t.href=location.origin+location.pathname,document.head.appendChild(t)}if(!document.querySelector('meta[name="description"]')){let t=document.createElement("meta");t.name="description",t.content="El Rinc\xF3n de \xC9bano - Minimarket con delivery instant\xE1neo.",document.head.appendChild(t)}}catch(t){console.warn("[modules/seo] injectSeoMetadata error:",t)}}function Ft(){try{if(!document.querySelector('link[rel="manifest"]')){let t=document.createElement("link");t.rel="manifest",t.href="/app.webmanifest",document.head.appendChild(t)}}catch(t){console.warn("[modules/pwa] injectPwaManifest error:",t)}}function Vt(){var t;try{(t=window==null?void 0:window.console)!=null&&t.debug&&console.debug("[modules/checkout] setupCheckoutProgress: no-op")}catch(e){}}var Wt=!1,Ht=new Map,ct=null,st=null,lt=null;function dt(t){if(t&&typeof t=="object"){if(t.default)return t.default;let e=Object.keys(t);if(e.length===1)return t[e[0]]}return t}function ut(t,e){return!t||!e?null:typeof t.getOrCreateInstance=="function"?t.getOrCreateInstance(e):new t(e)}function Se(t){return t?typeof t=="string"?document.querySelector(t):t:null}function ft(t,e){return Ht.has(t)?Ht.get(t)():e()}async function Ie(){ct||(ct=ft("collapse",()=>import("./chunks/collapse-NY5MXN7U.js")));let t=await ct;return dt(t)}async function Le(){st||(st=ft("dropdown",()=>import("./chunks/dropdown-3RTH4GTX.js")));let t=await st;return dt(t)}async function Pe(){lt||(lt=ft("offcanvas",()=>import("./chunks/offcanvas-HI6BCH6F.js")));let t=await lt;return dt(t)}function ke(){document.querySelectorAll('[data-bs-toggle="collapse"][data-bs-target]').forEach(e=>{e.addEventListener("click",()=>{xe(e)})})}async function xe(t){var e;try{let o=t.getAttribute("data-bs-target");if(!o)return;let s=document.querySelector(o);if(!s)return;let l=await Ie(),u=ut(l,s);(e=u==null?void 0:u.toggle)==null||e.call(u)}catch(o){console.error("No se pudo inicializar el Collapse de Bootstrap",o)}}function Ae(){document.querySelectorAll('[data-bs-toggle="dropdown"]').forEach(e=>{e.addEventListener("click",o=>{o.preventDefault(),qe(e)})})}async function qe(t){var e;try{let o=await Le(),s=ut(o,t);(e=s==null?void 0:s.toggle)==null||e.call(s)}catch(o){console.error("No se pudo inicializar el Dropdown de Bootstrap",o)}}function Kt(){Wt||(Wt=!0,typeof document!="undefined"&&(ke(),Ae()))}async function Gt(t){if(typeof document=="undefined")throw new Error("Offcanvas no disponible en este entorno");let e=Se(t);if(!e)throw new Error("No se encontr\xF3 el elemento de Offcanvas");let o=await Pe(),s=ut(o,e);if(!s||typeof s.show!="function")throw new Error("Instancia de Offcanvas inv\xE1lida");return s.show(),s}function G(t,e={}){let o=t.startsWith("/")?t:"/"+t,s=Object.entries(e).map(([u,v])=>`${u}=${v}`).join(","),l=o.split("/").map(encodeURIComponent).join("/");return`/cdn-cgi/image/${s}${l}`}var Q={fit:"cover",quality:82,format:"auto"};var te="__PRODUCT_DATA__",et=null,L=Object.freeze({hidden:"is-hidden",flex:"is-flex",block:"is-block",contentVisible:"has-content-visibility",containIntrinsic:"has-contain-intrinsic"});function vt(){if(typeof window!="undefined"){let t=window[te];if(t&&Array.isArray(t.products))return t}return et&&Array.isArray(et.products)?et:null}function ee(t,e={},{force:o=!1}={}){if(!Array.isArray(t))return null;let s={products:t,version:e.version||null,source:e.source||null,updatedAt:e.updatedAt||Date.now(),isPartial:!!e.isPartial,total:typeof e.total=="number"?e.total:null},l=vt();if(l&&!o){let u=l.version||null,v=s.version||null;if(!v&&u||!v&&!u||v&&u===v)return l}return et=s,typeof window!="undefined"&&(window[te]={...s}),s}function yt(t,e={}){return ee(t,e,{force:!1})}function Te(t,e={}){return ee(t,e,{force:!0})}var ht={path:"/service-worker.js",scope:"/",updateCheckInterval:300*1e3},Qt=!1;function ne(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}if(Qt)return;Qt=!0;let t=async()=>{if(document.readyState==="complete"){window.removeEventListener("load",t);try{await Oe()}catch(e){console.error("Service Worker initialization failed:",e),ze("Failed to initialize service worker. Some features may not work offline.")}}};window.addEventListener("load",t),t()}async function Oe(){try{let t=await navigator.serviceWorker.register(ht.path,{scope:ht.scope});console.log("ServiceWorker registered successfully:",t.scope),Be(t),Me(t),De(),Ne()}catch(t){throw console.error("ServiceWorker registration failed:",t),t}}function Be(t){t.addEventListener("updatefound",()=>{let e=t.installing;e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&e.postMessage({type:"SKIP_WAITING"})})})}function Me(t){Yt(t),setInterval(()=>{Yt(t)},ht.updateCheckInterval)}async function Yt(t){var e;try{await t.update();let o=await fetch("/data/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(o.ok){let l=(await o.json()).version,u=localStorage.getItem("productDataVersion");l!==u&&((e=t.active)==null||e.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",l),$e(null,"New product data available"))}}catch(o){console.warn("Update check failed:",o)}}function De(){let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}function Ne(){let t=document.getElementById("offline-indicator");if(!t)return;let e=()=>{let o=navigator.onLine;t.classList.toggle(L.hidden,o),t.classList.toggle(L.block,!o),o||je("You are currently offline. Some features may be limited.")};window.addEventListener("online",e),window.addEventListener("offline",e),navigator.onLine||e()}var pt=null;function bt(){return pt||(pt=import("./chunks/notifications-533VS4FV.js")),pt}function $e(t,e="Una versi\xF3n est\xE1 disponible"){bt().then(o=>o.showUpdateNotification(t,e))}function ze(t){bt().then(e=>e.showServiceWorkerError(t))}function je(t){bt().then(e=>e.showConnectivityNotification(t))}typeof navigator!="undefined"&&"serviceWorker"in navigator&&ne();var Ue=t=>typeof t=="object"&&t!==null||typeof t=="function",mt=()=>({map:new Map,weakMap:new WeakMap,hasValue:!1,value:void 0}),Re=(t,e=100)=>{if(typeof t!="function")throw new TypeError("Expected a function to memoize");(!Number.isFinite(e)||e<0)&&(e=0);let o=mt(),s=[],l=p=>{let h=s.indexOf(p);h!==-1&&s.splice(h,1),e>0&&s.push(p)},u=()=>{if(e!==0)for(;s.length>e;){let p=s.shift();p&&(p.hasValue=!1,p.value=void 0)}},v=(p,h)=>{if(Ue(h)){let b=p.weakMap.get(h);return b||(b=mt(),p.weakMap.set(h,b)),b}return p.map.has(h)||p.map.set(h,mt()),p.map.get(h)};return(...p)=>{if(e===0)return t(...p);let h=o;for(let b=0;b<p.length;b+=1)h=v(h,p[b]);if(h.hasValue)return l(h),h.value;let I=t(...p);return h.value=I,h.hasValue=!0,l(h),u(),I}},Fe=(t,e)=>{let o;return(...s)=>{clearTimeout(o),o=setTimeout(()=>t(...s),e)}},z=t=>{if(!t)return"";try{return String(t).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}catch(e){return String(t).toLowerCase()}},Ve=t=>{let e=`${t.name}-${t.category}`.toLowerCase(),o=0;for(let s=0;s<e.length;s++){let l=e.charCodeAt(s);o=(o<<5)-o+l,o=o&o}return`pid-${Math.abs(o)}`},gt=t=>{let e=document.createElement("div");return e.textContent=t,e.innerHTML},We="product-data",He=()=>{try{return typeof localStorage=="undefined"?null:localStorage.getItem("productDataVersion")}catch(t){return console.warn("Unable to read stored product data version:",t),null}},Jt=t=>{if(t)try{if(typeof localStorage=="undefined")return;localStorage.setItem("productDataVersion",t)}catch(e){console.warn("Unable to persist product data version:",e)}},re=()=>{if(typeof document=="undefined")return null;try{let t=document.getElementById(We);if(!t||!t.textContent)return null;let e=t.textContent.trim();if(!e)return null;let o=JSON.parse(e);return o?Array.isArray(o.initialProducts)?o:Array.isArray(o.products)?{...o,initialProducts:o.products}:null:null}catch(t){return B("warn","inline_product_parse_failure",{error:t.message}),null}},Ke=(t,e)=>{let o=t.id||Ve(t),s=typeof t.originalIndex=="number"?t.originalIndex:typeof t.order=="number"?t.order:e;return{...t,id:o,name:gt(t.name),description:gt(t.description),category:gt(t.category),categoryKey:t.categoryKey||z(t.category),originalIndex:s}},wt=(t=[])=>t.map((e,o)=>Ke(e,o));function Ge(){let t=vt();if(t)return t;let e=re();if(!e||!Array.isArray(e.initialProducts))return null;let o=wt(e.initialProducts);return yt(o,{version:e.version||null,source:"inline",isPartial:!0,total:typeof e.totalProducts=="number"?e.totalProducts:o.length})}Ge();var Y=class extends Error{constructor(e,{cause:o,correlationId:s}){super(e),this.name="ProductDataError",this.correlationId=s,o&&(this.cause=o)}},Qe=async(t,e,o,s,l)=>{let u=new URL(t,window.location.origin);if(u.origin!==window.location.origin||u.protocol!=="https:")throw new Error("Invalid request URL: only same-origin HTTPS requests are allowed");let v=u.toString(),p=0,h;for(;p<=o;)try{let I=Date.now(),b=await fetch(v,e),C=Date.now()-I;if(B("info","fetch_products_attempt",{correlationId:l,attempt:p+1,durationMs:C}),!b.ok)throw new Error(`HTTP error. Status: ${b.status}`);return b}catch(I){if(h=I,p++,p>o)break;B("warn","fetch_products_retry",{correlationId:l,attempt:p,error:I.message,runbook:"RUNBOOK.md#product-data"}),await new Promise(b=>setTimeout(b,s*p))}throw new Y(`Failed to fetch products: ${h.message}`,{cause:h,correlationId:l})},Ye=async()=>{let t=Mt(),e=re(),o=(e==null?void 0:e.initialProducts)||null,s=(e==null?void 0:e.version)||null,l=typeof(e==null?void 0:e.totalProducts)=="number"?e.totalProducts:null,u=Array.isArray(o)?wt(o):null,v=Array.isArray(u),p=He();v&&(s&&Jt(s),yt(u,{version:s||null,source:"inline",isPartial:!0,total:l!=null?l:u.length}),B("info","fetch_products_inline_bootstrap",{correlationId:t,count:u.length}));let h=p||s||null,I=h?`/data/product_data.json?v=${encodeURIComponent(h)}`:"/data/product_data.json";try{let C=await(await Qe(I,{cache:"no-store",headers:{Accept:"application/json"}},2,300,t)).json(),_=wt(C.products||[]);return Te(_,{version:C.version||null,source:"network",isPartial:!1,total:_.length}),C.version&&Jt(C.version),B("info","fetch_products_success",{correlationId:t,count:_.length,source:"network"}),_}catch(b){if(v)return yt(u,{version:s||null,source:"inline-fallback",isPartial:!0,total:l!=null?l:u.length}),B("warn","fetch_products_network_fallback_inline",{correlationId:t,error:b.message,runbook:"RUNBOOK.md#product-data"}),u;throw B("error","fetch_products_failure",{correlationId:t,error:b.message,runbook:"RUNBOOK.md#product-data"}),A(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${b.message})`),b instanceof Y?b:new Y(b.message,{cause:b,correlationId:t})}},f=(t,e={},o=[])=>{let s=document.createElement(t);return Object.entries(e).forEach(([l,u])=>{l==="text"?s.textContent=u:s.setAttribute(l,u)}),o.forEach(l=>{typeof l=="string"?s.appendChild(document.createTextNode(l)):s.appendChild(l)}),s},A=t=>{let e=f("div",{class:"error-message",role:"alert"},[f("p",{},[t]),f("button",{class:"retry-button"},["Intentar nuevamente"])]),o=document.getElementById("product-container");o?(o.innerHTML="",o.appendChild(e),e.querySelector(".retry-button").addEventListener("click",oe)):console.error("Contenedor de productos no encontrado")},Zt=[],Xt;try{Zt=JSON.parse((Xt=globalThis.localStorage)==null?void 0:Xt.getItem("cart"))||[]}catch(t){Zt=[]}var Je=(t=typeof window!="undefined"?window.performance:void 0)=>{let e="unavailable",o="unavailable",s="unavailable";try{if(!t||typeof t.getEntriesByType!="function")return;let l=t.getEntriesByType("paint")||[],u=t.getEntriesByType("navigation")||[],v=l.find(h=>(h==null?void 0:h.name)==="first-contentful-paint")||l[0];v&&typeof v.startTime=="number"&&(e=v.startTime);let p=u[0];p&&typeof p.domContentLoadedEventEnd=="number"?o=p.domContentLoadedEventEnd:t.timing&&typeof t.timing.domContentLoadedEventEnd=="number"&&(o=t.timing.domContentLoadedEventEnd),p&&typeof p.loadEventEnd=="number"?s=p.loadEventEnd:t.timing&&typeof t.timing.loadEventEnd=="number"&&(s=t.timing.loadEventEnd)}catch(l){console.warn("Performance metrics unavailable:",l)}finally{console.log("First Contentful Paint:",e),console.log("DOM Content Loaded:",o),console.log("Load Time:",s)}};typeof window!="undefined"&&(window.__APP_READY__=!1,window.addEventListener("error",t=>{let e=t.target||t.srcElement,o=!!(e&&(e.tagName==="IMG"||e.tagName==="SCRIPT"||e.tagName==="LINK")),s=!!t.error;if(o||!s){console.warn("Ignored non-fatal error:",{tag:e&&e.tagName,src:e&&(e.src||e.href||e.currentSrc)});return}if(!window.__APP_READY__){console.error("Runtime error before app ready:",t.error);return}console.error("Unhandled JS error:",t.error),A("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")}),window.addEventListener("securitypolicyviolation",t=>{console.warn("CSP violation (logged only):",{blockedURI:t.blockedURI,violatedDirective:t.violatedDirective,sourceFile:t.sourceFile})}));var oe=async()=>{var xt,At,qt;console.log("Initializing app...");let t=document.getElementById("product-container"),e=document.getElementById("sort-options"),o=document.getElementById("filter-keyword"),s=document.getElementById("cart-count"),l=document.getElementById("cart-items"),u=document.getElementById("cart-total"),p=Object.entries({"#product-container":t,"#sort-options":e,"#filter-keyword":o,"#cart-count":s,"#cart-items":l,"#cart-total":u}).filter(([,n])=>!n).map(([n])=>n);if(p.length){B("warn","init_app_missing_dom",{missingSelectors:p,location:typeof window!="undefined"?(xt=window.location)==null?void 0:xt.pathname:"unknown"});return}let h=()=>{let n=document.getElementById("filter-discount");if(n)return n;let a=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),c=a?a.querySelector(".row"):null;if(!c)return null;let i=f("div",{class:"col-12 mt-2"}),r=f("div",{class:"form-check form-switch"}),d=f("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),m=f("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return r.appendChild(d),r.appendChild(m),i.appendChild(r),c.appendChild(i),d},I=12,b=12,C=[],_=[],M=0,Et=I,j=null,J=null,Z=null,X=!1,P=JSON.parse(localStorage.getItem("cart"))||[],nt=()=>{let n=document.getElementById("offline-indicator");if(n){let a=navigator.onLine;n.classList.toggle(L.hidden,a),n.classList.toggle(L.block,!a)}navigator.onLine||console.log("App is offline. Using cached data if available.")};function ie(){let n=document.getElementById("current-year");n&&(n.textContent=new Date().getFullYear())}let ce=(n,a,c="CLP")=>{let i=new Intl.NumberFormat("es-CL",{style:"currency",currency:c,minimumFractionDigits:0}),r=i.format(n);if(a){let d=n-a,m=i.format(d);return f("div",{class:"precio-container"},[f("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[m]),f("span",{class:"precio-original","aria-label":"Precio original"},[f("span",{class:"tachado"},[r])])])}return f("div",{class:"precio-container"},[f("span",{class:"precio","aria-label":"Precio"},[r])])},se=n=>{let a=f("div",{class:`quantity-control ${L.hidden}`}),c=f("button",{class:"quantity-btn","data-action":"decrease","aria-label":"Decrease quantity"},["-"]),i=f("button",{class:"quantity-btn","data-action":"increase","aria-label":"Increase quantity"},["+"]),r=f("input",{type:"number",class:"quantity-input",value:Math.max(F(n.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":n.id});return a.appendChild(c),a.appendChild(r),a.appendChild(i),a};function Ct(n,a){var k;if(!n)return;let c=n.querySelector(".add-to-cart-btn"),i=n.querySelector(".quantity-control"),r=i==null?void 0:i.querySelector(".quantity-input"),d=(i==null?void 0:i.querySelector('.quantity-btn[data-action="decrease"]'))||(i==null?void 0:i.querySelector(".quantity-btn")),m=(i==null?void 0:i.querySelector('.quantity-btn[data-action="increase"]'))||((k=i==null?void 0:i.querySelectorAll(".quantity-btn"))==null?void 0:k[1]),y=(w,g,E)=>{w&&w.dataset.listenerAttached!=="true"&&(w.addEventListener(g,E),w.dataset.listenerAttached="true")};y(c,"click",()=>{Pt(a,1),H(c,i,!0)}),y(d,"click",()=>W(a,-1)),y(m,"click",()=>W(a,1)),y(r,"change",w=>{let g=parseInt(w.target.value,10);if(!Number.isFinite(g)){w.target.value=Math.max(F(a.id),1);return}let E=F(a.id);W(a,g-E)});let S=F(a.id);r&&(r.value=S>0?S:1),H(c,i,S>0)}let F=n=>{let a=P.find(c=>c.id===n);return a?a.quantity:0},le=(n,{reset:a=!1}={})=>{if(!t)return 0;a&&(t.innerHTML="");let c=document.createDocumentFragment();return n.forEach(i=>{let{id:r,name:d,description:m,image_path:y,price:S,discount:k,stock:w}=i,g=["producto","col-12","col-sm-6","col-md-4","col-lg-3","mb-4",w?"":"agotado",L.contentVisible,L.containIntrinsic].filter(Boolean).join(" "),E=f("div",{class:g,"aria-label":`Product: ${d}`,"data-product-id":r}),T=f("div",{class:"card"});if(k&&Number(k)>0){let x=Math.round(Number(k)/Number(S)*100),Tt=f("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(x)?x:0}%`]);T.appendChild(Tt)}let D=`/${y.replace(/^\//,"")}`,$=f("img",{src:G(D,{...Q,width:400}),srcset:[`${G(D,{...Q,width:200})} 200w`,`${G(D,{...Q,width:400})} 400w`,`${G(D,{...Q,width:800})} 800w`].join(", "),sizes:"(min-width: 1200px) 25vw, (min-width: 992px) 33vw, (min-width: 576px) 50vw, 100vw",alt:d,class:"card-img-top product-thumb",loading:"lazy",fetchpriority:"auto",decoding:"async",width:"400",height:"400"});T.appendChild($);let U=f("div",{class:"card-body"});U.appendChild(f("h3",{class:"card-title"},[d])),U.appendChild(f("p",{class:"card-text"},[m])),U.appendChild(ce(S,k));let N=f("div",{class:"action-area","data-pid":r}),it=f("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":r,"aria-label":`Add ${d} to cart`},["Agregar al carrito"]),O=se(i);N.appendChild(it),N.appendChild(O),U.appendChild(N),Ct(N,i),T.appendChild(U),E.appendChild(T),c.appendChild(E)}),t.appendChild(c),fe(),n.length},de=n=>{if(!t)return 0;let a=t.querySelectorAll("[data-product-id]");if(!a.length)return 0;let c=new Map(n.map(r=>[r.id,r])),i=0;return a.forEach(r=>{let d=r.getAttribute("data-product-id");if(!d||!c.has(d))return;let m=c.get(d);r.classList.add(L.contentVisible,L.containIntrinsic);let y=r.querySelector(".action-area");Ct(y,m),i+=1}),i},_t=()=>{t&&(t.innerHTML=""),M=0},rt=()=>{var i,r,d;let n=(e==null?void 0:e.value)||"original",a=((r=(i=o==null?void 0:o.value)==null?void 0:i.trim)==null?void 0:r.call(i))||"",c=((d=document.getElementById("filter-discount"))==null?void 0:d.checked)||!1;_=we(C,a,n,c)},St=n=>{if(!Array.isArray(_)||_.length===0)return q(),!1;let a=M;if(a>=_.length)return q(),!1;let c=_.slice(a,a+n);return c.length?(le(c),M+=c.length,q(),!0):(q(),!1)},ot=()=>St(Et||I),It=()=>St(b),q=()=>{let n=M<_.length;j&&(j.classList.toggle("d-none",!n),j.disabled=!n),Z&&J&&(Z.disconnect(),n&&Z.observe(J))},ue=()=>{j=document.getElementById("catalog-load-more"),J=document.getElementById("catalog-sentinel"),j&&j.addEventListener("click",()=>{It()}),J&&typeof window!="undefined"&&"IntersectionObserver"in window&&(Z=new IntersectionObserver(n=>{n.forEach(a=>{a.isIntersecting&&It()})},{rootMargin:"200px"})),q()},fe=()=>{if(typeof window!="undefined"&&"IntersectionObserver"in window){let n=new IntersectionObserver((a,c)=>{a.forEach(i=>{if(i.isIntersecting){let r=i.target;r.src=r.dataset.src,r.dataset.srcset&&(r.srcset=r.dataset.srcset),r.dataset.sizes&&(r.sizes=r.dataset.sizes),r.classList.remove("lazyload"),c.unobserve(r)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(a=>n.observe(a))}else document.querySelectorAll("img.lazyload").forEach(n=>{n.dataset.src&&(n.src=n.dataset.src),n.dataset.srcset&&(n.srcset=n.dataset.srcset),n.dataset.sizes&&(n.sizes=n.dataset.sizes),n.classList.remove("lazyload")})};function pe(n,a){if(!n||!a||n.length<3)return!1;let c=d=>d.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),i=c(n),r=c(a);return r.includes(i)?!0:i.length>=4?me(i,r):!1}function me(n,a){return a.split(/\s+/).some(i=>{if(Math.abs(i.length-n.length)>1)return!1;let r=0,d=Math.max(i.length,n.length);if(Math.min(i.length,n.length)<4)return!1;if(i.length===n.length){for(let y=0;y<i.length;y++)if(i[y]!==n[y]&&r++,r>1)return!1;return r===1}else return ge(n,i)})}function ge(n,a){let c=n.length>a.length?n:a,i=n.length>a.length?a:n;if(c.length-i.length!==1)return!1;let r=0,d=0,m=0;for(;d<i.length&&m<c.length;)if(i[d]===c[m])d++,m++;else{if(r++,r>1)return!1;m++}return!0}let ye=(n,a,c,i=!1)=>{let r=a.trim();return n.filter(d=>!d.stock||i&&!(d.discount&&Number(d.discount)>0)?!1:!r||d.name.toLowerCase().includes(r.toLowerCase())||d.description.toLowerCase().includes(r.toLowerCase())?!0:r.length>=4?pe(r,d.name):!1).sort((d,m)=>he(d,m,c))},he=(n,a,c)=>{if(!c||c==="original")return n.originalIndex-a.originalIndex;let[i,r]=c.split("-"),d=i==="price"?n.price-(n.discount||0):n.name.toLowerCase(),m=i==="price"?a.price-(a.discount||0):a.name.toLowerCase();return r==="asc"?d<m?-1:d>m?1:0:m<d?-1:m>d?1:0},we=Re(ye),Lt=()=>{try{if(rt(),_t(),!_.length){q();return}ot()}catch(n){console.error("Error al actualizar visualizaci\xF3n de productos:",n),A("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},at=Fe(Lt,300),V=()=>{let n=document.getElementById("cart-count"),a=P.reduce((c,i)=>c+i.quantity,0);n.textContent=a,n.setAttribute("aria-label",`${a} items in cart`)},Pt=(n,a)=>{try{let c=P.find(r=>r.id===n.id);c?c.quantity=Math.min(c.quantity+a,50):P.push({id:n.id,name:n.name,description:n.description,price:n.price,discount:n.discount,image_path:n.image_path,quantity:Math.min(a,50),category:n.category,stock:n.stock}),tt(),V(),K();let i=document.querySelector(`[data-id="${n.id}"].quantity-input`);i&&(i.value=Math.max(F(n.id),1))}catch(c){console.error("Error al agregar al carrito:",c),A("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},kt=n=>{try{P=P.filter(c=>c.id!==n),tt(),V(),K();let a=document.querySelector(`.action-area[data-pid="${n}"]`);if(a){let c=a.querySelector(".add-to-cart-btn"),i=a.querySelector(".quantity-control");H(c,i,!1)}}catch(a){console.error("Error al eliminar del carrito:",a),A("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},W=(n,a)=>{try{let c=P.find(y=>y.id===n.id),i=c?c.quantity+a:1,r=document.querySelector(`.action-area[data-pid="${n.id}"]`),d=r==null?void 0:r.querySelector(".add-to-cart-btn"),m=r==null?void 0:r.querySelector(".quantity-control");if(i<=0)kt(n.id),H(d,m,!1);else if(i<=50){c?c.quantity=i:(Pt(n,1),H(d,m,!0)),tt(),V(),K();let y=document.querySelector(`[data-id="${n.id}"].quantity-input`);y&&(y.value=i,y.classList.add("quantity-changed"),setTimeout(()=>y.classList.remove("quantity-changed"),300))}}catch(c){console.error("Error al actualizar cantidad:",c),A("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},ve=()=>{try{P=[],tt(),V(),K(),Lt()}catch(n){console.error("Error al vaciar el carrito:",n),A("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},H=(n,a,c)=>{if(!n||!a)return;let i=!c;n.classList.toggle(L.hidden,!i),n.classList.toggle(L.flex,i),a.classList.toggle(L.hidden,!c),a.classList.toggle(L.flex,c)},tt=()=>{try{localStorage.setItem("cart",JSON.stringify(P))}catch(n){console.error("Error al guardar el carrito:",n),A("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},K=()=>{let n=document.getElementById("cart-items"),a=document.getElementById("cart-total");n.innerHTML="";let c=0;P.forEach(r=>{let d=r.price-(r.discount||0),m=f("div",{class:"cart-item mb-3 d-flex align-items-start","aria-label":`Cart item: ${r.name}`}),y=f("div",{class:"cart-item-content flex-grow-1"});y.appendChild(f("div",{class:"fw-bold mb-1"},[r.name]));let S=f("div",{class:"mb-2"}),k=f("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":r.id,"aria-label":`Disminuir cantidad de ${r.name}`},["-"]),w=f("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":r.id,"aria-label":`Aumentar cantidad de ${r.name}`},["+"]),g=f("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${r.name}`},[r.quantity.toString()]);S.appendChild(k),S.appendChild(g),S.appendChild(w),y.appendChild(S),y.appendChild(f("div",{class:"text-muted small"},[`Precio: $${d.toLocaleString("es-CL")}`])),y.appendChild(f("div",{class:"fw-bold"},[`Subtotal: $${(d*r.quantity).toLocaleString("es-CL")}`]));let E=f("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":r.id,"aria-label":`Eliminar ${r.name} del carrito`},["Eliminar"]);y.appendChild(E);let T=window.location.pathname.includes("/pages/"),D;T?D=`../${r.image_path.replace(/^\//,"")}`:D=r.image_path;let $=f("div",{class:"cart-item-thumb ms-3 flex-shrink-0"}),N={src:r.thumbnail_path||D,alt:r.name,class:"cart-item-thumb-img",loading:"lazy",decoding:"async",width:"100",height:"100"};if(Array.isArray(r.thumbnail_variants)){let O=r.thumbnail_variants.filter(x=>x&&x.url&&x.width).map(x=>`${x.url} ${x.width}w`);O.length&&(N.srcset=O.join(", "),N.sizes="100px")}let it=f("img",N);if($.appendChild(it),m.appendChild(y),m.appendChild($),n.appendChild(m),window.__DEBUG_CART__)try{let O=window.getComputedStyle(m),x=window.getComputedStyle($),Tt=window.getComputedStyle(y),Ot=$.getBoundingClientRect(),Bt=y.getBoundingClientRect();console.debug("[cart] item",{name:r.name,order:{firstIsContent:m.firstChild===y,lastIsThumb:m.lastChild===$},container:{display:O.display,flexDirection:O.flexDirection,flexWrap:O.flexWrap},thumb:{width:x.width,height:x.height,rect:{w:Ot.width,h:Ot.height}},content:{rect:{w:Bt.width,h:Bt.height}}})}catch(O){}c+=d*r.quantity}),a.textContent=`Total: $${c.toLocaleString("es-CL")}`,a.setAttribute("aria-label",`Total: $${c.toLocaleString("es-CL")}`);let i=document.getElementById("payment-credit-container");if(i)if(c>=3e4)i.classList.remove("d-none");else{i.classList.add("d-none");let r=i.querySelector("input");r&&(r.checked=!1)}},be=()=>{let n=document.querySelector('input[name="paymentMethod"]:checked');if(!n){alert("Por favor seleccione un m\xE9todo de pago");return}let a=`Mi pedido:

`;P.forEach(r=>{let d=r.price-(r.discount||0);a+=`${r.name}
`,a+=`Cantidad: ${r.quantity}
`,a+=`Precio unitario: $${d.toLocaleString("es-CL")}
`,a+=`Subtotal: $${(d*r.quantity).toLocaleString("es-CL")}

`});let c=P.reduce((r,d)=>r+(d.price-(d.discount||0))*d.quantity,0);a+=`Total: $${c.toLocaleString("es-CL")}
`,a+=`M\xE9todo de pago: ${n.value}`;let i=encodeURIComponent(a);window.open(`https://wa.me/56951118901?text=${i}`,"_blank")};try{ie();let n=vt();(At=n==null?void 0:n.products)!=null&&At.length&&(C=n.products.map((w,g)=>({...w,originalIndex:typeof w.originalIndex=="number"?w.originalIndex:g,categoryKey:w.categoryKey||z(w.category)})));let a=document.querySelector("main"),c=((qt=a==null?void 0:a.dataset)==null?void 0:qt.category)||"";if(c){let w=z(c);C=C.filter(g=>(g.categoryKey||z(g.category))===w).map((g,E)=>({...g,originalIndex:typeof g.originalIndex=="number"?g.originalIndex:E}))}let i=de(C);i>0?(M=i,Et=i):M=0,ue(),rt(),q(),M===0&&_.length&&ot();let r=Ye();e.addEventListener("change",()=>{X=!0,at()}),o.addEventListener("input",()=>{X=!0,at()});let d=h();d&&d.addEventListener("change",()=>{X=!0,at()});let m=await r;if(!Array.isArray(m)||m.length===0){if(!C.length){A("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}}else if(C=m.map((w,g)=>({...w,originalIndex:typeof w.originalIndex=="number"?w.originalIndex:g,categoryKey:w.categoryKey||z(w.category)})),c){let w=z(c);C=C.filter(g=>(g.categoryKey||z(g.category))===w).map((g,E)=>({...g,originalIndex:typeof g.originalIndex=="number"?g.originalIndex:E}))}rt(),X||M===0?(_t(),_.length?ot():q()):q(),typeof window!="undefined"&&(window.__APP_READY__=!0),window.addEventListener("online",nt),window.addEventListener("offline",nt),nt();let y=document.getElementById("cart-icon"),S=document.getElementById("empty-cart"),k=document.getElementById("submit-cart");y&&y.addEventListener("click",async()=>{K();try{await Gt("#cartOffcanvas")}catch(w){console.error("Bootstrap Offcanvas no est\xE1 disponible",w);let g=document.getElementById("cartOffcanvas");g&&g.classList.add("show")}}),S&&S.addEventListener("click",ve),k&&k.addEventListener("click",be),l&&l.addEventListener("click",w=>{var T;let g=w.target,E=(T=g.closest("[data-id]"))==null?void 0:T.dataset.id;E&&(g.classList.contains("decrease-quantity")?W({id:E},-1):g.classList.contains("increase-quantity")?W({id:E},1):g.classList.contains("remove-item")&&kt(E))}),V(),"performance"in window&&window.addEventListener("load",()=>{Je()})}catch(n){console.error("Error al inicializar productos:",n),A("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document!="undefined"&&document.addEventListener("DOMContentLoaded",function(){ne(),oe().catch(t=>{console.error("Error al inicializar la aplicaci\xF3n:",t),A("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})});function ae(){let t=document.documentElement;try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-defer]').forEach(e=>{e.media="all",e.removeAttribute("data-defer")})}catch(e){}t.dataset.enhancementsInit!=="1"&&(t.dataset.enhancementsInit="1",Dt(),Vt(),Nt(),$t(),Rt(),Ut(),Ft(),Kt())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ae):ae();try{typeof window!="undefined"&&window.__ANALYTICS_ENABLE__===!0&&import("./chunks/analytics-O2RU3SL6.js").then(t=>{t.initAnalytics({enabled:!0,consentRequired:!0,sampleRate:1}),window.__analyticsTrack=(e,o)=>{try{return t.track(e,o)}catch(s){return!1}},t.track("page_view",{path:location.pathname})}).catch(()=>{})}catch(t){}export{ae as __initEnhancementsOnceForTest};
