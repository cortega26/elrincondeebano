(()=>{var D=(t,e)=>()=>(t&&(e=t(t=0)),e);var le=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);function vt(){try{let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=`
      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */
      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }
      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }

      /* Contornos de enfoque claros para accesibilidad */
      .navbar .nav-link:focus,
      .navbar .dropdown-item:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* Espaciado entre botones en el offcanvas del carrito */
      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }
    `,document.head.appendChild(t)}catch(t){console.warn("[modules/enhancements] injectEnhancementStyles error:",t)}}var bt=D(()=>{});function Ct(){try{document.addEventListener("keydown",e=>{e.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=".keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }",document.head.appendChild(t)}catch(t){console.warn("[modules/a11y] setupNavigationAccessibility error:",t)}}var Et=D(()=>{});function St(){try{"loading"in HTMLImageElement.prototype&&document.querySelectorAll("img:not([loading])").forEach(t=>{t.loading="lazy"})}catch(t){console.warn("[modules/perf] setupPerformanceOptimizations error:",t)}}var It=D(()=>{});function de(){try{if(typeof window>"u")return null;let t=window[N];if(t&&Array.isArray(t.products))return t.products}catch(t){console.warn("[modules/seo] Unable to read shared product data:",t)}return null}function ue(t,e={}){if(typeof window>"u"||!Array.isArray(t))return;let a=window[N]||{};window[N]={...a,products:t,version:e.version??a.version??null,updatedAt:e.updatedAt||Date.now(),source:e.source||a.source||"seo"}}function Pt(t=[]){let e={};return t.forEach(a=>{let l=a.id||String(a.name)+"-"+String(a.category);e[l]=a}),e}function _t(){if(typeof window>"u")return;let t=window[N]||{};t.structuredDataInjected||(window[N]={...t,structuredDataInjected:!0})}async function fe(){try{let t=de();if(t)return Pt(t);let e=localStorage.getItem("productDataVersion"),a=e?`/data/product_data.json?v=${encodeURIComponent(e)}`:"/data/product_data.json",l=await fetch(a,{cache:"no-store",headers:{Accept:"application/json"}});if(!l.ok)return null;let d=await l.json(),p=Array.isArray(d?.products)?d.products:Array.isArray(d)?d:[];return ue(p,{version:d?.version||e||null,source:"seo-fallback"}),Pt(p)}catch(t){return console.error("[modules/seo] Error loading product data:",t),null}}async function Lt(){try{if(document.querySelector('script[type="application/ld+json"]')){_t();return}if((typeof window<"u"?window[N]:null)?.structuredDataInjected)return;let e=await fe();if(!e)return;let l=Object.values(e).slice(0,20).map(h=>({"@type":"Product",name:h.name,image:h.image_path,description:h.description,brand:h.brand||"Gen\xE9rico",offers:{"@type":"Offer",price:h.price,priceCurrency:"CLP",availability:h.stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}})),d={"@context":"https://schema.org","@graph":[{"@type":"Store",name:"El Rinc\xF3n de \xC9bano",image:"https://elrincondeebano.com/assets/images/web/logo.webp",description:"Un minimarket en la puerta de tu departamento",address:{"@type":"PostalAddress",addressCountry:"CL"},telephone:"+56951118901",url:"http://www.elrincondeebano.com/",contactPoint:{"@type":"ContactPoint",telephone:"+56-951118901",contactType:"customer service"}},...l]},p=document.createElement("script");p.type="application/ld+json",window&&window.__CSP_NONCE__&&p.setAttribute("nonce",window.__CSP_NONCE__),p.textContent=JSON.stringify(d),document.head.appendChild(p),_t()}catch(t){console.error("[modules/seo] Error generating structured data:",t)}}function At(){try{if(!document.querySelector('link[rel="canonical"]')){let t=document.createElement("link");t.rel="canonical",t.href=location.origin+location.pathname,document.head.appendChild(t)}if(!document.querySelector('meta[name="description"]')){let t=document.createElement("meta");t.name="description",t.content="El Rinc\xF3n de \xC9bano - Minimarket con delivery instant\xE1neo.",document.head.appendChild(t)}}catch(t){console.warn("[modules/seo] injectSeoMetadata error:",t)}}var N,xt=D(()=>{N="__PRODUCT_DATA__"});function qt(){try{if(!document.querySelector('link[rel="manifest"]')){let t=document.createElement("link");t.rel="manifest",t.href="/app.webmanifest",document.head.appendChild(t)}}catch(t){console.warn("[modules/pwa] injectPwaManifest error:",t)}}var kt=D(()=>{});function Tt(){try{window?.console?.debug&&console.debug("[modules/checkout] setupCheckoutProgress: no-op")}catch{}}var Dt=D(()=>{});function W(t,e={}){let a=t.startsWith("/")?t:"/"+t,l=Object.entries(e).map(([p,h])=>`${p}=${h}`).join(","),d=a.split("/").map(encodeURIComponent).join("/");return`/cdn-cgi/image/${l}${d}`}var V,Ot=D(()=>{V={fit:"cover",quality:82,format:"auto"}});function $t(){return`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function O(t,e,a={}){let l={level:t,message:e,...a},d=JSON.stringify(l);typeof console[t]=="function"?console[t](d):console.log(d)}var Bt=D(()=>{});function ct(){if(typeof window<"u"){let t=window[jt];if(t&&Array.isArray(t.products))return t}return Y&&Array.isArray(Y.products)?Y:null}function Ut(t,e={},{force:a=!1}={}){if(!Array.isArray(t))return null;let l={products:t,version:e.version||null,source:e.source||null,updatedAt:e.updatedAt||Date.now(),isPartial:!!e.isPartial,total:typeof e.total=="number"?e.total:null},d=ct();if(d&&!a){let p=d.version||null,h=l.version||null;if(!h&&p||!h&&!p||h&&p===h)return d}return Y=l,typeof window<"u"&&(window[jt]={...l}),l}function ot(t,e={}){return Ut(t,e,{force:!1})}function me(t,e={}){return Ut(t,e,{force:!0})}function Ft(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}if(Mt)return;Mt=!0;let t=async()=>{if(document.readyState==="complete"){window.removeEventListener("load",t);try{await pe()}catch(e){console.error("Service Worker initialization failed:",e),be("Failed to initialize service worker. Some features may not work offline.")}}};window.addEventListener("load",t),t()}async function pe(){try{let t=await navigator.serviceWorker.register(at.path,{scope:at.scope});console.log("ServiceWorker registered successfully:",t.scope),ye(t),ge(t),he(),we()}catch(t){throw console.error("ServiceWorker registration failed:",t),t}}function ye(t){t.addEventListener("updatefound",()=>{let e=t.installing;e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&e.postMessage({type:"SKIP_WAITING"})})})}function ge(t){Nt(t),setInterval(()=>{Nt(t)},at.updateCheckInterval)}async function Nt(t){try{await t.update();let e=await fetch("/data/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(e.ok){let l=(await e.json()).version,d=localStorage.getItem("productDataVersion");l!==d&&(t.active?.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",l),ve(null,"New product data available"))}}catch(e){console.warn("Update check failed:",e)}}function he(){let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}function we(){let t=document.getElementById("offline-indicator");if(!t)return;let e=()=>{let a=navigator.onLine;t.classList.toggle("is-hidden",a),t.style.display=a?"none":"block",a||Ce("You are currently offline. Some features may be limited.")};window.addEventListener("online",e),window.addEventListener("offline",e),navigator.onLine||e()}function ve(t,e="Una versi\xF3n est\xE1 disponible"){let a=st(e,"Actualizar ahora","Despu\xE9s",()=>{t?t.postMessage({type:"SKIP_WAITING"}):window.location.reload()});lt(a)}function be(t){let e=st(t,"Reload","Dismiss",()=>window.location.reload());lt(e)}function Ce(t){let e=st(t,"Retry","Dismiss",()=>window.location.reload());lt(e)}function st(t,e,a,l){let d=document.createElement("div");return d.className="notification-toast",d.setAttribute("role","alert"),d.setAttribute("aria-live","polite"),d.innerHTML=`
        <div class="notification-content">
            <p>${t}</p>
            <div class="notification-actions">
                <button class="primary-action">${e}</button>
                <button class="secondary-action">${a}</button>
            </div>
        </div>
    `,d.querySelector(".primary-action").addEventListener("click",()=>{try{l()}catch(p){console.error("Primary action failed:",p)}d.remove()}),d.querySelector(".secondary-action").addEventListener("click",()=>{d.remove()}),d}function lt(t){let e=document.querySelector(".notification-toast");e&&e.remove(),document.body.appendChild(t),setTimeout(()=>{document.body.contains(t)&&t.remove()},300*1e3)}function Ae(){let t=ct();if(t)return t;let e=Kt();if(!e||!Array.isArray(e.initialProducts))return null;let a=it(e.initialProducts);return ot(a,{version:e.version||null,source:"inline",isPartial:!0,total:typeof e.totalProducts=="number"?e.totalProducts:a.length})}var jt,Y,at,Mt,Ee,Se,$,Ie,rt,Pe,_e,zt,Kt,Le,it,Q,xe,qe,u,A,Rt,Ht,Wt=D(()=>{Ot();Bt();jt="__PRODUCT_DATA__",Y=null;at={path:"/service-worker.js",scope:"/",updateCheckInterval:300*1e3},Mt=!1;typeof navigator<"u"&&"serviceWorker"in navigator&&Ft();Ee=(t,e=100)=>{let a=new Map;return(...l)=>{let d=JSON.stringify(l);if(a.has(d))return a.get(d);let p=t(...l);if(a.size>=e){let h=a.keys().next().value;a.delete(h)}return a.set(d,p),p}},Se=(t,e)=>{let a;return(...l)=>{clearTimeout(a),a=setTimeout(()=>t(...l),e)}},$=t=>{if(!t)return"";try{return String(t).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}catch{return String(t).toLowerCase()}},Ie=t=>{let e=`${t.name}-${t.category}`.toLowerCase(),a=0;for(let l=0;l<e.length;l++){let d=e.charCodeAt(l);a=(a<<5)-a+d,a=a&a}return`pid-${Math.abs(a)}`},rt=t=>{let e=document.createElement("div");return e.textContent=t,e.innerHTML},Pe="product-data",_e=()=>{try{return typeof localStorage>"u"?null:localStorage.getItem("productDataVersion")}catch(t){return console.warn("Unable to read stored product data version:",t),null}},zt=t=>{if(t)try{if(typeof localStorage>"u")return;localStorage.setItem("productDataVersion",t)}catch(e){console.warn("Unable to persist product data version:",e)}},Kt=()=>{if(typeof document>"u")return null;try{let t=document.getElementById(Pe);if(!t||!t.textContent)return null;let e=t.textContent.trim();if(!e)return null;let a=JSON.parse(e);return a?Array.isArray(a.initialProducts)?a:Array.isArray(a.products)?{...a,initialProducts:a.products}:null:null}catch(t){return O("warn","inline_product_parse_failure",{error:t.message}),null}},Le=(t,e)=>{let a=t.id||Ie(t),l=typeof t.originalIndex=="number"?t.originalIndex:typeof t.order=="number"?t.order:e;return{...t,id:a,name:rt(t.name),description:rt(t.description),category:rt(t.category),categoryKey:t.categoryKey||$(t.category),originalIndex:l}},it=(t=[])=>t.map((e,a)=>Le(e,a));Ae();Q=class extends Error{constructor(e,{cause:a,correlationId:l}){super(e),this.name="ProductDataError",this.correlationId=l,a&&(this.cause=a)}},xe=async(t,e,a,l,d)=>{let p=new URL(t,window.location.origin);if(p.origin!==window.location.origin||p.protocol!=="https:")throw new Error("Invalid request URL: only same-origin HTTPS requests are allowed");let h=p.toString(),v=0,C;for(;v<=a;)try{let q=Date.now(),w=await fetch(h,e),P=Date.now()-q;if(O("info","fetch_products_attempt",{correlationId:d,attempt:v+1,durationMs:P}),!w.ok)throw new Error(`HTTP error. Status: ${w.status}`);return w}catch(q){if(C=q,v++,v>a)break;O("warn","fetch_products_retry",{correlationId:d,attempt:v,error:q.message,runbook:"RUNBOOK.md#product-data"}),await new Promise(w=>setTimeout(w,l*v))}throw new Q(`Failed to fetch products: ${C.message}`,{cause:C,correlationId:d})},qe=async()=>{let t=$t(),e=Kt(),a=e?.initialProducts||null,l=e?.version||null,d=typeof e?.totalProducts=="number"?e.totalProducts:null,p=Array.isArray(a)?it(a):null,h=Array.isArray(p),v=_e();h&&(l&&zt(l),ot(p,{version:l||null,source:"inline",isPartial:!0,total:d??p.length}),O("info","fetch_products_inline_bootstrap",{correlationId:t,count:p.length}));let C=v||l||null,q=C?`/data/product_data.json?v=${encodeURIComponent(C)}`:"/data/product_data.json";try{let P=await(await xe(q,{cache:"no-store",headers:{Accept:"application/json"}},2,300,t)).json(),k=it(P.products||[]);return me(k,{version:P.version||null,source:"network",isPartial:!1,total:k.length}),P.version&&zt(P.version),O("info","fetch_products_success",{correlationId:t,count:k.length,source:"network"}),k}catch(w){if(h)return ot(p,{version:l||null,source:"inline-fallback",isPartial:!0,total:d??p.length}),O("warn","fetch_products_network_fallback_inline",{correlationId:t,error:w.message,runbook:"RUNBOOK.md#product-data"}),p;throw O("error","fetch_products_failure",{correlationId:t,error:w.message,runbook:"RUNBOOK.md#product-data"}),A(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${w.message})`),w instanceof Q?w:new Q(w.message,{cause:w,correlationId:t})}},u=(t,e={},a=[])=>{let l=document.createElement(t);return Object.entries(e).forEach(([d,p])=>{d==="text"?l.textContent=p:l.setAttribute(d,p)}),a.forEach(d=>{typeof d=="string"?l.appendChild(document.createTextNode(d)):l.appendChild(d)}),l},A=t=>{let e=u("div",{class:"error-message",role:"alert"},[u("p",{},[t]),u("button",{class:"retry-button"},["Intentar nuevamente"])]),a=document.getElementById("product-container");a?(a.innerHTML="",a.appendChild(e),e.querySelector(".retry-button").addEventListener("click",Ht)):console.error("Contenedor de productos no encontrado")},Rt=[];try{Rt=JSON.parse(globalThis.localStorage?.getItem("cart"))||[]}catch{Rt=[]}typeof window<"u"&&(window.__APP_READY__=!1,window.addEventListener("error",t=>{let e=t.target||t.srcElement,a=!!(e&&(e.tagName==="IMG"||e.tagName==="SCRIPT"||e.tagName==="LINK")),l=!!t.error;if(a||!l){console.warn("Ignored non-fatal error:",{tag:e&&e.tagName,src:e&&(e.src||e.href||e.currentSrc)});return}if(!window.__APP_READY__){console.error("Runtime error before app ready:",t.error);return}console.error("Unhandled JS error:",t.error),A("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")}),window.addEventListener("securitypolicyviolation",t=>{console.warn("CSP violation (logged only):",{blockedURI:t.blockedURI,violatedDirective:t.violatedDirective,sourceFile:t.sourceFile})}));Ht=async()=>{console.log("Initializing app...");let t=document.getElementById("product-container"),e=document.getElementById("sort-options"),a=document.getElementById("filter-keyword"),l=()=>{let n=document.getElementById("filter-discount");if(n)return n;let o=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),i=o?o.querySelector(".row"):null;if(!i)return null;let c=u("div",{class:"col-12 mt-2"}),r=u("div",{class:"form-check form-switch"}),s=u("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),f=u("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return r.appendChild(s),r.appendChild(f),c.appendChild(r),i.appendChild(c),s},d=12,p=12,h=[],v=[],C=0,q=d,w=null,P=null,k=null,G=!1,I=JSON.parse(localStorage.getItem("cart"))||[],Z=()=>{let n=document.getElementById("offline-indicator");if(n){let o=navigator.onLine;n.classList.toggle("is-hidden",o),n.style.display=o?"none":"block"}navigator.onLine||console.log("App is offline. Using cached data if available.")};function Qt(){let n=document.getElementById("current-year");n&&(n.textContent=new Date().getFullYear())}let Gt=(n,o,i="CLP")=>{let c=new Intl.NumberFormat("es-CL",{style:"currency",currency:i,minimumFractionDigits:0}),r=c.format(n);if(o){let s=n-o,f=c.format(s);return u("div",{class:"precio-container"},[u("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[f]),u("span",{class:"precio-original","aria-label":"Precio original"},[u("span",{class:"tachado"},[r])])])}return u("div",{class:"precio-container"},[u("span",{class:"precio","aria-label":"Precio"},[r])])},Jt=n=>{let o=u("div",{class:"quantity-control",style:"display:none;"}),i=u("button",{class:"quantity-btn","data-action":"decrease","aria-label":"Decrease quantity"},["-"]),c=u("button",{class:"quantity-btn","data-action":"increase","aria-label":"Increase quantity"},["+"]),r=u("input",{type:"number",class:"quantity-input",value:Math.max(z(n.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":n.id});return o.appendChild(i),o.appendChild(r),o.appendChild(c),o};function dt(n,o){if(!n)return;let i=n.querySelector(".add-to-cart-btn"),c=n.querySelector(".quantity-control"),r=c?.querySelector(".quantity-input"),s=c?.querySelector('.quantity-btn[data-action="decrease"]')||c?.querySelector(".quantity-btn"),f=c?.querySelector('.quantity-btn[data-action="increase"]')||c?.querySelectorAll(".quantity-btn")?.[1],g=(b,y,m)=>{b&&b.dataset.listenerAttached!=="true"&&(b.addEventListener(y,m),b.dataset.listenerAttached="true")};g(i,"click",()=>{yt(o,1),U(i,c,!0)}),g(s,"click",()=>j(o,-1)),g(f,"click",()=>j(o,1)),g(r,"change",b=>{let y=parseInt(b.target.value,10);if(!Number.isFinite(y)){b.target.value=Math.max(z(o.id),1);return}let m=z(o.id);j(o,y-m)});let S=z(o.id);r&&(r.value=S>0?S:1),U(i,c,S>0)}let z=n=>{let o=I.find(i=>i.id===n);return o?o.quantity:0},Yt=(n,{reset:o=!1}={})=>{if(!t)return 0;o&&(t.innerHTML="");let i=document.createDocumentFragment();return n.forEach(c=>{let{id:r,name:s,description:f,image_path:g,price:S,discount:b,stock:y}=c,m=u("div",{class:`producto col-12 col-sm-6 col-md-4 col-lg-3 mb-4 ${y?"":"agotado"}`,"aria-label":`Product: ${s}`,"data-product-id":r});m.style.setProperty("content-visibility","auto"),m.style.setProperty("contain-intrinsic-size","400px 560px");let E=u("div",{class:"card"});if(b&&Number(b)>0){let x=Math.round(Number(b)/Number(S)*100),L=u("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(x)?x:0}%`]);E.appendChild(L)}let M=`/${g.replace(/^\//,"")}`,F=u("img",{src:W(M,{...V,width:400}),srcset:[`${W(M,{...V,width:200})} 200w`,`${W(M,{...V,width:400})} 400w`,`${W(M,{...V,width:800})} 800w`].join(", "),sizes:"(max-width: 640px) 200px, 400px",alt:s,class:"card-img-top product-thumb",loading:"lazy",decoding:"async",width:"400",height:"400"});E.appendChild(F);let _=u("div",{class:"card-body"});_.appendChild(u("h3",{class:"card-title"},[s])),_.appendChild(u("p",{class:"card-text"},[f])),_.appendChild(Gt(S,b));let K=u("div",{class:"action-area","data-pid":r}),H=u("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":r,"aria-label":`Add ${s} to cart`},["Agregar al carrito"]),nt=Jt(c);K.appendChild(H),K.appendChild(nt),_.appendChild(K),dt(K,c),E.appendChild(_),m.appendChild(E),i.appendChild(m)}),t.appendChild(i),te(),n.length},Zt=n=>{if(!t)return 0;let o=t.querySelectorAll("[data-product-id]");if(!o.length)return 0;let i=new Map(n.map(r=>[r.id,r])),c=0;return o.forEach(r=>{let s=r.getAttribute("data-product-id");if(!s||!i.has(s))return;let f=i.get(s);r.style.setProperty("content-visibility","auto"),r.style.setProperty("contain-intrinsic-size","400px 560px");let g=r.querySelector(".action-area");dt(g,f),c+=1}),c},ut=()=>{t&&(t.innerHTML=""),C=0},X=()=>{let n=e?.value||"original",o=a?.value?.trim?.()||"",i=document.getElementById("filter-discount")?.checked||!1;v=ie(h,o,n,i)},ft=n=>{if(!Array.isArray(v)||v.length===0)return T(),!1;let o=C;if(o>=v.length)return T(),!1;let i=v.slice(o,o+n);return i.length?(Yt(i),C+=i.length,T(),!0):(T(),!1)},tt=()=>ft(q||d),mt=()=>ft(p),T=()=>{let n=C<v.length;w&&(w.classList.toggle("d-none",!n),w.disabled=!n),k&&P&&(k.disconnect(),n&&k.observe(P))},Xt=()=>{w=document.getElementById("catalog-load-more"),P=document.getElementById("catalog-sentinel"),w&&w.addEventListener("click",()=>{mt()}),P&&(k=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting&&mt()})},{rootMargin:"200px"})),T()},te=()=>{let n=new IntersectionObserver((o,i)=>{o.forEach(c=>{if(c.isIntersecting){let r=c.target;r.src=r.dataset.src,r.dataset.srcset&&(r.srcset=r.dataset.srcset),r.dataset.sizes&&(r.sizes=r.dataset.sizes),r.classList.remove("lazyload"),i.unobserve(r)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(o=>n.observe(o))};function ee(n,o){if(!n||!o||n.length<3)return!1;let i=s=>s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),c=i(n),r=i(o);return r.includes(c)?!0:c.length>=4?ne(c,r):!1}function ne(n,o){return o.split(/\s+/).some(c=>{if(Math.abs(c.length-n.length)>1)return!1;let r=0,s=Math.max(c.length,n.length);if(Math.min(c.length,n.length)<4)return!1;if(c.length===n.length){for(let g=0;g<c.length;g++)if(c[g]!==n[g]&&r++,r>1)return!1;return r===1}else return re(n,c)})}function re(n,o){let i=n.length>o.length?n:o,c=n.length>o.length?o:n;if(i.length-c.length!==1)return!1;let r=0,s=0,f=0;for(;s<c.length&&f<i.length;)if(c[s]===i[f])s++,f++;else{if(r++,r>1)return!1;f++}return!0}let oe=(n,o,i,c=!1)=>{let r=o.trim();return n.filter(s=>!s.stock||c&&!(s.discount&&Number(s.discount)>0)?!1:!r||s.name.toLowerCase().includes(r.toLowerCase())||s.description.toLowerCase().includes(r.toLowerCase())?!0:r.length>=4?ee(r,s.name):!1).sort((s,f)=>ae(s,f,i))},ae=(n,o,i)=>{if(!i||i==="original")return n.originalIndex-o.originalIndex;let[c,r]=i.split("-"),s=c==="price"?n.price-(n.discount||0):n.name.toLowerCase(),f=c==="price"?o.price-(o.discount||0):o.name.toLowerCase();return r==="asc"?s<f?-1:s>f?1:0:f<s?-1:f>s?1:0},ie=Ee(oe),pt=()=>{try{if(X(),ut(),!v.length){T();return}tt()}catch(n){console.error("Error al actualizar visualizaci\xF3n de productos:",n),A("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},et=Se(pt,300),R=()=>{let n=document.getElementById("cart-count"),o=I.reduce((i,c)=>i+c.quantity,0);n.textContent=o,n.setAttribute("aria-label",`${o} items in cart`)},yt=(n,o)=>{try{let i=I.find(r=>r.id===n.id);i?i.quantity=Math.min(i.quantity+o,50):I.push({id:n.id,name:n.name,description:n.description,price:n.price,discount:n.discount,image_path:n.image_path,quantity:Math.min(o,50),category:n.category,stock:n.stock}),J(),R(),B();let c=document.querySelector(`[data-id="${n.id}"].quantity-input`);c&&(c.value=Math.max(z(n.id),1))}catch(i){console.error("Error al agregar al carrito:",i),A("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},gt=n=>{try{I=I.filter(i=>i.id!==n),J(),R(),B();let o=document.querySelector(`.action-area[data-pid="${n}"]`);if(o){let i=o.querySelector(".add-to-cart-btn"),c=o.querySelector(".quantity-control");U(i,c,!1)}}catch(o){console.error("Error al eliminar del carrito:",o),A("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},j=(n,o)=>{try{let i=I.find(g=>g.id===n.id),c=i?i.quantity+o:1,r=document.querySelector(`.action-area[data-pid="${n.id}"]`),s=r?.querySelector(".add-to-cart-btn"),f=r?.querySelector(".quantity-control");if(c<=0)gt(n.id),U(s,f,!1);else if(c<=50){i?i.quantity=c:(yt(n,1),U(s,f,!0)),J(),R(),B();let g=document.querySelector(`[data-id="${n.id}"].quantity-input`);g&&(g.value=c,g.classList.add("quantity-changed"),setTimeout(()=>g.classList.remove("quantity-changed"),300))}}catch(i){console.error("Error al actualizar cantidad:",i),A("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},ce=()=>{try{I=[],J(),R(),B(),pt()}catch(n){console.error("Error al vaciar el carrito:",n),A("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},U=(n,o,i)=>{!n||!o||(i?(n.style.display="none",o.style.display="flex"):(o.style.display="none",n.style.display="flex"))},J=()=>{try{localStorage.setItem("cart",JSON.stringify(I))}catch(n){console.error("Error al guardar el carrito:",n),A("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},B=()=>{let n=document.getElementById("cart-items"),o=document.getElementById("cart-total");n.innerHTML="";let i=0;I.forEach(r=>{let s=r.price-(r.discount||0),f=u("div",{class:"cart-item mb-3 d-flex align-items-start","aria-label":`Cart item: ${r.name}`}),g=u("div",{class:"cart-item-content flex-grow-1"});g.appendChild(u("div",{class:"fw-bold mb-1"},[r.name]));let S=u("div",{class:"mb-2"}),b=u("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":r.id,"aria-label":`Disminuir cantidad de ${r.name}`},["-"]),y=u("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":r.id,"aria-label":`Aumentar cantidad de ${r.name}`},["+"]),m=u("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${r.name}`},[r.quantity.toString()]);S.appendChild(b),S.appendChild(m),S.appendChild(y),g.appendChild(S),g.appendChild(u("div",{class:"text-muted small"},[`Precio: $${s.toLocaleString("es-CL")}`])),g.appendChild(u("div",{class:"fw-bold"},[`Subtotal: $${(s*r.quantity).toLocaleString("es-CL")}`]));let E=u("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":r.id,"aria-label":`Eliminar ${r.name} del carrito`},["Eliminar"]);g.appendChild(E);let M=window.location.pathname.includes("/pages/"),F;M?F=`../${r.image_path.replace(/^\//,"")}`:F=r.image_path;let _=u("div",{class:"cart-item-thumb ms-3 flex-shrink-0"}),H={src:r.thumbnail_path||F,alt:r.name,class:"cart-item-thumb-img",loading:"lazy",decoding:"async",width:"100",height:"100"};if(Array.isArray(r.thumbnail_variants)){let x=r.thumbnail_variants.filter(L=>L&&L.url&&L.width).map(L=>`${L.url} ${L.width}w`);x.length&&(H.srcset=x.join(", "),H.sizes="100px")}let nt=u("img",H);if(_.appendChild(nt),f.appendChild(g),f.appendChild(_),n.appendChild(f),window.__DEBUG_CART__)try{let x=window.getComputedStyle(f),L=window.getComputedStyle(_),Te=window.getComputedStyle(g),ht=_.getBoundingClientRect(),wt=g.getBoundingClientRect();console.debug("[cart] item",{name:r.name,order:{firstIsContent:f.firstChild===g,lastIsThumb:f.lastChild===_},container:{display:x.display,flexDirection:x.flexDirection,flexWrap:x.flexWrap},thumb:{width:L.width,height:L.height,rect:{w:ht.width,h:ht.height}},content:{rect:{w:wt.width,h:wt.height}}})}catch{}i+=s*r.quantity}),o.textContent=`Total: $${i.toLocaleString("es-CL")}`,o.setAttribute("aria-label",`Total: $${i.toLocaleString("es-CL")}`);let c=document.getElementById("payment-credit-container");if(c)if(i>=3e4)c.classList.remove("d-none");else{c.classList.add("d-none");let r=c.querySelector("input");r&&(r.checked=!1)}},se=()=>{let n=document.querySelector('input[name="paymentMethod"]:checked');if(!n){alert("Por favor seleccione un m\xE9todo de pago");return}let o=`Mi pedido:

`;I.forEach(r=>{let s=r.price-(r.discount||0);o+=`${r.name}
`,o+=`Cantidad: ${r.quantity}
`,o+=`Precio unitario: $${s.toLocaleString("es-CL")}
`,o+=`Subtotal: $${(s*r.quantity).toLocaleString("es-CL")}

`});let i=I.reduce((r,s)=>r+(s.price-(s.discount||0))*s.quantity,0);o+=`Total: $${i.toLocaleString("es-CL")}
`,o+=`M\xE9todo de pago: ${n.value}`;let c=encodeURIComponent(o);window.open(`https://wa.me/56951118901?text=${c}`,"_blank")};try{Qt();let n=ct();n?.products?.length&&(h=n.products.map((y,m)=>({...y,originalIndex:typeof y.originalIndex=="number"?y.originalIndex:m,categoryKey:y.categoryKey||$(y.category)})));let i=document.querySelector("main")?.dataset?.category||"";if(i){let y=$(i);h=h.filter(m=>(m.categoryKey||$(m.category))===y).map((m,E)=>({...m,originalIndex:typeof m.originalIndex=="number"?m.originalIndex:E}))}let c=Zt(h);c>0?(C=c,q=c):C=0,Xt(),X(),T(),C===0&&v.length&&tt();let r=qe();e.addEventListener("change",()=>{G=!0,et()}),a.addEventListener("input",()=>{G=!0,et()});let s=l();s&&s.addEventListener("change",()=>{G=!0,et()});let f=await r;if(!Array.isArray(f)||f.length===0){if(!h.length){A("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}}else if(h=f.map((y,m)=>({...y,originalIndex:typeof y.originalIndex=="number"?y.originalIndex:m,categoryKey:y.categoryKey||$(y.category)})),i){let y=$(i);h=h.filter(m=>(m.categoryKey||$(m.category))===y).map((m,E)=>({...m,originalIndex:typeof m.originalIndex=="number"?m.originalIndex:E}))}X(),G||C===0?(ut(),v.length?tt():T()):T(),typeof window<"u"&&(window.__APP_READY__=!0),window.addEventListener("online",Z),window.addEventListener("offline",Z),Z();let g=document.getElementById("cart-icon"),S=document.getElementById("empty-cart"),b=document.getElementById("submit-cart");g.addEventListener("click",()=>{if(typeof window.bootstrap<"u"&&window.bootstrap.Offcanvas){let y=new window.bootstrap.Offcanvas(document.getElementById("cartOffcanvas"));B(),y.show()}else{console.error("Bootstrap Offcanvas no est\xE1 disponible"),B();let y=document.getElementById("cartOffcanvas");y&&y.classList.add("show")}}),S.addEventListener("click",ce),b.addEventListener("click",se),document.getElementById("cart-items").addEventListener("click",y=>{let m=y.target,E=m.closest("[data-id]")?.dataset.id;E&&(m.classList.contains("decrease-quantity")?j({id:E},-1):m.classList.contains("increase-quantity")?j({id:E},1):m.classList.contains("remove-item")&&gt(E))}),R(),"performance"in window&&window.addEventListener("load",()=>{let y=performance.getEntriesByType("paint"),m=performance.getEntriesByType("navigation")[0];console.log("First Contentful Paint:",y[0].startTime),console.log("DOM Content Loaded:",m.domContentLoadedEventEnd),console.log("Load Time:",m.loadEventEnd)})}catch(n){console.error("Error al inicializar productos:",n),A("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document<"u"&&document.addEventListener("DOMContentLoaded",function(){Ft(),Ht().catch(t=>{console.error("Error al inicializar la aplicaci\xF3n:",t),A("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})})});var ke=le(()=>{bt();Et();It();xt();kt();Dt();Wt();function Vt(){let t=document.documentElement;try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-defer]').forEach(e=>{e.media="all",e.removeAttribute("data-defer")})}catch{}t.dataset.enhancementsInit!=="1"&&(t.dataset.enhancementsInit="1",vt(),Tt(),Ct(),St(),At(),Lt(),qt())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Vt):Vt()});ke();})();
