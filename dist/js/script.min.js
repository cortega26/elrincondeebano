import{a as Be,b as M}from"./chunks/chunk-TXIFLR42.js";import"./chunks/chunk-72ZECFVW.js";function De(){try{let e=document.createElement("style");window&&window.__CSP_NONCE__&&e.setAttribute("nonce",window.__CSP_NONCE__),e.textContent=`
      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */
      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }
      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }

      /* Contornos de enfoque claros para accesibilidad */
      .navbar .nav-link:focus,
      .navbar .dropdown-item:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* Espaciado entre botones en el offcanvas del carrito */
      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }
    `,document.head.appendChild(e)}catch(e){console.warn("[modules/enhancements] injectEnhancementStyles error:",e)}}function Ne(){try{document.addEventListener("keydown",t=>{t.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});let e=document.createElement("style");window&&window.__CSP_NONCE__&&e.setAttribute("nonce",window.__CSP_NONCE__),e.textContent=".keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }",document.head.appendChild(e)}catch(e){console.warn("[modules/a11y] setupNavigationAccessibility error:",e)}}function $e(){try{"loading"in HTMLImageElement.prototype&&document.querySelectorAll("img:not([loading])").forEach(e=>{e.loading="lazy"})}catch(e){console.warn("[modules/perf] setupPerformanceOptimizations error:",e)}}var U="__PRODUCT_DATA__";function At(){try{if(typeof window=="undefined")return null;let e=window[U];if(e&&Array.isArray(e.products))return e.products}catch(e){console.warn("[modules/seo] Unable to read shared product data:",e)}return null}function kt(e,t={}){var a,l;if(typeof window=="undefined"||!Array.isArray(e))return;let n=window[U]||{};window[U]={...n,products:e,version:(l=(a=t.version)!=null?a:n.version)!=null?l:null,updatedAt:t.updatedAt||Date.now(),source:t.source||n.source||"seo"}}function je(e=[]){let t={};return e.forEach(n=>{let a=n.id||String(n.name)+"-"+String(n.category);t[a]=n}),t}function ze(){if(typeof window=="undefined")return;let e=window[U]||{};e.structuredDataInjected||(window[U]={...e,structuredDataInjected:!0})}async function xt(){try{let e=At();if(e)return je(e);let t=localStorage.getItem("productDataVersion"),n=t?`/data/product_data.json?v=${encodeURIComponent(t)}`:"/data/product_data.json",a=await fetch(n,{cache:"no-store",headers:{Accept:"application/json"}});if(!a.ok)return null;let l=await a.json(),u=Array.isArray(l==null?void 0:l.products)?l.products:Array.isArray(l)?l:[];return kt(u,{version:(l==null?void 0:l.version)||t||null,source:"seo-fallback"}),je(u)}catch(e){return console.error("[modules/seo] Error loading product data:",e),null}}async function Fe(){try{if(document.querySelector('script[type="application/ld+json"]')){ze();return}let e=typeof window!="undefined"?window[U]:null;if(e!=null&&e.structuredDataInjected)return;let t=await xt();if(!t)return;let a=Object.values(t).slice(0,20).map(h=>({"@type":"Product",name:h.name,image:h.image_path,description:h.description,brand:h.brand||"Gen\xE9rico",offers:{"@type":"Offer",price:h.price,priceCurrency:"CLP",availability:h.stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}})),l={"@context":"https://schema.org","@graph":[{"@type":"Store",name:"El Rinc\xF3n de \xC9bano",image:"https://elrincondeebano.com/assets/images/web/logo.webp",description:"Un minimarket en la puerta de tu departamento",address:{"@type":"PostalAddress",addressCountry:"CL"},telephone:"+56951118901",url:"http://www.elrincondeebano.com/",contactPoint:{"@type":"ContactPoint",telephone:"+56-951118901",contactType:"customer service"}},...a]},u=document.createElement("script");u.type="application/ld+json",window&&window.__CSP_NONCE__&&u.setAttribute("nonce",window.__CSP_NONCE__),u.textContent=JSON.stringify(l),document.head.appendChild(u),ze()}catch(e){console.error("[modules/seo] Error generating structured data:",e)}}function Ue(){try{if(!document.querySelector('link[rel="canonical"]')){let e=document.createElement("link");e.rel="canonical",e.href=location.origin+location.pathname,document.head.appendChild(e)}if(!document.querySelector('meta[name="description"]')){let e=document.createElement("meta");e.name="description",e.content="El Rinc\xF3n de \xC9bano - Minimarket con delivery instant\xE1neo.",document.head.appendChild(e)}}catch(e){console.warn("[modules/seo] injectSeoMetadata error:",e)}}function Re(){try{if(!document.querySelector('link[rel="manifest"]')){let e=document.createElement("link");e.rel="manifest",e.href="/app.webmanifest",document.head.appendChild(e)}}catch(e){console.warn("[modules/pwa] injectPwaManifest error:",e)}}function We(){var e;try{(e=window==null?void 0:window.console)!=null&&e.debug&&console.debug("[modules/checkout] setupCheckoutProgress: no-op")}catch(t){}}var ne=new WeakMap,le=new Set,Ve=new Set,qt=typeof window!="undefined"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame.bind(window):e=>setTimeout(e,16),He=typeof window!="undefined"&&typeof window.cancelAnimationFrame=="function"?window.cancelAnimationFrame.bind(window):e=>clearTimeout(e);function Tt(e){if(typeof e.composedPath=="function")return e.composedPath();let t=[],n=e.target;for(;n;)t.push(n),n=n.parentNode;return typeof window!="undefined"&&t.push(window),t.push(document),t}function Ot(e,t,n){var u;if(!e)return`${t}-${n}`;if(typeof e.id=="string"&&e.id.trim().length>0)return`id:${e.id}`;let a=(u=e.dataset)==null?void 0:u.dropdownId;if(a)return a;let l=`${t}:${n}`;return e.dataset&&(e.dataset.dropdownId=l),l}function de(e,t){let{toggle:n,menu:a,dropdownNode:l}=e;n.classList.toggle("show",t),n.setAttribute("aria-expanded",t?"true":"false"),a&&a.classList.toggle("show",t),l&&l.classList.toggle("show",t)}function G(e){e.expandedId=null,e.toggles.forEach(t=>{de(t,!1)})}function Mt(e){if(e.outsideListenerInstalled)return;e.outsideListenerInstalled=!0;let t=!1,n=()=>{document.addEventListener("pointerdown",e.onPointerDownOutside,!0),t=!0};e.outsideListenerCleanup=()=>{e.installTimer!==null&&(clearTimeout(e.installTimer),e.installTimer=null),t&&(document.removeEventListener("pointerdown",e.onPointerDownOutside,!0),t=!1),e.outsideListenerInstalled=!1},e.installTimer=setTimeout(()=>{e.installTimer=null,n()},0)}function Ke(e,t,n){if(!(e.button!==void 0&&e.button!==0)){if(t.preventNavigation&&n.toggle.tagName==="A"&&e.preventDefault(),e.stopPropagation(),typeof e.stopImmediatePropagation=="function"&&e.stopImmediatePropagation(),t.justOpened=!0,t.justOpenedFrame!==null&&He(t.justOpenedFrame),t.justOpenedFrame=qt(()=>{t.justOpened=!1,t.justOpenedFrame=null}),Mt(t),t.expandedId===n.id){G(t);return}G(t),de(n,!0),t.expandedId=n.id}}function Bt(e,t,n){let a=e.key;a==="Enter"||a===" "||a==="Spacebar"?(e.preventDefault(),Ke(e,t,n)):a==="Escape"&&(G(t),n.toggle.focus())}function Dt(e,t){let n=e.closest(".dropdown"),a=n==null?void 0:n.querySelector(".dropdown-menu"),l=Ot(e,"auto",t),u={toggle:e,menu:a,dropdownNode:n,id:l};return a&&!a.id&&(a.id=`${l}-menu`),a&&e.setAttribute("aria-controls",a.id),u}function Nt(e){let t={container:e,toggles:[],expandedId:null,justOpened:!1,justOpenedFrame:null,outsideListenerInstalled:!1,outsideListenerCleanup:null,installTimer:null,onPointerDownOutside:null,preventNavigation:!0};return t.onPointerDownOutside=a=>{t.justOpened||Tt(a).includes(t.container)||G(t)},Array.from(e.querySelectorAll(".dropdown-toggle")).forEach((a,l)=>{if(a.dataset.menuControllerBound==="1")return;a.dataset.menuControllerBound="1";let u=Dt(a,l);t.toggles.push(u);let h=g=>Ke(g,t,u),f=g=>Bt(g,t,u);a.addEventListener("pointerdown",h),a.addEventListener("keydown",f),u.cleanup=()=>{a.removeEventListener("pointerdown",h),a.removeEventListener("keydown",f),delete a.dataset.menuControllerBound}}),ne.set(e,t),le.add(e),Ve.add(t),t.toggles.length===0?($t(t),null):t}function $t(e){e&&(e.toggles.forEach(t=>{var n;de(t,!1),(n=t.cleanup)==null||n.call(t)}),e.toggles=[],G(e),e.outsideListenerCleanup&&(e.outsideListenerCleanup(),e.outsideListenerCleanup=null),e.justOpenedFrame!==null&&(He(e.justOpenedFrame),e.justOpenedFrame=null),e.container&&(ne.delete(e.container),le.delete(e.container)),Ve.delete(e))}function Ge({container:e}={}){if(typeof document=="undefined")return;let t;if(e)t=[e];else{let n=Array.from(document.querySelectorAll("#navbar-container"));t=n.length>0?n:Array.from(document.querySelectorAll(".navbar, nav"))}t.forEach(n=>{if(!(n instanceof HTMLElement)||n.querySelectorAll(".dropdown-toggle").length===0||ne.get(n))return;Nt(n)||(ne.delete(n),le.delete(n))})}var Qe=!1,Ye=new Map,ue=null,fe=null;function Je(e){if(e&&typeof e=="object"){if(e.default)return e.default;let t=Object.keys(e);if(t.length===1)return e[t[0]]}return e}function Ze(e,t){return!e||!t?null:typeof e.getOrCreateInstance=="function"?e.getOrCreateInstance(t):new e(t)}function jt(e){return e?typeof e=="string"?document.querySelector(e):e:null}function Xe(e,t){return Ye.has(e)?Ye.get(e)():t()}async function zt(){ue||(ue=Xe("collapse",()=>import("./chunks/collapse-5AVOIS7J.js")));let e=await ue;return Je(e)}async function Ft(){fe||(fe=Xe("offcanvas",()=>import("./chunks/offcanvas-7MPV3VGN.js")));let e=await fe;return Je(e)}function Ut(){document.querySelectorAll('[data-bs-toggle="collapse"][data-bs-target]').forEach(t=>{t.addEventListener("click",n=>{Wt(t)&&n.preventDefault(),typeof n.stopImmediatePropagation=="function"&&n.stopImmediatePropagation(),n.stopPropagation(),Rt(t,n)})})}async function Rt(e,t){var n;try{let a=e.getAttribute("data-bs-target");if(!a)return;let l=document.querySelector(a);if(!l)return;let u=await zt(),h=Ze(u,l);(n=h==null?void 0:h.toggle)==null||n.call(h,t)}catch(a){console.error("No se pudo inicializar el Collapse de Bootstrap",a)}}function Wt(e){if(!e||e.tagName!=="A")return!1;let t=e.getAttribute("href");return!t||t==="#"}function et(){Qe||(Qe=!0,typeof document!="undefined"&&(Ut(),Ge()))}async function tt(e){if(typeof document=="undefined")throw new Error("Offcanvas no disponible en este entorno");let t=jt(e);if(!t)throw new Error("No se encontr\xF3 el elemento de Offcanvas");let n=await Ft(),a=Ze(n,t);if(!a||typeof a.show!="function")throw new Error("Instancia de Offcanvas inv\xE1lida");return a.show(),a}function Q(e,t={}){let n=e.startsWith("/")?e:"/"+e,a=Object.entries(t).map(([u,h])=>`${u}=${h}`).join(","),l=n.split("/").map(encodeURIComponent).join("/");return`/cdn-cgi/image/${a}${l}`}var Y={fit:"cover",quality:82,format:"auto"};var ct="__PRODUCT_DATA__",re=null,L=Object.freeze({hidden:"is-hidden",flex:"is-flex",block:"is-block",contentVisible:"has-content-visibility",containIntrinsic:"has-contain-intrinsic"});function ve(){if(typeof window!="undefined"){let e=window[ct];if(e&&Array.isArray(e.products))return e}return re&&Array.isArray(re.products)?re:null}function st(e,t={},{force:n=!1}={}){if(!Array.isArray(e))return null;let a={products:e,version:t.version||null,source:t.source||null,updatedAt:t.updatedAt||Date.now(),isPartial:!!t.isPartial,total:typeof t.total=="number"?t.total:null},l=ve();if(l&&!n){let u=l.version||null,h=a.version||null;if(!h&&u||!h&&!u||h&&u===h)return l}return re=a,typeof window!="undefined"&&(window[ct]={...a}),a}function he(e,t={}){return st(e,t,{force:!1})}function Vt(e,t={}){return st(e,t,{force:!0})}var ye={path:"/service-worker.js",scope:"/",updateCheckInterval:300*1e3},nt=!1;function lt(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}if(nt)return;nt=!0;let e=async()=>{if(document.readyState==="complete"){window.removeEventListener("load",e);try{await Ht()}catch(t){console.error("Service Worker initialization failed:",t),Zt("Failed to initialize service worker. Some features may not work offline.")}}};window.addEventListener("load",e),e()}async function Ht(){try{let e=await navigator.serviceWorker.register(ye.path,{scope:ye.scope});console.log("ServiceWorker registered successfully:",e.scope),Kt(e),Gt(e),Qt(),Yt()}catch(e){throw console.error("ServiceWorker registration failed:",e),e}}function Kt(e){e.addEventListener("updatefound",()=>{let t=e.installing;t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&t.postMessage({type:"SKIP_WAITING"})})})}function Gt(e){rt(e),setInterval(()=>{rt(e)},ye.updateCheckInterval)}async function rt(e){var t;try{await e.update();let n=await fetch("/data/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(n.ok){let l=(await n.json()).version,u=localStorage.getItem("productDataVersion");l!==u&&((t=e.active)==null||t.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",l),Jt(null,"New product data available"))}}catch(n){console.warn("Update check failed:",n)}}function Qt(){let e=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{e||(e=!0,window.location.reload())})}function Yt(){let e=document.getElementById("offline-indicator");if(!e)return;let t=()=>{let n=navigator.onLine;e.classList.toggle(L.hidden,n),e.classList.toggle(L.block,!n),n||Xt("You are currently offline. Some features may be limited.")};window.addEventListener("online",t),window.addEventListener("offline",t),navigator.onLine||t()}var pe=null;function be(){return pe||(pe=import("./chunks/notifications-533VS4FV.js")),pe}function Jt(e,t="Una versi\xF3n est\xE1 disponible"){be().then(n=>n.showUpdateNotification(e,t))}function Zt(e){be().then(t=>t.showServiceWorkerError(e))}function Xt(e){be().then(t=>t.showConnectivityNotification(e))}typeof navigator!="undefined"&&"serviceWorker"in navigator&&lt();var en=e=>typeof e=="object"&&e!==null||typeof e=="function",me=()=>({map:new Map,weakMap:new WeakMap,hasValue:!1,value:void 0}),tn=(e,t=100)=>{if(typeof e!="function")throw new TypeError("Expected a function to memoize");(!Number.isFinite(t)||t<0)&&(t=0);let n=me(),a=[],l=f=>{let g=a.indexOf(f);g!==-1&&a.splice(g,1),t>0&&a.push(f)},u=()=>{if(t!==0)for(;a.length>t;){let f=a.shift();f&&(f.hasValue=!1,f.value=void 0)}},h=(f,g)=>{if(en(g)){let b=f.weakMap.get(g);return b||(b=me(),f.weakMap.set(g,b)),b}return f.map.has(g)||f.map.set(g,me()),f.map.get(g)};return(...f)=>{if(t===0)return e(...f);let g=n;for(let b=0;b<f.length;b+=1)g=h(g,f[b]);if(g.hasValue)return l(g),g.value;let I=e(...f);return g.value=I,g.hasValue=!0,l(g),u(),I}},nn=(e,t)=>{let n;return(...a)=>{clearTimeout(n),n=setTimeout(()=>e(...a),t)}},j=e=>{if(!e)return"";try{return String(e).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}catch(t){return String(e).toLowerCase()}},rn=e=>{let t=`${e.name}-${e.category}`.toLowerCase(),n=0;for(let a=0;a<t.length;a++){let l=t.charCodeAt(a);n=(n<<5)-n+l,n=n&n}return`pid-${Math.abs(n)}`},ge=e=>{let t=document.createElement("div");return t.textContent=e,t.innerHTML},on="product-data",an=()=>{try{return typeof localStorage=="undefined"?null:localStorage.getItem("productDataVersion")}catch(e){return console.warn("Unable to read stored product data version:",e),null}},ot=e=>{if(e)try{if(typeof localStorage=="undefined")return;localStorage.setItem("productDataVersion",e)}catch(t){console.warn("Unable to persist product data version:",t)}},dt=()=>{if(typeof document=="undefined")return null;try{let e=document.getElementById(on);if(!e||!e.textContent)return null;let t=e.textContent.trim();if(!t)return null;let n=JSON.parse(t);return n?Array.isArray(n.initialProducts)?n:Array.isArray(n.products)?{...n,initialProducts:n.products}:null:null}catch(e){return M("warn","inline_product_parse_failure",{error:e.message}),null}},cn=(e,t)=>{let n=e.id||rn(e),a=typeof e.originalIndex=="number"?e.originalIndex:typeof e.order=="number"?e.order:t;return{...e,id:n,name:ge(e.name),description:ge(e.description),category:ge(e.category),categoryKey:e.categoryKey||j(e.category),originalIndex:a}},we=(e=[])=>e.map((t,n)=>cn(t,n));function sn(){let e=ve();if(e)return e;let t=dt();if(!t||!Array.isArray(t.initialProducts))return null;let n=we(t.initialProducts);return he(n,{version:t.version||null,source:"inline",isPartial:!0,total:typeof t.totalProducts=="number"?t.totalProducts:n.length})}sn();var J=class extends Error{constructor(t,{cause:n,correlationId:a}){super(t),this.name="ProductDataError",this.correlationId=a,n&&(this.cause=n)}},ln=async(e,t,n,a,l)=>{let u=new URL(e,window.location.origin);if(u.origin!==window.location.origin||u.protocol!=="https:")throw new Error("Invalid request URL: only same-origin HTTPS requests are allowed");let h=u.toString(),f=0,g;for(;f<=n;)try{let I=Date.now(),b=await fetch(h,t),E=Date.now()-I;if(M("info","fetch_products_attempt",{correlationId:l,attempt:f+1,durationMs:E}),!b.ok)throw new Error(`HTTP error. Status: ${b.status}`);return b}catch(I){if(g=I,f++,f>n)break;M("warn","fetch_products_retry",{correlationId:l,attempt:f,error:I.message,runbook:"RUNBOOK.md#product-data"}),await new Promise(b=>setTimeout(b,a*f))}throw new J(`Failed to fetch products: ${g.message}`,{cause:g,correlationId:l})},dn=async()=>{let e=Be(),t=dt(),n=(t==null?void 0:t.initialProducts)||null,a=(t==null?void 0:t.version)||null,l=typeof(t==null?void 0:t.totalProducts)=="number"?t.totalProducts:null,u=Array.isArray(n)?we(n):null,h=Array.isArray(u),f=an();h&&(a&&ot(a),he(u,{version:a||null,source:"inline",isPartial:!0,total:l!=null?l:u.length}),M("info","fetch_products_inline_bootstrap",{correlationId:e,count:u.length}));let g=f||a||null,I=g?`/data/product_data.json?v=${encodeURIComponent(g)}`:"/data/product_data.json";try{let E=await(await ln(I,{cache:"no-store",headers:{Accept:"application/json"}},2,300,e)).json(),_=we(E.products||[]);return Vt(_,{version:E.version||null,source:"network",isPartial:!1,total:_.length}),E.version&&ot(E.version),M("info","fetch_products_success",{correlationId:e,count:_.length,source:"network"}),_}catch(b){if(h)return he(u,{version:a||null,source:"inline-fallback",isPartial:!0,total:l!=null?l:u.length}),M("warn","fetch_products_network_fallback_inline",{correlationId:e,error:b.message,runbook:"RUNBOOK.md#product-data"}),u;throw M("error","fetch_products_failure",{correlationId:e,error:b.message,runbook:"RUNBOOK.md#product-data"}),x(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${b.message})`),b instanceof J?b:new J(b.message,{cause:b,correlationId:e})}},p=(e,t={},n=[])=>{let a=document.createElement(e);return Object.entries(t).forEach(([l,u])=>{l==="text"?a.textContent=u:a.setAttribute(l,u)}),n.forEach(l=>{typeof l=="string"?a.appendChild(document.createTextNode(l)):a.appendChild(l)}),a},x=e=>{let t=p("div",{class:"error-message",role:"alert"},[p("p",{},[e]),p("button",{class:"retry-button"},["Intentar nuevamente"])]),n=document.getElementById("product-container");n?(n.innerHTML="",n.appendChild(t),t.querySelector(".retry-button").addEventListener("click",ut)):console.error("Contenedor de productos no encontrado")},at=[],it;try{at=JSON.parse((it=globalThis.localStorage)==null?void 0:it.getItem("cart"))||[]}catch(e){at=[]}var un=(e=typeof window!="undefined"?window.performance:void 0)=>{let t="unavailable",n="unavailable",a="unavailable";try{if(!e||typeof e.getEntriesByType!="function")return;let l=e.getEntriesByType("paint")||[],u=e.getEntriesByType("navigation")||[],h=l.find(g=>(g==null?void 0:g.name)==="first-contentful-paint")||l[0];h&&typeof h.startTime=="number"&&(t=h.startTime);let f=u[0];f&&typeof f.domContentLoadedEventEnd=="number"?n=f.domContentLoadedEventEnd:e.timing&&typeof e.timing.domContentLoadedEventEnd=="number"&&(n=e.timing.domContentLoadedEventEnd),f&&typeof f.loadEventEnd=="number"?a=f.loadEventEnd:e.timing&&typeof e.timing.loadEventEnd=="number"&&(a=e.timing.loadEventEnd)}catch(l){console.warn("Performance metrics unavailable:",l)}finally{console.log("First Contentful Paint:",t),console.log("DOM Content Loaded:",n),console.log("Load Time:",a)}};typeof window!="undefined"&&(window.__APP_READY__=!1,window.addEventListener("error",e=>{let t=e.target||e.srcElement,n=!!(t&&(t.tagName==="IMG"||t.tagName==="SCRIPT"||t.tagName==="LINK")),a=!!e.error;if(n||!a){console.warn("Ignored non-fatal error:",{tag:t&&t.tagName,src:t&&(t.src||t.href||t.currentSrc)});return}if(!window.__APP_READY__){console.error("Runtime error before app ready:",e.error);return}console.error("Unhandled JS error:",e.error),x("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")}),window.addEventListener("securitypolicyviolation",e=>{console.warn("CSP violation (logged only):",{blockedURI:e.blockedURI,violatedDirective:e.violatedDirective,sourceFile:e.sourceFile})}));var ut=async()=>{var ke,xe,qe;console.log("Initializing app...");let e=document.getElementById("product-container"),t=document.getElementById("sort-options"),n=document.getElementById("filter-keyword"),a=document.getElementById("cart-count"),l=document.getElementById("cart-items"),u=document.getElementById("cart-total"),f=Object.entries({"#product-container":e,"#sort-options":t,"#filter-keyword":n,"#cart-count":a,"#cart-items":l,"#cart-total":u}).filter(([,r])=>!r).map(([r])=>r);if(f.length){M("warn","init_app_missing_dom",{missingSelectors:f,location:typeof window!="undefined"?(ke=window.location)==null?void 0:ke.pathname:"unknown"});return}let g=()=>{let r=document.getElementById("filter-discount");if(r)return r;let i=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),s=i?i.querySelector(".row"):null;if(!s)return null;let c=p("div",{class:"col-12 mt-2"}),o=p("div",{class:"form-check form-switch"}),d=p("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),m=p("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return o.appendChild(d),o.appendChild(m),c.appendChild(o),s.appendChild(c),d},I=12,b=12,E=[],_=[],B=0,Ce=I,z=null,Z=null,X=null,ee=!1,P=JSON.parse(localStorage.getItem("cart"))||[],oe=()=>{let r=document.getElementById("offline-indicator");if(r){let i=navigator.onLine;r.classList.toggle(L.hidden,i),r.classList.toggle(L.block,!i)}navigator.onLine||console.log("App is offline. Using cached data if available.")};function pt(){let r=document.getElementById("current-year");r&&(r.textContent=new Date().getFullYear())}let mt=(r,i,s="CLP")=>{let c=new Intl.NumberFormat("es-CL",{style:"currency",currency:s,minimumFractionDigits:0}),o=c.format(r);if(i){let d=r-i,m=c.format(d);return p("div",{class:"precio-container"},[p("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[m]),p("span",{class:"precio-original","aria-label":"Precio original"},[p("span",{class:"tachado"},[o])])])}return p("div",{class:"precio-container"},[p("span",{class:"precio","aria-label":"Precio"},[o])])},gt=r=>{let i=p("div",{class:`quantity-control ${L.hidden}`}),s=p("button",{class:"quantity-btn","data-action":"decrease","aria-label":"Decrease quantity"},["-"]),c=p("button",{class:"quantity-btn","data-action":"increase","aria-label":"Increase quantity"},["+"]),o=p("input",{type:"number",class:"quantity-input",value:Math.max(R(r.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":r.id});return i.appendChild(s),i.appendChild(o),i.appendChild(c),i};function Ee(r,i){var A;if(!r)return;let s=r.querySelector(".add-to-cart-btn"),c=r.querySelector(".quantity-control"),o=c==null?void 0:c.querySelector(".quantity-input"),d=(c==null?void 0:c.querySelector('.quantity-btn[data-action="decrease"]'))||(c==null?void 0:c.querySelector(".quantity-btn")),m=(c==null?void 0:c.querySelector('.quantity-btn[data-action="increase"]'))||((A=c==null?void 0:c.querySelectorAll(".quantity-btn"))==null?void 0:A[1]),w=(v,y,C)=>{v&&v.dataset.listenerAttached!=="true"&&(v.addEventListener(y,C),v.dataset.listenerAttached="true")};w(s,"click",()=>{Pe(i,1),H(s,c,!0)}),w(d,"click",()=>V(i,-1)),w(m,"click",()=>V(i,1)),w(o,"change",v=>{let y=parseInt(v.target.value,10);if(!Number.isFinite(y)){v.target.value=Math.max(R(i.id),1);return}let C=R(i.id);V(i,y-C)});let S=R(i.id);o&&(o.value=S>0?S:1),H(s,c,S>0)}let R=r=>{let i=P.find(s=>s.id===r);return i?i.quantity:0},ht=(r,{reset:i=!1}={})=>{if(!e)return 0;i&&(e.innerHTML="");let s=document.createDocumentFragment();return r.forEach(c=>{let{id:o,name:d,description:m,image_path:w,price:S,discount:A,stock:v}=c,y=["producto","col-12","col-sm-6","col-md-4","col-lg-3","mb-4",v?"":"agotado",L.contentVisible,L.containIntrinsic].filter(Boolean).join(" "),C=p("div",{class:y,"aria-label":`Product: ${d}`,"data-product-id":o}),T=p("div",{class:"card"});if(A&&Number(A)>0){let k=Math.round(Number(A)/Number(S)*100),Te=p("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(k)?k:0}%`]);T.appendChild(Te)}let D=`/${w.replace(/^\//,"")}`,$=p("img",{src:Q(D,{...Y,width:400}),srcset:[`${Q(D,{...Y,width:200})} 200w`,`${Q(D,{...Y,width:400})} 400w`,`${Q(D,{...Y,width:800})} 800w`].join(", "),sizes:"(min-width: 1200px) 25vw, (min-width: 992px) 33vw, (min-width: 576px) 50vw, 100vw",alt:d,class:"card-img-top product-thumb",loading:"lazy",fetchpriority:"auto",decoding:"async",width:"400",height:"400"});T.appendChild($);let F=p("div",{class:"card-body"});F.appendChild(p("h3",{class:"card-title"},[d])),F.appendChild(p("p",{class:"card-text"},[m])),F.appendChild(mt(S,A));let N=p("div",{class:"action-area","data-pid":o}),se=p("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":o,"aria-label":`Add ${d} to cart`},["Agregar al carrito"]),O=gt(c);N.appendChild(se),N.appendChild(O),F.appendChild(N),Ee(N,c),T.appendChild(F),C.appendChild(T),s.appendChild(C)}),e.appendChild(s),vt(),r.length},yt=r=>{if(!e)return 0;let i=e.querySelectorAll("[data-product-id]");if(!i.length)return 0;let s=new Map(r.map(o=>[o.id,o])),c=0;return i.forEach(o=>{let d=o.getAttribute("data-product-id");if(!d||!s.has(d))return;let m=s.get(d);o.classList.add(L.contentVisible,L.containIntrinsic);let w=o.querySelector(".action-area");Ee(w,m),c+=1}),c},_e=()=>{e&&(e.innerHTML=""),B=0},ae=()=>{var c,o,d;let r=(t==null?void 0:t.value)||"original",i=((o=(c=n==null?void 0:n.value)==null?void 0:c.trim)==null?void 0:o.call(c))||"",s=((d=document.getElementById("filter-discount"))==null?void 0:d.checked)||!1;_=It(E,i,r,s)},Se=r=>{if(!Array.isArray(_)||_.length===0)return q(),!1;let i=B;if(i>=_.length)return q(),!1;let s=_.slice(i,i+r);return s.length?(ht(s),B+=s.length,q(),!0):(q(),!1)},ie=()=>Se(Ce||I),Ie=()=>Se(b),q=()=>{let r=B<_.length;z&&(z.classList.toggle("d-none",!r),z.disabled=!r),X&&Z&&(X.disconnect(),r&&X.observe(Z))},wt=()=>{z=document.getElementById("catalog-load-more"),Z=document.getElementById("catalog-sentinel"),z&&z.addEventListener("click",()=>{Ie()}),Z&&typeof window!="undefined"&&"IntersectionObserver"in window&&(X=new IntersectionObserver(r=>{r.forEach(i=>{i.isIntersecting&&Ie()})},{rootMargin:"200px"})),q()},vt=()=>{if(typeof window!="undefined"&&"IntersectionObserver"in window){let r=new IntersectionObserver((i,s)=>{i.forEach(c=>{if(c.isIntersecting){let o=c.target;o.src=o.dataset.src,o.dataset.srcset&&(o.srcset=o.dataset.srcset),o.dataset.sizes&&(o.sizes=o.dataset.sizes),o.classList.remove("lazyload"),s.unobserve(o)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(i=>r.observe(i))}else document.querySelectorAll("img.lazyload").forEach(r=>{r.dataset.src&&(r.src=r.dataset.src),r.dataset.srcset&&(r.srcset=r.dataset.srcset),r.dataset.sizes&&(r.sizes=r.dataset.sizes),r.classList.remove("lazyload")})};function bt(r,i){if(!r||!i||r.length<3)return!1;let s=d=>d.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),c=s(r),o=s(i);return o.includes(c)?!0:c.length>=4?Ct(c,o):!1}function Ct(r,i){return i.split(/\s+/).some(c=>{if(Math.abs(c.length-r.length)>1)return!1;let o=0,d=Math.max(c.length,r.length);if(Math.min(c.length,r.length)<4)return!1;if(c.length===r.length){for(let w=0;w<c.length;w++)if(c[w]!==r[w]&&o++,o>1)return!1;return o===1}else return Et(r,c)})}function Et(r,i){let s=r.length>i.length?r:i,c=r.length>i.length?i:r;if(s.length-c.length!==1)return!1;let o=0,d=0,m=0;for(;d<c.length&&m<s.length;)if(c[d]===s[m])d++,m++;else{if(o++,o>1)return!1;m++}return!0}let _t=(r,i,s,c=!1)=>{let o=i.trim();return r.filter(d=>!d.stock||c&&!(d.discount&&Number(d.discount)>0)?!1:!o||d.name.toLowerCase().includes(o.toLowerCase())||d.description.toLowerCase().includes(o.toLowerCase())?!0:o.length>=4?bt(o,d.name):!1).sort((d,m)=>St(d,m,s))},St=(r,i,s)=>{if(!s||s==="original")return r.originalIndex-i.originalIndex;let[c,o]=s.split("-"),d=c==="price"?r.price-(r.discount||0):r.name.toLowerCase(),m=c==="price"?i.price-(i.discount||0):i.name.toLowerCase();return o==="asc"?d<m?-1:d>m?1:0:m<d?-1:m>d?1:0},It=tn(_t),Le=()=>{try{if(ae(),_e(),!_.length){q();return}ie()}catch(r){console.error("Error al actualizar visualizaci\xF3n de productos:",r),x("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},ce=nn(Le,300),W=()=>{let r=document.getElementById("cart-count"),i=P.reduce((s,c)=>s+c.quantity,0);r.textContent=i,r.setAttribute("aria-label",`${i} items in cart`)},Pe=(r,i)=>{try{let s=P.find(o=>o.id===r.id);s?s.quantity=Math.min(s.quantity+i,50):P.push({id:r.id,name:r.name,description:r.description,price:r.price,discount:r.discount,image_path:r.image_path,quantity:Math.min(i,50),category:r.category,stock:r.stock}),te(),W(),K();let c=document.querySelector(`[data-id="${r.id}"].quantity-input`);c&&(c.value=Math.max(R(r.id),1))}catch(s){console.error("Error al agregar al carrito:",s),x("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},Ae=r=>{try{P=P.filter(s=>s.id!==r),te(),W(),K();let i=document.querySelector(`.action-area[data-pid="${r}"]`);if(i){let s=i.querySelector(".add-to-cart-btn"),c=i.querySelector(".quantity-control");H(s,c,!1)}}catch(i){console.error("Error al eliminar del carrito:",i),x("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},V=(r,i)=>{try{let s=P.find(w=>w.id===r.id),c=s?s.quantity+i:1,o=document.querySelector(`.action-area[data-pid="${r.id}"]`),d=o==null?void 0:o.querySelector(".add-to-cart-btn"),m=o==null?void 0:o.querySelector(".quantity-control");if(c<=0)Ae(r.id),H(d,m,!1);else if(c<=50){s?s.quantity=c:(Pe(r,1),H(d,m,!0)),te(),W(),K();let w=document.querySelector(`[data-id="${r.id}"].quantity-input`);w&&(w.value=c,w.classList.add("quantity-changed"),setTimeout(()=>w.classList.remove("quantity-changed"),300))}}catch(s){console.error("Error al actualizar cantidad:",s),x("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},Lt=()=>{try{P=[],te(),W(),K(),Le()}catch(r){console.error("Error al vaciar el carrito:",r),x("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},H=(r,i,s)=>{if(!r||!i)return;let c=!s;r.classList.toggle(L.hidden,!c),r.classList.toggle(L.flex,c),i.classList.toggle(L.hidden,!s),i.classList.toggle(L.flex,s)},te=()=>{try{localStorage.setItem("cart",JSON.stringify(P))}catch(r){console.error("Error al guardar el carrito:",r),x("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},K=()=>{let r=document.getElementById("cart-items"),i=document.getElementById("cart-total");r.innerHTML="";let s=0;P.forEach(o=>{let d=o.price-(o.discount||0),m=p("div",{class:"cart-item mb-3 d-flex align-items-start","aria-label":`Cart item: ${o.name}`}),w=p("div",{class:"cart-item-content flex-grow-1"});w.appendChild(p("div",{class:"fw-bold mb-1"},[o.name]));let S=p("div",{class:"mb-2"}),A=p("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":o.id,"aria-label":`Disminuir cantidad de ${o.name}`},["-"]),v=p("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":o.id,"aria-label":`Aumentar cantidad de ${o.name}`},["+"]),y=p("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${o.name}`},[o.quantity.toString()]);S.appendChild(A),S.appendChild(y),S.appendChild(v),w.appendChild(S),w.appendChild(p("div",{class:"text-muted small"},[`Precio: $${d.toLocaleString("es-CL")}`])),w.appendChild(p("div",{class:"fw-bold"},[`Subtotal: $${(d*o.quantity).toLocaleString("es-CL")}`]));let C=p("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":o.id,"aria-label":`Eliminar ${o.name} del carrito`},["Eliminar"]);w.appendChild(C);let T=window.location.pathname.includes("/pages/"),D;T?D=`../${o.image_path.replace(/^\//,"")}`:D=o.image_path;let $=p("div",{class:"cart-item-thumb ms-3 flex-shrink-0"}),N={src:o.thumbnail_path||D,alt:o.name,class:"cart-item-thumb-img",loading:"lazy",decoding:"async",width:"100",height:"100"};if(Array.isArray(o.thumbnail_variants)){let O=o.thumbnail_variants.filter(k=>k&&k.url&&k.width).map(k=>`${k.url} ${k.width}w`);O.length&&(N.srcset=O.join(", "),N.sizes="100px")}let se=p("img",N);if($.appendChild(se),m.appendChild(w),m.appendChild($),r.appendChild(m),window.__DEBUG_CART__)try{let O=window.getComputedStyle(m),k=window.getComputedStyle($),Te=window.getComputedStyle(w),Oe=$.getBoundingClientRect(),Me=w.getBoundingClientRect();console.debug("[cart] item",{name:o.name,order:{firstIsContent:m.firstChild===w,lastIsThumb:m.lastChild===$},container:{display:O.display,flexDirection:O.flexDirection,flexWrap:O.flexWrap},thumb:{width:k.width,height:k.height,rect:{w:Oe.width,h:Oe.height}},content:{rect:{w:Me.width,h:Me.height}}})}catch(O){}s+=d*o.quantity}),i.textContent=`Total: $${s.toLocaleString("es-CL")}`,i.setAttribute("aria-label",`Total: $${s.toLocaleString("es-CL")}`);let c=document.getElementById("payment-credit-container");if(c)if(s>=3e4)c.classList.remove("d-none");else{c.classList.add("d-none");let o=c.querySelector("input");o&&(o.checked=!1)}},Pt=()=>{let r=document.querySelector('input[name="paymentMethod"]:checked');if(!r){alert("Por favor seleccione un m\xE9todo de pago");return}let i=`Mi pedido:

`;P.forEach(o=>{let d=o.price-(o.discount||0);i+=`${o.name}
`,i+=`Cantidad: ${o.quantity}
`,i+=`Precio unitario: $${d.toLocaleString("es-CL")}
`,i+=`Subtotal: $${(d*o.quantity).toLocaleString("es-CL")}

`});let s=P.reduce((o,d)=>o+(d.price-(d.discount||0))*d.quantity,0);i+=`Total: $${s.toLocaleString("es-CL")}
`,i+=`M\xE9todo de pago: ${r.value}`;let c=encodeURIComponent(i);window.open(`https://wa.me/56951118901?text=${c}`,"_blank")};try{pt();let r=ve();(xe=r==null?void 0:r.products)!=null&&xe.length&&(E=r.products.map((v,y)=>({...v,originalIndex:typeof v.originalIndex=="number"?v.originalIndex:y,categoryKey:v.categoryKey||j(v.category)})));let i=document.querySelector("main"),s=((qe=i==null?void 0:i.dataset)==null?void 0:qe.category)||"";if(s){let v=j(s);E=E.filter(y=>(y.categoryKey||j(y.category))===v).map((y,C)=>({...y,originalIndex:typeof y.originalIndex=="number"?y.originalIndex:C}))}let c=yt(E);c>0?(B=c,Ce=c):B=0,wt(),ae(),q(),B===0&&_.length&&ie();let o=dn();t.addEventListener("change",()=>{ee=!0,ce()}),n.addEventListener("input",()=>{ee=!0,ce()});let d=g();d&&d.addEventListener("change",()=>{ee=!0,ce()});let m=await o;if(!Array.isArray(m)||m.length===0){if(!E.length){x("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}}else if(E=m.map((v,y)=>({...v,originalIndex:typeof v.originalIndex=="number"?v.originalIndex:y,categoryKey:v.categoryKey||j(v.category)})),s){let v=j(s);E=E.filter(y=>(y.categoryKey||j(y.category))===v).map((y,C)=>({...y,originalIndex:typeof y.originalIndex=="number"?y.originalIndex:C}))}ae(),ee||B===0?(_e(),_.length?ie():q()):q(),typeof window!="undefined"&&(window.__APP_READY__=!0),window.addEventListener("online",oe),window.addEventListener("offline",oe),oe();let w=document.getElementById("cart-icon"),S=document.getElementById("empty-cart"),A=document.getElementById("submit-cart");w&&w.addEventListener("click",async()=>{K();try{await tt("#cartOffcanvas")}catch(v){console.error("Bootstrap Offcanvas no est\xE1 disponible",v);let y=document.getElementById("cartOffcanvas");y&&y.classList.add("show")}}),S&&S.addEventListener("click",Lt),A&&A.addEventListener("click",Pt),l&&l.addEventListener("click",v=>{var T;let y=v.target,C=(T=y.closest("[data-id]"))==null?void 0:T.dataset.id;C&&(y.classList.contains("decrease-quantity")?V({id:C},-1):y.classList.contains("increase-quantity")?V({id:C},1):y.classList.contains("remove-item")&&Ae(C))}),W(),"performance"in window&&window.addEventListener("load",()=>{un()})}catch(r){console.error("Error al inicializar productos:",r),x("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document!="undefined"&&document.addEventListener("DOMContentLoaded",function(){lt(),ut().catch(e=>{console.error("Error al inicializar la aplicaci\xF3n:",e),x("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})});function ft(){let e=document.documentElement;try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-defer]').forEach(t=>{t.media="all",t.removeAttribute("data-defer")})}catch(t){}e.dataset.enhancementsInit!=="1"&&(e.dataset.enhancementsInit="1",De(),We(),Ne(),$e(),Ue(),Fe(),Re(),et())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ft):ft();try{typeof window!="undefined"&&window.__ANALYTICS_ENABLE__===!0&&import("./chunks/analytics-O2RU3SL6.js").then(e=>{e.initAnalytics({enabled:!0,consentRequired:!0,sampleRate:1}),window.__analyticsTrack=(t,n)=>{try{return e.track(t,n)}catch(a){return!1}},e.track("page_view",{path:location.pathname})}).catch(()=>{})}catch(e){}export{ft as __initEnhancementsOnceForTest};
