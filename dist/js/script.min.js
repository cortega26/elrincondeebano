import{a as Mt,b as B}from"./chunks/chunk-TXIFLR42.js";import"./chunks/chunk-72ZECFVW.js";function Nt(){try{let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=`
      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */
      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }
      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }

      /* Contornos de enfoque claros para accesibilidad */
      .navbar .nav-link:focus,
      .navbar .dropdown-item:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* Espaciado entre botones en el offcanvas del carrito */
      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }
    `,document.head.appendChild(t)}catch(t){console.warn("[modules/enhancements] injectEnhancementStyles error:",t)}}function Dt(){try{document.addEventListener("keydown",e=>{e.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=".keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }",document.head.appendChild(t)}catch(t){console.warn("[modules/a11y] setupNavigationAccessibility error:",t)}}function $t(){try{"loading"in HTMLImageElement.prototype&&document.querySelectorAll("img:not([loading])").forEach(t=>{t.loading="lazy"})}catch(t){console.warn("[modules/perf] setupPerformanceOptimizations error:",t)}}var R="__PRODUCT_DATA__";function Ce(){try{if(typeof window=="undefined")return null;let t=window[R];if(t&&Array.isArray(t.products))return t.products}catch(t){console.warn("[modules/seo] Unable to read shared product data:",t)}return null}function _e(t,e={}){var c,l;if(typeof window=="undefined"||!Array.isArray(t))return;let r=window[R]||{};window[R]={...r,products:t,version:(l=(c=e.version)!=null?c:r.version)!=null?l:null,updatedAt:e.updatedAt||Date.now(),source:e.source||r.source||"seo"}}function zt(t=[]){let e={};return t.forEach(r=>{let c=r.id||String(r.name)+"-"+String(r.category);e[c]=r}),e}function jt(){if(typeof window=="undefined")return;let t=window[R]||{};t.structuredDataInjected||(window[R]={...t,structuredDataInjected:!0})}async function Se(){try{let t=Ce();if(t)return zt(t);let e=localStorage.getItem("productDataVersion"),r=e?`/data/product_data.json?v=${encodeURIComponent(e)}`:"/data/product_data.json",c=await fetch(r,{cache:"no-store",headers:{Accept:"application/json"}});if(!c.ok)return null;let l=await c.json(),u=Array.isArray(l==null?void 0:l.products)?l.products:Array.isArray(l)?l:[];return _e(u,{version:(l==null?void 0:l.version)||e||null,source:"seo-fallback"}),zt(u)}catch(t){return console.error("[modules/seo] Error loading product data:",t),null}}async function Ut(){try{if(document.querySelector('script[type="application/ld+json"]')){jt();return}let t=typeof window!="undefined"?window[R]:null;if(t!=null&&t.structuredDataInjected)return;let e=await Se();if(!e)return;let c=Object.values(e).slice(0,20).map(h=>({"@type":"Product",name:h.name,image:h.image_path,description:h.description,brand:h.brand||"Gen\xE9rico",offers:{"@type":"Offer",price:h.price,priceCurrency:"CLP",availability:h.stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}})),l={"@context":"https://schema.org","@graph":[{"@type":"Store",name:"El Rinc\xF3n de \xC9bano",image:"https://elrincondeebano.com/assets/images/web/logo.webp",description:"Un minimarket en la puerta de tu departamento",address:{"@type":"PostalAddress",addressCountry:"CL"},telephone:"+56951118901",url:"http://www.elrincondeebano.com/",contactPoint:{"@type":"ContactPoint",telephone:"+56-951118901",contactType:"customer service"}},...c]},u=document.createElement("script");u.type="application/ld+json",window&&window.__CSP_NONCE__&&u.setAttribute("nonce",window.__CSP_NONCE__),u.textContent=JSON.stringify(l),document.head.appendChild(u),jt()}catch(t){console.error("[modules/seo] Error generating structured data:",t)}}function Rt(){try{if(!document.querySelector('link[rel="canonical"]')){let t=document.createElement("link");t.rel="canonical",t.href=location.origin+location.pathname,document.head.appendChild(t)}if(!document.querySelector('meta[name="description"]')){let t=document.createElement("meta");t.name="description",t.content="El Rinc\xF3n de \xC9bano - Minimarket con delivery instant\xE1neo.",document.head.appendChild(t)}}catch(t){console.warn("[modules/seo] injectSeoMetadata error:",t)}}function Ft(){try{if(!document.querySelector('link[rel="manifest"]')){let t=document.createElement("link");t.rel="manifest",t.href="/app.webmanifest",document.head.appendChild(t)}}catch(t){console.warn("[modules/pwa] injectPwaManifest error:",t)}}function Vt(){var t;try{(t=window==null?void 0:window.console)!=null&&t.debug&&console.debug("[modules/checkout] setupCheckoutProgress: no-op")}catch(e){}}var Wt=!1,Ht=new Map,ct=null,st=null,lt=null;function dt(t){if(t&&typeof t=="object"){if(t.default)return t.default;let e=Object.keys(t);if(e.length===1)return t[e[0]]}return t}function ut(t,e){return!t||!e?null:typeof t.getOrCreateInstance=="function"?t.getOrCreateInstance(e):new t(e)}function Ie(t){return t?typeof t=="string"?document.querySelector(t):t:null}function ft(t,e){return Ht.has(t)?Ht.get(t)():e()}async function Pe(){ct||(ct=ft("collapse",()=>import("./chunks/collapse-NY5MXN7U.js")));let t=await ct;return dt(t)}async function Le(){st||(st=ft("dropdown",()=>import("./chunks/dropdown-3RTH4GTX.js")));let t=await st;return dt(t)}async function ke(){lt||(lt=ft("offcanvas",()=>import("./chunks/offcanvas-HI6BCH6F.js")));let t=await lt;return dt(t)}function xe(){document.querySelectorAll('[data-bs-toggle="collapse"][data-bs-target]').forEach(e=>{e.addEventListener("click",r=>{Kt(e)&&r.preventDefault(),typeof r.stopImmediatePropagation=="function"&&r.stopImmediatePropagation(),r.stopPropagation(),Ae(e,r)})})}async function Ae(t,e){var r;try{let c=t.getAttribute("data-bs-target");if(!c)return;let l=document.querySelector(c);if(!l)return;let u=await Pe(),h=ut(u,l);(r=h==null?void 0:h.toggle)==null||r.call(h,e)}catch(c){console.error("No se pudo inicializar el Collapse de Bootstrap",c)}}function Kt(t){if(!t||t.tagName!=="A")return!1;let e=t.getAttribute("href");return!e||e==="#"}function qe(){document.querySelectorAll('[data-bs-toggle="dropdown"]').forEach(e=>{let r=async c=>{Kt(e)&&c.preventDefault(),typeof c.stopImmediatePropagation=="function"&&c.stopImmediatePropagation(),typeof c.stopPropagation=="function"&&c.stopPropagation(),e.removeEventListener("click",r);try{await Te(e,c)}catch(l){e.addEventListener("click",r)}};e.addEventListener("click",r)})}async function Te(t,e){var r;try{let c=await Le();e&&typeof(c==null?void 0:c.clearMenus)=="function"&&c.clearMenus(e);let l=ut(c,t);(r=l==null?void 0:l.toggle)==null||r.call(l,e)}catch(c){throw console.error("No se pudo inicializar el Dropdown de Bootstrap",c),c}}function Gt(){Wt||(Wt=!0,typeof document!="undefined"&&(xe(),qe()))}async function Qt(t){if(typeof document=="undefined")throw new Error("Offcanvas no disponible en este entorno");let e=Ie(t);if(!e)throw new Error("No se encontr\xF3 el elemento de Offcanvas");let r=await ke(),c=ut(r,e);if(!c||typeof c.show!="function")throw new Error("Instancia de Offcanvas inv\xE1lida");return c.show(),c}function G(t,e={}){let r=t.startsWith("/")?t:"/"+t,c=Object.entries(e).map(([u,h])=>`${u}=${h}`).join(","),l=r.split("/").map(encodeURIComponent).join("/");return`/cdn-cgi/image/${c}${l}`}var Q={fit:"cover",quality:82,format:"auto"};var ee="__PRODUCT_DATA__",et=null,P=Object.freeze({hidden:"is-hidden",flex:"is-flex",block:"is-block",contentVisible:"has-content-visibility",containIntrinsic:"has-contain-intrinsic"});function vt(){if(typeof window!="undefined"){let t=window[ee];if(t&&Array.isArray(t.products))return t}return et&&Array.isArray(et.products)?et:null}function ne(t,e={},{force:r=!1}={}){if(!Array.isArray(t))return null;let c={products:t,version:e.version||null,source:e.source||null,updatedAt:e.updatedAt||Date.now(),isPartial:!!e.isPartial,total:typeof e.total=="number"?e.total:null},l=vt();if(l&&!r){let u=l.version||null,h=c.version||null;if(!h&&u||!h&&!u||h&&u===h)return l}return et=c,typeof window!="undefined"&&(window[ee]={...c}),c}function yt(t,e={}){return ne(t,e,{force:!1})}function Oe(t,e={}){return ne(t,e,{force:!0})}var ht={path:"/service-worker.js",scope:"/",updateCheckInterval:300*1e3},Yt=!1;function re(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}if(Yt)return;Yt=!0;let t=async()=>{if(document.readyState==="complete"){window.removeEventListener("load",t);try{await Be()}catch(e){console.error("Service Worker initialization failed:",e),je("Failed to initialize service worker. Some features may not work offline.")}}};window.addEventListener("load",t),t()}async function Be(){try{let t=await navigator.serviceWorker.register(ht.path,{scope:ht.scope});console.log("ServiceWorker registered successfully:",t.scope),Me(t),Ne(t),De(),$e()}catch(t){throw console.error("ServiceWorker registration failed:",t),t}}function Me(t){t.addEventListener("updatefound",()=>{let e=t.installing;e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&e.postMessage({type:"SKIP_WAITING"})})})}function Ne(t){Jt(t),setInterval(()=>{Jt(t)},ht.updateCheckInterval)}async function Jt(t){var e;try{await t.update();let r=await fetch("/data/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(r.ok){let l=(await r.json()).version,u=localStorage.getItem("productDataVersion");l!==u&&((e=t.active)==null||e.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",l),ze(null,"New product data available"))}}catch(r){console.warn("Update check failed:",r)}}function De(){let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}function $e(){let t=document.getElementById("offline-indicator");if(!t)return;let e=()=>{let r=navigator.onLine;t.classList.toggle(P.hidden,r),t.classList.toggle(P.block,!r),r||Ue("You are currently offline. Some features may be limited.")};window.addEventListener("online",e),window.addEventListener("offline",e),navigator.onLine||e()}var pt=null;function bt(){return pt||(pt=import("./chunks/notifications-533VS4FV.js")),pt}function ze(t,e="Una versi\xF3n est\xE1 disponible"){bt().then(r=>r.showUpdateNotification(t,e))}function je(t){bt().then(e=>e.showServiceWorkerError(t))}function Ue(t){bt().then(e=>e.showConnectivityNotification(t))}typeof navigator!="undefined"&&"serviceWorker"in navigator&&re();var Re=t=>typeof t=="object"&&t!==null||typeof t=="function",mt=()=>({map:new Map,weakMap:new WeakMap,hasValue:!1,value:void 0}),Fe=(t,e=100)=>{if(typeof t!="function")throw new TypeError("Expected a function to memoize");(!Number.isFinite(e)||e<0)&&(e=0);let r=mt(),c=[],l=p=>{let w=c.indexOf(p);w!==-1&&c.splice(w,1),e>0&&c.push(p)},u=()=>{if(e!==0)for(;c.length>e;){let p=c.shift();p&&(p.hasValue=!1,p.value=void 0)}},h=(p,w)=>{if(Re(w)){let b=p.weakMap.get(w);return b||(b=mt(),p.weakMap.set(w,b)),b}return p.map.has(w)||p.map.set(w,mt()),p.map.get(w)};return(...p)=>{if(e===0)return t(...p);let w=r;for(let b=0;b<p.length;b+=1)w=h(w,p[b]);if(w.hasValue)return l(w),w.value;let I=t(...p);return w.value=I,w.hasValue=!0,l(w),u(),I}},Ve=(t,e)=>{let r;return(...c)=>{clearTimeout(r),r=setTimeout(()=>t(...c),e)}},z=t=>{if(!t)return"";try{return String(t).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}catch(e){return String(t).toLowerCase()}},We=t=>{let e=`${t.name}-${t.category}`.toLowerCase(),r=0;for(let c=0;c<e.length;c++){let l=e.charCodeAt(c);r=(r<<5)-r+l,r=r&r}return`pid-${Math.abs(r)}`},gt=t=>{let e=document.createElement("div");return e.textContent=t,e.innerHTML},He="product-data",Ke=()=>{try{return typeof localStorage=="undefined"?null:localStorage.getItem("productDataVersion")}catch(t){return console.warn("Unable to read stored product data version:",t),null}},Zt=t=>{if(t)try{if(typeof localStorage=="undefined")return;localStorage.setItem("productDataVersion",t)}catch(e){console.warn("Unable to persist product data version:",e)}},oe=()=>{if(typeof document=="undefined")return null;try{let t=document.getElementById(He);if(!t||!t.textContent)return null;let e=t.textContent.trim();if(!e)return null;let r=JSON.parse(e);return r?Array.isArray(r.initialProducts)?r:Array.isArray(r.products)?{...r,initialProducts:r.products}:null:null}catch(t){return B("warn","inline_product_parse_failure",{error:t.message}),null}},Ge=(t,e)=>{let r=t.id||We(t),c=typeof t.originalIndex=="number"?t.originalIndex:typeof t.order=="number"?t.order:e;return{...t,id:r,name:gt(t.name),description:gt(t.description),category:gt(t.category),categoryKey:t.categoryKey||z(t.category),originalIndex:c}},wt=(t=[])=>t.map((e,r)=>Ge(e,r));function Qe(){let t=vt();if(t)return t;let e=oe();if(!e||!Array.isArray(e.initialProducts))return null;let r=wt(e.initialProducts);return yt(r,{version:e.version||null,source:"inline",isPartial:!0,total:typeof e.totalProducts=="number"?e.totalProducts:r.length})}Qe();var Y=class extends Error{constructor(e,{cause:r,correlationId:c}){super(e),this.name="ProductDataError",this.correlationId=c,r&&(this.cause=r)}},Ye=async(t,e,r,c,l)=>{let u=new URL(t,window.location.origin);if(u.origin!==window.location.origin||u.protocol!=="https:")throw new Error("Invalid request URL: only same-origin HTTPS requests are allowed");let h=u.toString(),p=0,w;for(;p<=r;)try{let I=Date.now(),b=await fetch(h,e),C=Date.now()-I;if(B("info","fetch_products_attempt",{correlationId:l,attempt:p+1,durationMs:C}),!b.ok)throw new Error(`HTTP error. Status: ${b.status}`);return b}catch(I){if(w=I,p++,p>r)break;B("warn","fetch_products_retry",{correlationId:l,attempt:p,error:I.message,runbook:"RUNBOOK.md#product-data"}),await new Promise(b=>setTimeout(b,c*p))}throw new Y(`Failed to fetch products: ${w.message}`,{cause:w,correlationId:l})},Je=async()=>{let t=Mt(),e=oe(),r=(e==null?void 0:e.initialProducts)||null,c=(e==null?void 0:e.version)||null,l=typeof(e==null?void 0:e.totalProducts)=="number"?e.totalProducts:null,u=Array.isArray(r)?wt(r):null,h=Array.isArray(u),p=Ke();h&&(c&&Zt(c),yt(u,{version:c||null,source:"inline",isPartial:!0,total:l!=null?l:u.length}),B("info","fetch_products_inline_bootstrap",{correlationId:t,count:u.length}));let w=p||c||null,I=w?`/data/product_data.json?v=${encodeURIComponent(w)}`:"/data/product_data.json";try{let C=await(await Ye(I,{cache:"no-store",headers:{Accept:"application/json"}},2,300,t)).json(),_=wt(C.products||[]);return Oe(_,{version:C.version||null,source:"network",isPartial:!1,total:_.length}),C.version&&Zt(C.version),B("info","fetch_products_success",{correlationId:t,count:_.length,source:"network"}),_}catch(b){if(h)return yt(u,{version:c||null,source:"inline-fallback",isPartial:!0,total:l!=null?l:u.length}),B("warn","fetch_products_network_fallback_inline",{correlationId:t,error:b.message,runbook:"RUNBOOK.md#product-data"}),u;throw B("error","fetch_products_failure",{correlationId:t,error:b.message,runbook:"RUNBOOK.md#product-data"}),A(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${b.message})`),b instanceof Y?b:new Y(b.message,{cause:b,correlationId:t})}},f=(t,e={},r=[])=>{let c=document.createElement(t);return Object.entries(e).forEach(([l,u])=>{l==="text"?c.textContent=u:c.setAttribute(l,u)}),r.forEach(l=>{typeof l=="string"?c.appendChild(document.createTextNode(l)):c.appendChild(l)}),c},A=t=>{let e=f("div",{class:"error-message",role:"alert"},[f("p",{},[t]),f("button",{class:"retry-button"},["Intentar nuevamente"])]),r=document.getElementById("product-container");r?(r.innerHTML="",r.appendChild(e),e.querySelector(".retry-button").addEventListener("click",ae)):console.error("Contenedor de productos no encontrado")},Xt=[],te;try{Xt=JSON.parse((te=globalThis.localStorage)==null?void 0:te.getItem("cart"))||[]}catch(t){Xt=[]}var Ze=(t=typeof window!="undefined"?window.performance:void 0)=>{let e="unavailable",r="unavailable",c="unavailable";try{if(!t||typeof t.getEntriesByType!="function")return;let l=t.getEntriesByType("paint")||[],u=t.getEntriesByType("navigation")||[],h=l.find(w=>(w==null?void 0:w.name)==="first-contentful-paint")||l[0];h&&typeof h.startTime=="number"&&(e=h.startTime);let p=u[0];p&&typeof p.domContentLoadedEventEnd=="number"?r=p.domContentLoadedEventEnd:t.timing&&typeof t.timing.domContentLoadedEventEnd=="number"&&(r=t.timing.domContentLoadedEventEnd),p&&typeof p.loadEventEnd=="number"?c=p.loadEventEnd:t.timing&&typeof t.timing.loadEventEnd=="number"&&(c=t.timing.loadEventEnd)}catch(l){console.warn("Performance metrics unavailable:",l)}finally{console.log("First Contentful Paint:",e),console.log("DOM Content Loaded:",r),console.log("Load Time:",c)}};typeof window!="undefined"&&(window.__APP_READY__=!1,window.addEventListener("error",t=>{let e=t.target||t.srcElement,r=!!(e&&(e.tagName==="IMG"||e.tagName==="SCRIPT"||e.tagName==="LINK")),c=!!t.error;if(r||!c){console.warn("Ignored non-fatal error:",{tag:e&&e.tagName,src:e&&(e.src||e.href||e.currentSrc)});return}if(!window.__APP_READY__){console.error("Runtime error before app ready:",t.error);return}console.error("Unhandled JS error:",t.error),A("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")}),window.addEventListener("securitypolicyviolation",t=>{console.warn("CSP violation (logged only):",{blockedURI:t.blockedURI,violatedDirective:t.violatedDirective,sourceFile:t.sourceFile})}));var ae=async()=>{var xt,At,qt;console.log("Initializing app...");let t=document.getElementById("product-container"),e=document.getElementById("sort-options"),r=document.getElementById("filter-keyword"),c=document.getElementById("cart-count"),l=document.getElementById("cart-items"),u=document.getElementById("cart-total"),p=Object.entries({"#product-container":t,"#sort-options":e,"#filter-keyword":r,"#cart-count":c,"#cart-items":l,"#cart-total":u}).filter(([,n])=>!n).map(([n])=>n);if(p.length){B("warn","init_app_missing_dom",{missingSelectors:p,location:typeof window!="undefined"?(xt=window.location)==null?void 0:xt.pathname:"unknown"});return}let w=()=>{let n=document.getElementById("filter-discount");if(n)return n;let a=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),s=a?a.querySelector(".row"):null;if(!s)return null;let i=f("div",{class:"col-12 mt-2"}),o=f("div",{class:"form-check form-switch"}),d=f("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),m=f("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return o.appendChild(d),o.appendChild(m),i.appendChild(o),s.appendChild(i),d},I=12,b=12,C=[],_=[],M=0,Et=I,j=null,J=null,Z=null,X=!1,L=JSON.parse(localStorage.getItem("cart"))||[],nt=()=>{let n=document.getElementById("offline-indicator");if(n){let a=navigator.onLine;n.classList.toggle(P.hidden,a),n.classList.toggle(P.block,!a)}navigator.onLine||console.log("App is offline. Using cached data if available.")};function ce(){let n=document.getElementById("current-year");n&&(n.textContent=new Date().getFullYear())}let se=(n,a,s="CLP")=>{let i=new Intl.NumberFormat("es-CL",{style:"currency",currency:s,minimumFractionDigits:0}),o=i.format(n);if(a){let d=n-a,m=i.format(d);return f("div",{class:"precio-container"},[f("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[m]),f("span",{class:"precio-original","aria-label":"Precio original"},[f("span",{class:"tachado"},[o])])])}return f("div",{class:"precio-container"},[f("span",{class:"precio","aria-label":"Precio"},[o])])},le=n=>{let a=f("div",{class:`quantity-control ${P.hidden}`}),s=f("button",{class:"quantity-btn","data-action":"decrease","aria-label":"Decrease quantity"},["-"]),i=f("button",{class:"quantity-btn","data-action":"increase","aria-label":"Increase quantity"},["+"]),o=f("input",{type:"number",class:"quantity-input",value:Math.max(F(n.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":n.id});return a.appendChild(s),a.appendChild(o),a.appendChild(i),a};function Ct(n,a){var k;if(!n)return;let s=n.querySelector(".add-to-cart-btn"),i=n.querySelector(".quantity-control"),o=i==null?void 0:i.querySelector(".quantity-input"),d=(i==null?void 0:i.querySelector('.quantity-btn[data-action="decrease"]'))||(i==null?void 0:i.querySelector(".quantity-btn")),m=(i==null?void 0:i.querySelector('.quantity-btn[data-action="increase"]'))||((k=i==null?void 0:i.querySelectorAll(".quantity-btn"))==null?void 0:k[1]),y=(v,g,E)=>{v&&v.dataset.listenerAttached!=="true"&&(v.addEventListener(g,E),v.dataset.listenerAttached="true")};y(s,"click",()=>{Lt(a,1),H(s,i,!0)}),y(d,"click",()=>W(a,-1)),y(m,"click",()=>W(a,1)),y(o,"change",v=>{let g=parseInt(v.target.value,10);if(!Number.isFinite(g)){v.target.value=Math.max(F(a.id),1);return}let E=F(a.id);W(a,g-E)});let S=F(a.id);o&&(o.value=S>0?S:1),H(s,i,S>0)}let F=n=>{let a=L.find(s=>s.id===n);return a?a.quantity:0},de=(n,{reset:a=!1}={})=>{if(!t)return 0;a&&(t.innerHTML="");let s=document.createDocumentFragment();return n.forEach(i=>{let{id:o,name:d,description:m,image_path:y,price:S,discount:k,stock:v}=i,g=["producto","col-12","col-sm-6","col-md-4","col-lg-3","mb-4",v?"":"agotado",P.contentVisible,P.containIntrinsic].filter(Boolean).join(" "),E=f("div",{class:g,"aria-label":`Product: ${d}`,"data-product-id":o}),T=f("div",{class:"card"});if(k&&Number(k)>0){let x=Math.round(Number(k)/Number(S)*100),Tt=f("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(x)?x:0}%`]);T.appendChild(Tt)}let N=`/${y.replace(/^\//,"")}`,$=f("img",{src:G(N,{...Q,width:400}),srcset:[`${G(N,{...Q,width:200})} 200w`,`${G(N,{...Q,width:400})} 400w`,`${G(N,{...Q,width:800})} 800w`].join(", "),sizes:"(min-width: 1200px) 25vw, (min-width: 992px) 33vw, (min-width: 576px) 50vw, 100vw",alt:d,class:"card-img-top product-thumb",loading:"lazy",fetchpriority:"auto",decoding:"async",width:"400",height:"400"});T.appendChild($);let U=f("div",{class:"card-body"});U.appendChild(f("h3",{class:"card-title"},[d])),U.appendChild(f("p",{class:"card-text"},[m])),U.appendChild(se(S,k));let D=f("div",{class:"action-area","data-pid":o}),it=f("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":o,"aria-label":`Add ${d} to cart`},["Agregar al carrito"]),O=le(i);D.appendChild(it),D.appendChild(O),U.appendChild(D),Ct(D,i),T.appendChild(U),E.appendChild(T),s.appendChild(E)}),t.appendChild(s),pe(),n.length},ue=n=>{if(!t)return 0;let a=t.querySelectorAll("[data-product-id]");if(!a.length)return 0;let s=new Map(n.map(o=>[o.id,o])),i=0;return a.forEach(o=>{let d=o.getAttribute("data-product-id");if(!d||!s.has(d))return;let m=s.get(d);o.classList.add(P.contentVisible,P.containIntrinsic);let y=o.querySelector(".action-area");Ct(y,m),i+=1}),i},_t=()=>{t&&(t.innerHTML=""),M=0},rt=()=>{var i,o,d;let n=(e==null?void 0:e.value)||"original",a=((o=(i=r==null?void 0:r.value)==null?void 0:i.trim)==null?void 0:o.call(i))||"",s=((d=document.getElementById("filter-discount"))==null?void 0:d.checked)||!1;_=ve(C,a,n,s)},St=n=>{if(!Array.isArray(_)||_.length===0)return q(),!1;let a=M;if(a>=_.length)return q(),!1;let s=_.slice(a,a+n);return s.length?(de(s),M+=s.length,q(),!0):(q(),!1)},ot=()=>St(Et||I),It=()=>St(b),q=()=>{let n=M<_.length;j&&(j.classList.toggle("d-none",!n),j.disabled=!n),Z&&J&&(Z.disconnect(),n&&Z.observe(J))},fe=()=>{j=document.getElementById("catalog-load-more"),J=document.getElementById("catalog-sentinel"),j&&j.addEventListener("click",()=>{It()}),J&&typeof window!="undefined"&&"IntersectionObserver"in window&&(Z=new IntersectionObserver(n=>{n.forEach(a=>{a.isIntersecting&&It()})},{rootMargin:"200px"})),q()},pe=()=>{if(typeof window!="undefined"&&"IntersectionObserver"in window){let n=new IntersectionObserver((a,s)=>{a.forEach(i=>{if(i.isIntersecting){let o=i.target;o.src=o.dataset.src,o.dataset.srcset&&(o.srcset=o.dataset.srcset),o.dataset.sizes&&(o.sizes=o.dataset.sizes),o.classList.remove("lazyload"),s.unobserve(o)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(a=>n.observe(a))}else document.querySelectorAll("img.lazyload").forEach(n=>{n.dataset.src&&(n.src=n.dataset.src),n.dataset.srcset&&(n.srcset=n.dataset.srcset),n.dataset.sizes&&(n.sizes=n.dataset.sizes),n.classList.remove("lazyload")})};function me(n,a){if(!n||!a||n.length<3)return!1;let s=d=>d.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),i=s(n),o=s(a);return o.includes(i)?!0:i.length>=4?ge(i,o):!1}function ge(n,a){return a.split(/\s+/).some(i=>{if(Math.abs(i.length-n.length)>1)return!1;let o=0,d=Math.max(i.length,n.length);if(Math.min(i.length,n.length)<4)return!1;if(i.length===n.length){for(let y=0;y<i.length;y++)if(i[y]!==n[y]&&o++,o>1)return!1;return o===1}else return ye(n,i)})}function ye(n,a){let s=n.length>a.length?n:a,i=n.length>a.length?a:n;if(s.length-i.length!==1)return!1;let o=0,d=0,m=0;for(;d<i.length&&m<s.length;)if(i[d]===s[m])d++,m++;else{if(o++,o>1)return!1;m++}return!0}let he=(n,a,s,i=!1)=>{let o=a.trim();return n.filter(d=>!d.stock||i&&!(d.discount&&Number(d.discount)>0)?!1:!o||d.name.toLowerCase().includes(o.toLowerCase())||d.description.toLowerCase().includes(o.toLowerCase())?!0:o.length>=4?me(o,d.name):!1).sort((d,m)=>we(d,m,s))},we=(n,a,s)=>{if(!s||s==="original")return n.originalIndex-a.originalIndex;let[i,o]=s.split("-"),d=i==="price"?n.price-(n.discount||0):n.name.toLowerCase(),m=i==="price"?a.price-(a.discount||0):a.name.toLowerCase();return o==="asc"?d<m?-1:d>m?1:0:m<d?-1:m>d?1:0},ve=Fe(he),Pt=()=>{try{if(rt(),_t(),!_.length){q();return}ot()}catch(n){console.error("Error al actualizar visualizaci\xF3n de productos:",n),A("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},at=Ve(Pt,300),V=()=>{let n=document.getElementById("cart-count"),a=L.reduce((s,i)=>s+i.quantity,0);n.textContent=a,n.setAttribute("aria-label",`${a} items in cart`)},Lt=(n,a)=>{try{let s=L.find(o=>o.id===n.id);s?s.quantity=Math.min(s.quantity+a,50):L.push({id:n.id,name:n.name,description:n.description,price:n.price,discount:n.discount,image_path:n.image_path,quantity:Math.min(a,50),category:n.category,stock:n.stock}),tt(),V(),K();let i=document.querySelector(`[data-id="${n.id}"].quantity-input`);i&&(i.value=Math.max(F(n.id),1))}catch(s){console.error("Error al agregar al carrito:",s),A("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},kt=n=>{try{L=L.filter(s=>s.id!==n),tt(),V(),K();let a=document.querySelector(`.action-area[data-pid="${n}"]`);if(a){let s=a.querySelector(".add-to-cart-btn"),i=a.querySelector(".quantity-control");H(s,i,!1)}}catch(a){console.error("Error al eliminar del carrito:",a),A("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},W=(n,a)=>{try{let s=L.find(y=>y.id===n.id),i=s?s.quantity+a:1,o=document.querySelector(`.action-area[data-pid="${n.id}"]`),d=o==null?void 0:o.querySelector(".add-to-cart-btn"),m=o==null?void 0:o.querySelector(".quantity-control");if(i<=0)kt(n.id),H(d,m,!1);else if(i<=50){s?s.quantity=i:(Lt(n,1),H(d,m,!0)),tt(),V(),K();let y=document.querySelector(`[data-id="${n.id}"].quantity-input`);y&&(y.value=i,y.classList.add("quantity-changed"),setTimeout(()=>y.classList.remove("quantity-changed"),300))}}catch(s){console.error("Error al actualizar cantidad:",s),A("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},be=()=>{try{L=[],tt(),V(),K(),Pt()}catch(n){console.error("Error al vaciar el carrito:",n),A("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},H=(n,a,s)=>{if(!n||!a)return;let i=!s;n.classList.toggle(P.hidden,!i),n.classList.toggle(P.flex,i),a.classList.toggle(P.hidden,!s),a.classList.toggle(P.flex,s)},tt=()=>{try{localStorage.setItem("cart",JSON.stringify(L))}catch(n){console.error("Error al guardar el carrito:",n),A("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},K=()=>{let n=document.getElementById("cart-items"),a=document.getElementById("cart-total");n.innerHTML="";let s=0;L.forEach(o=>{let d=o.price-(o.discount||0),m=f("div",{class:"cart-item mb-3 d-flex align-items-start","aria-label":`Cart item: ${o.name}`}),y=f("div",{class:"cart-item-content flex-grow-1"});y.appendChild(f("div",{class:"fw-bold mb-1"},[o.name]));let S=f("div",{class:"mb-2"}),k=f("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":o.id,"aria-label":`Disminuir cantidad de ${o.name}`},["-"]),v=f("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":o.id,"aria-label":`Aumentar cantidad de ${o.name}`},["+"]),g=f("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${o.name}`},[o.quantity.toString()]);S.appendChild(k),S.appendChild(g),S.appendChild(v),y.appendChild(S),y.appendChild(f("div",{class:"text-muted small"},[`Precio: $${d.toLocaleString("es-CL")}`])),y.appendChild(f("div",{class:"fw-bold"},[`Subtotal: $${(d*o.quantity).toLocaleString("es-CL")}`]));let E=f("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":o.id,"aria-label":`Eliminar ${o.name} del carrito`},["Eliminar"]);y.appendChild(E);let T=window.location.pathname.includes("/pages/"),N;T?N=`../${o.image_path.replace(/^\//,"")}`:N=o.image_path;let $=f("div",{class:"cart-item-thumb ms-3 flex-shrink-0"}),D={src:o.thumbnail_path||N,alt:o.name,class:"cart-item-thumb-img",loading:"lazy",decoding:"async",width:"100",height:"100"};if(Array.isArray(o.thumbnail_variants)){let O=o.thumbnail_variants.filter(x=>x&&x.url&&x.width).map(x=>`${x.url} ${x.width}w`);O.length&&(D.srcset=O.join(", "),D.sizes="100px")}let it=f("img",D);if($.appendChild(it),m.appendChild(y),m.appendChild($),n.appendChild(m),window.__DEBUG_CART__)try{let O=window.getComputedStyle(m),x=window.getComputedStyle($),Tt=window.getComputedStyle(y),Ot=$.getBoundingClientRect(),Bt=y.getBoundingClientRect();console.debug("[cart] item",{name:o.name,order:{firstIsContent:m.firstChild===y,lastIsThumb:m.lastChild===$},container:{display:O.display,flexDirection:O.flexDirection,flexWrap:O.flexWrap},thumb:{width:x.width,height:x.height,rect:{w:Ot.width,h:Ot.height}},content:{rect:{w:Bt.width,h:Bt.height}}})}catch(O){}s+=d*o.quantity}),a.textContent=`Total: $${s.toLocaleString("es-CL")}`,a.setAttribute("aria-label",`Total: $${s.toLocaleString("es-CL")}`);let i=document.getElementById("payment-credit-container");if(i)if(s>=3e4)i.classList.remove("d-none");else{i.classList.add("d-none");let o=i.querySelector("input");o&&(o.checked=!1)}},Ee=()=>{let n=document.querySelector('input[name="paymentMethod"]:checked');if(!n){alert("Por favor seleccione un m\xE9todo de pago");return}let a=`Mi pedido:

`;L.forEach(o=>{let d=o.price-(o.discount||0);a+=`${o.name}
`,a+=`Cantidad: ${o.quantity}
`,a+=`Precio unitario: $${d.toLocaleString("es-CL")}
`,a+=`Subtotal: $${(d*o.quantity).toLocaleString("es-CL")}

`});let s=L.reduce((o,d)=>o+(d.price-(d.discount||0))*d.quantity,0);a+=`Total: $${s.toLocaleString("es-CL")}
`,a+=`M\xE9todo de pago: ${n.value}`;let i=encodeURIComponent(a);window.open(`https://wa.me/56951118901?text=${i}`,"_blank")};try{ce();let n=vt();(At=n==null?void 0:n.products)!=null&&At.length&&(C=n.products.map((v,g)=>({...v,originalIndex:typeof v.originalIndex=="number"?v.originalIndex:g,categoryKey:v.categoryKey||z(v.category)})));let a=document.querySelector("main"),s=((qt=a==null?void 0:a.dataset)==null?void 0:qt.category)||"";if(s){let v=z(s);C=C.filter(g=>(g.categoryKey||z(g.category))===v).map((g,E)=>({...g,originalIndex:typeof g.originalIndex=="number"?g.originalIndex:E}))}let i=ue(C);i>0?(M=i,Et=i):M=0,fe(),rt(),q(),M===0&&_.length&&ot();let o=Je();e.addEventListener("change",()=>{X=!0,at()}),r.addEventListener("input",()=>{X=!0,at()});let d=w();d&&d.addEventListener("change",()=>{X=!0,at()});let m=await o;if(!Array.isArray(m)||m.length===0){if(!C.length){A("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}}else if(C=m.map((v,g)=>({...v,originalIndex:typeof v.originalIndex=="number"?v.originalIndex:g,categoryKey:v.categoryKey||z(v.category)})),s){let v=z(s);C=C.filter(g=>(g.categoryKey||z(g.category))===v).map((g,E)=>({...g,originalIndex:typeof g.originalIndex=="number"?g.originalIndex:E}))}rt(),X||M===0?(_t(),_.length?ot():q()):q(),typeof window!="undefined"&&(window.__APP_READY__=!0),window.addEventListener("online",nt),window.addEventListener("offline",nt),nt();let y=document.getElementById("cart-icon"),S=document.getElementById("empty-cart"),k=document.getElementById("submit-cart");y&&y.addEventListener("click",async()=>{K();try{await Qt("#cartOffcanvas")}catch(v){console.error("Bootstrap Offcanvas no est\xE1 disponible",v);let g=document.getElementById("cartOffcanvas");g&&g.classList.add("show")}}),S&&S.addEventListener("click",be),k&&k.addEventListener("click",Ee),l&&l.addEventListener("click",v=>{var T;let g=v.target,E=(T=g.closest("[data-id]"))==null?void 0:T.dataset.id;E&&(g.classList.contains("decrease-quantity")?W({id:E},-1):g.classList.contains("increase-quantity")?W({id:E},1):g.classList.contains("remove-item")&&kt(E))}),V(),"performance"in window&&window.addEventListener("load",()=>{Ze()})}catch(n){console.error("Error al inicializar productos:",n),A("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document!="undefined"&&document.addEventListener("DOMContentLoaded",function(){re(),ae().catch(t=>{console.error("Error al inicializar la aplicaci\xF3n:",t),A("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})});function ie(){let t=document.documentElement;try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-defer]').forEach(e=>{e.media="all",e.removeAttribute("data-defer")})}catch(e){}t.dataset.enhancementsInit!=="1"&&(t.dataset.enhancementsInit="1",Nt(),Vt(),Dt(),$t(),Rt(),Ut(),Ft(),Gt())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ie):ie();try{typeof window!="undefined"&&window.__ANALYTICS_ENABLE__===!0&&import("./chunks/analytics-O2RU3SL6.js").then(t=>{t.initAnalytics({enabled:!0,consentRequired:!0,sampleRate:1}),window.__analyticsTrack=(e,r)=>{try{return t.track(e,r)}catch(c){return!1}},t.track("page_view",{path:location.pathname})}).catch(()=>{})}catch(t){}export{ie as __initEnhancementsOnceForTest};
