{
  "version": 3,
  "sources": ["../../src/js/modules/enhancements.js", "../../src/js/modules/a11y.js", "../../src/js/modules/perf.js", "../../src/js/modules/seo.js", "../../src/js/modules/pwa.js", "../../src/js/modules/checkout.js", "../../src/js/modules/menu-controller.mjs", "../../src/js/modules/bootstrap.mjs", "../../src/js/utils/cfimg.mjs", "../../src/js/script.mjs", "../../src/js/main.js"],
  "sourcesContent": ["// UI enhancement styles (migrated from csp.js)\r\nexport function injectEnhancementStyles() {\r\n  try {\r\n    const styleEl = document.createElement('style');\r\n    if (window && window.__CSP_NONCE__) {\r\n      styleEl.setAttribute('nonce', window.__CSP_NONCE__);\r\n    }\r\n    styleEl.textContent = `\r\n      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */\r\n      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }\r\n      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }\r\n\r\n      /* Contornos de enfoque claros para accesibilidad */\r\n      .navbar .nav-link:focus,\r\n      .navbar .dropdown-item:focus {\r\n        outline: 2px solid var(--primary-color);\r\n        outline-offset: 2px;\r\n      }\r\n\r\n      /* Espaciado entre botones en el offcanvas del carrito */\r\n      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }\r\n    `;\r\n    document.head.appendChild(styleEl);\r\n  } catch (e) {\r\n    console.warn('[modules/enhancements] injectEnhancementStyles error:', e);\r\n  }\r\n}\r\n", "// Basic navigation accessibility hooks (migrated from csp.js)\r\nexport function setupNavigationAccessibility() {\n  try {\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Tab') document.body.classList.add('keyboard-navigation');\n    });\n    document.addEventListener('mousedown', () => {\n      document.body.classList.remove('keyboard-navigation');\n    });\n\n    const style = document.createElement('style');\n    if (window && window.__CSP_NONCE__) {\n      style.setAttribute('nonce', window.__CSP_NONCE__);\n    }\n    style.textContent = `.keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }`;\n    document.head.appendChild(style);\n  } catch (e) {\n    console.warn('[modules/a11y] setupNavigationAccessibility error:', e);\n  }\n}\n\nfunction getFocusableElements(container) {\n  if (!container) return [];\n  const selectors = [\n    'a[href]',\n    'area[href]',\n    'button:not([disabled])',\n    'input:not([disabled]):not([type=\"hidden\"])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    '[tabindex]:not([tabindex=\"-1\"])',\n    '[contenteditable=\"true\"]'\n  ];\n  return Array.from(container.querySelectorAll(selectors.join(','))).filter((el) => {\n    if (!(el instanceof HTMLElement)) return false;\n    const style = window.getComputedStyle(el);\n    return style.visibility !== 'hidden' && style.display !== 'none';\n  });\n}\n\nexport function setupCartOffcanvasAccessibility() {\n  try {\n    const cartOffcanvas = document.getElementById('cartOffcanvas');\n    if (!cartOffcanvas) return;\n\n    const heading = cartOffcanvas.querySelector('#cartOffcanvasLabel');\n    const triggerButton = document.getElementById('cart-icon');\n    let lastFocusedElement = null;\n    let keydownAttached = false;\n\n    const handleKeydown = (event) => {\n      if (event.key === 'Escape' && cartOffcanvas.dataset.bsFallback === '1') {\n        event.preventDefault();\n        cartOffcanvas.classList.remove('show');\n        cartOffcanvas.setAttribute('aria-hidden', 'true');\n        handleHide();\n        return;\n      }\n\n      if (event.key !== 'Tab') return;\n      const focusable = getFocusableElements(cartOffcanvas);\n      if (!focusable.length) {\n        event.preventDefault();\n        return;\n      }\n\n      const first = focusable[0];\n      const last = focusable[focusable.length - 1];\n      const active = document.activeElement;\n\n      if (event.shiftKey) {\n        if (active === first || !cartOffcanvas.contains(active)) {\n          event.preventDefault();\n          last.focus();\n        }\n      } else if (active === last) {\n        event.preventDefault();\n        first.focus();\n      }\n    };\n\n    const attachKeydown = () => {\n      if (!keydownAttached) {\n        cartOffcanvas.addEventListener('keydown', handleKeydown);\n        keydownAttached = true;\n      }\n    };\n\n    const detachKeydown = () => {\n      if (keydownAttached) {\n        cartOffcanvas.removeEventListener('keydown', handleKeydown);\n        keydownAttached = false;\n      }\n    };\n\n    const focusInitial = () => {\n      if (heading instanceof HTMLElement && typeof heading.focus === 'function') {\n        heading.focus();\n      } else {\n        cartOffcanvas.focus();\n      }\n    };\n\n    function handleHide() {\n      detachKeydown();\n      if (lastFocusedElement && typeof lastFocusedElement.focus === 'function') {\n        lastFocusedElement.focus();\n      } else if (triggerButton && typeof triggerButton.focus === 'function') {\n        triggerButton.focus();\n      }\n    }\n\n    cartOffcanvas.addEventListener('show.bs.offcanvas', () => {\n      lastFocusedElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;\n      attachKeydown();\n    });\n\n    cartOffcanvas.addEventListener('shown.bs.offcanvas', () => {\n      focusInitial();\n    });\n\n    cartOffcanvas.addEventListener('hidden.bs.offcanvas', () => {\n      handleHide();\n    });\n\n    cartOffcanvas.addEventListener('click', (event) => {\n      const target = event.target instanceof HTMLElement ? event.target : null;\n      if (!target) return;\n      const dismissTrigger = target.closest('[data-bs-dismiss=\"offcanvas\"]');\n      if (!dismissTrigger) return;\n      if (cartOffcanvas.dataset.bsFallback === '1') {\n        event.preventDefault();\n        cartOffcanvas.classList.remove('show');\n        cartOffcanvas.setAttribute('aria-hidden', 'true');\n        handleHide();\n      }\n    });\n  } catch (e) {\n    console.warn('[modules/a11y] setupCartOffcanvasAccessibility error:', e);\n  }\n}\n", "// Lightweight performance hooks (migrated from csp.js)\r\nexport function setupPerformanceOptimizations() {\r\n  try {\r\n    // Native lazy-loading for images where missing\r\n    if ('loading' in HTMLImageElement.prototype) {\r\n      document.querySelectorAll('img:not([loading])').forEach((img) => {\r\n        img.loading = 'lazy';\r\n      });\r\n    }\r\n  } catch (e) {\r\n    console.warn('[modules/perf] setupPerformanceOptimizations error:', e);\r\n  }\r\n}\r\n\r\n", "// SEO metadata + structured data (migrated/adapted from csp.js)\r\n\r\nconst PRODUCT_DATA_GLOBAL_KEY = '__PRODUCT_DATA__';\r\n\r\nfunction getSharedProducts() {\r\n  try {\r\n    if (typeof window === 'undefined') return null;\r\n    const payload = window[PRODUCT_DATA_GLOBAL_KEY];\r\n    if (payload && Array.isArray(payload.products)) {\r\n      return payload.products;\r\n    }\r\n  } catch (e) {\r\n    console.warn('[modules/seo] Unable to read shared product data:', e);\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction persistSharedProducts(products, metadata = {}) {\r\n  if (typeof window === 'undefined' || !Array.isArray(products)) {\r\n    return;\r\n  }\r\n  const existing = window[PRODUCT_DATA_GLOBAL_KEY] || {};\r\n  window[PRODUCT_DATA_GLOBAL_KEY] = {\r\n    ...existing,\r\n    products,\r\n    version: metadata.version ?? existing.version ?? null,\r\n    updatedAt: metadata.updatedAt || Date.now(),\r\n    source: metadata.source || existing.source || 'seo'\r\n  };\r\n}\r\n\r\nfunction createProductMap(products = []) {\r\n  const map = {};\r\n  products.forEach((p) => {\r\n    const key = p.id || String(p.name) + '-' + String(p.category);\r\n    map[key] = p;\r\n  });\r\n  return map;\r\n}\r\n\r\nfunction markStructuredDataInjected() {\r\n  if (typeof window === 'undefined') return;\r\n  const payload = window[PRODUCT_DATA_GLOBAL_KEY] || {};\r\n  if (payload.structuredDataInjected) {\r\n    return;\r\n  }\r\n  window[PRODUCT_DATA_GLOBAL_KEY] = {\r\n    ...payload,\r\n    structuredDataInjected: true\r\n  };\r\n}\r\n\r\nasync function loadProductData() {\r\n  try {\r\n    const sharedProducts = getSharedProducts();\r\n    if (sharedProducts) {\r\n      return createProductMap(sharedProducts);\r\n    }\r\n\r\n    const version = localStorage.getItem('productDataVersion');\r\n    const url = version ? `/data/product_data.json?v=${encodeURIComponent(version)}` : '/data/product_data.json';\r\n    const response = await fetch(url, { cache: 'no-store', headers: { 'Accept': 'application/json' } });\r\n    if (!response.ok) return null;\r\n    const data = await response.json();\r\n    const arr = Array.isArray(data?.products) ? data.products : (Array.isArray(data) ? data : []);\r\n    persistSharedProducts(arr, { version: data?.version || version || null, source: 'seo-fallback' });\r\n    return createProductMap(arr);\r\n  } catch (e) {\r\n    console.error('[modules/seo] Error loading product data:', e);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function injectStructuredData() {\r\n  try {\r\n    if (document.querySelector('script[type=\"application/ld+json\"]')) {\r\n      markStructuredDataInjected();\r\n      return;\r\n    }\r\n    const sharedPayload = typeof window !== 'undefined' ? window[PRODUCT_DATA_GLOBAL_KEY] : null;\r\n    if (sharedPayload?.structuredDataInjected) {\r\n      return;\r\n    }\r\n    const map = await loadProductData();\r\n    if (!map) return;\r\n    const products = Object.values(map);\r\n    const structuredProducts = products.slice(0, 20).map((p) => ({\r\n      '@type': 'Product',\r\n      name: p.name,\r\n      image: p.image_path,\r\n      description: p.description,\r\n      brand: p.brand || 'Gen\u00E9rico',\r\n      offers: {\r\n        '@type': 'Offer',\r\n        price: p.price,\r\n        priceCurrency: 'CLP',\r\n        availability: p.stock ? 'https://schema.org/InStock' : 'https://schema.org/OutOfStock',\r\n      },\r\n    }));\r\n\r\n    const structuredData = {\r\n      '@context': 'https://schema.org',\r\n      '@graph': [\r\n        {\r\n          '@type': 'Store',\r\n          name: 'El Rinc\u00F3n de \u00C9bano',\r\n          image: 'https://elrincondeebano.com/assets/images/web/logo.webp',\r\n          description: 'Un minimarket en la puerta de tu departamento',\r\n          address: { '@type': 'PostalAddress', addressCountry: 'CL' },\r\n          telephone: '+56951118901',\r\n          url: 'http://www.elrincondeebano.com/',\r\n          contactPoint: {\r\n            '@type': 'ContactPoint',\r\n            telephone: '+56-951118901',\r\n            contactType: 'customer service',\r\n          },\r\n        },\r\n        ...structuredProducts,\r\n      ],\r\n    };\r\n\r\n    const scriptEl = document.createElement('script');\r\n    scriptEl.type = 'application/ld+json';\r\n    if (window && window.__CSP_NONCE__) {\r\n      scriptEl.setAttribute('nonce', window.__CSP_NONCE__);\r\n    }\r\n    scriptEl.textContent = JSON.stringify(structuredData);\r\n    document.head.appendChild(scriptEl);\r\n    markStructuredDataInjected();\r\n  } catch (e) {\r\n    console.error('[modules/seo] Error generating structured data:', e);\r\n  }\r\n}\r\n\r\nexport function injectSeoMetadata() {\r\n  try {\r\n    if (!document.querySelector('link[rel=\"canonical\"]')) {\r\n      const link = document.createElement('link');\r\n      link.rel = 'canonical';\r\n      link.href = location.origin + location.pathname;\r\n      document.head.appendChild(link);\r\n    }\r\n    if (!document.querySelector('meta[name=\"description\"]')) {\r\n      const meta = document.createElement('meta');\r\n      meta.name = 'description';\r\n      meta.content = 'El Rinc\u00F3n de \u00C9bano - Minimarket con delivery instant\u00E1neo.';\r\n      document.head.appendChild(meta);\r\n    }\r\n  } catch (e) {\r\n    console.warn('[modules/seo] injectSeoMetadata error:', e);\r\n  }\r\n}\r\n", "// PWA manifest injection (migrated from csp.js)\r\nexport function injectPwaManifest() {\r\n  try {\r\n    if (!document.querySelector('link[rel=\"manifest\"]')) {\r\n      const link = document.createElement('link');\r\n      link.rel = 'manifest';\r\n      link.href = '/app.webmanifest';\r\n      document.head.appendChild(link);\r\n    }\r\n  } catch (e) {\r\n    console.warn('[modules/pwa] injectPwaManifest error:', e);\r\n  }\r\n}\r\n\r\n", "// Placeholder for checkout progress (migrated from csp.js)\r\nexport function setupCheckoutProgress() {\r\n  try {\r\n    if (window?.console?.debug) console.debug('[modules/checkout] setupCheckoutProgress: no-op');\r\n  } catch {}\r\n}\r\n\r\n", "const controllerRegistry = new WeakMap();\r\nconst controllerContainers = new Set();\r\nconst activeControllers = new Set();\r\n\r\nconst raf = typeof window !== 'undefined' && typeof window.requestAnimationFrame === 'function'\r\n  ? window.requestAnimationFrame.bind(window)\r\n  : (cb) => setTimeout(cb, 16);\r\n\r\nconst caf = typeof window !== 'undefined' && typeof window.cancelAnimationFrame === 'function'\r\n  ? window.cancelAnimationFrame.bind(window)\r\n  : (id) => clearTimeout(id);\r\n\r\nfunction composedPath(event) {\r\n  if (typeof event.composedPath === 'function') {\r\n    return event.composedPath();\r\n  }\r\n  const path = [];\r\n  let current = event.target;\r\n  while (current) {\r\n    path.push(current);\r\n    current = current.parentNode;\r\n  }\r\n  if (typeof window !== 'undefined') {\r\n    path.push(window);\r\n  }\r\n  path.push(document);\r\n  return path;\r\n}\r\n\r\nfunction ensureId(baseElement, prefix, index) {\r\n  if (!baseElement) {\r\n    return `${prefix}-${index}`;\r\n  }\r\n  if (typeof baseElement.id === 'string' && baseElement.id.trim().length > 0) {\r\n    return `id:${baseElement.id}`;\r\n  }\r\n  const datasetId = baseElement.dataset?.dropdownId;\r\n  if (datasetId) {\r\n    return datasetId;\r\n  }\r\n  const generated = `${prefix}:${index}`;\r\n  if (baseElement.dataset) {\r\n    baseElement.dataset.dropdownId = generated;\r\n  }\r\n  return generated;\r\n}\r\n\r\nfunction setExpanded(entry, isExpanded) {\r\n  const { toggle, menu, dropdownNode } = entry;\r\n  toggle.classList.toggle('show', isExpanded);\r\n  toggle.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');\r\n  if (menu) {\r\n    menu.classList.toggle('show', isExpanded);\r\n  }\r\n  if (dropdownNode) {\r\n    dropdownNode.classList.toggle('show', isExpanded);\r\n  }\r\n}\r\n\r\nfunction closeAll(state) {\r\n  state.expandedId = null;\r\n  state.toggles.forEach((entry) => {\r\n    setExpanded(entry, false);\r\n  });\r\n}\r\n\r\nfunction ensureOutsideListener(state) {\r\n  if (state.outsideListenerInstalled) {\r\n    return;\r\n  }\r\n  state.outsideListenerInstalled = true;\r\n  let listenerAttached = false;\r\n  const attach = () => {\r\n    document.addEventListener('pointerdown', state.onPointerDownOutside, true);\r\n    listenerAttached = true;\r\n  };\r\n  state.outsideListenerCleanup = () => {\r\n    if (state.installTimer !== null) {\r\n      clearTimeout(state.installTimer);\r\n      state.installTimer = null;\r\n    }\r\n    if (listenerAttached) {\r\n      document.removeEventListener('pointerdown', state.onPointerDownOutside, true);\r\n      listenerAttached = false;\r\n    }\r\n    state.outsideListenerInstalled = false;\r\n  };\r\n  state.installTimer = setTimeout(() => {\r\n    state.installTimer = null;\r\n    attach();\r\n  }, 0);\r\n}\r\n\r\nfunction handleTogglePointerDown(event, state, entry) {\r\n  if (event.button !== undefined && event.button !== 0) {\r\n    return;\r\n  }\r\n  if (state.preventNavigation && entry.toggle.tagName === 'A') {\r\n    event.preventDefault();\r\n  }\r\n  event.stopPropagation();\r\n  if (typeof event.stopImmediatePropagation === 'function') {\r\n    event.stopImmediatePropagation();\r\n  }\r\n\r\n  state.justOpened = true;\r\n  if (state.justOpenedFrame !== null) {\r\n    caf(state.justOpenedFrame);\r\n  }\r\n  state.justOpenedFrame = raf(() => {\r\n    state.justOpened = false;\r\n    state.justOpenedFrame = null;\r\n  });\r\n\r\n  ensureOutsideListener(state);\r\n\r\n  if (state.expandedId === entry.id) {\r\n    closeAll(state);\r\n    return;\r\n  }\r\n\r\n  closeAll(state);\r\n  setExpanded(entry, true);\r\n  state.expandedId = entry.id;\r\n}\r\n\r\nfunction handleToggleKeyDown(event, state, entry) {\r\n  const key = event.key;\r\n  if (key === 'Enter' || key === ' ' || key === 'Spacebar') {\r\n    event.preventDefault();\r\n    handleTogglePointerDown(event, state, entry);\r\n  } else if (key === 'Escape') {\r\n    closeAll(state);\r\n    entry.toggle.focus();\r\n  }\r\n}\r\n\r\nfunction now() {\r\n  if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\r\n    return performance.now();\r\n  }\r\n  return Date.now();\r\n}\r\n\r\nfunction createEntry(toggle, index) {\r\n  const dropdownNode = toggle.closest('.dropdown');\r\n  const menu = dropdownNode?.querySelector('.dropdown-menu');\r\n  const id = ensureId(toggle, 'auto', index);\r\n  const entry = { toggle, menu, dropdownNode, id, lastPointerTime: 0 };\r\n  if (menu && !menu.id) {\r\n    menu.id = `${id}-menu`;\r\n  }\r\n  if (menu) {\r\n    toggle.setAttribute('aria-controls', menu.id);\r\n  }\r\n  return entry;\r\n}\r\n\r\nfunction createController(nav) {\r\n  const state = {\r\n    container: nav,\r\n    toggles: [],\r\n    expandedId: null,\r\n    justOpened: false,\r\n    justOpenedFrame: null,\r\n    outsideListenerInstalled: false,\r\n    outsideListenerCleanup: null,\r\n    installTimer: null,\r\n    onPointerDownOutside: null,\r\n    preventNavigation: true,\r\n  };\r\n\r\n  state.onPointerDownOutside = (event) => {\r\n    if (state.justOpened) {\r\n      return;\r\n    }\r\n    const path = composedPath(event);\r\n    if (path.includes(state.container)) {\r\n      return;\r\n    }\r\n    closeAll(state);\r\n  };\r\n\r\n  const toggles = Array.from(nav.querySelectorAll('.dropdown-toggle'));\r\n  toggles.forEach((toggle, index) => {\r\n    if (toggle.dataset.menuControllerBound === '1') {\r\n      return;\r\n    }\r\n    toggle.dataset.menuControllerBound = '1';\r\n    const entry = createEntry(toggle, index);\r\n    state.toggles.push(entry);\r\n\r\n    const pointerHandler = (event) => {\r\n      entry.lastPointerTime = now();\r\n      handleTogglePointerDown(event, state, entry);\r\n    };\r\n    const clickHandler = (event) => {\r\n      const sincePointer = now() - (entry.lastPointerTime || 0);\r\n      if (sincePointer < 250) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        if (typeof event.stopImmediatePropagation === 'function') {\r\n          event.stopImmediatePropagation();\r\n        }\r\n        return;\r\n      }\r\n      handleTogglePointerDown(event, state, entry);\r\n    };\r\n    const keyHandler = (event) => handleToggleKeyDown(event, state, entry);\r\n    toggle.addEventListener('pointerdown', pointerHandler);\r\n    toggle.addEventListener('click', clickHandler);\r\n    toggle.addEventListener('keydown', keyHandler);\r\n    entry.cleanup = () => {\r\n      toggle.removeEventListener('pointerdown', pointerHandler);\r\n      toggle.removeEventListener('click', clickHandler);\r\n      toggle.removeEventListener('keydown', keyHandler);\r\n      delete toggle.dataset.menuControllerBound;\r\n    };\r\n  });\r\n\r\n  controllerRegistry.set(nav, state);\r\n  controllerContainers.add(nav);\r\n  activeControllers.add(state);\r\n  if (state.toggles.length === 0) {\r\n    destroyController(state);\r\n    return null;\r\n  }\r\n  return state;\r\n}\r\n\r\nfunction destroyController(state) {\r\n  if (!state) {\r\n    return;\r\n  }\r\n  state.toggles.forEach((entry) => {\r\n    setExpanded(entry, false);\r\n    entry.cleanup?.();\r\n  });\r\n  state.toggles = [];\r\n  closeAll(state);\r\n  if (state.outsideListenerCleanup) {\r\n    state.outsideListenerCleanup();\r\n    state.outsideListenerCleanup = null;\r\n  }\r\n  if (state.justOpenedFrame !== null) {\r\n    caf(state.justOpenedFrame);\r\n    state.justOpenedFrame = null;\r\n  }\r\n  if (state.container) {\r\n    controllerRegistry.delete(state.container);\r\n    controllerContainers.delete(state.container);\r\n  }\r\n  activeControllers.delete(state);\r\n}\r\n\r\nexport function setupUnifiedMenuController({ container } = {}) {\r\n  if (typeof document === 'undefined') {\r\n    return;\r\n  }\r\n  let navContainers;\r\n  if (container) {\r\n    navContainers = [container];\r\n  } else {\r\n    const preferred = Array.from(document.querySelectorAll('#navbar-container'));\r\n    navContainers = preferred.length > 0 ? preferred : Array.from(document.querySelectorAll('.navbar, nav'));\r\n  }\r\n\r\n  navContainers.forEach((nav) => {\r\n    if (!(nav instanceof HTMLElement)) {\r\n      return;\r\n    }\r\n    const toggles = nav.querySelectorAll('.dropdown-toggle');\r\n    if (toggles.length === 0) {\r\n      return;\r\n    }\r\n    const existing = controllerRegistry.get(nav);\r\n    if (existing) {\r\n      return;\r\n    }\r\n    const controller = createController(nav);\r\n    if (!controller) {\r\n      controllerRegistry.delete(nav);\r\n      controllerContainers.delete(nav);\r\n    }\r\n  });\r\n}\r\n\r\nexport function __resetMenuControllerForTest() {\r\n  Array.from(controllerContainers).forEach((nav) => {\r\n    const state = controllerRegistry.get(nav);\r\n    destroyController(state);\r\n  });\r\n  activeControllers.clear();\r\n}\r\n\r\nexport function __getMenuControllerSnapshot() {\r\n  const controllers = Array.from(activeControllers).map((state) => ({\r\n    containerId: state.container.id || null,\r\n    expandedId: state.expandedId,\r\n    toggleCount: state.toggles.length,\r\n  }));\r\n  return {\r\n    controllerCount: controllers.length,\r\n    controllers,\r\n  };\r\n}\r\n", "import {\r\n  setupUnifiedMenuController,\r\n  __getMenuControllerSnapshot,\r\n  __resetMenuControllerForTest,\r\n} from './menu-controller.mjs';\r\n\r\nlet bootstrapInitialized = false;\r\nconst loaderOverrides = new Map();\r\nlet collapseModulePromise = null;\r\nlet offcanvasModulePromise = null;\r\n\r\nfunction getModuleExport(module) {\r\n  if (module && typeof module === 'object') {\r\n    if (module.default) {\r\n      return module.default;\r\n    }\r\n    const keys = Object.keys(module);\r\n    if (keys.length === 1) {\r\n      return module[keys[0]];\r\n    }\r\n  }\r\n  return module;\r\n}\r\n\r\nfunction getOrCreateInstance(Component, element) {\r\n  if (!Component || !element) {\r\n    return null;\r\n  }\r\n  if (typeof Component.getOrCreateInstance === 'function') {\r\n    return Component.getOrCreateInstance(element);\r\n  }\r\n  return new Component(element);\r\n}\r\n\r\nfunction resolveElement(target) {\r\n  if (!target) {\r\n    return null;\r\n  }\r\n  if (typeof target === 'string') {\r\n    return document.querySelector(target);\r\n  }\r\n  return target;\r\n}\r\n\r\nfunction loadWithOverride(name, importer) {\r\n  if (loaderOverrides.has(name)) {\r\n    return loaderOverrides.get(name)();\r\n  }\r\n  return importer();\r\n}\r\n\r\nasync function loadCollapse() {\r\n  if (!collapseModulePromise) {\r\n    collapseModulePromise = loadWithOverride('collapse', () => import('bootstrap/js/dist/collapse'));\r\n  }\r\n  const module = await collapseModulePromise;\r\n  return getModuleExport(module);\r\n}\r\n\r\nasync function loadOffcanvas() {\r\n  if (!offcanvasModulePromise) {\r\n    offcanvasModulePromise = loadWithOverride('offcanvas', () => import('bootstrap/js/dist/offcanvas'));\r\n  }\r\n  const module = await offcanvasModulePromise;\r\n  return getModuleExport(module);\r\n}\r\n\r\nfunction setupCollapseToggles() {\r\n  const toggles = document.querySelectorAll('[data-bs-toggle=\"collapse\"][data-bs-target]');\r\n  toggles.forEach((toggle) => {\r\n    toggle.addEventListener('click', (event) => {\r\n      if (shouldPreventNavigation(toggle)) {\r\n        event.preventDefault();\r\n      }\r\n      if (typeof event.stopImmediatePropagation === 'function') {\r\n        event.stopImmediatePropagation();\r\n      }\r\n      event.stopPropagation();\r\n      void activateCollapse(toggle, event);\r\n    });\r\n  });\r\n}\r\n\r\nasync function activateCollapse(toggle, event) {\r\n  try {\r\n    const targetSelector = toggle.getAttribute('data-bs-target');\r\n    if (!targetSelector) {\r\n      return;\r\n    }\r\n    const target = document.querySelector(targetSelector);\r\n    if (!target) {\r\n      return;\r\n    }\r\n    const Collapse = await loadCollapse();\r\n    const instance = getOrCreateInstance(Collapse, target);\r\n    instance?.toggle?.(event);\r\n  } catch (error) {\r\n    console.error('No se pudo inicializar el Collapse de Bootstrap', error);\r\n  }\r\n}\r\n\r\nfunction shouldPreventNavigation(toggle) {\r\n  if (!toggle || toggle.tagName !== 'A') {\r\n    return false;\r\n  }\r\n  const href = toggle.getAttribute('href');\r\n  return !href || href === '#';\r\n}\r\n\r\nexport function initializeBootstrapUI() {\r\n  if (bootstrapInitialized) {\r\n    return;\r\n  }\r\n  bootstrapInitialized = true;\r\n  if (typeof document === 'undefined') {\r\n    return;\r\n  }\r\n  setupCollapseToggles();\r\n  setupUnifiedMenuController();\r\n}\r\n\r\nexport async function showOffcanvas(target) {\r\n  if (typeof document === 'undefined') {\r\n    throw new Error('Offcanvas no disponible en este entorno');\r\n  }\r\n  const element = resolveElement(target);\r\n  if (!element) {\r\n    throw new Error('No se encontr\u00F3 el elemento de Offcanvas');\r\n  }\r\n  const Offcanvas = await loadOffcanvas();\r\n  const instance = getOrCreateInstance(Offcanvas, element);\r\n  if (!instance || typeof instance.show !== 'function') {\r\n    throw new Error('Instancia de Offcanvas inv\u00E1lida');\r\n  }\r\n  instance.show();\r\n  return instance;\r\n}\r\n\r\nexport function __setBootstrapLoaderOverride(name, loader) {\r\n  loaderOverrides.set(name, loader);\r\n  if (name === 'collapse') {\r\n    collapseModulePromise = null;\r\n  } else if (name === 'offcanvas') {\r\n    offcanvasModulePromise = null;\r\n  }\r\n}\r\n\r\nexport function __resetBootstrapTestState() {\r\n  loaderOverrides.clear();\r\n  collapseModulePromise = null;\r\n  offcanvasModulePromise = null;\r\n  bootstrapInitialized = false;\r\n  __resetMenuControllerForTest();\r\n}\r\n\r\nexport function __getDropdownStateSnapshot() {\r\n  return __getMenuControllerSnapshot();\r\n}\r\n", "/**\r\n * Build a Cloudflare image URL with optional transformation parameters.\r\n * @param {string} path - Image path, absolute or relative.\r\n * @param {Record<string, string|number>} [opts] - Key/value pairs passed to the CDN.\r\n * @returns {string} The rewritten URL.\r\n */\r\nexport function cfimg(path, opts = {}) {\r\n  const p = path.startsWith('/') ? path : '/' + path;\r\n  const params = Object.entries(opts).map(([k, v]) => `${k}=${v}`).join(',');\r\n  const encoded = p.split('/').map(encodeURIComponent).join('/');\r\n  return `/cdn-cgi/image/${params}${encoded}`;\r\n}\r\n\r\n/**\r\n * Default options for product thumbnail transformations.\r\n * @type {Record<string, string|number>}\r\n */\r\nexport const CFIMG_THUMB = { fit: 'cover', quality: 75, format: 'auto' };\n", "import { cfimg, CFIMG_THUMB } from './utils/cfimg.mjs';\r\nimport { log, createCorrelationId } from './utils/logger.mjs';\r\nimport { showOffcanvas } from './modules/bootstrap.mjs';\r\n\r\nconst PRODUCT_DATA_GLOBAL_KEY = '__PRODUCT_DATA__';\r\nlet sharedProductData = null;\r\n\r\nconst UTILITY_CLASSES = Object.freeze({\r\n    hidden: 'is-hidden',\r\n    flex: 'is-flex',\r\n    block: 'is-block',\r\n    contentVisible: 'has-content-visibility',\r\n    containIntrinsic: 'has-contain-intrinsic'\r\n});\r\n\r\nconst PRODUCT_IMAGE_WIDTHS = Object.freeze([200, 320, 400]);\r\nconst PRODUCT_IMAGE_SIZES = '(min-width: 1200px) 280px, (min-width: 992px) 240px, (min-width: 576px) 45vw, 80vw';\r\nconst CART_IMAGE_WIDTHS = Object.freeze([80, 120, 160]);\r\n\r\nconst normaliseAssetPath = (value = '') => {\r\n    if (!value) {\r\n        return '';\r\n    }\r\n    const trimmed = value.startsWith('/') ? value.slice(1) : value;\r\n    return `/${trimmed}`;\r\n};\r\n\r\nconst buildCfSrc = (assetPath, extraOpts = {}) => {\r\n    const normalised = normaliseAssetPath(assetPath);\r\n    if (!normalised) {\r\n        return '';\r\n    }\r\n    return cfimg(normalised, { ...CFIMG_THUMB, ...extraOpts });\r\n};\r\n\r\nconst buildCfSrcset = (assetPath, extraOpts = {}, widths = PRODUCT_IMAGE_WIDTHS) => {\r\n    const normalised = normaliseAssetPath(assetPath);\r\n    if (!normalised) {\r\n        return '';\r\n    }\r\n    return widths\r\n        .map(width => `${cfimg(normalised, { ...CFIMG_THUMB, width, ...extraOpts })} ${width}w`)\r\n        .join(', ');\r\n};\r\n\r\nconst STATIC_SRC_DESCRIPTOR_KEYS = Object.freeze(['descriptor', 'd']);\r\n\r\nconst encodeStaticPath = (path) => {\r\n    if (!path) {\r\n        return '';\r\n    }\r\n    try {\r\n        return encodeURI(path);\r\n    } catch (_err) {\r\n        return path;\r\n    }\r\n};\r\n\r\nconst buildStaticSrcset = (assetPath) => {\r\n    if (!assetPath) {\r\n        return '';\r\n    }\r\n\r\n    const normaliseDescriptor = (descriptorCandidate) => {\r\n        if (typeof descriptorCandidate === 'string') {\r\n            const trimmed = descriptorCandidate.trim();\r\n            return trimmed ? trimmed : '';\r\n        }\r\n        if (typeof descriptorCandidate === 'number' && Number.isFinite(descriptorCandidate)) {\r\n            return `${descriptorCandidate}w`;\r\n        }\r\n        return '';\r\n    };\r\n\r\n    const buildEntry = (entry) => {\r\n        if (typeof entry === 'string') {\r\n            const normalised = normaliseAssetPath(entry);\r\n            return encodeStaticPath(normalised);\r\n        }\r\n\r\n        if (entry && typeof entry === 'object') {\r\n            const srcCandidate = entry.src || entry.path || entry.url || '';\r\n            const src = normaliseAssetPath(srcCandidate);\r\n            if (!src) {\r\n                return '';\r\n            }\r\n\r\n            const descriptorKey = STATIC_SRC_DESCRIPTOR_KEYS.find(key => key in entry);\r\n            const descriptor = descriptorKey ? normaliseDescriptor(entry[descriptorKey]) : normaliseDescriptor(entry.width);\r\n            const encodedSrc = encodeStaticPath(src);\r\n            return descriptor ? `${encodedSrc} ${descriptor}` : encodedSrc;\r\n        }\r\n\r\n        return '';\r\n    };\r\n\r\n    if (Array.isArray(assetPath)) {\r\n        return assetPath\r\n            .map(buildEntry)\r\n            .filter(Boolean)\r\n            .join(', ');\r\n    }\r\n\r\n    if (assetPath && typeof assetPath === 'object') {\r\n        if (typeof assetPath.srcset === 'string') {\r\n            const trimmed = assetPath.srcset.trim();\r\n            if (trimmed) {\r\n                return trimmed;\r\n            }\r\n        }\r\n\r\n        if (Array.isArray(assetPath.variants)) {\r\n            return assetPath.variants\r\n                .map(buildEntry)\r\n                .filter(Boolean)\r\n                .join(', ');\r\n        }\r\n\r\n        return buildEntry(assetPath);\r\n    }\r\n\r\n    const normalised = normaliseAssetPath(assetPath);\r\n    return encodeStaticPath(normalised);\r\n};\r\n\r\nconst isAvifAsset = (assetPath) => {\r\n    if (typeof assetPath !== 'string') {\r\n        return false;\r\n    }\r\n    const trimmed = assetPath.trim();\r\n    if (!trimmed) {\r\n        return false;\r\n    }\r\n    return /\\.avif(?:[?#].*)?$/i.test(trimmed);\r\n};\r\n\r\nconst resolveAvifSrcset = (assetPath, widths = PRODUCT_IMAGE_WIDTHS) => {\r\n    if (!assetPath) {\r\n        return '';\r\n    }\r\n\r\n    if (Array.isArray(assetPath)) {\r\n        const staticSrcset = buildStaticSrcset(assetPath);\r\n        if (staticSrcset && /\\.avif/i.test(staticSrcset)) {\r\n            return staticSrcset;\r\n        }\r\n    }\r\n\r\n    if (assetPath && typeof assetPath === 'object' && !Array.isArray(assetPath)) {\r\n        const srcsetFromObject = buildStaticSrcset(assetPath);\r\n        if (srcsetFromObject && /\\.avif/i.test(srcsetFromObject)) {\r\n            return srcsetFromObject;\r\n        }\r\n\r\n        const srcCandidate = assetPath.src || assetPath.path || assetPath.url || '';\r\n        if (isAvifAsset(srcCandidate)) {\r\n            return buildStaticSrcset(srcCandidate);\r\n        }\r\n    }\r\n\r\n    if (isAvifAsset(assetPath)) {\r\n        return buildStaticSrcset(assetPath);\r\n    }\r\n\r\n    return buildCfSrcset(assetPath, { format: 'avif' }, widths);\r\n};\r\nfunction getSharedProductData() {\r\n    if (typeof window !== 'undefined') {\r\n        const payload = window[PRODUCT_DATA_GLOBAL_KEY];\r\n        if (payload && Array.isArray(payload.products)) {\r\n            return payload;\r\n        }\r\n    }\r\n    if (sharedProductData && Array.isArray(sharedProductData.products)) {\r\n        return sharedProductData;\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction writeSharedProductData(products, metadata = {}, { force = false } = {}) {\r\n    if (!Array.isArray(products)) {\r\n        return null;\r\n    }\r\n    const payload = {\r\n        products,\r\n        version: metadata.version || null,\r\n        source: metadata.source || null,\r\n        updatedAt: metadata.updatedAt || Date.now(),\r\n        isPartial: Boolean(metadata.isPartial),\r\n        total: typeof metadata.total === 'number' ? metadata.total : null\r\n    };\r\n    const existing = getSharedProductData();\r\n    if (existing && !force) {\r\n        const existingVersion = existing.version || null;\r\n        const payloadVersion = payload.version || null;\r\n        const shouldKeepExisting =\r\n            (!payloadVersion && existingVersion) ||\r\n            (!payloadVersion && !existingVersion) ||\r\n            (payloadVersion && existingVersion === payloadVersion);\r\n        if (shouldKeepExisting) {\r\n            return existing;\r\n        }\r\n    }\r\n    sharedProductData = payload;\r\n    if (typeof window !== 'undefined') {\r\n        window[PRODUCT_DATA_GLOBAL_KEY] = { ...payload };\r\n    }\r\n    return payload;\r\n}\r\n\r\nfunction ensureSharedProductData(products, metadata = {}) {\r\n    return writeSharedProductData(products, metadata, { force: false });\r\n}\r\n\r\nfunction overwriteSharedProductData(products, metadata = {}) {\r\n    return writeSharedProductData(products, metadata, { force: true });\r\n}\r\n\r\n// Service Worker Configuration and Initialization\r\nconst SERVICE_WORKER_CONFIG = {\r\n    path: '/service-worker.js',\r\n    scope: '/',\r\n    updateCheckInterval: 5 * 60 * 1000, // 5 minutes\r\n};\r\n\r\nconst LOCALHOST_HOSTNAMES = new Set(['localhost', '127.0.0.1', '::1', '[::1]']);\r\n\r\nfunction safeReadLocalStorage(key) {\r\n    if (typeof window === 'undefined') {\r\n        return null;\r\n    }\r\n\r\n    try {\r\n        const storage = window.localStorage ?? globalThis.localStorage ?? null;\r\n        if (!storage) {\r\n            return null;\r\n        }\r\n        return storage.getItem(key);\r\n    } catch (error) {\r\n        console.warn('Unable to access localStorage for key', key, error);\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction shouldRegisterServiceWorker() {\r\n    if (typeof window === 'undefined') {\r\n        return false;\r\n    }\r\n\r\n    const disabledFlag = safeReadLocalStorage('ebano-sw-disabled');\r\n    if (disabledFlag === 'true') {\r\n        console.info('Service worker registration skipped by kill-switch flag.');\r\n        return false;\r\n    }\r\n\r\n    const hostname = window.location?.hostname ?? '';\r\n    const isLocalhost = LOCALHOST_HOSTNAMES.has(hostname);\r\n    if (isLocalhost) {\r\n        const enableLocalFlag = safeReadLocalStorage('ebano-sw-enable-local');\r\n        const query = window.location?.search ?? '';\r\n        const queryEnables = typeof query === 'string' && /(?:^|[?&])sw=on(?:&|$)/i.test(query);\r\n        if (enableLocalFlag === 'true' || queryEnables) {\r\n            return true;\r\n        }\r\n        console.info('Service worker registration skipped on localhost. Set localStorage ebano-sw-enable-local=true to override.');\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nlet serviceWorkerRegistrationSetup = false;\r\n\r\n// Enhanced service worker registration with proper error handling and lifecycle management\r\nfunction registerServiceWorker() {\r\n    if (!('serviceWorker' in navigator)) {\r\n        console.warn('Service workers are not supported in this browser');\r\n        return;\r\n    }\r\n\r\n    if (!shouldRegisterServiceWorker()) {\r\n        return;\r\n    }\r\n\r\n    if (serviceWorkerRegistrationSetup) {\r\n        return;\r\n    }\r\n\r\n    serviceWorkerRegistrationSetup = true;\r\n\r\n    const startRegistration = async () => {\r\n        if (document.readyState !== 'complete') {\r\n            return;\r\n        }\r\n\r\n        window.removeEventListener('load', startRegistration);\r\n\r\n        try {\r\n            await initializeServiceWorker();\r\n        } catch (error) {\r\n            console.error('Service Worker initialization failed:', error);\r\n            showServiceWorkerError('Failed to initialize service worker. Some features may not work offline.');\r\n        }\r\n    };\r\n\r\n    window.addEventListener('load', startRegistration);\r\n    startRegistration();\r\n}\r\n\r\nfunction __resetServiceWorkerRegistrationForTest() {\r\n    serviceWorkerRegistrationSetup = false;\r\n}\r\n\r\n// Initialize the service worker and set up event handlers\r\nasync function initializeServiceWorker() {\r\n    try {\r\n        const registration = await navigator.serviceWorker.register(\r\n            SERVICE_WORKER_CONFIG.path,\r\n            { scope: SERVICE_WORKER_CONFIG.scope }\r\n        );\r\n\r\n        console.log('ServiceWorker registered successfully:', registration.scope);\r\n\r\n        // Set up update handling\r\n        setupUpdateHandling(registration);\r\n\r\n        // Set up periodic update checks\r\n        setupPeriodicUpdateCheck(registration);\r\n\r\n        // Handle controller changes\r\n        setupControllerChangeHandling();\r\n\r\n        // Set up offline/online detection\r\n        setupConnectivityHandling();\r\n\r\n    } catch (error) {\r\n        console.error('ServiceWorker registration failed:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n// Set up handling for service worker updates\r\nfunction setupUpdateHandling(registration) {\r\n    registration.addEventListener('updatefound', () => {\r\n        const newWorker = registration.installing;\r\n        newWorker.addEventListener('statechange', () => {\r\n            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\r\n                // Immediately activate the new service worker without a prompt\r\n                newWorker.postMessage({ type: 'SKIP_WAITING' });\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n\r\n// Set up periodic checks for service worker updates\r\nfunction setupPeriodicUpdateCheck(registration) {\r\n    // Initial check\r\n    checkForUpdates(registration);\r\n\r\n    // Set up periodic checks\r\n    setInterval(() => {\r\n        checkForUpdates(registration);\r\n    }, SERVICE_WORKER_CONFIG.updateCheckInterval);\r\n}\r\n\r\n// Check for service worker updates\r\nasync function checkForUpdates(registration) {\r\n    try {\r\n        await registration.update();\r\n\r\n        // Check if product data needs updating\r\n        const response = await fetch('/data/product_data.json', { cache: 'no-store', headers: { 'Accept': 'application/json' } });\r\n\r\n        if (response.ok) {\r\n            const data = await response.json();\r\n            const currentVersion = data.version;\r\n            const storedVersion = localStorage.getItem('productDataVersion');\r\n\r\n            if (currentVersion !== storedVersion) {\r\n                registration.active?.postMessage({\r\n                    type: 'INVALIDATE_PRODUCT_CACHE'\r\n                });\r\n\r\n                localStorage.setItem('productDataVersion', currentVersion);\r\n                showUpdateNotification(null, 'New product data available');\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.warn('Update check failed:', error);\r\n    }\r\n}\r\n\r\n// Set up handling for service worker controller changes\r\nfunction setupControllerChangeHandling() {\r\n    let refreshing = false;\r\n    navigator.serviceWorker.addEventListener('controllerchange', () => {\r\n        if (!refreshing) {\r\n            refreshing = true;\r\n            window.location.reload();\r\n        }\r\n    });\r\n}\r\n\r\n// Set up handling for online/offline connectivity\r\nfunction setupConnectivityHandling() {\r\n    const offlineIndicator = document.getElementById('offline-indicator');\r\n    if (!offlineIndicator) {\r\n        return;\r\n    }\r\n    const updateOnlineStatus = () => {\r\n        const hidden = navigator.onLine;\r\n        offlineIndicator.classList.toggle(UTILITY_CLASSES.hidden, hidden);\r\n        offlineIndicator.classList.toggle(UTILITY_CLASSES.block, !hidden);\r\n\r\n        if (!hidden) {\r\n            showConnectivityNotification('You are currently offline. Some features may be limited.');\r\n        }\r\n    };\r\n\r\n    window.addEventListener('online', updateOnlineStatus);\r\n    window.addEventListener('offline', updateOnlineStatus);\r\n\r\n    if (!navigator.onLine) {\r\n        updateOnlineStatus();\r\n    }\r\n}\r\n\r\n// Notifications are lazy-loaded to reduce initial JS\r\nlet __notificationsModulePromise = null;\r\nfunction __loadNotifications() {\r\n    if (!__notificationsModulePromise) {\r\n        __notificationsModulePromise = import('./modules/notifications.mjs');\r\n    }\r\n    return __notificationsModulePromise;\r\n}\r\n\r\nfunction showUpdateNotification(serviceWorker, message = 'Una versi\u00F3n est\u00E1 disponible') {\r\n    __loadNotifications().then((m) => m.showUpdateNotification(serviceWorker, message));\r\n}\r\n\r\nfunction showServiceWorkerError(message) {\r\n    __loadNotifications().then((m) => m.showServiceWorkerError(message));\r\n}\r\n\r\nfunction showConnectivityNotification(message) {\r\n    __loadNotifications().then((m) => m.showConnectivityNotification(message));\r\n}\r\n\r\n// Initialize the service worker when running in a browser environment\r\nif (typeof navigator !== 'undefined' && 'serviceWorker' in navigator) {\r\n    registerServiceWorker();\r\n}\r\n\r\n\r\n// Utility functions\r\nconst isCacheableObject = (value) => (typeof value === 'object' && value !== null) || typeof value === 'function';\r\n\r\nconst createCacheNode = () => ({\r\n  map: new Map(),\r\n  weakMap: new WeakMap(),\r\n  hasValue: false,\r\n  value: undefined\r\n});\r\n\r\nconst memoize = (fn, cacheSize = 100) => {\r\n  if (typeof fn !== 'function') {\r\n    throw new TypeError('Expected a function to memoize');\r\n  }\r\n\r\n  if (!Number.isFinite(cacheSize) || cacheSize < 0) {\r\n    cacheSize = 0;\r\n  }\r\n\r\n  const root = createCacheNode();\r\n  const lru = [];\r\n\r\n  const touch = (node) => {\r\n    const index = lru.indexOf(node);\r\n    if (index !== -1) {\r\n      lru.splice(index, 1);\r\n    }\r\n    if (cacheSize > 0) {\r\n      lru.push(node);\r\n    }\r\n  };\r\n\r\n  const evictIfNeeded = () => {\r\n    if (cacheSize === 0) {\r\n      return;\r\n    }\r\n    while (lru.length > cacheSize) {\r\n      const oldest = lru.shift();\r\n      if (!oldest) {\r\n        continue;\r\n      }\r\n      oldest.hasValue = false;\r\n      oldest.value = undefined;\r\n    }\r\n  };\r\n\r\n  const getChildNode = (node, arg) => {\r\n    const useWeakMap = isCacheableObject(arg);\r\n    if (useWeakMap) {\r\n      let next = node.weakMap.get(arg);\r\n      if (!next) {\r\n        next = createCacheNode();\r\n        node.weakMap.set(arg, next);\r\n      }\r\n      return next;\r\n    }\r\n    if (!node.map.has(arg)) {\r\n      node.map.set(arg, createCacheNode());\r\n    }\r\n    return node.map.get(arg);\r\n  };\r\n\r\n  return (...args) => {\r\n    if (cacheSize === 0) {\r\n      return fn(...args);\r\n    }\r\n    let node = root;\r\n    for (let i = 0; i < args.length; i += 1) {\r\n      node = getChildNode(node, args[i]);\r\n    }\r\n    if (node.hasValue) {\r\n      touch(node);\r\n      return node.value;\r\n    }\r\n    const result = fn(...args);\r\n    node.value = result;\r\n    node.hasValue = true;\r\n    touch(node);\r\n    evictIfNeeded();\r\n    return result;\r\n  };\r\n};\r\n\r\nconst debounce = (func, delay) => {\r\n    let timeoutId;\r\n    return (...args) => {\r\n        clearTimeout(timeoutId);\r\n        timeoutId = setTimeout(() => func(...args), delay);\r\n    };\r\n};\r\n\r\nconst scheduleIdle = (fn, timeout = 500) => {\r\n    if (typeof window !== 'undefined' && typeof window.requestIdleCallback === 'function') {\r\n        const handle = window.requestIdleCallback(fn, { timeout });\r\n        return { type: 'idle', handle };\r\n    }\r\n    const handle = setTimeout(fn, 0);\r\n    return { type: 'timeout', handle };\r\n};\r\n\r\nconst cancelScheduledIdle = (token) => {\r\n    if (!token) return;\r\n    if (token.type === 'idle' && typeof window !== 'undefined' && typeof window.cancelIdleCallback === 'function') {\r\n        window.cancelIdleCallback(token.handle);\r\n    } else if (token.type === 'timeout') {\r\n        clearTimeout(token.handle);\r\n    }\r\n};\r\n\r\n// Normalize strings for robust comparisons (remove accents, spaces, punctuation, lowercased)\r\nconst normalizeString = (str) => {\r\n    if (!str) return '';\r\n    try {\r\n        return String(str)\r\n            .normalize('NFD')\r\n            .replace(/[\\u0300-\\u036f]/g, '')\r\n            .replace(/[^a-zA-Z0-9]/g, '')\r\n            .toLowerCase();\r\n    } catch {\r\n        return String(str).toLowerCase();\r\n    }\r\n};\r\n\r\n\r\n\r\n// Add this utility function for generating stable product IDs\r\nconst DEFAULT_CATEGORY = 'General';\r\nconst DEFAULT_PRODUCT_NAME_PREFIX = 'Producto';\r\n\r\nconst generateStableId = (product, index = 0) => {\r\n    const hasValidShape = product && typeof product === 'object';\r\n    const rawName = hasValidShape && typeof product.name === 'string' ? product.name.trim() : '';\r\n    const rawCategory = hasValidShape && typeof product.category === 'string' ? product.category.trim() : '';\r\n\r\n    const safeName = rawName.length > 0 ? rawName : `${DEFAULT_PRODUCT_NAME_PREFIX}-${index + 1}`;\r\n    const safeCategory = rawCategory.length > 0 ? rawCategory : DEFAULT_CATEGORY;\r\n\r\n    const baseString = `${safeName}-${safeCategory}`.toLowerCase();\r\n\r\n    let hash = 0;\r\n    for (let i = 0; i < baseString.length; i += 1) {\r\n        const charCode = baseString.charCodeAt(i);\r\n        hash = ((hash << 5) - hash) + charCode;\r\n        hash &= hash; // Convert to 32-bit integer\r\n    }\r\n\r\n    const needsFallbackSuffix = rawName.length === 0 || rawCategory.length === 0;\r\n    const suffix = needsFallbackSuffix ? `-${index}` : '';\r\n\r\n    return `pid-${Math.abs(hash)}${suffix}`;\r\n};\r\n\r\nconst sanitizeHTML = (unsafe) => {\r\n    const element = document.createElement('div');\r\n    element.textContent = unsafe;\r\n    return element.innerHTML;\r\n};\r\n\r\nconst INLINE_PRODUCT_SCRIPT_ID = 'product-data';\r\n\r\nconst getStoredProductVersion = () => {\r\n    try {\r\n        if (typeof localStorage === 'undefined') {\r\n            return null;\r\n        }\r\n        return localStorage.getItem('productDataVersion');\r\n    } catch (error) {\r\n        console.warn('Unable to read stored product data version:', error);\r\n        return null;\r\n    }\r\n};\r\n\r\nconst setStoredProductVersion = (version) => {\r\n    if (!version) {\r\n        return;\r\n    }\r\n    try {\r\n        if (typeof localStorage === 'undefined') {\r\n            return;\r\n        }\r\n        localStorage.setItem('productDataVersion', version);\r\n    } catch (error) {\r\n        console.warn('Unable to persist product data version:', error);\r\n    }\r\n};\r\n\r\nconst parseInlineProductData = () => {\r\n    if (typeof document === 'undefined') {\r\n        return null;\r\n    }\r\n    try {\r\n        const script = document.getElementById(INLINE_PRODUCT_SCRIPT_ID);\r\n        if (!script || !script.textContent) {\r\n            return null;\r\n        }\r\n        const payload = script.textContent.trim();\r\n        if (!payload) {\r\n            return null;\r\n        }\r\n        const parsed = JSON.parse(payload);\r\n        if (!parsed) {\r\n            return null;\r\n        }\r\n        if (Array.isArray(parsed.initialProducts)) {\r\n            return parsed;\r\n        }\r\n        if (Array.isArray(parsed.products)) {\r\n            return { ...parsed, initialProducts: parsed.products };\r\n        }\r\n        return null;\r\n    } catch (error) {\r\n        log('warn', 'inline_product_parse_failure', { error: error.message });\r\n        return null;\r\n    }\r\n};\r\n\r\nconst transformProduct = (product, index) => {\r\n    if (!product || typeof product !== 'object') {\r\n        return null;\r\n    }\r\n\r\n    const id = typeof product.id === 'string' && product.id.trim().length > 0\r\n        ? product.id.trim()\r\n        : generateStableId(product, index);\r\n\r\n    const originalIndex = typeof product.originalIndex === 'number'\r\n        ? product.originalIndex\r\n        : typeof product.order === 'number'\r\n            ? product.order\r\n            : index;\r\n\r\n    const safeName = typeof product.name === 'string' && product.name.trim().length > 0\r\n        ? product.name\r\n        : `${DEFAULT_PRODUCT_NAME_PREFIX} ${index + 1}`;\r\n\r\n    const safeDescription = typeof product.description === 'string' ? product.description : '';\r\n    const safeCategory = typeof product.category === 'string' && product.category.trim().length > 0\r\n        ? product.category\r\n        : DEFAULT_CATEGORY;\r\n    const safeImagePath = typeof product.image_path === 'string' ? product.image_path : '';\r\n    const safeImageAvifPath = typeof product.image_avif_path === 'string' ? product.image_avif_path : '';\r\n\r\n    return {\r\n        ...product,\r\n        id,\r\n        name: sanitizeHTML(safeName),\r\n        description: sanitizeHTML(safeDescription),\r\n        category: sanitizeHTML(safeCategory),\r\n        categoryKey: product.categoryKey || normalizeString(safeCategory),\r\n        image_path: safeImagePath,\r\n        image_avif_path: safeImageAvifPath,\r\n        originalIndex\r\n    };\r\n};\r\n\r\nconst transformProducts = (products = []) => products\r\n    .map((product, index) => transformProduct(product, index))\r\n    .filter(Boolean);\r\n\r\nfunction hydrateSharedProductDataFromInline() {\r\n    const existing = getSharedProductData();\r\n    if (existing) {\r\n        return existing;\r\n    }\r\n    const inlineData = parseInlineProductData();\r\n    if (!inlineData || !Array.isArray(inlineData.initialProducts)) {\r\n        return null;\r\n    }\r\n    const transformed = transformProducts(inlineData.initialProducts);\r\n    return ensureSharedProductData(transformed, {\r\n        version: inlineData.version || null,\r\n        source: 'inline',\r\n        isPartial: true,\r\n        total: typeof inlineData.totalProducts === 'number' ? inlineData.totalProducts : transformed.length\r\n    });\r\n}\r\n\r\nhydrateSharedProductDataFromInline();\r\n\r\nclass ProductDataError extends Error {\r\n    constructor(message, { cause, correlationId }) {\r\n        super(message);\r\n        this.name = 'ProductDataError';\r\n        this.correlationId = correlationId;\r\n        if (cause) this.cause = cause;\r\n    }\r\n}\r\n\r\nconst fetchWithRetry = async (url, opts, retries, backoffMs, correlationId) => {\r\n    const parsed = new URL(url, window.location.origin);\r\n    if (parsed.origin !== window.location.origin || parsed.protocol !== 'https:') {\r\n        throw new Error('Invalid request URL: only same-origin HTTPS requests are allowed');\r\n    }\r\n    const sanitizedUrl = parsed.toString();\r\n    let attempt = 0;\r\n    let lastError;\r\n    while (attempt <= retries) {\r\n        try {\r\n            const start = Date.now();\r\n            const response = await fetch(sanitizedUrl, opts);\r\n            const durationMs = Date.now() - start;\r\n            log('info', 'fetch_products_attempt', { correlationId, attempt: attempt + 1, durationMs });\r\n            if (!response.ok) {\r\n                throw new Error(`HTTP error. Status: ${response.status}`);\r\n            }\r\n            return response;\r\n        } catch (err) {\r\n            lastError = err;\r\n            attempt++;\r\n            if (attempt > retries) break;\r\n            log('warn', 'fetch_products_retry', { correlationId, attempt, error: err.message, runbook: 'RUNBOOK.md#product-data' });\r\n            await new Promise(resolve => setTimeout(resolve, backoffMs * attempt));\r\n        }\r\n    }\r\n    throw new ProductDataError(`Failed to fetch products: ${lastError.message}`, { cause: lastError, correlationId });\r\n};\r\n\r\n// Modify the fetchProducts function\r\nconst fetchProducts = async () => {\r\n    const correlationId = createCorrelationId();\r\n    const inlineData = parseInlineProductData();\r\n    const inlineSource = inlineData?.initialProducts || null;\r\n    const inlineVersion = inlineData?.version || null;\r\n    const inlineTotal = typeof inlineData?.totalProducts === 'number' ? inlineData.totalProducts : null;\r\n    const inlineProducts = Array.isArray(inlineSource) ? transformProducts(inlineSource) : null;\r\n    const hasInlineProducts = Array.isArray(inlineProducts);\r\n    const storedVersion = getStoredProductVersion();\r\n\r\n    if (hasInlineProducts) {\r\n        if (inlineVersion) {\r\n            setStoredProductVersion(inlineVersion);\r\n        }\r\n        ensureSharedProductData(inlineProducts, {\r\n            version: inlineVersion || null,\r\n            source: 'inline',\r\n            isPartial: true,\r\n            total: inlineTotal ?? inlineProducts.length\r\n        });\r\n        log('info', 'fetch_products_inline_bootstrap', { correlationId, count: inlineProducts.length });\r\n    }\r\n\r\n    const versionForUrl = storedVersion || inlineVersion || null;\r\n    const url = versionForUrl ? `/data/product_data.json?v=${encodeURIComponent(versionForUrl)}` : '/data/product_data.json';\r\n\r\n    try {\r\n        const response = await fetchWithRetry(\r\n            url,\r\n            { cache: 'no-store', headers: { 'Accept': 'application/json' } },\r\n            2,\r\n            300,\r\n            correlationId\r\n        );\r\n        const data = await response.json();\r\n        const transformed = transformProducts(data.products || []);\r\n        overwriteSharedProductData(transformed, {\r\n            version: data.version || null,\r\n            source: 'network',\r\n            isPartial: false,\r\n            total: transformed.length\r\n        });\r\n        if (data.version) {\r\n            setStoredProductVersion(data.version);\r\n        }\r\n        log('info', 'fetch_products_success', { correlationId, count: transformed.length, source: 'network' });\r\n        return transformed;\r\n    } catch (error) {\r\n        if (hasInlineProducts) {\r\n            ensureSharedProductData(inlineProducts, {\r\n                version: inlineVersion || null,\r\n                source: 'inline-fallback',\r\n                isPartial: true,\r\n                total: inlineTotal ?? inlineProducts.length\r\n            });\r\n            log('warn', 'fetch_products_network_fallback_inline', { correlationId, error: error.message, runbook: 'RUNBOOK.md#product-data' });\r\n            return inlineProducts;\r\n        }\r\n        log('error', 'fetch_products_failure', { correlationId, error: error.message, runbook: 'RUNBOOK.md#product-data' });\r\n        showErrorMessage(`Error al cargar los productos. Por favor, verifique su conexi\u00F3n a internet e int\u00E9ntelo de nuevo. (Error: ${error.message})`);\r\n        if (error instanceof ProductDataError) {\r\n            throw error;\r\n        }\r\n        throw new ProductDataError(error.message, { cause: error, correlationId });\r\n    }\r\n};\r\n\r\nconst createSafeElement = (tag, attributes = {}, children = []) => {\r\n    const element = document.createElement(tag);\r\n    Object.entries(attributes).forEach(([key, value]) => {\r\n        if (key === 'text') {\r\n            element.textContent = value;\r\n        } else {\r\n            element.setAttribute(key, value);\r\n        }\r\n    });\r\n    children.forEach(child => {\r\n        if (typeof child === 'string') {\r\n            element.appendChild(document.createTextNode(child));\r\n        } else {\r\n            element.appendChild(child);\r\n        }\r\n    });\r\n    return element;\r\n};\r\n\r\nconst createProductPicture = ({ imagePath, avifPath, alt, eager = false }) => {\r\n    const sizes = PRODUCT_IMAGE_SIZES;\r\n    const pictureChildren = [];\r\n    const avifSrcset = resolveAvifSrcset(avifPath);\r\n    if (avifSrcset) {\r\n        pictureChildren.push(createSafeElement('source', {\r\n            type: 'image/avif',\r\n            srcset: avifSrcset,\r\n            sizes\r\n        }));\r\n    }\r\n    const fallbackSrc = buildCfSrc(imagePath, { width: 320 }) || normaliseAssetPath(imagePath);\r\n    const fallbackSrcset = buildCfSrcset(imagePath);\r\n    const imgAttrs = {\r\n        src: fallbackSrc || '',\r\n        alt: alt || '',\r\n        class: 'card-img-top product-thumb',\r\n        loading: eager ? 'eager' : 'lazy',\r\n        fetchpriority: eager ? 'high' : 'auto',\r\n        decoding: 'async',\r\n        width: '400',\r\n        height: '400',\r\n        sizes\r\n    };\r\n    if (fallbackSrcset) {\r\n        imgAttrs.srcset = fallbackSrcset;\r\n    }\r\n    const imgElement = createSafeElement('img', imgAttrs);\r\n    pictureChildren.push(imgElement);\r\n    return createSafeElement('picture', {}, pictureChildren);\r\n};\r\n\r\nconst createCartThumbnail = ({ imagePath, avifPath, alt }) => {\r\n    const sizes = '100px';\r\n    const sources = [];\r\n    const avifSrcset = resolveAvifSrcset(avifPath, CART_IMAGE_WIDTHS);\r\n    if (avifSrcset) {\r\n        sources.push(createSafeElement('source', {\r\n            type: 'image/avif',\r\n            srcset: avifSrcset,\r\n            sizes\r\n        }));\r\n    }\r\n    const fallbackSrc = buildCfSrc(imagePath, { width: CART_IMAGE_WIDTHS[1] }) || normaliseAssetPath(imagePath);\r\n    const fallbackSrcset = buildCfSrcset(imagePath, {}, CART_IMAGE_WIDTHS);\r\n    const imgAttrs = {\r\n        src: fallbackSrc || '',\r\n        alt: alt || '',\r\n        class: 'cart-item-thumb-img',\r\n        loading: 'lazy',\r\n        decoding: 'async',\r\n        width: '100',\r\n        height: '100',\r\n        sizes\r\n    };\r\n    if (fallbackSrcset) {\r\n        imgAttrs.srcset = fallbackSrcset;\r\n    }\r\n    const imgElement = createSafeElement('img', imgAttrs);\r\n    return createSafeElement('picture', {}, [...sources, imgElement]);\r\n};\r\n\r\nconst showErrorMessage = (message) => {\r\n    const errorMessage = createSafeElement('div', { class: 'error-message', role: 'alert' }, [\r\n        createSafeElement('p', {}, [message]),\r\n        createSafeElement('button', { class: 'retry-button' }, ['Intentar nuevamente'])\r\n    ]);\r\n    const productContainer = document.getElementById('product-container');\r\n    if (productContainer) {\r\n        productContainer.innerHTML = '';\r\n        productContainer.appendChild(errorMessage);\r\n        errorMessage.querySelector('.retry-button').addEventListener('click', initApp);\r\n    } else {\r\n        console.error('Contenedor de productos no encontrado');\r\n    }\r\n};\r\n\r\n// Basic cart helpers (exposed for tests)\r\nlet cart = [];\r\ntry {\r\n    cart = JSON.parse(globalThis.localStorage?.getItem('cart')) || [];\r\n} catch {\r\n    cart = [];\r\n}\r\n\r\nconst getCartItemQuantity = (productId) => {\r\n    const item = cart.find(item => item.id === productId);\r\n    return item ? item.quantity : 0;\r\n};\r\n\r\nconst updateCartIcon = () => {\r\n    const cartCount = document.getElementById('cart-count');\r\n    const totalItems = cart.reduce((total, item) => total + item.quantity, 0);\r\n    if (cartCount) {\r\n        if (cartCount.dataset.initialized !== '1') {\r\n            cartCount.dataset.initialized = '1';\r\n        }\r\n        cartCount.textContent = String(totalItems);\r\n        cartCount.setAttribute('aria-label', `${totalItems} items in cart`);\r\n    }\r\n};\r\n\r\nconst saveCart = () => {\r\n    try {\r\n        globalThis.localStorage?.setItem('cart', JSON.stringify(cart));\r\n    } catch (error) {\r\n        console.error('Error al guardar el carrito:', error);\r\n        showErrorMessage('Error al guardar el carrito. Tus cambios podr\u00EDan no persistir.');\r\n    }\r\n};\r\n\r\nconst logPerformanceMetrics = (perf = (typeof window !== 'undefined' ? window.performance : undefined)) => {\r\n    let fcpValue = 'unavailable';\r\n    let domContentLoadedValue = 'unavailable';\r\n    let loadTimeValue = 'unavailable';\r\n\r\n    try {\r\n        if (!perf || typeof perf.getEntriesByType !== 'function') {\r\n            return;\r\n        }\r\n\r\n        const paintEntries = perf.getEntriesByType('paint') || [];\r\n        const navigationEntries = perf.getEntriesByType('navigation') || [];\r\n\r\n        const fcpEntry = paintEntries.find(entry => entry?.name === 'first-contentful-paint') || paintEntries[0];\r\n        if (fcpEntry && typeof fcpEntry.startTime === 'number') {\r\n            fcpValue = fcpEntry.startTime;\r\n        }\r\n\r\n        const navigationEntry = navigationEntries[0];\r\n        if (navigationEntry && typeof navigationEntry.domContentLoadedEventEnd === 'number') {\r\n            domContentLoadedValue = navigationEntry.domContentLoadedEventEnd;\r\n        } else if (perf.timing && typeof perf.timing.domContentLoadedEventEnd === 'number') {\r\n            domContentLoadedValue = perf.timing.domContentLoadedEventEnd;\r\n        }\r\n\r\n        if (navigationEntry && typeof navigationEntry.loadEventEnd === 'number') {\r\n            loadTimeValue = navigationEntry.loadEventEnd;\r\n        } else if (perf.timing && typeof perf.timing.loadEventEnd === 'number') {\r\n            loadTimeValue = perf.timing.loadEventEnd;\r\n        }\r\n    } catch (error) {\r\n        console.warn('Performance metrics unavailable:', error);\r\n    } finally {\r\n        console.log('First Contentful Paint:', fcpValue);\r\n        console.log('DOM Content Loaded:', domContentLoadedValue);\r\n        console.log('Load Time:', loadTimeValue);\r\n    }\r\n};\r\n\r\nconst toggleActionArea = (btn, quantityControl, showQuantity) => {\r\n    if (!btn || !quantityControl) return;\r\n    const showButton = !showQuantity;\r\n    btn.classList.toggle(UTILITY_CLASSES.hidden, !showButton);\r\n    btn.classList.toggle(UTILITY_CLASSES.flex, showButton);\r\n\r\n    quantityControl.classList.toggle(UTILITY_CLASSES.hidden, !showQuantity);\r\n    quantityControl.classList.toggle(UTILITY_CLASSES.flex, showQuantity);\r\n};\r\n\r\nconst renderCart = () => {\r\n    const cartItems = document.getElementById('cart-items');\r\n    const cartTotal = document.getElementById('cart-total');\r\n    if (!cartItems || !cartTotal) return;\r\n    cartItems.innerHTML = '';\r\n    let total = 0;\r\n    cart.forEach(item => {\r\n        const discounted = item.price - (item.discount || 0);\r\n        const itemEl = createSafeElement('div', { class: 'cart-item', 'data-id': item.id });\r\n        itemEl.appendChild(createSafeElement('span', { class: 'item-quantity' }, [item.quantity.toString()]));\r\n        cartItems.appendChild(itemEl);\r\n        total += discounted * item.quantity;\r\n    });\r\n    cartTotal.textContent = `$${total.toLocaleString('es-CL')}`;\r\n};\r\n\r\nconst addToCart = (product, quantity) => {\r\n    try {\r\n        const existingItem = cart.find(item => item.id === product.id);\r\n        if (existingItem) {\r\n            existingItem.quantity = Math.min(existingItem.quantity + quantity, 50);\r\n        } else {\r\n            cart.push({\r\n                id: product.id,\r\n                name: product.name,\r\n                description: product.description,\r\n                price: product.price,\r\n                discount: product.discount,\r\n                image_path: product.image_path,\r\n                image_avif_path: product.image_avif_path,\r\n                quantity: Math.min(quantity, 50),\r\n                category: product.category,\r\n                stock: product.stock\r\n            });\r\n        }\r\n        saveCart();\r\n        updateCartIcon();\r\n        renderCart();\r\n        try { if (typeof window !== 'undefined' && typeof window.__analyticsTrack === 'function') window.__analyticsTrack('add_to_cart', { id: product.id, q: quantity, price: product.price }); } catch {}\r\n        const quantityInput = document.querySelector(`[data-id=\"${product.id}\"].quantity-input`);\r\n        if (quantityInput) {\r\n            quantityInput.value = Math.max(getCartItemQuantity(product.id), 1);\r\n        }\r\n    } catch (error) {\r\n        console.error('Error al agregar al carrito:', error);\r\n        showErrorMessage('Error al agregar el art\u00EDculo al carrito. Por favor, intenta nuevamente.');\r\n    }\r\n};\r\n\r\nconst removeFromCart = (productId) => {\r\n    try {\r\n        cart = cart.filter(item => item.id !== productId);\r\n        saveCart();\r\n        updateCartIcon();\r\n        renderCart();\r\n        try { if (typeof window !== 'undefined' && typeof window.__analyticsTrack === 'function') window.__analyticsTrack('remove_from_cart', { id: productId }); } catch {}\r\n        const actionArea = document.querySelector(`.action-area[data-pid=\"${productId}\"]`);\r\n        if (actionArea) {\r\n            const btn = actionArea.querySelector('.add-to-cart-btn');\r\n            const qc = actionArea.querySelector('.quantity-control');\r\n            toggleActionArea(btn, qc, false);\r\n        }\r\n    } catch (error) {\r\n        console.error('Error al eliminar del carrito:', error);\r\n        showErrorMessage('Error al eliminar el art\u00EDculo del carrito. Por favor, intenta nuevamente.');\r\n    }\r\n};\r\n\r\nconst updateQuantity = (product, change) => {\r\n    try {\r\n        const item = cart.find(item => item.id === product.id);\r\n        const newQuantity = item ? item.quantity + change : 1;\r\n        const actionArea = document.querySelector(`.action-area[data-pid=\"${product.id}\"]`);\r\n        const btn = actionArea?.querySelector('.add-to-cart-btn');\r\n        const qc = actionArea?.querySelector('.quantity-control');\r\n\r\n        if (newQuantity <= 0) {\r\n            removeFromCart(product.id);\r\n            toggleActionArea(btn, qc, false);\r\n        } else if (newQuantity <= 50) {\r\n            if (item) {\r\n                item.quantity = newQuantity;\r\n            } else {\r\n                addToCart(product, 1);\r\n                toggleActionArea(btn, qc, true);\r\n            }\r\n            saveCart();\r\n            updateCartIcon();\r\n            renderCart();\r\n\r\n            const quantityInput = document.querySelector(`[data-id=\"${product.id}\"].quantity-input`);\r\n            if (quantityInput) {\r\n                quantityInput.value = newQuantity;\r\n                quantityInput.classList.add('quantity-changed');\r\n                setTimeout(() => quantityInput.classList.remove('quantity-changed'), 300);\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.error('Error al actualizar cantidad:', error);\r\n        showErrorMessage('Error al actualizar la cantidad. Por favor, intenta nuevamente.');\r\n    }\r\n};\r\n\r\nconst emptyCart = () => {\r\n    try {\r\n        cart = [];\r\n        saveCart();\r\n        updateCartIcon();\r\n        renderCart();\r\n        if (typeof updateProductDisplay === 'function') {\r\n            updateProductDisplay();\r\n        }\r\n    } catch (error) {\r\n        console.error('Error al vaciar el carrito:', error);\r\n        showErrorMessage('Error al vaciar el carrito. Por favor, int\u00E9ntelo de nuevo.');\r\n    }\r\n};\r\n\r\n// Global error handling: be conservative during initial render\r\nif (typeof window !== 'undefined') {\r\n    window.__APP_READY__ = false;\r\n\r\n    window.addEventListener('error', (event) => {\r\n        const target = event.target || event.srcElement;\r\n        const isResourceError = !!(target && (\r\n            target.tagName === 'IMG' ||\r\n            target.tagName === 'SCRIPT' ||\r\n            target.tagName === 'LINK'\r\n        ));\r\n        const hasRuntimeError = !!event.error;\r\n\r\n        // Ignore resource errors and non-runtime errors\r\n        if (isResourceError || !hasRuntimeError) {\r\n            console.warn('Ignored non-fatal error:', {\r\n                tag: target && target.tagName,\r\n                src: target && (target.src || target.href || target.currentSrc)\r\n            });\r\n            return;\r\n        }\r\n\r\n        // Only show banner after the app is ready; otherwise just log\r\n        if (!window.__APP_READY__) {\r\n            console.error('Runtime error before app ready:', event.error);\r\n            return;\r\n        }\r\n        console.error('Unhandled JS error:', event.error);\r\n        showErrorMessage('Ocurri\u00F3 un error inesperado. Por favor, recarga la p\u00E1gina.');\r\n    });\r\n\r\n    // Avoid noisy CSP warnings breaking UX\r\n    window.addEventListener('securitypolicyviolation', (e) => {\r\n        console.warn('CSP violation (logged only):', {\r\n            blockedURI: e.blockedURI,\r\n            violatedDirective: e.violatedDirective,\r\n            sourceFile: e.sourceFile,\r\n        });\r\n    });\r\n}\r\n\r\n// Main function to initialize the application\r\nconst initApp = async () => {\r\n    console.log('Initializing app...');\r\n\r\n    const productContainer = document.getElementById('product-container');\r\n    const sortOptions = document.getElementById('sort-options');\r\n    const filterKeyword = document.getElementById('filter-keyword');\r\n    const cartCountElement = document.getElementById('cart-count');\r\n    const cartItemsElement = document.getElementById('cart-items');\r\n    const cartTotalElement = document.getElementById('cart-total');\r\n\r\n    const essentialElements = {\r\n        '#product-container': productContainer,\r\n        '#sort-options': sortOptions,\r\n        '#filter-keyword': filterKeyword,\r\n        '#cart-count': cartCountElement,\r\n        '#cart-items': cartItemsElement,\r\n        '#cart-total': cartTotalElement\r\n    };\r\n\r\n    const missingSelectors = Object.entries(essentialElements)\r\n        .filter(([, element]) => !element)\r\n        .map(([selector]) => selector);\r\n\r\n    if (missingSelectors.length) {\r\n        log('warn', 'init_app_missing_dom', {\r\n            missingSelectors,\r\n            location: typeof window !== 'undefined' ? window.location?.pathname : 'unknown'\r\n        });\r\n        return;\r\n    }\r\n\r\n    // Ensure discount-only toggle exists in the filter UI\r\n    const ensureDiscountToggle = () => {\r\n        let toggle = document.getElementById('filter-discount');\r\n        if (toggle) return toggle;\r\n\r\n        const filterSection = document.querySelector('section[aria-label*=\"filtrado\"], section[aria-label*=\"Opciones de filtrado\"]');\r\n        const filterSectionRow = filterSection ? filterSection.querySelector('.row') : null;\r\n        if (!filterSectionRow) return null;\r\n\r\n        const col = createSafeElement('div', { class: 'col-12 mt-2' });\r\n        const formCheck = createSafeElement('div', { class: 'form-check form-switch' });\r\n        const input = createSafeElement('input', {\r\n            class: 'form-check-input',\r\n            type: 'checkbox',\r\n            id: 'filter-discount',\r\n            'aria-label': 'Mostrar solo productos con descuento'\r\n        });\r\n        const label = createSafeElement('label', { class: 'form-check-label', for: 'filter-discount' }, ['Solo productos con descuento']);\r\n        formCheck.appendChild(input);\r\n        formCheck.appendChild(label);\r\n        col.appendChild(formCheck);\r\n        filterSectionRow.appendChild(col);\r\n        return input;\r\n    };\r\n\r\n    const INITIAL_BATCH_FALLBACK = 12;\r\n    const SUBSEQUENT_BATCH_SIZE = 12;\r\n\r\n    let products = [];\r\n    let filteredProducts = [];\r\n    let visibleCount = 0;\r\n    let initialBatchSize = INITIAL_BATCH_FALLBACK;\r\n    let loadMoreButton = null;\r\n    let catalogSentinel = null;\r\n    let sentinelObserver = null;\r\n    let userHasInteracted = false;\r\n    let cart = JSON.parse(localStorage.getItem('cart')) || [];\r\n\r\n    const updateOnlineStatus = () => {\r\n        const offlineIndicator = document.getElementById('offline-indicator');\r\n        if (offlineIndicator) {\r\n            const hidden = navigator.onLine;\r\n            offlineIndicator.classList.toggle(UTILITY_CLASSES.hidden, hidden);\r\n            offlineIndicator.classList.toggle(UTILITY_CLASSES.block, !hidden);\r\n        }\r\n        if (!navigator.onLine) {\r\n            console.log('App is offline. Using cached data if available.');\r\n        }\r\n    };\r\n\r\n    function initFooter() {\r\n        const yearSpan = document.getElementById('current-year');\r\n        if (yearSpan) {\r\n            yearSpan.textContent = new Date().getFullYear();\r\n        }\r\n    }\r\n\r\n    const DEFAULT_CURRENCY_CODE = 'CLP';\r\n    let hasLoggedCurrencyFallback = false;\r\n\r\n    const normalizeCurrencyCode = (currencyCode) => {\r\n        if (typeof currencyCode !== 'string') {\r\n            return DEFAULT_CURRENCY_CODE;\r\n        }\r\n        const trimmed = currencyCode.trim().toUpperCase();\r\n        if (/^[A-Z]{3}$/.test(trimmed)) {\r\n            return trimmed;\r\n        }\r\n        return DEFAULT_CURRENCY_CODE;\r\n    };\r\n\r\n    const createCurrencyFormatter = (currencyCode) => {\r\n        const fallbackCode = normalizeCurrencyCode(currencyCode);\r\n        try {\r\n            return new Intl.NumberFormat('es-CL', {\r\n                style: 'currency',\r\n                currency: fallbackCode,\r\n                minimumFractionDigits: 0\r\n            });\r\n        } catch (error) {\n            if (!hasLoggedCurrencyFallback) {\n                const message = (error && typeof error.message === 'string')\n                    ? error.message\n                    : 'Unknown currency formatter failure';\n                console.warn('Falling back to CLP currency formatter', {\n                    currencyCode,\n                    message\n                });\n                hasLoggedCurrencyFallback = true;\n            }\n            return new Intl.NumberFormat('es-CL', {\n                style: 'currency',\n                currency: DEFAULT_CURRENCY_CODE,\n                minimumFractionDigits: 0\n            });\n        }\r\n    };\r\n\r\n    const renderPriceHtml = (price, discount, currencyCode = DEFAULT_CURRENCY_CODE) => {\r\n        const numericPrice = Number(price) || 0;\r\n        const numericDiscount = Number(discount) || 0;\r\n        const formatter = createCurrencyFormatter(currencyCode);\r\n\r\n        const formattedPrice = formatter.format(numericPrice);\r\n\r\n        if (numericDiscount) {\r\n            const discountedPrice = Math.max(numericPrice - numericDiscount, 0);\r\n            const formattedDiscountedPrice = formatter.format(discountedPrice);\r\n\r\n            return createSafeElement('div', { class: 'precio-container' }, [\r\n                createSafeElement(\r\n                    'span',\r\n                    { class: 'precio-descuento', 'aria-label': 'Precio con descuento' },\r\n                    [formattedDiscountedPrice]\r\n                ),\r\n                createSafeElement(\r\n                    'span',\r\n                    { class: 'precio-original', 'aria-label': 'Precio original' },\r\n                    [\r\n                        createSafeElement(\r\n                            'span',\r\n                            { class: 'tachado' },\r\n                            [formattedPrice]\r\n                        )\r\n                    ]\r\n                )\r\n            ]);\r\n        }\r\n\r\n        return createSafeElement('div', { class: 'precio-container' }, [\r\n            createSafeElement(\r\n                'span',\r\n                { class: 'precio', 'aria-label': 'Precio' },\r\n                [formattedPrice]\r\n            )\r\n        ]);\r\n    };\r\n\r\n\r\nconst renderQuantityControl = (product) => {\r\n        const quantityControl = createSafeElement('div', {\r\n            class: `quantity-control ${UTILITY_CLASSES.hidden}`,\r\n            role: 'group',\r\n            'aria-label': 'Seleccionar cantidad',\r\n            'aria-live': 'polite'\r\n        });\r\n        const minusBtn = createSafeElement('button', {\r\n            class: 'quantity-btn',\r\n            type: 'button',\r\n            'data-action': 'decrease',\r\n            'aria-label': 'Decrease quantity'\r\n        }, ['-']);\r\n        const plusBtn = createSafeElement('button', {\r\n            class: 'quantity-btn',\r\n            type: 'button',\r\n            'data-action': 'increase',\r\n            'aria-label': 'Increase quantity'\r\n        }, ['+']);\r\n        const input = createSafeElement('input', {\r\n            type: 'number',\r\n            class: 'quantity-input',\r\n            value: Math.max(getCartItemQuantity(product.id), 1),\r\n            min: '1',\r\n            max: '50',\r\n            'aria-label': 'Quantity',\r\n            'data-id': product.id\r\n        });\r\n\r\n        quantityControl.appendChild(minusBtn);\r\n        quantityControl.appendChild(input);\r\n        quantityControl.appendChild(plusBtn);\r\n\r\n        return quantityControl;\r\n    };\r\n\r\n    function setupActionArea(actionArea, product) {\r\n        if (!actionArea) {\r\n            return;\r\n        }\r\n        const addToCartBtn = actionArea.querySelector('.add-to-cart-btn');\r\n        const quantityControl = actionArea.querySelector('.quantity-control');\r\n        const quantityInput = quantityControl?.querySelector('.quantity-input');\r\n        const minusBtn = quantityControl?.querySelector('.quantity-btn[data-action=\"decrease\"]') || quantityControl?.querySelector('.quantity-btn');\r\n        const plusBtn = quantityControl?.querySelector('.quantity-btn[data-action=\"increase\"]') || quantityControl?.querySelectorAll('.quantity-btn')?.[1];\r\n\r\n        const bind = (element, event, handler) => {\r\n            if (!element) {\r\n                return;\r\n            }\r\n            if (element.dataset.listenerAttached === 'true') {\r\n                return;\r\n            }\r\n            element.addEventListener(event, handler);\r\n            element.dataset.listenerAttached = 'true';\r\n        };\r\n\r\n        bind(addToCartBtn, 'click', () => {\r\n            addToCart(product, 1);\r\n            toggleActionArea(addToCartBtn, quantityControl, true);\r\n        });\r\n\r\n        bind(minusBtn, 'click', () => updateQuantity(product, -1));\r\n        bind(plusBtn, 'click', () => updateQuantity(product, 1));\r\n        bind(quantityInput, 'change', (event) => {\r\n            const newQuantity = parseInt(event.target.value, 10);\r\n            if (!Number.isFinite(newQuantity)) {\r\n                event.target.value = Math.max(getCartItemQuantity(product.id), 1);\r\n                return;\r\n            }\r\n            const currentQuantity = getCartItemQuantity(product.id);\r\n            updateQuantity(product, newQuantity - currentQuantity);\r\n        });\r\n\r\n        const currentQuantity = getCartItemQuantity(product.id);\r\n        if (quantityInput) {\r\n            quantityInput.value = currentQuantity > 0 ? currentQuantity : 1;\r\n        }\r\n        toggleActionArea(addToCartBtn, quantityControl, currentQuantity > 0);\r\n    }\r\n\r\n    const getCartItemQuantity = (productId) => {\r\n        const item = cart.find(item => item.id === productId);\r\n        return item ? item.quantity : 0;\r\n    };\r\n\r\n    const renderProducts = (productsToRender, { reset = false } = {}) => {\r\n        if (!productContainer) {\r\n            return 0;\r\n        }\r\n        if (reset) {\r\n            productContainer.innerHTML = '';\r\n        }\r\n\r\n        const fragment = document.createDocumentFragment();\r\n\r\n        productsToRender.forEach(product => {\r\n            const { id, name, description, image_path, image_avif_path, price, discount, stock } = product;\r\n\r\n            const productClasses = [\r\n                'producto',\r\n                'col-12',\r\n                'col-sm-6',\r\n                'col-md-4',\r\n                'col-lg-3',\r\n                'mb-4',\r\n                !stock ? 'agotado' : '',\r\n                UTILITY_CLASSES.contentVisible,\r\n                UTILITY_CLASSES.containIntrinsic\r\n            ].filter(Boolean).join(' ');\r\n\r\n            const titleId = `product-title-${id}`;\r\n            const productElement = createSafeElement('article', {\r\n                class: productClasses,\r\n                'data-product-id': id,\r\n                'aria-labelledby': titleId\r\n            });\r\n\r\n            const cardElement = createSafeElement('div', { class: 'card h-100' });\r\n\r\n            if (discount && Number(discount) > 0) {\r\n                const pct = Math.round((Number(discount) / Number(price)) * 100);\r\n                const badge = createSafeElement('span', { class: 'discount-badge badge bg-danger', 'aria-label': 'Producto en oferta' }, [`-${isFinite(pct) ? pct : 0}%`]);\r\n                cardElement.appendChild(badge);\r\n            }\r\n\r\n            const pictureElement = createProductPicture({\r\n                imagePath: image_path,\r\n                avifPath: image_avif_path,\r\n                alt: name,\r\n                eager: false\r\n            });\r\n            cardElement.appendChild(pictureElement);\r\n\r\n            const cardBody = createSafeElement('div', { class: 'card-body d-flex flex-column' });\r\n            cardBody.appendChild(createSafeElement('h3', { class: 'card-title mb-2', id: titleId }, [name]));\r\n            cardBody.appendChild(createSafeElement('p', { class: 'card-text mb-3' }, [description]));\r\n            const priceContainer = renderPriceHtml(price, discount);\r\n            priceContainer.classList.add('mb-3');\r\n            cardBody.appendChild(priceContainer);\r\n\r\n            const actionArea = createSafeElement('div', {\r\n                class: 'action-area mt-auto',\r\n                'data-pid': id,\r\n                role: 'group',\r\n                'aria-label': `Acciones de compra para ${name}`\r\n            });\r\n            const addToCartBtn = createSafeElement('button', {\r\n                class: 'btn btn-primary add-to-cart-btn mt-2',\r\n                type: 'button',\r\n                'data-id': id,\r\n                'aria-label': `Add ${name} to cart`\r\n            }, ['Agregar al carrito']);\r\n            const quantityControl = renderQuantityControl(product);\r\n\r\n            actionArea.appendChild(addToCartBtn);\r\n            actionArea.appendChild(quantityControl);\r\n            cardBody.appendChild(actionArea);\r\n\r\n            setupActionArea(actionArea, product);\r\n\r\n            cardElement.appendChild(cardBody);\r\n            productElement.appendChild(cardElement);\r\n            fragment.appendChild(productElement);\r\n        });\r\n\r\n        productContainer.appendChild(fragment);\r\n        lazyLoadImages();\r\n        return productsToRender.length;\r\n    };\r\n\r\n    const hydratePreRenderedProducts = (productList) => {\r\n        if (!productContainer) {\r\n            return 0;\r\n        }\r\n        const cards = productContainer.querySelectorAll('[data-product-id]');\r\n        if (!cards.length) {\r\n            return 0;\r\n        }\r\n        const map = new Map(productList.map(item => [item.id, item]));\r\n        let hydrated = 0;\r\n        cards.forEach(card => {\r\n            const productId = card.getAttribute('data-product-id');\r\n            if (!productId || !map.has(productId)) {\r\n                return;\r\n            }\r\n            const product = map.get(productId);\r\n            card.classList.add(UTILITY_CLASSES.contentVisible, UTILITY_CLASSES.containIntrinsic);\r\n            const actionArea = card.querySelector('.action-area');\r\n            setupActionArea(actionArea, product);\r\n            hydrated += 1;\r\n        });\r\n        return hydrated;\r\n    };\r\n\r\n    const resetProductList = () => {\r\n        if (productContainer) {\r\n            productContainer.innerHTML = '';\r\n        }\r\n        visibleCount = 0;\r\n    };\r\n\r\n    const applyFilters = () => {\r\n        const criterion = sortOptions?.value || 'original';\r\n        const keyword = filterKeyword?.value?.trim?.() || '';\r\n        const discountOnly = document.getElementById('filter-discount')?.checked || false;\r\n        filteredProducts = memoizedFilterProducts(products, keyword, criterion, discountOnly);\r\n    };\r\n\r\n    const appendBatch = (size) => {\r\n        if (!Array.isArray(filteredProducts) || filteredProducts.length === 0) {\r\n            updateLoadMoreVisibility();\r\n            return false;\r\n        }\r\n        const start = visibleCount;\r\n        if (start >= filteredProducts.length) {\r\n            updateLoadMoreVisibility();\r\n            return false;\r\n        }\r\n        const nextProducts = filteredProducts.slice(start, start + size);\r\n        if (!nextProducts.length) {\r\n            updateLoadMoreVisibility();\r\n            return false;\r\n        }\r\n        renderProducts(nextProducts);\r\n        visibleCount += nextProducts.length;\r\n        updateLoadMoreVisibility();\r\n        return true;\r\n    };\r\n\r\n    const appendInitialBatch = () => {\r\n        const batchSize = initialBatchSize || INITIAL_BATCH_FALLBACK;\r\n        return appendBatch(batchSize);\r\n    };\r\n\r\n    const appendNextBatch = () => appendBatch(SUBSEQUENT_BATCH_SIZE);\r\n\r\n    const updateLoadMoreVisibility = () => {\r\n        const hasMore = visibleCount < filteredProducts.length;\r\n        if (loadMoreButton) {\r\n            loadMoreButton.classList.toggle('d-none', !hasMore);\r\n            loadMoreButton.disabled = !hasMore;\r\n        }\r\n        if (sentinelObserver && catalogSentinel) {\r\n            sentinelObserver.disconnect();\r\n            if (hasMore) {\r\n                sentinelObserver.observe(catalogSentinel);\r\n            }\r\n        }\r\n    };\r\n\r\n    const setupDeferredLoading = () => {\r\n        loadMoreButton = document.getElementById('catalog-load-more');\r\n        catalogSentinel = document.getElementById('catalog-sentinel');\r\n        if (loadMoreButton) {\r\n            loadMoreButton.addEventListener('click', () => {\r\n                appendNextBatch();\r\n            });\r\n        }\r\n        // Guard: some test/browser environments may lack IntersectionObserver\r\n        if (catalogSentinel && typeof window !== 'undefined' && 'IntersectionObserver' in window) {\r\n            sentinelObserver = new IntersectionObserver(entries => {\r\n                entries.forEach(entry => {\r\n                    if (entry.isIntersecting) {\r\n                        appendNextBatch();\r\n                    }\r\n                });\r\n            }, { rootMargin: '200px' });\r\n        }\r\n        updateLoadMoreVisibility();\r\n    };\r\n\r\n    const lazyLoadImages = () => {\r\n        if (typeof window !== 'undefined' && 'IntersectionObserver' in window) {\r\n            const imageObserver = new IntersectionObserver((entries, observer) => {\r\n                entries.forEach(entry => {\r\n                    if (entry.isIntersecting) {\r\n                        const img = entry.target;\r\n                        img.src = img.dataset.src;\r\n                        if (img.dataset.srcset) img.srcset = img.dataset.srcset;\r\n                        if (img.dataset.sizes) img.sizes = img.dataset.sizes;\r\n                        img.classList.remove('lazyload');\r\n                        observer.unobserve(img);\r\n                    }\r\n                });\r\n            }, { rootMargin: '100px' });\r\n\r\n            document.querySelectorAll('img.lazyload').forEach(img => imageObserver.observe(img));\r\n        } else {\r\n            // Fallback: eagerly set sources without observing (avoids runtime errors)\r\n            document.querySelectorAll('img.lazyload').forEach(img => {\r\n                if (img.dataset.src) img.src = img.dataset.src;\r\n                if (img.dataset.srcset) img.srcset = img.dataset.srcset;\r\n                if (img.dataset.sizes) img.sizes = img.dataset.sizes;\r\n                img.classList.remove('lazyload');\r\n            });\r\n        }\r\n    };\r\n\r\n    // MUCH MORE CONSERVATIVE fuzzy matching - only for obvious typos\r\n    function simpleTypoFix(query, text) {\r\n    if (!query || !text || query.length < 3) return false;\r\n    \r\n    const normalizeText = (str) => str.toLowerCase()\r\n        .normalize('NFD')\r\n        .replace(/[\\u0300-\\u036f]/g, '') // Remove accents only\r\n        .trim();\r\n    \r\n    const normalizedQuery = normalizeText(query);\r\n    const normalizedText = normalizeText(text);\r\n    \r\n    // First try exact match (same as original)\r\n    if (normalizedText.includes(normalizedQuery)) {\r\n        return true;\r\n    }\r\n    \r\n    // ONLY try typo correction if query is 4+ characters\r\n    // and the difference is just 1-2 characters\r\n    if (normalizedQuery.length >= 4) {\r\n        // Check if it's a simple 1-character typo\r\n        // Like \"choclate\" vs \"chocolate\" or \"galetas\" vs \"galletas\"\r\n        return isSimpleTypo(normalizedQuery, normalizedText);\r\n    }\r\n    \r\n    return false;\r\n    }\r\n\r\n    // Very strict typo detection - only catches obvious single-character mistakes\r\n    function isSimpleTypo(query, text) {\r\n    const words = text.split(/\\s+/);\r\n    \r\n    return words.some(word => {\r\n        if (Math.abs(word.length - query.length) > 1) return false;\r\n        \r\n        // Count character differences\r\n        let differences = 0;\r\n        const maxLen = Math.max(word.length, query.length);\r\n        const minLen = Math.min(word.length, query.length);\r\n        \r\n        // Too short to safely compare\r\n        if (minLen < 4) return false;\r\n        \r\n        // Check for single character insertion/deletion\r\n        if (word.length === query.length) {\r\n        // Same length - check for substitution\r\n        for (let i = 0; i < word.length; i++) {\r\n            if (word[i] !== query[i]) differences++;\r\n            if (differences > 1) return false; // More than 1 difference\r\n        }\r\n        return differences === 1;\r\n        } else {\r\n        // Different length - check for insertion/deletion\r\n        return isOneCharacterDifference(query, word);\r\n        }\r\n    });\r\n    }\r\n\r\n    // Check if two words differ by exactly one character (insertion/deletion)\r\n    function isOneCharacterDifference(str1, str2) {\r\n    const longer = str1.length > str2.length ? str1 : str2;\r\n    const shorter = str1.length > str2.length ? str2 : str1;\r\n    \r\n    if (longer.length - shorter.length !== 1) return false;\r\n    \r\n    let shifts = 0;\r\n    let i = 0, j = 0;\r\n    \r\n    while (i < shorter.length && j < longer.length) {\r\n        if (shorter[i] === longer[j]) {\r\n        i++;\r\n        j++;\r\n        } else {\r\n        shifts++;\r\n        if (shifts > 1) return false; // More than one shift needed\r\n        j++; // Skip the extra character in longer string\r\n        }\r\n    }\r\n    \r\n    return true;\r\n    }\r\n\r\n    // REPLACE your filterProducts function with this CONSERVATIVE version:\r\n    const filterProducts = (products, keyword, sortCriterion, discountOnly = false) => {\r\n    const trimmedKeyword = keyword.trim();\r\n    \r\n    return products\r\n        .filter(product => {\r\n        if (!product.stock) return false;\r\n        if (discountOnly && !(product.discount && Number(product.discount) > 0)) return false;\r\n        \r\n        // If no keyword, show all (same as original behavior)\r\n        if (!trimmedKeyword) return true;\r\n        \r\n        // Try EXACT matching first (exactly like original)\r\n        const exactMatch = product.name.toLowerCase().includes(trimmedKeyword.toLowerCase()) ||\r\n                            product.description.toLowerCase().includes(trimmedKeyword.toLowerCase());\r\n        \r\n        if (exactMatch) return true;\r\n        \r\n        // ONLY try typo fix for longer queries and only for name field\r\n        if (trimmedKeyword.length >= 4) {\r\n            return simpleTypoFix(trimmedKeyword, product.name);\r\n        }\r\n        \r\n        return false;\r\n        })\r\n        .sort((a, b) => sortProducts(a, b, sortCriterion));\r\n    };\r\n\r\n    const sortProducts = (a, b, criterion) => {\r\n        if (!criterion || criterion === 'original') {\r\n            return a.originalIndex - b.originalIndex;\r\n        }\r\n        const [property, order] = criterion.split('-');\r\n        const valueA = property === 'price' ? a.price - (a.discount || 0) : a.name.toLowerCase();\r\n        const valueB = property === 'price' ? b.price - (b.discount || 0) : b.name.toLowerCase();\r\n        return order === 'asc' ?\r\n            (valueA < valueB ? -1 : valueA > valueB ? 1 : 0) :\r\n            (valueB < valueA ? -1 : valueB > valueA ? 1 : 0);\r\n    };\r\n\r\n    const memoizedFilterProducts = memoize(filterProducts);\r\n\r\n    const updateProductDisplay = () => {\r\n        try {\r\n            applyFilters();\r\n            resetProductList();\r\n            if (!filteredProducts.length) {\r\n                updateLoadMoreVisibility();\r\n                return;\r\n            }\r\n            appendInitialBatch();\r\n        } catch (error) {\r\n            console.error('Error al actualizar visualizaci\u00F3n de productos:', error);\r\n            showErrorMessage('Error al actualizar la visualizaci\u00F3n de productos. Por favor, intenta m\u00E1s tarde.');\r\n        }\r\n    };\r\n\r\n    let pendingIdleUpdate = null;\r\n    const debouncedUpdateProductDisplay = debounce(() => {\r\n        cancelScheduledIdle(pendingIdleUpdate);\r\n        pendingIdleUpdate = scheduleIdle(() => {\r\n            updateProductDisplay();\r\n            pendingIdleUpdate = null;\r\n        }, 400);\r\n    }, 150);\r\n\r\n    const updateCartIcon = () => {\r\n        const cartCount = document.getElementById('cart-count');\r\n        const totalItems = cart.reduce((total, item) => total + item.quantity, 0);\r\n        cartCount.textContent = totalItems;\r\n        cartCount.setAttribute('aria-label', `${totalItems} items in cart`);\r\n    };\r\n\r\n    const addToCart = (product, quantity) => {\r\n        try {\r\n            const existingItem = cart.find(item => item.id === product.id);\r\n            if (existingItem) {\r\n                existingItem.quantity = Math.min(existingItem.quantity + quantity, 50);\r\n            } else {\r\n                // Store complete product information\r\n                cart.push({\r\n                    id: product.id,\r\n                    name: product.name,\r\n                    description: product.description,\r\n                    price: product.price,\r\n                    discount: product.discount,\r\n                    image_path: product.image_path,\r\n                    image_avif_path: product.image_avif_path,\r\n                    quantity: Math.min(quantity, 50),\r\n                    category: product.category,\r\n                    stock: product.stock\r\n                });\r\n            }\r\n            saveCart();\r\n            updateCartIcon();\r\n            renderCart();\r\n\r\n            const quantityInput = document.querySelector(`[data-id=\"${product.id}\"].quantity-input`);\r\n            if (quantityInput) {\r\n                quantityInput.value = Math.max(getCartItemQuantity(product.id), 1);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error al agregar al carrito:', error);\r\n            showErrorMessage('Error al agregar el art\u00EDculo al carrito. Por favor, intenta nuevamente.');\r\n        }\r\n    };\r\n\r\n    const removeFromCart = (productId) => {\r\n        try {\r\n            cart = cart.filter(item => item.id !== productId);\r\n            saveCart();\r\n            updateCartIcon();\r\n            renderCart();\r\n            // Toggle card back to add state without re-rendering\r\n            const actionArea = document.querySelector(`.action-area[data-pid=\"${productId}\"]`);\r\n            if (actionArea) {\r\n                const btn = actionArea.querySelector('.add-to-cart-btn');\r\n                const qc = actionArea.querySelector('.quantity-control');\r\n                toggleActionArea(btn, qc, false);\r\n            }\r\n        }\r\n        catch (error) {\r\n            console.error('Error al eliminar del carrito:', error);\r\n            showErrorMessage('Error al eliminar el art\u00EDculo del carrito. Por favor, intenta nuevamente.');\r\n        }\r\n    };\r\n\r\n    const updateQuantity = (product, change) => {\r\n        try {\r\n            const item = cart.find(item => item.id === product.id);\r\n            const newQuantity = item ? item.quantity + change : 1;\r\n\r\n            const actionArea = document.querySelector(`.action-area[data-pid=\"${product.id}\"]`);\r\n            const btn = actionArea?.querySelector('.add-to-cart-btn');\r\n            const qc = actionArea?.querySelector('.quantity-control');\r\n\r\n            if (newQuantity <= 0) {\r\n                removeFromCart(product.id);\r\n                toggleActionArea(btn, qc, false);\r\n            } else if (newQuantity <= 50) {\r\n                if (item) {\r\n                    item.quantity = newQuantity;\r\n                } else {\r\n                    addToCart(product, 1);\r\n                    toggleActionArea(btn, qc, true);\r\n                }\r\n                saveCart();\r\n                updateCartIcon();\r\n                renderCart();\r\n\r\n                const quantityInput = document.querySelector(`[data-id=\"${product.id}\"].quantity-input`);\r\n                if (quantityInput) {\r\n                    quantityInput.value = newQuantity;\r\n                    quantityInput.classList.add('quantity-changed');\r\n                    setTimeout(() => quantityInput.classList.remove('quantity-changed'), 300);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error al actualizar cantidad:', error);\r\n            showErrorMessage('Error al actualizar la cantidad. Por favor, intenta nuevamente.');\r\n        }\r\n    };\r\n\r\n    const emptyCart = () => {\r\n        try {\r\n            cart = [];\r\n            saveCart();\r\n            updateCartIcon();\r\n            renderCart();\r\n            updateProductDisplay();\r\n        } catch (error) {\r\n            console.error('Error al vaciar el carrito:', error);\r\n            showErrorMessage('Error al vaciar el carrito. Por favor, int\u00E9ntelo de nuevo.');\r\n        }\r\n    };\r\n\r\n    // Toggle action area in a specific card without re-rendering the grid\r\n    const toggleActionArea = (btn, quantityControl, showQuantity) => {\r\n        if (!btn || !quantityControl) return;\r\n        const showButton = !showQuantity;\r\n        btn.classList.toggle(UTILITY_CLASSES.hidden, !showButton);\r\n        btn.classList.toggle(UTILITY_CLASSES.flex, showButton);\r\n\r\n        quantityControl.classList.toggle(UTILITY_CLASSES.hidden, !showQuantity);\r\n        quantityControl.classList.toggle(UTILITY_CLASSES.flex, showQuantity);\r\n    };\r\n\r\n    const saveCart = () => {\r\n        try {\r\n            localStorage.setItem('cart', JSON.stringify(cart));\r\n        } catch (error) {\r\n            console.error('Error al guardar el carrito:', error);\r\n            showErrorMessage('Error al guardar el carrito. Tus cambios podr\u00EDan no persistir.');\r\n        }\r\n    };\r\n\r\n    // Find the renderCart function (around line 485) and modify it like this:\r\n\r\n    const renderCart = () => {\r\n        const cartItems = document.getElementById('cart-items');\r\n        const cartTotal = document.getElementById('cart-total');\r\n        cartItems.innerHTML = '';\r\n\r\n        let total = 0;\r\n\r\n        cart.forEach(item => {\r\n            const discountedPrice = item.price - (item.discount || 0);\r\n\r\n            // Contenedor principal: usar flex de Bootstrap (con fallback CSS para thumbnail)\r\n            const itemElement = createSafeElement('div', {\r\n                class: 'cart-item mb-3 d-flex align-items-start',\r\n                'aria-label': `Cart item: ${item.name}`\r\n            });\r\n\r\n            // Contenedor de datos del producto (nombre, controles, precio, subtotal, bot\u00F3n)\r\n            const contentContainer = createSafeElement('div', {\r\n                class: 'cart-item-content flex-grow-1'\r\n            });\r\n\r\n            // Nombre\r\n            contentContainer.appendChild(\r\n                createSafeElement('div', { class: 'fw-bold mb-1' }, [item.name])\r\n            );\r\n\r\n            // Controles de cantidad\r\n            const quantityContainer = createSafeElement('div', { class: 'mb-2' });\r\n            const decreaseBtn = createSafeElement('button', {\r\n                class: 'btn btn-sm btn-secondary decrease-quantity',\r\n                'data-id': item.id,\r\n                'aria-label': `Disminuir cantidad de ${item.name}`\r\n            }, ['-']);\r\n            const increaseBtn = createSafeElement('button', {\r\n                class: 'btn btn-sm btn-secondary increase-quantity',\r\n                'data-id': item.id,\r\n                'aria-label': `Aumentar cantidad de ${item.name}`\r\n            }, ['+']);\r\n            const quantitySpan = createSafeElement('span', {\r\n                class: 'mx-2 item-quantity',\r\n                'aria-label': `Cantidad de ${item.name}`\r\n            }, [item.quantity.toString()]);\r\n            quantityContainer.appendChild(decreaseBtn);\r\n            quantityContainer.appendChild(quantitySpan);\r\n            quantityContainer.appendChild(increaseBtn);\r\n            contentContainer.appendChild(quantityContainer);\r\n\r\n            // Precio y subtotal\r\n            contentContainer.appendChild(\r\n                createSafeElement('div', { class: 'text-muted small' },\r\n                    [`Precio: $${discountedPrice.toLocaleString('es-CL')}`]\r\n                )\r\n            );\r\n            contentContainer.appendChild(\r\n                createSafeElement('div', { class: 'fw-bold' },\r\n                    [`Subtotal: $${(discountedPrice * item.quantity).toLocaleString('es-CL')}`]\r\n                )\r\n            );\r\n\r\n            // Bot\u00F3n \"Eliminar\"\r\n            const removeBtn = createSafeElement('button', {\r\n                class: 'btn btn-sm btn-danger remove-item mt-2',\r\n                'data-id': item.id,\r\n                'aria-label': `Eliminar ${item.name} del carrito`\r\n            }, ['Eliminar']);\r\n            contentContainer.appendChild(removeBtn);\r\n\r\n            // Determinar ruta de la imagen (igual que en renderProducts)\r\n            const isSubcategoryPage = window.location.pathname.includes('/pages/');\r\n            let adjustedImagePath;\r\n            if (isSubcategoryPage) {\r\n                adjustedImagePath = `../${item.image_path.replace(/^\\//, '')}`;\r\n            } else {\r\n                adjustedImagePath = item.image_path;\r\n            }\r\n\r\n            // Miniatura a la derecha (CSP-safe), contenido a la izquierda\r\n            const thumbnailContainer = createSafeElement('div', {\r\n                class: 'cart-item-thumb ms-3 flex-shrink-0'\r\n            });\r\n            const thumbSrc = item.thumbnail_path || adjustedImagePath;\r\n            const thumbnailPicture = createCartThumbnail({\r\n                imagePath: item.thumbnail_path || item.image_path,\r\n                avifPath: item.image_avif_path,\r\n                alt: item.name\r\n            });\r\n            const fallbackImg = thumbnailPicture.querySelector('img');\r\n            if (fallbackImg) {\r\n                if (!fallbackImg.getAttribute('src') && thumbSrc) {\r\n                    fallbackImg.setAttribute('src', thumbSrc);\r\n                }\r\n                if (Array.isArray(item.thumbnail_variants)) {\r\n                    const parts = item.thumbnail_variants\r\n                        .filter(v => v && v.url && v.width)\r\n                        .map(v => `${v.url} ${v.width}w`);\r\n                    if (parts.length) {\r\n                        fallbackImg.setAttribute('srcset', parts.join(', '));\r\n                        fallbackImg.setAttribute('sizes', '100px');\r\n                    }\r\n                } else if (!fallbackImg.getAttribute('sizes')) {\r\n                    fallbackImg.setAttribute('sizes', '100px');\r\n                }\r\n            }\r\n            thumbnailContainer.appendChild(thumbnailPicture);\r\n\r\n            // A\u00F1adir primero el contenido (izquierda) y luego la miniatura (derecha)\r\n            itemElement.appendChild(contentContainer);\r\n            itemElement.appendChild(thumbnailContainer);\r\n\r\n            // Insertar en el DOM\r\n            cartItems.appendChild(itemElement);\r\n\r\n            // Debug (opt-in): inspect computed styles and rectangles\r\n            if (window.__DEBUG_CART__) {\r\n                try {\r\n                    const cs = window.getComputedStyle(itemElement);\r\n                    const csThumb = window.getComputedStyle(thumbnailContainer);\r\n                    const csContent = window.getComputedStyle(contentContainer);\r\n                    const rectThumb = thumbnailContainer.getBoundingClientRect();\r\n                    const rectContent = contentContainer.getBoundingClientRect();\r\n                    console.debug('[cart] item', {\r\n                        name: item.name,\r\n                        order: {\r\n                            firstIsContent: itemElement.firstChild === contentContainer,\r\n                            lastIsThumb: itemElement.lastChild === thumbnailContainer,\r\n                        },\r\n                        container: { display: cs.display, flexDirection: cs.flexDirection, flexWrap: cs.flexWrap },\r\n                        thumb: { width: csThumb.width, height: csThumb.height, rect: { w: rectThumb.width, h: rectThumb.height } },\r\n                        content: { rect: { w: rectContent.width, h: rectContent.height } },\r\n                    });\r\n                } catch (e) { /* ignore */ }\r\n            }\r\n\r\n            // Calcular total\r\n            total += discountedPrice * item.quantity;\r\n        });\r\n\r\n        // Mostrar total\r\n        cartTotal.textContent = `Total: $${total.toLocaleString('es-CL')}`;\r\n        cartTotal.setAttribute('aria-label', `Total: $${total.toLocaleString('es-CL')}`);\r\n\r\n        // Mostrar u ocultar la opci\u00F3n de pago con tarjeta de cr\u00E9dito seg\u00FAn el total\r\n        const creditOption = document.getElementById('payment-credit-container');\r\n        if (creditOption) {\r\n            if (total >= 30000) {\r\n                creditOption.classList.remove('d-none');\r\n            } else {\r\n                creditOption.classList.add('d-none');\r\n                const creditInput = creditOption.querySelector('input');\r\n                if (creditInput) {\r\n                    creditInput.checked = false;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    const submitCart = () => {\r\n        const selectedPayment = document.querySelector('input[name=\"paymentMethod\"]:checked');\r\n        if (!selectedPayment) {\r\n            alert('Por favor seleccione un m\u00E9todo de pago');\r\n            return;\r\n        }\r\n\r\n        let message = \"Mi pedido:\\n\\n\";\r\n        cart.forEach(item => {\r\n            const discountedPrice = item.price - (item.discount || 0);\r\n            message += `${item.name}\\n`;\r\n            message += `Cantidad: ${item.quantity}\\n`;\r\n            message += `Precio unitario: $${discountedPrice.toLocaleString('es-CL')}\\n`;\r\n            message += `Subtotal: $${(discountedPrice * item.quantity).toLocaleString('es-CL')}\\n\\n`;\r\n        });\r\n\r\n        const total = cart.reduce((sum, item) => sum + (item.price - (item.discount || 0)) * item.quantity, 0);\r\n        message += `Total: $${total.toLocaleString('es-CL')}\\n`;\r\n        message += `M\u00E9todo de pago: ${selectedPayment.value}`;\r\n\r\n        const encodedMessage = encodeURIComponent(message);\r\n        window.open(`https://wa.me/56951118901?text=${encodedMessage}`, '_blank');\r\n    };\r\n\r\n    try {\r\n        initFooter();\r\n\r\n        const bootstrapPayload = getSharedProductData();\r\n        if (bootstrapPayload?.products?.length) {\r\n            products = bootstrapPayload.products.map((product, index) => ({\r\n                ...product,\r\n                originalIndex: typeof product.originalIndex === 'number' ? product.originalIndex : index,\r\n                categoryKey: product.categoryKey || normalizeString(product.category)\r\n            }));\r\n        }\r\n\r\n        const mainElement = document.querySelector('main');\r\n        const currentCategory = mainElement?.dataset?.category || '';\r\n        if (currentCategory) {\r\n            const normCurrent = normalizeString(currentCategory);\r\n            products = products\r\n                .filter(product => (product.categoryKey || normalizeString(product.category)) === normCurrent)\r\n                .map((product, index) => ({\r\n                    ...product,\r\n                    originalIndex: typeof product.originalIndex === 'number' ? product.originalIndex : index\r\n                }));\r\n        }\r\n\r\n        const hydratedCount = hydratePreRenderedProducts(products);\r\n        if (hydratedCount > 0) {\r\n            visibleCount = hydratedCount;\r\n            initialBatchSize = hydratedCount;\r\n        } else {\r\n            visibleCount = 0;\r\n        }\r\n\r\n        setupDeferredLoading();\r\n        applyFilters();\r\n        updateLoadMoreVisibility();\r\n        if (visibleCount === 0 && filteredProducts.length) {\r\n            appendInitialBatch();\r\n        }\r\n\r\n        const fetchPromise = fetchProducts();\r\n\r\n        sortOptions.addEventListener('change', () => {\r\n            userHasInteracted = true;\r\n            debouncedUpdateProductDisplay();\r\n        });\r\n        filterKeyword.addEventListener('input', () => {\r\n            userHasInteracted = true;\r\n            debouncedUpdateProductDisplay();\r\n        });\r\n\r\n        const discountToggle = ensureDiscountToggle();\r\n        if (discountToggle) {\r\n            discountToggle.addEventListener('change', () => {\r\n                userHasInteracted = true;\r\n                debouncedUpdateProductDisplay();\r\n            });\r\n        }\r\n\r\n        const networkProducts = await fetchPromise;\r\n\r\n        if (!Array.isArray(networkProducts) || networkProducts.length === 0) {\r\n            if (!products.length) {\r\n                showErrorMessage('No hay productos disponibles. Por favor, intenta m\u00E1s tarde.');\r\n                return;\r\n            }\r\n        } else {\r\n            products = networkProducts.map((product, index) => ({\r\n                ...product,\r\n                originalIndex: typeof product.originalIndex === 'number' ? product.originalIndex : index,\r\n                categoryKey: product.categoryKey || normalizeString(product.category)\r\n            }));\r\n            if (currentCategory) {\r\n                const normCurrent = normalizeString(currentCategory);\r\n                products = products\r\n                    .filter(product => (product.categoryKey || normalizeString(product.category)) === normCurrent)\r\n                    .map((product, index) => ({\r\n                        ...product,\r\n                        originalIndex: typeof product.originalIndex === 'number' ? product.originalIndex : index\r\n                    }));\r\n            }\r\n        }\r\n\r\n        applyFilters();\r\n        if (userHasInteracted || visibleCount === 0) {\r\n            resetProductList();\r\n            if (filteredProducts.length) {\r\n                appendInitialBatch();\r\n            } else {\r\n                updateLoadMoreVisibility();\r\n            }\r\n        } else {\r\n            updateLoadMoreVisibility();\r\n        }\r\n\r\n        if (typeof window !== 'undefined') window.__APP_READY__ = true;\r\n\r\n        window.addEventListener('online', updateOnlineStatus);\r\n        window.addEventListener('offline', updateOnlineStatus);\r\n        updateOnlineStatus();\r\n\r\n        const cartIcon = document.getElementById('cart-icon');\r\n        const emptyCartBtn = document.getElementById('empty-cart');\r\n        const submitCartBtn = document.getElementById('submit-cart');\r\n\r\n        if (cartIcon) {\r\n            cartIcon.addEventListener('click', async () => {\r\n                renderCart();\r\n                const cartOffcanvasElement = document.getElementById('cartOffcanvas');\r\n                try {\r\n                    await showOffcanvas('#cartOffcanvas');\r\n                    if (cartOffcanvasElement) {\r\n                        cartOffcanvasElement.dataset.bsFallback = '0';\r\n                    }\r\n                } catch (error) {\r\n                    console.error('Bootstrap Offcanvas no est\u00E1 disponible', error);\r\n                    if (cartOffcanvasElement) {\r\n                        cartOffcanvasElement.dataset.bsFallback = '1';\r\n                        cartOffcanvasElement.classList.add('show');\r\n                        cartOffcanvasElement.removeAttribute('aria-hidden');\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (emptyCartBtn) {\r\n            emptyCartBtn.addEventListener('click', emptyCart);\r\n        }\r\n        if (submitCartBtn) {\r\n            submitCartBtn.addEventListener('click', submitCart);\r\n        }\r\n\r\n        if (cartItemsElement) {\r\n            cartItemsElement.addEventListener('click', (e) => {\r\n                const target = e.target;\r\n                const productId = target.closest('[data-id]')?.dataset.id;\r\n\r\n                if (!productId) return;\r\n\r\n                if (target.classList.contains('decrease-quantity')) {\r\n                    updateQuantity({ id: productId }, -1);\r\n                } else if (target.classList.contains('increase-quantity')) {\r\n                    updateQuantity({ id: productId }, 1);\r\n                } else if (target.classList.contains('remove-item')) {\r\n                    removeFromCart(productId);\r\n                }\r\n            });\r\n        }\r\n\r\n        updateCartIcon();\r\n\r\n        if ('performance' in window) {\r\n            window.addEventListener('load', () => {\r\n                logPerformanceMetrics();\r\n            });\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error(\"Error al inicializar productos:\", error);\r\n        showErrorMessage('Error al cargar productos. Por favor, int\u00E9ntelo m\u00E1s tarde.');\r\n    }\r\n};\r\n\r\n// Run the application when the DOM is ready\r\nif (typeof document !== 'undefined') {\r\n    document.addEventListener('DOMContentLoaded', function () {\r\n        // Register service worker first\r\n        registerServiceWorker();\r\n\r\n        // Then initialize the app\r\n        initApp().catch(error => {\r\n            console.error('Error al inicializar la aplicaci\u00F3n:', error);\r\n            showErrorMessage('Error al inicializar la aplicaci\u00F3n. Por favor, actualice la p\u00E1gina.');\r\n        });\r\n    });\r\n}\r\nfunction __getCart() {\r\n    return cart;\r\n}\r\n\r\nfunction __resetCart() {\r\n    cart = [];\r\n}\r\n\r\nexport {\r\n    generateStableId,\r\n    fetchProducts,\r\n    fetchWithRetry,\r\n    initApp,\r\n    addToCart,\r\n    removeFromCart,\r\n    updateQuantity,\r\n    updateCartIcon,\r\n    showUpdateNotification,\r\n    showServiceWorkerError,\r\n    showConnectivityNotification,\r\n    registerServiceWorker as __registerServiceWorkerForTest,\r\n    shouldRegisterServiceWorker as __shouldRegisterServiceWorkerForTest,\r\n    __resetServiceWorkerRegistrationForTest,\r\n    memoize as __memoizeForTest,\r\n    resolveAvifSrcset as __resolveAvifSrcsetForTest,\r\n    buildStaticSrcset as __buildStaticSrcsetForTest,\r\n    __getCart,\r\n    __resetCart,\r\n    logPerformanceMetrics\r\n};\r\n\r\n\r\n\r\n\r\n", "// ESM entry point to compose site enhancements and core app\r\n\r\nimport { injectEnhancementStyles } from './modules/enhancements.js';\r\nimport { setupNavigationAccessibility, setupCartOffcanvasAccessibility } from './modules/a11y.js';\nimport { setupPerformanceOptimizations } from './modules/perf.js';\r\nimport { injectSeoMetadata, injectStructuredData } from './modules/seo.js';\r\nimport { injectPwaManifest } from './modules/pwa.js';\r\nimport { setupCheckoutProgress } from './modules/checkout.js';\r\nimport { initializeBootstrapUI } from './modules/bootstrap.mjs';\r\n\r\n// Import the core app for side effects when bundling.\r\n// Note: When bundling via esbuild, this pulls in the main application logic.\r\nimport './script.mjs';\r\n\r\n\r\nfunction initEnhancementsOnce() {\r\n  const root = document.documentElement;\r\n  // Always enable deferred styles first (idempotent)\r\n  try {\r\n    document\r\n      .querySelectorAll('link[rel=\"stylesheet\"][media=\"print\"][data-defer]')\r\n      .forEach((link) => {\r\n        link.media = 'all';\r\n        link.removeAttribute('data-defer');\r\n      });\r\n  } catch {}\r\n\r\n  if (root.dataset.enhancementsInit === '1') return;\r\n  root.dataset.enhancementsInit = '1';\r\n\r\n  injectEnhancementStyles();\r\n  setupCheckoutProgress();\n  setupNavigationAccessibility();\n  setupCartOffcanvasAccessibility();\n  setupPerformanceOptimizations();\r\n  injectSeoMetadata();\r\n  injectStructuredData();\r\n  injectPwaManifest();\r\n  initializeBootstrapUI();\r\n}\r\n\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', initEnhancementsOnce);\r\n} else {\r\n  initEnhancementsOnce();\r\n}\r\n\r\n// Test hook: expose the initializer to allow unit tests to verify\r\n// the deferred CSS swap logic and one-time initialization behavior.\r\n// This export has no effect on runtime behavior.\r\nexport { initEnhancementsOnce as __initEnhancementsOnceForTest };\r\n\r\n// Optional analytics (fully opt-in via global flag to avoid any startup cost)\r\ntry {\r\n  if (typeof window !== 'undefined' && window.__ANALYTICS_ENABLE__ === true) {\r\n    import('./modules/analytics.mjs').then((m) => {\r\n      m.initAnalytics({ enabled: true, consentRequired: true, sampleRate: 1.0 });\r\n      window.__analyticsTrack = (name, props) => { try { return m.track(name, props); } catch { return false; } };\r\n      m.track('page_view', { path: location.pathname });\r\n    }).catch(() => {});\r\n  }\r\n} catch {}\r\n"],
  "mappings": "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",
  "names": ["injectEnhancementStyles", "styleEl", "setupNavigationAccessibility", "e", "style", "getFocusableElements", "container", "selectors", "el", "setupCartOffcanvasAccessibility", "handleHide", "detachKeydown", "lastFocusedElement", "triggerButton", "cartOffcanvas", "heading", "keydownAttached", "handleKeydown", "event", "focusable", "first", "last", "active", "attachKeydown", "focusInitial", "target", "setupPerformanceOptimizations", "img", "PRODUCT_DATA_GLOBAL_KEY", "getSharedProducts", "payload", "persistSharedProducts", "products", "metadata", "_a", "_b", "existing", "createProductMap", "map", "p", "key", "markStructuredDataInjected", "loadProductData", "sharedProducts", "version", "url", "response", "data", "arr", "injectStructuredData", "sharedPayload", "structuredProducts", "structuredData", "scriptEl", "injectSeoMetadata", "link", "meta", "injectPwaManifest", "link", "setupCheckoutProgress", "_a", "e", "controllerRegistry", "controllerContainers", "activeControllers", "raf", "cb", "caf", "id", "composedPath", "event", "path", "current", "ensureId", "baseElement", "prefix", "index", "_a", "datasetId", "generated", "setExpanded", "entry", "isExpanded", "toggle", "menu", "dropdownNode", "closeAll", "state", "ensureOutsideListener", "listenerAttached", "attach", "handleTogglePointerDown", "handleToggleKeyDown", "key", "now", "createEntry", "createController", "nav", "pointerHandler", "clickHandler", "keyHandler", "destroyController", "setupUnifiedMenuController", "container", "navContainers", "preferred", "bootstrapInitialized", "loaderOverrides", "collapseModulePromise", "offcanvasModulePromise", "getModuleExport", "module", "keys", "getOrCreateInstance", "Component", "element", "resolveElement", "target", "loadWithOverride", "name", "importer", "loadCollapse", "loadOffcanvas", "setupCollapseToggles", "toggle", "event", "shouldPreventNavigation", "activateCollapse", "_a", "targetSelector", "Collapse", "instance", "error", "href", "initializeBootstrapUI", "setupUnifiedMenuController", "showOffcanvas", "Offcanvas", "cfimg", "path", "opts", "p", "params", "k", "v", "encoded", "CFIMG_THUMB", "PRODUCT_DATA_GLOBAL_KEY", "sharedProductData", "UTILITY_CLASSES", "PRODUCT_IMAGE_WIDTHS", "PRODUCT_IMAGE_SIZES", "CART_IMAGE_WIDTHS", "normaliseAssetPath", "value", "buildCfSrc", "assetPath", "extraOpts", "normalised", "cfimg", "CFIMG_THUMB", "buildCfSrcset", "widths", "width", "STATIC_SRC_DESCRIPTOR_KEYS", "encodeStaticPath", "path", "_err", "buildStaticSrcset", "normaliseDescriptor", "descriptorCandidate", "trimmed", "buildEntry", "entry", "srcCandidate", "src", "descriptorKey", "key", "descriptor", "encodedSrc", "isAvifAsset", "resolveAvifSrcset", "staticSrcset", "srcsetFromObject", "getSharedProductData", "payload", "writeSharedProductData", "products", "metadata", "force", "existing", "existingVersion", "payloadVersion", "ensureSharedProductData", "overwriteSharedProductData", "SERVICE_WORKER_CONFIG", "LOCALHOST_HOSTNAMES", "safeReadLocalStorage", "_a", "_b", "storage", "error", "shouldRegisterServiceWorker", "_c", "_d", "hostname", "enableLocalFlag", "query", "queryEnables", "serviceWorkerRegistrationSetup", "registerServiceWorker", "startRegistration", "initializeServiceWorker", "showServiceWorkerError", "initializeServiceWorker", "registration", "SERVICE_WORKER_CONFIG", "setupUpdateHandling", "setupPeriodicUpdateCheck", "setupControllerChangeHandling", "setupConnectivityHandling", "error", "newWorker", "checkForUpdates", "_a", "response", "currentVersion", "storedVersion", "showUpdateNotification", "refreshing", "offlineIndicator", "updateOnlineStatus", "hidden", "UTILITY_CLASSES", "showConnectivityNotification", "__notificationsModulePromise", "__loadNotifications", "serviceWorker", "message", "m", "showServiceWorkerError", "registerServiceWorker", "isCacheableObject", "value", "createCacheNode", "memoize", "fn", "cacheSize", "root", "lru", "touch", "node", "index", "evictIfNeeded", "oldest", "getChildNode", "arg", "next", "args", "i", "result", "debounce", "func", "delay", "timeoutId", "scheduleIdle", "timeout", "cancelScheduledIdle", "token", "normalizeString", "str", "e", "DEFAULT_CATEGORY", "DEFAULT_PRODUCT_NAME_PREFIX", "generateStableId", "product", "hasValidShape", "rawName", "rawCategory", "safeName", "safeCategory", "baseString", "hash", "charCode", "suffix", "sanitizeHTML", "unsafe", "element", "INLINE_PRODUCT_SCRIPT_ID", "getStoredProductVersion", "setStoredProductVersion", "version", "parseInlineProductData", "script", "payload", "parsed", "log", "transformProduct", "id", "originalIndex", "safeDescription", "safeImagePath", "safeImageAvifPath", "transformProducts", "products", "hydrateSharedProductDataFromInline", "existing", "getSharedProductData", "inlineData", "transformed", "ensureSharedProductData", "ProductDataError", "cause", "correlationId", "fetchWithRetry", "url", "opts", "retries", "backoffMs", "sanitizedUrl", "attempt", "lastError", "start", "durationMs", "err", "resolve", "fetchProducts", "createCorrelationId", "inlineSource", "inlineVersion", "inlineTotal", "inlineProducts", "hasInlineProducts", "versionForUrl", "data", "overwriteSharedProductData", "showErrorMessage", "createSafeElement", "tag", "attributes", "children", "key", "child", "createProductPicture", "imagePath", "avifPath", "alt", "eager", "sizes", "PRODUCT_IMAGE_SIZES", "pictureChildren", "avifSrcset", "resolveAvifSrcset", "fallbackSrc", "buildCfSrc", "normaliseAssetPath", "fallbackSrcset", "buildCfSrcset", "imgAttrs", "imgElement", "createCartThumbnail", "sources", "CART_IMAGE_WIDTHS", "errorMessage", "productContainer", "initApp", "cart", "logPerformanceMetrics", "perf", "fcpValue", "domContentLoadedValue", "loadTimeValue", "paintEntries", "navigationEntries", "fcpEntry", "entry", "navigationEntry", "error", "event", "target", "isResourceError", "hasRuntimeError", "showErrorMessage", "initApp", "_a", "_b", "_c", "productContainer", "sortOptions", "filterKeyword", "cartCountElement", "cartItemsElement", "cartTotalElement", "missingSelectors", "element", "selector", "log", "ensureDiscountToggle", "toggle", "filterSection", "filterSectionRow", "col", "createSafeElement", "formCheck", "input", "label", "INITIAL_BATCH_FALLBACK", "SUBSEQUENT_BATCH_SIZE", "products", "filteredProducts", "visibleCount", "initialBatchSize", "loadMoreButton", "catalogSentinel", "sentinelObserver", "userHasInteracted", "cart", "updateOnlineStatus", "offlineIndicator", "hidden", "UTILITY_CLASSES", "initFooter", "yearSpan", "DEFAULT_CURRENCY_CODE", "hasLoggedCurrencyFallback", "normalizeCurrencyCode", "currencyCode", "trimmed", "createCurrencyFormatter", "fallbackCode", "error", "message", "renderPriceHtml", "price", "discount", "numericPrice", "numericDiscount", "formatter", "formattedPrice", "discountedPrice", "formattedDiscountedPrice", "renderQuantityControl", "product", "quantityControl", "minusBtn", "plusBtn", "getCartItemQuantity", "setupActionArea", "actionArea", "addToCartBtn", "quantityInput", "bind", "handler", "addToCart", "toggleActionArea", "updateQuantity", "newQuantity", "currentQuantity", "productId", "item", "renderProducts", "productsToRender", "reset", "fragment", "id", "name", "description", "image_path", "image_avif_path", "stock", "productClasses", "titleId", "productElement", "cardElement", "pct", "badge", "pictureElement", "createProductPicture", "cardBody", "priceContainer", "lazyLoadImages", "hydratePreRenderedProducts", "productList", "cards", "map", "hydrated", "card", "resetProductList", "applyFilters", "criterion", "keyword", "discountOnly", "memoizedFilterProducts", "appendBatch", "size", "updateLoadMoreVisibility", "start", "nextProducts", "appendInitialBatch", "appendNextBatch", "hasMore", "setupDeferredLoading", "entries", "entry", "imageObserver", "observer", "img", "simpleTypoFix", "query", "text", "normalizeText", "str", "normalizedQuery", "normalizedText", "isSimpleTypo", "word", "differences", "maxLen", "i", "isOneCharacterDifference", "str1", "str2", "longer", "shorter", "shifts", "j", "filterProducts", "sortCriterion", "trimmedKeyword", "a", "sortProducts", "b", "property", "order", "valueA", "valueB", "memoize", "updateProductDisplay", "pendingIdleUpdate", "debouncedUpdateProductDisplay", "debounce", "cancelScheduledIdle", "scheduleIdle", "updateCartIcon", "cartCount", "totalItems", "total", "quantity", "existingItem", "saveCart", "renderCart", "removeFromCart", "btn", "qc", "change", "emptyCart", "showQuantity", "showButton", "cartItems", "cartTotal", "itemElement", "contentContainer", "quantityContainer", "decreaseBtn", "increaseBtn", "quantitySpan", "removeBtn", "isSubcategoryPage", "adjustedImagePath", "thumbnailContainer", "thumbSrc", "thumbnailPicture", "createCartThumbnail", "fallbackImg", "parts", "v", "cs", "csThumb", "csContent", "rectThumb", "rectContent", "e", "creditOption", "creditInput", "submitCart", "selectedPayment", "sum", "encodedMessage", "bootstrapPayload", "getSharedProductData", "index", "normalizeString", "mainElement", "currentCategory", "normCurrent", "hydratedCount", "fetchPromise", "fetchProducts", "discountToggle", "networkProducts", "cartIcon", "emptyCartBtn", "submitCartBtn", "cartOffcanvasElement", "showOffcanvas", "logPerformanceMetrics", "registerServiceWorker", "initEnhancementsOnce", "root", "link", "e", "injectEnhancementStyles", "setupCheckoutProgress", "setupNavigationAccessibility", "setupCartOffcanvasAccessibility", "setupPerformanceOptimizations", "injectSeoMetadata", "injectStructuredData", "injectPwaManifest", "initializeBootstrapUI", "m", "name", "props", "e"]
}
