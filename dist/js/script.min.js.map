{
  "version": 3,
  "sources": ["../../src/js/modules/enhancements.js", "../../src/js/modules/a11y.js", "../../src/js/modules/perf.js", "../../src/js/modules/seo.js", "../../src/js/modules/pwa.js", "../../src/js/modules/checkout.js", "../../src/js/modules/menu-controller.mjs", "../../src/js/modules/bootstrap.mjs", "../../src/js/utils/cfimg.mjs", "../../src/js/script.mjs", "../../src/js/main.js"],
  "sourcesContent": ["// UI enhancement styles (migrated from csp.js)\nexport function injectEnhancementStyles() {\n  try {\n    const styleEl = document.createElement('style');\n    if (window && window.__CSP_NONCE__) {\n      styleEl.setAttribute('nonce', window.__CSP_NONCE__);\n    }\n    styleEl.textContent = `\n      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */\n      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }\n      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }\n\n      /* Contornos de enfoque claros para accesibilidad */\n      .navbar .nav-link:focus,\n      .navbar .dropdown-item:focus {\n        outline: 2px solid var(--primary-color);\n        outline-offset: 2px;\n      }\n\n      /* Espaciado entre botones en el offcanvas del carrito */\n      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }\n    `;\n    document.head.appendChild(styleEl);\n  } catch (e) {\n    console.warn('[modules/enhancements] injectEnhancementStyles error:', e);\n  }\n}\n", "// Basic navigation accessibility hooks (migrated from csp.js)\nexport function setupNavigationAccessibility() {\n  try {\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Tab') document.body.classList.add('keyboard-navigation');\n    });\n    document.addEventListener('mousedown', () => {\n      document.body.classList.remove('keyboard-navigation');\n    });\n\n    const style = document.createElement('style');\n    if (window && window.__CSP_NONCE__) {\n      style.setAttribute('nonce', window.__CSP_NONCE__);\n    }\n    style.textContent = `.keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }`;\n    document.head.appendChild(style);\n  } catch (e) {\n    console.warn('[modules/a11y] setupNavigationAccessibility error:', e);\n  }\n}\n\nfunction getFocusableElements(container) {\n  if (!container) return [];\n  const selectors = [\n    'a[href]',\n    'area[href]',\n    'button:not([disabled])',\n    'input:not([disabled]):not([type=\"hidden\"])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    '[tabindex]:not([tabindex=\"-1\"])',\n    '[contenteditable=\"true\"]'\n  ];\n  return Array.from(container.querySelectorAll(selectors.join(','))).filter((el) => {\n    if (!(el instanceof HTMLElement)) return false;\n    const style = window.getComputedStyle(el);\n    return style.visibility !== 'hidden' && style.display !== 'none';\n  });\n}\n\nexport function setupCartOffcanvasAccessibility() {\n  try {\n    const cartOffcanvas = document.getElementById('cartOffcanvas');\n    if (!cartOffcanvas) return;\n\n    const heading = cartOffcanvas.querySelector('#cartOffcanvasLabel');\n    const triggerButton = document.getElementById('cart-icon');\n    let lastFocusedElement = null;\n    let keydownAttached = false;\n\n    const handleKeydown = (event) => {\n      if (event.key === 'Escape' && cartOffcanvas.dataset.bsFallback === '1') {\n        event.preventDefault();\n        cartOffcanvas.classList.remove('show');\n        cartOffcanvas.setAttribute('aria-hidden', 'true');\n        handleHide();\n        return;\n      }\n\n      if (event.key !== 'Tab') return;\n      const focusable = getFocusableElements(cartOffcanvas);\n      if (!focusable.length) {\n        event.preventDefault();\n        return;\n      }\n\n      const first = focusable[0];\n      const last = focusable[focusable.length - 1];\n      const active = document.activeElement;\n\n      if (event.shiftKey) {\n        if (active === first || !cartOffcanvas.contains(active)) {\n          event.preventDefault();\n          last.focus();\n        }\n      } else if (active === last) {\n        event.preventDefault();\n        first.focus();\n      }\n    };\n\n    const attachKeydown = () => {\n      if (!keydownAttached) {\n        cartOffcanvas.addEventListener('keydown', handleKeydown);\n        keydownAttached = true;\n      }\n    };\n\n    const detachKeydown = () => {\n      if (keydownAttached) {\n        cartOffcanvas.removeEventListener('keydown', handleKeydown);\n        keydownAttached = false;\n      }\n    };\n\n    const focusInitial = () => {\n      if (heading instanceof HTMLElement && typeof heading.focus === 'function') {\n        heading.focus();\n      } else {\n        cartOffcanvas.focus();\n      }\n    };\n\n    function handleHide() {\n      detachKeydown();\n      if (lastFocusedElement && typeof lastFocusedElement.focus === 'function') {\n        lastFocusedElement.focus();\n      } else if (triggerButton && typeof triggerButton.focus === 'function') {\n        triggerButton.focus();\n      }\n    }\n\n    cartOffcanvas.addEventListener('show.bs.offcanvas', () => {\n      lastFocusedElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;\n      attachKeydown();\n    });\n\n    cartOffcanvas.addEventListener('shown.bs.offcanvas', () => {\n      focusInitial();\n    });\n\n    cartOffcanvas.addEventListener('hidden.bs.offcanvas', () => {\n      handleHide();\n    });\n\n    cartOffcanvas.addEventListener('click', (event) => {\n      const target = event.target instanceof HTMLElement ? event.target : null;\n      if (!target) return;\n      const dismissTrigger = target.closest('[data-bs-dismiss=\"offcanvas\"]');\n      if (!dismissTrigger) return;\n      if (cartOffcanvas.dataset.bsFallback === '1') {\n        event.preventDefault();\n        cartOffcanvas.classList.remove('show');\n        cartOffcanvas.setAttribute('aria-hidden', 'true');\n        handleHide();\n      }\n    });\n  } catch (e) {\n    console.warn('[modules/a11y] setupCartOffcanvasAccessibility error:', e);\n  }\n}\n", "// Lightweight performance hooks (migrated from csp.js)\nexport function setupPerformanceOptimizations() {\n  try {\n    // Native lazy-loading for images where missing\n    if ('loading' in HTMLImageElement.prototype) {\n      document.querySelectorAll('img:not([loading])').forEach((img) => {\n        img.loading = 'lazy';\n      });\n    }\n  } catch (e) {\n    console.warn('[modules/perf] setupPerformanceOptimizations error:', e);\n  }\n}\n\n", "// SEO metadata + structured data (migrated/adapted from csp.js)\n\nconst PRODUCT_DATA_GLOBAL_KEY = '__PRODUCT_DATA__';\n\nfunction getSharedProducts() {\n  try {\n    if (typeof window === 'undefined') return null;\n    const payload = window[PRODUCT_DATA_GLOBAL_KEY];\n    if (payload && Array.isArray(payload.products)) {\n      return payload.products;\n    }\n  } catch (e) {\n    console.warn('[modules/seo] Unable to read shared product data:', e);\n  }\n  return null;\n}\n\nfunction persistSharedProducts(products, metadata = {}) {\n  if (typeof window === 'undefined' || !Array.isArray(products)) {\n    return;\n  }\n  const existing = window[PRODUCT_DATA_GLOBAL_KEY] || {};\n  window[PRODUCT_DATA_GLOBAL_KEY] = {\n    ...existing,\n    products,\n    version: metadata.version ?? existing.version ?? null,\n    updatedAt: metadata.updatedAt || Date.now(),\n    source: metadata.source || existing.source || 'seo'\n  };\n}\n\nfunction createProductMap(products = []) {\n  const map = {};\n  products.forEach((p) => {\n    const key = p.id || String(p.name) + '-' + String(p.category);\n    map[key] = p;\n  });\n  return map;\n}\n\nfunction markStructuredDataInjected() {\n  if (typeof window === 'undefined') return;\n  const payload = window[PRODUCT_DATA_GLOBAL_KEY] || {};\n  if (payload.structuredDataInjected) {\n    return;\n  }\n  window[PRODUCT_DATA_GLOBAL_KEY] = {\n    ...payload,\n    structuredDataInjected: true\n  };\n}\n\nasync function loadProductData() {\n  try {\n    const sharedProducts = getSharedProducts();\n    if (sharedProducts) {\n      return createProductMap(sharedProducts);\n    }\n\n    const version = localStorage.getItem('productDataVersion');\n    const url = version ? `/data/product_data.json?v=${encodeURIComponent(version)}` : '/data/product_data.json';\n    const response = await fetch(url, { cache: 'no-store', headers: { 'Accept': 'application/json' } });\n    if (!response.ok) return null;\n    const data = await response.json();\n    const arr = Array.isArray(data?.products) ? data.products : (Array.isArray(data) ? data : []);\n    persistSharedProducts(arr, { version: data?.version || version || null, source: 'seo-fallback' });\n    return createProductMap(arr);\n  } catch (e) {\n    console.error('[modules/seo] Error loading product data:', e);\n    return null;\n  }\n}\n\nexport async function injectStructuredData() {\n  try {\n    if (document.querySelector('script[type=\"application/ld+json\"]')) {\n      markStructuredDataInjected();\n      return;\n    }\n    const sharedPayload = typeof window !== 'undefined' ? window[PRODUCT_DATA_GLOBAL_KEY] : null;\n    if (sharedPayload?.structuredDataInjected) {\n      return;\n    }\n    const map = await loadProductData();\n    if (!map) return;\n    const products = Object.values(map);\n    const structuredProducts = products.slice(0, 20).map((p) => ({\n      '@type': 'Product',\n      name: p.name,\n      image: p.image_path,\n      description: p.description,\n      brand: p.brand || 'Gen\u00E9rico',\n      offers: {\n        '@type': 'Offer',\n        price: p.price,\n        priceCurrency: 'CLP',\n        availability: p.stock ? 'https://schema.org/InStock' : 'https://schema.org/OutOfStock',\n      },\n    }));\n\n    const structuredData = {\n      '@context': 'https://schema.org',\n      '@graph': [\n        {\n          '@type': 'Store',\n          name: 'El Rinc\u00F3n de \u00C9bano',\n          image: 'https://elrincondeebano.com/assets/images/web/logo.webp',\n          description: 'Un minimarket en la puerta de tu departamento',\n          address: { '@type': 'PostalAddress', addressCountry: 'CL' },\n          telephone: '+56951118901',\n          url: 'http://www.elrincondeebano.com/',\n          contactPoint: {\n            '@type': 'ContactPoint',\n            telephone: '+56-951118901',\n            contactType: 'customer service',\n          },\n        },\n        ...structuredProducts,\n      ],\n    };\n\n    const scriptEl = document.createElement('script');\n    scriptEl.type = 'application/ld+json';\n    if (window && window.__CSP_NONCE__) {\n      scriptEl.setAttribute('nonce', window.__CSP_NONCE__);\n    }\n    scriptEl.textContent = JSON.stringify(structuredData);\n    document.head.appendChild(scriptEl);\n    markStructuredDataInjected();\n  } catch (e) {\n    console.error('[modules/seo] Error generating structured data:', e);\n  }\n}\n\nexport function injectSeoMetadata() {\n  try {\n    if (!document.querySelector('link[rel=\"canonical\"]')) {\n      const link = document.createElement('link');\n      link.rel = 'canonical';\n      link.href = location.origin + location.pathname;\n      document.head.appendChild(link);\n    }\n    if (!document.querySelector('meta[name=\"description\"]')) {\n      const meta = document.createElement('meta');\n      meta.name = 'description';\n      meta.content = 'El Rinc\u00F3n de \u00C9bano - Minimarket con delivery instant\u00E1neo.';\n      document.head.appendChild(meta);\n    }\n  } catch (e) {\n    console.warn('[modules/seo] injectSeoMetadata error:', e);\n  }\n}\n", "// PWA manifest injection (migrated from csp.js)\nexport function injectPwaManifest() {\n  try {\n    if (!document.querySelector('link[rel=\"manifest\"]')) {\n      const link = document.createElement('link');\n      link.rel = 'manifest';\n      link.href = '/app.webmanifest';\n      document.head.appendChild(link);\n    }\n  } catch (e) {\n    console.warn('[modules/pwa] injectPwaManifest error:', e);\n  }\n}\n\n", "// Placeholder for checkout progress (migrated from csp.js)\nexport function setupCheckoutProgress() {\n  try {\n    if (window?.console?.debug) console.debug('[modules/checkout] setupCheckoutProgress: no-op');\n  } catch {}\n}\n\n", "const controllerRegistry = new WeakMap();\nconst controllerContainers = new Set();\nconst activeControllers = new Set();\n\nconst raf = typeof window !== 'undefined' && typeof window.requestAnimationFrame === 'function'\n  ? window.requestAnimationFrame.bind(window)\n  : (cb) => setTimeout(cb, 16);\n\nconst caf = typeof window !== 'undefined' && typeof window.cancelAnimationFrame === 'function'\n  ? window.cancelAnimationFrame.bind(window)\n  : (id) => clearTimeout(id);\n\nfunction composedPath(event) {\n  if (typeof event.composedPath === 'function') {\n    return event.composedPath();\n  }\n  const path = [];\n  let current = event.target;\n  while (current) {\n    path.push(current);\n    current = current.parentNode;\n  }\n  if (typeof window !== 'undefined') {\n    path.push(window);\n  }\n  path.push(document);\n  return path;\n}\n\nfunction ensureId(baseElement, prefix, index) {\n  if (!baseElement) {\n    return `${prefix}-${index}`;\n  }\n  if (typeof baseElement.id === 'string' && baseElement.id.trim().length > 0) {\n    return `id:${baseElement.id}`;\n  }\n  const datasetId = baseElement.dataset?.dropdownId;\n  if (datasetId) {\n    return datasetId;\n  }\n  const generated = `${prefix}:${index}`;\n  if (baseElement.dataset) {\n    baseElement.dataset.dropdownId = generated;\n  }\n  return generated;\n}\n\nfunction setExpanded(entry, isExpanded) {\n  const { toggle, menu, dropdownNode } = entry;\n  toggle.classList.toggle('show', isExpanded);\n  toggle.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');\n  if (menu) {\n    menu.classList.toggle('show', isExpanded);\n  }\n  if (dropdownNode) {\n    dropdownNode.classList.toggle('show', isExpanded);\n  }\n}\n\nfunction closeAll(state) {\n  state.expandedId = null;\n  state.toggles.forEach((entry) => {\n    setExpanded(entry, false);\n  });\n}\n\nfunction ensureOutsideListener(state) {\n  if (state.outsideListenerInstalled) {\n    return;\n  }\n  state.outsideListenerInstalled = true;\n  let listenerAttached = false;\n  const attach = () => {\n    document.addEventListener('pointerdown', state.onPointerDownOutside, true);\n    listenerAttached = true;\n  };\n  state.outsideListenerCleanup = () => {\n    if (state.installTimer !== null) {\n      clearTimeout(state.installTimer);\n      state.installTimer = null;\n    }\n    if (listenerAttached) {\n      document.removeEventListener('pointerdown', state.onPointerDownOutside, true);\n      listenerAttached = false;\n    }\n    state.outsideListenerInstalled = false;\n  };\n  state.installTimer = setTimeout(() => {\n    state.installTimer = null;\n    attach();\n  }, 0);\n}\n\nfunction handleTogglePointerDown(event, state, entry) {\n  if (event.button !== undefined && event.button !== 0) {\n    return;\n  }\n  if (state.preventNavigation && entry.toggle.tagName === 'A') {\n    event.preventDefault();\n  }\n  event.stopPropagation();\n  if (typeof event.stopImmediatePropagation === 'function') {\n    event.stopImmediatePropagation();\n  }\n\n  state.justOpened = true;\n  if (state.justOpenedFrame !== null) {\n    caf(state.justOpenedFrame);\n  }\n  state.justOpenedFrame = raf(() => {\n    state.justOpened = false;\n    state.justOpenedFrame = null;\n  });\n\n  ensureOutsideListener(state);\n\n  if (state.expandedId === entry.id) {\n    closeAll(state);\n    return;\n  }\n\n  closeAll(state);\n  setExpanded(entry, true);\n  state.expandedId = entry.id;\n}\n\nfunction handleToggleKeyDown(event, state, entry) {\n  const key = event.key;\n  if (key === 'Enter' || key === ' ' || key === 'Spacebar') {\n    event.preventDefault();\n    handleTogglePointerDown(event, state, entry);\n  } else if (key === 'Escape') {\n    closeAll(state);\n    entry.toggle.focus();\n  }\n}\n\nfunction now() {\n  if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\n    return performance.now();\n  }\n  return Date.now();\n}\n\nfunction createEntry(toggle, index) {\n  const dropdownNode = toggle.closest('.dropdown');\n  const menu = dropdownNode?.querySelector('.dropdown-menu');\n  const id = ensureId(toggle, 'auto', index);\n  const entry = { toggle, menu, dropdownNode, id, lastPointerTime: 0 };\n  if (menu && !menu.id) {\n    menu.id = `${id}-menu`;\n  }\n  if (menu) {\n    toggle.setAttribute('aria-controls', menu.id);\n  }\n  return entry;\n}\n\nfunction createController(nav) {\n  const state = {\n    container: nav,\n    toggles: [],\n    expandedId: null,\n    justOpened: false,\n    justOpenedFrame: null,\n    outsideListenerInstalled: false,\n    outsideListenerCleanup: null,\n    installTimer: null,\n    onPointerDownOutside: null,\n    preventNavigation: true,\n  };\n\n  state.onPointerDownOutside = (event) => {\n    if (state.justOpened) {\n      return;\n    }\n    const path = composedPath(event);\n    if (path.includes(state.container)) {\n      return;\n    }\n    closeAll(state);\n  };\n\n  const toggles = Array.from(nav.querySelectorAll('.dropdown-toggle'));\n  toggles.forEach((toggle, index) => {\n    if (toggle.dataset.menuControllerBound === '1') {\n      return;\n    }\n    toggle.dataset.menuControllerBound = '1';\n    const entry = createEntry(toggle, index);\n    state.toggles.push(entry);\n\n    const pointerHandler = (event) => {\n      entry.lastPointerTime = now();\n      handleTogglePointerDown(event, state, entry);\n    };\n    const clickHandler = (event) => {\n      const sincePointer = now() - (entry.lastPointerTime || 0);\n      if (sincePointer < 250) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (typeof event.stopImmediatePropagation === 'function') {\n          event.stopImmediatePropagation();\n        }\n        return;\n      }\n      handleTogglePointerDown(event, state, entry);\n    };\n    const keyHandler = (event) => handleToggleKeyDown(event, state, entry);\n    toggle.addEventListener('pointerdown', pointerHandler);\n    toggle.addEventListener('click', clickHandler);\n    toggle.addEventListener('keydown', keyHandler);\n    entry.cleanup = () => {\n      toggle.removeEventListener('pointerdown', pointerHandler);\n      toggle.removeEventListener('click', clickHandler);\n      toggle.removeEventListener('keydown', keyHandler);\n      delete toggle.dataset.menuControllerBound;\n    };\n  });\n\n  controllerRegistry.set(nav, state);\n  controllerContainers.add(nav);\n  activeControllers.add(state);\n  if (state.toggles.length === 0) {\n    destroyController(state);\n    return null;\n  }\n  return state;\n}\n\nfunction destroyController(state) {\n  if (!state) {\n    return;\n  }\n  state.toggles.forEach((entry) => {\n    setExpanded(entry, false);\n    entry.cleanup?.();\n  });\n  state.toggles = [];\n  closeAll(state);\n  if (state.outsideListenerCleanup) {\n    state.outsideListenerCleanup();\n    state.outsideListenerCleanup = null;\n  }\n  if (state.justOpenedFrame !== null) {\n    caf(state.justOpenedFrame);\n    state.justOpenedFrame = null;\n  }\n  if (state.container) {\n    controllerRegistry.delete(state.container);\n    controllerContainers.delete(state.container);\n  }\n  activeControllers.delete(state);\n}\n\nexport function setupUnifiedMenuController({ container } = {}) {\n  if (typeof document === 'undefined') {\n    return;\n  }\n  let navContainers;\n  if (container) {\n    navContainers = [container];\n  } else {\n    const preferred = Array.from(document.querySelectorAll('#navbar-container'));\n    navContainers = preferred.length > 0 ? preferred : Array.from(document.querySelectorAll('.navbar, nav'));\n  }\n\n  navContainers.forEach((nav) => {\n    if (!(nav instanceof HTMLElement)) {\n      return;\n    }\n    const toggles = nav.querySelectorAll('.dropdown-toggle');\n    if (toggles.length === 0) {\n      return;\n    }\n    const existing = controllerRegistry.get(nav);\n    if (existing) {\n      return;\n    }\n    const controller = createController(nav);\n    if (!controller) {\n      controllerRegistry.delete(nav);\n      controllerContainers.delete(nav);\n    }\n  });\n}\n\nexport function __resetMenuControllerForTest() {\n  Array.from(controllerContainers).forEach((nav) => {\n    const state = controllerRegistry.get(nav);\n    destroyController(state);\n  });\n  activeControllers.clear();\n}\n\nexport function __getMenuControllerSnapshot() {\n  const controllers = Array.from(activeControllers).map((state) => ({\n    containerId: state.container.id || null,\n    expandedId: state.expandedId,\n    toggleCount: state.toggles.length,\n  }));\n  return {\n    controllerCount: controllers.length,\n    controllers,\n  };\n}\n", "import {\n  setupUnifiedMenuController,\n  __getMenuControllerSnapshot,\n  __resetMenuControllerForTest,\n} from './menu-controller.mjs';\n\nlet bootstrapInitialized = false;\nconst loaderOverrides = new Map();\nlet collapseModulePromise = null;\nlet offcanvasModulePromise = null;\n\nfunction getModuleExport(module) {\n  if (module && typeof module === 'object') {\n    if (module.default) {\n      return module.default;\n    }\n    const keys = Object.keys(module);\n    if (keys.length === 1) {\n      return module[keys[0]];\n    }\n  }\n  return module;\n}\n\nfunction getOrCreateInstance(Component, element) {\n  if (!Component || !element) {\n    return null;\n  }\n  if (typeof Component.getOrCreateInstance === 'function') {\n    return Component.getOrCreateInstance(element);\n  }\n  return new Component(element);\n}\n\nfunction resolveElement(target) {\n  if (!target) {\n    return null;\n  }\n  if (typeof target === 'string') {\n    return document.querySelector(target);\n  }\n  return target;\n}\n\nfunction loadWithOverride(name, importer) {\n  if (loaderOverrides.has(name)) {\n    return loaderOverrides.get(name)();\n  }\n  return importer();\n}\n\nasync function loadCollapse() {\n  if (!collapseModulePromise) {\n    collapseModulePromise = loadWithOverride('collapse', () => import('bootstrap/js/dist/collapse'));\n  }\n  const module = await collapseModulePromise;\n  return getModuleExport(module);\n}\n\nasync function loadOffcanvas() {\n  if (!offcanvasModulePromise) {\n    offcanvasModulePromise = loadWithOverride('offcanvas', () => import('bootstrap/js/dist/offcanvas'));\n  }\n  const module = await offcanvasModulePromise;\n  return getModuleExport(module);\n}\n\nfunction setupCollapseToggles() {\n  const toggles = document.querySelectorAll('[data-bs-toggle=\"collapse\"][data-bs-target]');\n  toggles.forEach((toggle) => {\n    toggle.addEventListener('click', (event) => {\n      if (shouldPreventNavigation(toggle)) {\n        event.preventDefault();\n      }\n      if (typeof event.stopImmediatePropagation === 'function') {\n        event.stopImmediatePropagation();\n      }\n      event.stopPropagation();\n      void activateCollapse(toggle, event);\n    });\n  });\n}\n\nasync function activateCollapse(toggle, event) {\n  try {\n    const targetSelector = toggle.getAttribute('data-bs-target');\n    if (!targetSelector) {\n      return;\n    }\n    const target = document.querySelector(targetSelector);\n    if (!target) {\n      return;\n    }\n    const Collapse = await loadCollapse();\n    const instance = getOrCreateInstance(Collapse, target);\n    instance?.toggle?.(event);\n  } catch (error) {\n    console.error('No se pudo inicializar el Collapse de Bootstrap', error);\n  }\n}\n\nfunction shouldPreventNavigation(toggle) {\n  if (!toggle || toggle.tagName !== 'A') {\n    return false;\n  }\n  const href = toggle.getAttribute('href');\n  return !href || href === '#';\n}\n\nexport function initializeBootstrapUI() {\n  if (bootstrapInitialized) {\n    return;\n  }\n  bootstrapInitialized = true;\n  if (typeof document === 'undefined') {\n    return;\n  }\n  setupCollapseToggles();\n  setupUnifiedMenuController();\n}\n\nexport async function showOffcanvas(target) {\n  if (typeof document === 'undefined') {\n    throw new Error('Offcanvas no disponible en este entorno');\n  }\n  const element = resolveElement(target);\n  if (!element) {\n    throw new Error('No se encontr\u00F3 el elemento de Offcanvas');\n  }\n  const Offcanvas = await loadOffcanvas();\n  const instance = getOrCreateInstance(Offcanvas, element);\n  if (!instance || typeof instance.show !== 'function') {\n    throw new Error('Instancia de Offcanvas inv\u00E1lida');\n  }\n  instance.show();\n  return instance;\n}\n\nexport function __setBootstrapLoaderOverride(name, loader) {\n  loaderOverrides.set(name, loader);\n  if (name === 'collapse') {\n    collapseModulePromise = null;\n  } else if (name === 'offcanvas') {\n    offcanvasModulePromise = null;\n  }\n}\n\nexport function __resetBootstrapTestState() {\n  loaderOverrides.clear();\n  collapseModulePromise = null;\n  offcanvasModulePromise = null;\n  bootstrapInitialized = false;\n  __resetMenuControllerForTest();\n}\n\nexport function __getDropdownStateSnapshot() {\n  return __getMenuControllerSnapshot();\n}\n", "/**\n * Build a Cloudflare image URL with optional transformation parameters.\n * @param {string} path - Image path, absolute or relative.\n * @param {Record<string, string|number>} [opts] - Key/value pairs passed to the CDN.\n * @returns {string} The rewritten URL.\n */\nexport function cfimg(path, opts = {}) {\n  const p = path.startsWith('/') ? path : '/' + path;\n  const params = Object.entries(opts).map(([k, v]) => `${k}=${v}`).join(',');\n  const encoded = p.split('/').map(encodeURIComponent).join('/');\n  return `/cdn-cgi/image/${params}${encoded}`;\n}\n\n/**\n * Default options for product thumbnail transformations.\n * @type {Record<string, string|number>}\n */\nexport const CFIMG_THUMB = { fit: 'cover', quality: 75, format: 'auto' };\n", "import { cfimg, CFIMG_THUMB } from './utils/cfimg.mjs';\nimport { log, createCorrelationId } from './utils/logger.mjs';\nimport { showOffcanvas } from './modules/bootstrap.mjs';\n\nconst PRODUCT_DATA_GLOBAL_KEY = '__PRODUCT_DATA__';\nlet sharedProductData = null;\n\nconst UTILITY_CLASSES = Object.freeze({\n    hidden: 'is-hidden',\n    flex: 'is-flex',\n    block: 'is-block',\n    contentVisible: 'has-content-visibility',\n    containIntrinsic: 'has-contain-intrinsic'\n});\n\nconst PRODUCT_IMAGE_WIDTHS = Object.freeze([200, 320, 400]);\nconst PRODUCT_IMAGE_SIZES = '(min-width: 1200px) 280px, (min-width: 992px) 240px, (min-width: 576px) 45vw, 80vw';\nconst CART_IMAGE_WIDTHS = Object.freeze([80, 120, 160]);\n\nconst normaliseAssetPath = (value = '') => {\n    if (!value) {\n        return '';\n    }\n    const trimmed = value.startsWith('/') ? value.slice(1) : value;\n    return `/${trimmed}`;\n};\n\nconst buildCfSrc = (assetPath, extraOpts = {}) => {\n    const normalised = normaliseAssetPath(assetPath);\n    if (!normalised) {\n        return '';\n    }\n    return cfimg(normalised, { ...CFIMG_THUMB, ...extraOpts });\n};\n\nconst buildCfSrcset = (assetPath, extraOpts = {}, widths = PRODUCT_IMAGE_WIDTHS) => {\n    const normalised = normaliseAssetPath(assetPath);\n    if (!normalised) {\n        return '';\n    }\n    return widths\n        .map(width => `${cfimg(normalised, { ...CFIMG_THUMB, width, ...extraOpts })} ${width}w`)\n        .join(', ');\n};\n\nconst STATIC_SRC_DESCRIPTOR_KEYS = Object.freeze(['descriptor', 'd']);\n\nconst encodeStaticPath = (path) => {\n    if (!path) {\n        return '';\n    }\n    try {\n        return encodeURI(path);\n    } catch (_err) {\n        return path;\n    }\n};\n\nconst buildStaticSrcset = (assetPath) => {\n    if (!assetPath) {\n        return '';\n    }\n\n    const normaliseDescriptor = (descriptorCandidate) => {\n        if (typeof descriptorCandidate === 'string') {\n            const trimmed = descriptorCandidate.trim();\n            return trimmed ? trimmed : '';\n        }\n        if (typeof descriptorCandidate === 'number' && Number.isFinite(descriptorCandidate)) {\n            return `${descriptorCandidate}w`;\n        }\n        return '';\n    };\n\n    const buildEntry = (entry) => {\n        if (typeof entry === 'string') {\n            const normalised = normaliseAssetPath(entry);\n            return encodeStaticPath(normalised);\n        }\n\n        if (entry && typeof entry === 'object') {\n            const srcCandidate = entry.src || entry.path || entry.url || '';\n            const src = normaliseAssetPath(srcCandidate);\n            if (!src) {\n                return '';\n            }\n\n            const descriptorKey = STATIC_SRC_DESCRIPTOR_KEYS.find(key => key in entry);\n            const descriptor = descriptorKey ? normaliseDescriptor(entry[descriptorKey]) : normaliseDescriptor(entry.width);\n            const encodedSrc = encodeStaticPath(src);\n            return descriptor ? `${encodedSrc} ${descriptor}` : encodedSrc;\n        }\n\n        return '';\n    };\n\n    if (Array.isArray(assetPath)) {\n        return assetPath\n            .map(buildEntry)\n            .filter(Boolean)\n            .join(', ');\n    }\n\n    if (assetPath && typeof assetPath === 'object') {\n        if (typeof assetPath.srcset === 'string') {\n            const trimmed = assetPath.srcset.trim();\n            if (trimmed) {\n                return trimmed;\n            }\n        }\n\n        if (Array.isArray(assetPath.variants)) {\n            return assetPath.variants\n                .map(buildEntry)\n                .filter(Boolean)\n                .join(', ');\n        }\n\n        return buildEntry(assetPath);\n    }\n\n    const normalised = normaliseAssetPath(assetPath);\n    return encodeStaticPath(normalised);\n};\n\nconst isAvifAsset = (assetPath) => {\n    if (typeof assetPath !== 'string') {\n        return false;\n    }\n    const trimmed = assetPath.trim();\n    if (!trimmed) {\n        return false;\n    }\n    return /\\.avif(?:[?#].*)?$/i.test(trimmed);\n};\n\nconst resolveAvifSrcset = (assetPath, widths = PRODUCT_IMAGE_WIDTHS) => {\n    if (!assetPath) {\n        return '';\n    }\n\n    if (Array.isArray(assetPath)) {\n        const staticSrcset = buildStaticSrcset(assetPath);\n        if (staticSrcset && /\\.avif/i.test(staticSrcset)) {\n            return staticSrcset;\n        }\n    }\n\n    if (assetPath && typeof assetPath === 'object' && !Array.isArray(assetPath)) {\n        const srcsetFromObject = buildStaticSrcset(assetPath);\n        if (srcsetFromObject && /\\.avif/i.test(srcsetFromObject)) {\n            return srcsetFromObject;\n        }\n\n        const srcCandidate = assetPath.src || assetPath.path || assetPath.url || '';\n        if (isAvifAsset(srcCandidate)) {\n            return buildStaticSrcset(srcCandidate);\n        }\n    }\n\n    if (isAvifAsset(assetPath)) {\n        return buildStaticSrcset(assetPath);\n    }\n\n    return buildCfSrcset(assetPath, { format: 'avif' }, widths);\n};\nfunction getSharedProductData() {\n    if (typeof window !== 'undefined') {\n        const payload = window[PRODUCT_DATA_GLOBAL_KEY];\n        if (payload && Array.isArray(payload.products)) {\n            return payload;\n        }\n    }\n    if (sharedProductData && Array.isArray(sharedProductData.products)) {\n        return sharedProductData;\n    }\n    return null;\n}\n\nfunction writeSharedProductData(products, metadata = {}, { force = false } = {}) {\n    if (!Array.isArray(products)) {\n        return null;\n    }\n    const payload = {\n        products,\n        version: metadata.version || null,\n        source: metadata.source || null,\n        updatedAt: metadata.updatedAt || Date.now(),\n        isPartial: Boolean(metadata.isPartial),\n        total: typeof metadata.total === 'number' ? metadata.total : null\n    };\n    const existing = getSharedProductData();\n    if (existing && !force) {\n        const existingVersion = existing.version || null;\n        const payloadVersion = payload.version || null;\n        const shouldKeepExisting =\n            (!payloadVersion && existingVersion) ||\n            (!payloadVersion && !existingVersion) ||\n            (payloadVersion && existingVersion === payloadVersion);\n        if (shouldKeepExisting) {\n            return existing;\n        }\n    }\n    sharedProductData = payload;\n    if (typeof window !== 'undefined') {\n        window[PRODUCT_DATA_GLOBAL_KEY] = { ...payload };\n    }\n    return payload;\n}\n\nfunction ensureSharedProductData(products, metadata = {}) {\n    return writeSharedProductData(products, metadata, { force: false });\n}\n\nfunction overwriteSharedProductData(products, metadata = {}) {\n    return writeSharedProductData(products, metadata, { force: true });\n}\n\n// Service Worker Configuration and Initialization\nconst SERVICE_WORKER_CONFIG = {\n    path: '/service-worker.js',\n    scope: '/',\n    updateCheckInterval: 5 * 60 * 1000, // 5 minutes\n};\n\nconst LOCALHOST_HOSTNAMES = new Set(['localhost', '127.0.0.1', '::1', '[::1]']);\n\nfunction safeReadLocalStorage(key) {\n    if (typeof window === 'undefined') {\n        return null;\n    }\n\n    try {\n        const storage = window.localStorage ?? globalThis.localStorage ?? null;\n        if (!storage) {\n            return null;\n        }\n        return storage.getItem(key);\n    } catch (error) {\n        console.warn('Unable to access localStorage for key', key, error);\n        return null;\n    }\n}\n\nfunction shouldRegisterServiceWorker() {\n    if (typeof window === 'undefined') {\n        return false;\n    }\n\n    const disabledFlag = safeReadLocalStorage('ebano-sw-disabled');\n    if (disabledFlag === 'true') {\n        console.info('Service worker registration skipped by kill-switch flag.');\n        return false;\n    }\n\n    const hostname = window.location?.hostname ?? '';\n    const isLocalhost = LOCALHOST_HOSTNAMES.has(hostname);\n    if (isLocalhost) {\n        const enableLocalFlag = safeReadLocalStorage('ebano-sw-enable-local');\n        const query = window.location?.search ?? '';\n        const queryEnables = typeof query === 'string' && /(?:^|[?&])sw=on(?:&|$)/i.test(query);\n        if (enableLocalFlag === 'true' || queryEnables) {\n            return true;\n        }\n        console.info('Service worker registration skipped on localhost. Set localStorage ebano-sw-enable-local=true to override.');\n        return false;\n    }\n\n    return true;\n}\n\nlet serviceWorkerRegistrationSetup = false;\n\n// Enhanced service worker registration with proper error handling and lifecycle management\nfunction registerServiceWorker() {\n    if (!('serviceWorker' in navigator)) {\n        console.warn('Service workers are not supported in this browser');\n        return;\n    }\n\n    if (!shouldRegisterServiceWorker()) {\n        return;\n    }\n\n    if (serviceWorkerRegistrationSetup) {\n        return;\n    }\n\n    serviceWorkerRegistrationSetup = true;\n\n    const startRegistration = async () => {\n        if (document.readyState !== 'complete') {\n            return;\n        }\n\n        window.removeEventListener('load', startRegistration);\n\n        try {\n            await initializeServiceWorker();\n        } catch (error) {\n            console.error('Service Worker initialization failed:', error);\n            showServiceWorkerError('Failed to initialize service worker. Some features may not work offline.');\n        }\n    };\n\n    window.addEventListener('load', startRegistration);\n    startRegistration();\n}\n\nfunction __resetServiceWorkerRegistrationForTest() {\n    serviceWorkerRegistrationSetup = false;\n}\n\n// Initialize the service worker and set up event handlers\nasync function initializeServiceWorker() {\n    try {\n        const registration = await navigator.serviceWorker.register(\n            SERVICE_WORKER_CONFIG.path,\n            { scope: SERVICE_WORKER_CONFIG.scope }\n        );\n\n        console.log('ServiceWorker registered successfully:', registration.scope);\n\n        // Set up update handling\n        setupUpdateHandling(registration);\n\n        // Set up periodic update checks\n        setupPeriodicUpdateCheck(registration);\n\n        // Handle controller changes\n        setupControllerChangeHandling();\n\n        // Set up offline/online detection\n        setupConnectivityHandling();\n\n    } catch (error) {\n        console.error('ServiceWorker registration failed:', error);\n        throw error;\n    }\n}\n\n// Set up handling for service worker updates\nfunction setupUpdateHandling(registration) {\n    registration.addEventListener('updatefound', () => {\n        const newWorker = registration.installing;\n        newWorker.addEventListener('statechange', () => {\n            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\n                // Immediately activate the new service worker without a prompt\n                newWorker.postMessage({ type: 'SKIP_WAITING' });\n            }\n        });\n    });\n}\n\n\n// Set up periodic checks for service worker updates\nfunction setupPeriodicUpdateCheck(registration) {\n    // Initial check\n    checkForUpdates(registration);\n\n    // Set up periodic checks\n    setInterval(() => {\n        checkForUpdates(registration);\n    }, SERVICE_WORKER_CONFIG.updateCheckInterval);\n}\n\n// Check for service worker updates\nasync function checkForUpdates(registration) {\n    try {\n        await registration.update();\n\n        // Check if product data needs updating\n        const response = await fetch('/data/product_data.json', { cache: 'no-store', headers: { 'Accept': 'application/json' } });\n\n        if (response.ok) {\n            const data = await response.json();\n            const currentVersion = data.version;\n            const storedVersion = localStorage.getItem('productDataVersion');\n\n            if (currentVersion !== storedVersion) {\n                registration.active?.postMessage({\n                    type: 'INVALIDATE_PRODUCT_CACHE'\n                });\n\n                localStorage.setItem('productDataVersion', currentVersion);\n                showUpdateNotification(null, 'New product data available');\n            }\n        }\n    } catch (error) {\n        console.warn('Update check failed:', error);\n    }\n}\n\n// Set up handling for service worker controller changes\nfunction setupControllerChangeHandling() {\n    let refreshing = false;\n    navigator.serviceWorker.addEventListener('controllerchange', () => {\n        if (!refreshing) {\n            refreshing = true;\n            window.location.reload();\n        }\n    });\n}\n\n// Set up handling for online/offline connectivity\nfunction setupConnectivityHandling() {\n    const offlineIndicator = document.getElementById('offline-indicator');\n    if (!offlineIndicator) {\n        return;\n    }\n    const updateOnlineStatus = () => {\n        const hidden = navigator.onLine;\n        offlineIndicator.classList.toggle(UTILITY_CLASSES.hidden, hidden);\n        offlineIndicator.classList.toggle(UTILITY_CLASSES.block, !hidden);\n\n        if (!hidden) {\n            showConnectivityNotification('You are currently offline. Some features may be limited.');\n        }\n    };\n\n    window.addEventListener('online', updateOnlineStatus);\n    window.addEventListener('offline', updateOnlineStatus);\n\n    if (!navigator.onLine) {\n        updateOnlineStatus();\n    }\n}\n\n// Notifications are lazy-loaded to reduce initial JS\nlet __notificationsModulePromise = null;\nfunction __loadNotifications() {\n    if (!__notificationsModulePromise) {\n        __notificationsModulePromise = import('./modules/notifications.mjs');\n    }\n    return __notificationsModulePromise;\n}\n\nfunction showUpdateNotification(serviceWorker, message = 'Una versi\u00F3n est\u00E1 disponible') {\n    __loadNotifications().then((m) => m.showUpdateNotification(serviceWorker, message));\n}\n\nfunction showServiceWorkerError(message) {\n    __loadNotifications().then((m) => m.showServiceWorkerError(message));\n}\n\nfunction showConnectivityNotification(message) {\n    __loadNotifications().then((m) => m.showConnectivityNotification(message));\n}\n\n// Initialize the service worker when running in a browser environment\nif (typeof navigator !== 'undefined' && 'serviceWorker' in navigator) {\n    registerServiceWorker();\n}\n\n\n// Utility functions\nconst isCacheableObject = (value) => (typeof value === 'object' && value !== null) || typeof value === 'function';\n\nconst createCacheNode = () => ({\n  map: new Map(),\n  weakMap: new WeakMap(),\n  hasValue: false,\n  value: undefined\n});\n\nconst memoize = (fn, cacheSize = 100) => {\n  if (typeof fn !== 'function') {\n    throw new TypeError('Expected a function to memoize');\n  }\n\n  if (!Number.isFinite(cacheSize) || cacheSize < 0) {\n    cacheSize = 0;\n  }\n\n  const root = createCacheNode();\n  const lru = [];\n\n  const touch = (node) => {\n    const index = lru.indexOf(node);\n    if (index !== -1) {\n      lru.splice(index, 1);\n    }\n    if (cacheSize > 0) {\n      lru.push(node);\n    }\n  };\n\n  const evictIfNeeded = () => {\n    if (cacheSize === 0) {\n      return;\n    }\n    while (lru.length > cacheSize) {\n      const oldest = lru.shift();\n      if (!oldest) {\n        continue;\n      }\n      oldest.hasValue = false;\n      oldest.value = undefined;\n    }\n  };\n\n  const getChildNode = (node, arg) => {\n    const useWeakMap = isCacheableObject(arg);\n    if (useWeakMap) {\n      let next = node.weakMap.get(arg);\n      if (!next) {\n        next = createCacheNode();\n        node.weakMap.set(arg, next);\n      }\n      return next;\n    }\n    if (!node.map.has(arg)) {\n      node.map.set(arg, createCacheNode());\n    }\n    return node.map.get(arg);\n  };\n\n  return (...args) => {\n    if (cacheSize === 0) {\n      return fn(...args);\n    }\n    let node = root;\n    for (let i = 0; i < args.length; i += 1) {\n      node = getChildNode(node, args[i]);\n    }\n    if (node.hasValue) {\n      touch(node);\n      return node.value;\n    }\n    const result = fn(...args);\n    node.value = result;\n    node.hasValue = true;\n    touch(node);\n    evictIfNeeded();\n    return result;\n  };\n};\n\nconst debounce = (func, delay) => {\n    let timeoutId;\n    return (...args) => {\n        clearTimeout(timeoutId);\n        timeoutId = setTimeout(() => func(...args), delay);\n    };\n};\n\nconst scheduleIdle = (fn, timeout = 500) => {\n    if (typeof window !== 'undefined' && typeof window.requestIdleCallback === 'function') {\n        const handle = window.requestIdleCallback(fn, { timeout });\n        return { type: 'idle', handle };\n    }\n    const handle = setTimeout(fn, 0);\n    return { type: 'timeout', handle };\n};\n\nconst cancelScheduledIdle = (token) => {\n    if (!token) return;\n    if (token.type === 'idle' && typeof window !== 'undefined' && typeof window.cancelIdleCallback === 'function') {\n        window.cancelIdleCallback(token.handle);\n    } else if (token.type === 'timeout') {\n        clearTimeout(token.handle);\n    }\n};\n\n// Normalize strings for robust comparisons (remove accents, spaces, punctuation, lowercased)\nconst normalizeString = (str) => {\n    if (!str) return '';\n    try {\n        return String(str)\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .replace(/[^a-zA-Z0-9]/g, '')\n            .toLowerCase();\n    } catch {\n        return String(str).toLowerCase();\n    }\n};\n\n\n\n// Add this utility function for generating stable product IDs\nconst DEFAULT_CATEGORY = 'General';\nconst DEFAULT_PRODUCT_NAME_PREFIX = 'Producto';\n\nconst generateStableId = (product, index = 0) => {\n    const hasValidShape = product && typeof product === 'object';\n    const rawName = hasValidShape && typeof product.name === 'string' ? product.name.trim() : '';\n    const rawCategory = hasValidShape && typeof product.category === 'string' ? product.category.trim() : '';\n\n    const safeName = rawName.length > 0 ? rawName : `${DEFAULT_PRODUCT_NAME_PREFIX}-${index + 1}`;\n    const safeCategory = rawCategory.length > 0 ? rawCategory : DEFAULT_CATEGORY;\n\n    const baseString = `${safeName}-${safeCategory}`.toLowerCase();\n\n    let hash = 0;\n    for (let i = 0; i < baseString.length; i += 1) {\n        const charCode = baseString.charCodeAt(i);\n        hash = ((hash << 5) - hash) + charCode;\n        hash &= hash; // Convert to 32-bit integer\n    }\n\n    const needsFallbackSuffix = rawName.length === 0 || rawCategory.length === 0;\n    const suffix = needsFallbackSuffix ? `-${index}` : '';\n\n    return `pid-${Math.abs(hash)}${suffix}`;\n};\n\nconst sanitizeHTML = (unsafe) => {\n    const element = document.createElement('div');\n    element.textContent = unsafe;\n    return element.innerHTML;\n};\n\nconst INLINE_PRODUCT_SCRIPT_ID = 'product-data';\n\nconst getStoredProductVersion = () => {\n    try {\n        if (typeof localStorage === 'undefined') {\n            return null;\n        }\n        return localStorage.getItem('productDataVersion');\n    } catch (error) {\n        console.warn('Unable to read stored product data version:', error);\n        return null;\n    }\n};\n\nconst setStoredProductVersion = (version) => {\n    if (!version) {\n        return;\n    }\n    try {\n        if (typeof localStorage === 'undefined') {\n            return;\n        }\n        localStorage.setItem('productDataVersion', version);\n    } catch (error) {\n        console.warn('Unable to persist product data version:', error);\n    }\n};\n\nconst parseInlineProductData = () => {\n    if (typeof document === 'undefined') {\n        return null;\n    }\n    try {\n        const script = document.getElementById(INLINE_PRODUCT_SCRIPT_ID);\n        if (!script || !script.textContent) {\n            return null;\n        }\n        const payload = script.textContent.trim();\n        if (!payload) {\n            return null;\n        }\n        const parsed = JSON.parse(payload);\n        if (!parsed) {\n            return null;\n        }\n        if (Array.isArray(parsed.initialProducts)) {\n            return parsed;\n        }\n        if (Array.isArray(parsed.products)) {\n            return { ...parsed, initialProducts: parsed.products };\n        }\n        return null;\n    } catch (error) {\n        log('warn', 'inline_product_parse_failure', { error: error.message });\n        return null;\n    }\n};\n\nconst transformProduct = (product, index) => {\n    if (!product || typeof product !== 'object') {\n        return null;\n    }\n\n    const id = typeof product.id === 'string' && product.id.trim().length > 0\n        ? product.id.trim()\n        : generateStableId(product, index);\n\n    const originalIndex = typeof product.originalIndex === 'number'\n        ? product.originalIndex\n        : typeof product.order === 'number'\n            ? product.order\n            : index;\n\n    const safeName = typeof product.name === 'string' && product.name.trim().length > 0\n        ? product.name\n        : `${DEFAULT_PRODUCT_NAME_PREFIX} ${index + 1}`;\n\n    const safeDescription = typeof product.description === 'string' ? product.description : '';\n    const safeCategory = typeof product.category === 'string' && product.category.trim().length > 0\n        ? product.category\n        : DEFAULT_CATEGORY;\n    const safeImagePath = typeof product.image_path === 'string' ? product.image_path : '';\n    const safeImageAvifPath = typeof product.image_avif_path === 'string' ? product.image_avif_path : '';\n\n    return {\n        ...product,\n        id,\n        name: sanitizeHTML(safeName),\n        description: sanitizeHTML(safeDescription),\n        category: sanitizeHTML(safeCategory),\n        categoryKey: product.categoryKey || normalizeString(safeCategory),\n        image_path: safeImagePath,\n        image_avif_path: safeImageAvifPath,\n        originalIndex\n    };\n};\n\nconst transformProducts = (products = []) => products\n    .map((product, index) => transformProduct(product, index))\n    .filter(Boolean);\n\nfunction hydrateSharedProductDataFromInline() {\n    const existing = getSharedProductData();\n    if (existing) {\n        return existing;\n    }\n    const inlineData = parseInlineProductData();\n    if (!inlineData || !Array.isArray(inlineData.initialProducts)) {\n        return null;\n    }\n    const transformed = transformProducts(inlineData.initialProducts);\n    return ensureSharedProductData(transformed, {\n        version: inlineData.version || null,\n        source: 'inline',\n        isPartial: true,\n        total: typeof inlineData.totalProducts === 'number' ? inlineData.totalProducts : transformed.length\n    });\n}\n\nhydrateSharedProductDataFromInline();\n\nclass ProductDataError extends Error {\n    constructor(message, { cause, correlationId }) {\n        super(message);\n        this.name = 'ProductDataError';\n        this.correlationId = correlationId;\n        if (cause) this.cause = cause;\n    }\n}\n\nconst fetchWithRetry = async (url, opts, retries, backoffMs, correlationId) => {\n    const parsed = new URL(url, window.location.origin);\n    if (parsed.origin !== window.location.origin || parsed.protocol !== 'https:') {\n        throw new Error('Invalid request URL: only same-origin HTTPS requests are allowed');\n    }\n    const sanitizedUrl = parsed.toString();\n    let attempt = 0;\n    let lastError;\n    while (attempt <= retries) {\n        try {\n            const start = Date.now();\n            const response = await fetch(sanitizedUrl, opts);\n            const durationMs = Date.now() - start;\n            log('info', 'fetch_products_attempt', { correlationId, attempt: attempt + 1, durationMs });\n            if (!response.ok) {\n                throw new Error(`HTTP error. Status: ${response.status}`);\n            }\n            return response;\n        } catch (err) {\n            lastError = err;\n            attempt++;\n            if (attempt > retries) break;\n            log('warn', 'fetch_products_retry', { correlationId, attempt, error: err.message, runbook: 'RUNBOOK.md#product-data' });\n            await new Promise(resolve => setTimeout(resolve, backoffMs * attempt));\n        }\n    }\n    throw new ProductDataError(`Failed to fetch products: ${lastError.message}`, { cause: lastError, correlationId });\n};\n\n// Modify the fetchProducts function\nconst fetchProducts = async () => {\n    const correlationId = createCorrelationId();\n    const inlineData = parseInlineProductData();\n    const inlineSource = inlineData?.initialProducts || null;\n    const inlineVersion = inlineData?.version || null;\n    const inlineTotal = typeof inlineData?.totalProducts === 'number' ? inlineData.totalProducts : null;\n    const inlineProducts = Array.isArray(inlineSource) ? transformProducts(inlineSource) : null;\n    const hasInlineProducts = Array.isArray(inlineProducts);\n    const storedVersion = getStoredProductVersion();\n\n    if (hasInlineProducts) {\n        if (inlineVersion) {\n            setStoredProductVersion(inlineVersion);\n        }\n        ensureSharedProductData(inlineProducts, {\n            version: inlineVersion || null,\n            source: 'inline',\n            isPartial: true,\n            total: inlineTotal ?? inlineProducts.length\n        });\n        log('info', 'fetch_products_inline_bootstrap', { correlationId, count: inlineProducts.length });\n    }\n\n    const versionForUrl = storedVersion || inlineVersion || null;\n    const url = versionForUrl ? `/data/product_data.json?v=${encodeURIComponent(versionForUrl)}` : '/data/product_data.json';\n\n    try {\n        const response = await fetchWithRetry(\n            url,\n            { cache: 'no-store', headers: { 'Accept': 'application/json' } },\n            2,\n            300,\n            correlationId\n        );\n        const data = await response.json();\n        const transformed = transformProducts(data.products || []);\n        overwriteSharedProductData(transformed, {\n            version: data.version || null,\n            source: 'network',\n            isPartial: false,\n            total: transformed.length\n        });\n        if (data.version) {\n            setStoredProductVersion(data.version);\n        }\n        log('info', 'fetch_products_success', { correlationId, count: transformed.length, source: 'network' });\n        return transformed;\n    } catch (error) {\n        if (hasInlineProducts) {\n            ensureSharedProductData(inlineProducts, {\n                version: inlineVersion || null,\n                source: 'inline-fallback',\n                isPartial: true,\n                total: inlineTotal ?? inlineProducts.length\n            });\n            log('warn', 'fetch_products_network_fallback_inline', { correlationId, error: error.message, runbook: 'RUNBOOK.md#product-data' });\n            return inlineProducts;\n        }\n        log('error', 'fetch_products_failure', { correlationId, error: error.message, runbook: 'RUNBOOK.md#product-data' });\n        showErrorMessage(`Error al cargar los productos. Por favor, verifique su conexi\u00F3n a internet e int\u00E9ntelo de nuevo. (Error: ${error.message})`);\n        if (error instanceof ProductDataError) {\n            throw error;\n        }\n        throw new ProductDataError(error.message, { cause: error, correlationId });\n    }\n};\n\nconst createSafeElement = (tag, attributes = {}, children = []) => {\n    const element = document.createElement(tag);\n    Object.entries(attributes).forEach(([key, value]) => {\n        if (key === 'text') {\n            element.textContent = value;\n        } else {\n            element.setAttribute(key, value);\n        }\n    });\n    children.forEach(child => {\n        if (typeof child === 'string') {\n            element.appendChild(document.createTextNode(child));\n        } else {\n            element.appendChild(child);\n        }\n    });\n    return element;\n};\n\nconst createProductPicture = ({ imagePath, avifPath, alt, eager = false }) => {\n    const sizes = PRODUCT_IMAGE_SIZES;\n    const pictureChildren = [];\n    const avifSrcset = resolveAvifSrcset(avifPath);\n    if (avifSrcset) {\n        pictureChildren.push(createSafeElement('source', {\n            type: 'image/avif',\n            srcset: avifSrcset,\n            sizes\n        }));\n    }\n    const fallbackSrc = buildCfSrc(imagePath, { width: 320 }) || normaliseAssetPath(imagePath);\n    const fallbackSrcset = buildCfSrcset(imagePath);\n    const imgAttrs = {\n        src: fallbackSrc || '',\n        alt: alt || '',\n        class: 'card-img-top product-thumb',\n        loading: eager ? 'eager' : 'lazy',\n        fetchpriority: eager ? 'high' : 'auto',\n        decoding: 'async',\n        width: '400',\n        height: '400',\n        sizes\n    };\n    if (fallbackSrcset) {\n        imgAttrs.srcset = fallbackSrcset;\n    }\n    const imgElement = createSafeElement('img', imgAttrs);\n    pictureChildren.push(imgElement);\n    return createSafeElement('picture', {}, pictureChildren);\n};\n\nconst createCartThumbnail = ({ imagePath, avifPath, alt }) => {\n    const sizes = '100px';\n    const sources = [];\n    const avifSrcset = resolveAvifSrcset(avifPath, CART_IMAGE_WIDTHS);\n    if (avifSrcset) {\n        sources.push(createSafeElement('source', {\n            type: 'image/avif',\n            srcset: avifSrcset,\n            sizes\n        }));\n    }\n    const fallbackSrc = buildCfSrc(imagePath, { width: CART_IMAGE_WIDTHS[1] }) || normaliseAssetPath(imagePath);\n    const fallbackSrcset = buildCfSrcset(imagePath, {}, CART_IMAGE_WIDTHS);\n    const imgAttrs = {\n        src: fallbackSrc || '',\n        alt: alt || '',\n        class: 'cart-item-thumb-img',\n        loading: 'lazy',\n        decoding: 'async',\n        width: '100',\n        height: '100',\n        sizes\n    };\n    if (fallbackSrcset) {\n        imgAttrs.srcset = fallbackSrcset;\n    }\n    const imgElement = createSafeElement('img', imgAttrs);\n    return createSafeElement('picture', {}, [...sources, imgElement]);\n};\n\nconst showErrorMessage = (message) => {\n    const errorMessage = createSafeElement('div', { class: 'error-message', role: 'alert' }, [\n        createSafeElement('p', {}, [message]),\n        createSafeElement('button', { class: 'retry-button' }, ['Intentar nuevamente'])\n    ]);\n    const productContainer = document.getElementById('product-container');\n    if (productContainer) {\n        productContainer.innerHTML = '';\n        productContainer.appendChild(errorMessage);\n        errorMessage.querySelector('.retry-button').addEventListener('click', initApp);\n    } else {\n        console.error('Contenedor de productos no encontrado');\n    }\n};\n\n// Basic cart helpers (exposed for tests)\nlet cart = [];\ntry {\n    cart = JSON.parse(globalThis.localStorage?.getItem('cart')) || [];\n} catch {\n    cart = [];\n}\n\nconst getCartItemQuantity = (productId) => {\n    const item = cart.find(item => item.id === productId);\n    return item ? item.quantity : 0;\n};\n\nconst updateCartIcon = () => {\n    const cartCount = document.getElementById('cart-count');\n    const totalItems = cart.reduce((total, item) => total + item.quantity, 0);\n    if (cartCount) {\n        if (cartCount.dataset.initialized !== '1') {\n            cartCount.dataset.initialized = '1';\n        }\n        cartCount.textContent = String(totalItems);\n        cartCount.setAttribute('aria-label', `${totalItems} items in cart`);\n    }\n};\n\nconst saveCart = () => {\n    try {\n        globalThis.localStorage?.setItem('cart', JSON.stringify(cart));\n    } catch (error) {\n        console.error('Error al guardar el carrito:', error);\n        showErrorMessage('Error al guardar el carrito. Tus cambios podr\u00EDan no persistir.');\n    }\n};\n\nconst logPerformanceMetrics = (perf = (typeof window !== 'undefined' ? window.performance : undefined)) => {\n    let fcpValue = 'unavailable';\n    let domContentLoadedValue = 'unavailable';\n    let loadTimeValue = 'unavailable';\n\n    try {\n        if (!perf || typeof perf.getEntriesByType !== 'function') {\n            return;\n        }\n\n        const paintEntries = perf.getEntriesByType('paint') || [];\n        const navigationEntries = perf.getEntriesByType('navigation') || [];\n\n        const fcpEntry = paintEntries.find(entry => entry?.name === 'first-contentful-paint') || paintEntries[0];\n        if (fcpEntry && typeof fcpEntry.startTime === 'number') {\n            fcpValue = fcpEntry.startTime;\n        }\n\n        const navigationEntry = navigationEntries[0];\n        if (navigationEntry && typeof navigationEntry.domContentLoadedEventEnd === 'number') {\n            domContentLoadedValue = navigationEntry.domContentLoadedEventEnd;\n        } else if (perf.timing && typeof perf.timing.domContentLoadedEventEnd === 'number') {\n            domContentLoadedValue = perf.timing.domContentLoadedEventEnd;\n        }\n\n        if (navigationEntry && typeof navigationEntry.loadEventEnd === 'number') {\n            loadTimeValue = navigationEntry.loadEventEnd;\n        } else if (perf.timing && typeof perf.timing.loadEventEnd === 'number') {\n            loadTimeValue = perf.timing.loadEventEnd;\n        }\n    } catch (error) {\n        console.warn('Performance metrics unavailable:', error);\n    } finally {\n        console.log('First Contentful Paint:', fcpValue);\n        console.log('DOM Content Loaded:', domContentLoadedValue);\n        console.log('Load Time:', loadTimeValue);\n    }\n};\n\nconst toggleActionArea = (btn, quantityControl, showQuantity) => {\n    if (!btn || !quantityControl) return;\n    const showButton = !showQuantity;\n    btn.classList.toggle(UTILITY_CLASSES.hidden, !showButton);\n    btn.classList.toggle(UTILITY_CLASSES.flex, showButton);\n\n    quantityControl.classList.toggle(UTILITY_CLASSES.hidden, !showQuantity);\n    quantityControl.classList.toggle(UTILITY_CLASSES.flex, showQuantity);\n};\n\nconst renderCart = () => {\n    const cartItems = document.getElementById('cart-items');\n    const cartTotal = document.getElementById('cart-total');\n    if (!cartItems || !cartTotal) return;\n    cartItems.innerHTML = '';\n    let total = 0;\n    cart.forEach(item => {\n        const discounted = item.price - (item.discount || 0);\n        const itemEl = createSafeElement('div', { class: 'cart-item', 'data-id': item.id });\n        itemEl.appendChild(createSafeElement('span', { class: 'item-quantity' }, [item.quantity.toString()]));\n        cartItems.appendChild(itemEl);\n        total += discounted * item.quantity;\n    });\n    cartTotal.textContent = `$${total.toLocaleString('es-CL')}`;\n};\n\nconst addToCart = (product, quantity) => {\n    try {\n        const existingItem = cart.find(item => item.id === product.id);\n        if (existingItem) {\n            existingItem.quantity = Math.min(existingItem.quantity + quantity, 50);\n        } else {\n            cart.push({\n                id: product.id,\n                name: product.name,\n                description: product.description,\n                price: product.price,\n                discount: product.discount,\n                image_path: product.image_path,\n                image_avif_path: product.image_avif_path,\n                quantity: Math.min(quantity, 50),\n                category: product.category,\n                stock: product.stock\n            });\n        }\n        saveCart();\n        updateCartIcon();\n        renderCart();\n        try { if (typeof window !== 'undefined' && typeof window.__analyticsTrack === 'function') window.__analyticsTrack('add_to_cart', { id: product.id, q: quantity, price: product.price }); } catch {}\n        const quantityInput = document.querySelector(`[data-id=\"${product.id}\"].quantity-input`);\n        if (quantityInput) {\n            quantityInput.value = Math.max(getCartItemQuantity(product.id), 1);\n        }\n    } catch (error) {\n        console.error('Error al agregar al carrito:', error);\n        showErrorMessage('Error al agregar el art\u00EDculo al carrito. Por favor, intenta nuevamente.');\n    }\n};\n\nconst removeFromCart = (productId) => {\n    try {\n        cart = cart.filter(item => item.id !== productId);\n        saveCart();\n        updateCartIcon();\n        renderCart();\n        try { if (typeof window !== 'undefined' && typeof window.__analyticsTrack === 'function') window.__analyticsTrack('remove_from_cart', { id: productId }); } catch {}\n        const actionArea = document.querySelector(`.action-area[data-pid=\"${productId}\"]`);\n        if (actionArea) {\n            const btn = actionArea.querySelector('.add-to-cart-btn');\n            const qc = actionArea.querySelector('.quantity-control');\n            toggleActionArea(btn, qc, false);\n        }\n    } catch (error) {\n        console.error('Error al eliminar del carrito:', error);\n        showErrorMessage('Error al eliminar el art\u00EDculo del carrito. Por favor, intenta nuevamente.');\n    }\n};\n\nconst updateQuantity = (product, change) => {\n    try {\n        const item = cart.find(item => item.id === product.id);\n        const newQuantity = item ? item.quantity + change : 1;\n        const actionArea = document.querySelector(`.action-area[data-pid=\"${product.id}\"]`);\n        const btn = actionArea?.querySelector('.add-to-cart-btn');\n        const qc = actionArea?.querySelector('.quantity-control');\n\n        if (newQuantity <= 0) {\n            removeFromCart(product.id);\n            toggleActionArea(btn, qc, false);\n        } else if (newQuantity <= 50) {\n            if (item) {\n                item.quantity = newQuantity;\n            } else {\n                addToCart(product, 1);\n                toggleActionArea(btn, qc, true);\n            }\n            saveCart();\n            updateCartIcon();\n            renderCart();\n\n            const quantityInput = document.querySelector(`[data-id=\"${product.id}\"].quantity-input`);\n            if (quantityInput) {\n                quantityInput.value = newQuantity;\n                quantityInput.classList.add('quantity-changed');\n                setTimeout(() => quantityInput.classList.remove('quantity-changed'), 300);\n            }\n        }\n    } catch (error) {\n        console.error('Error al actualizar cantidad:', error);\n        showErrorMessage('Error al actualizar la cantidad. Por favor, intenta nuevamente.');\n    }\n};\n\nconst emptyCart = () => {\n    try {\n        cart = [];\n        saveCart();\n        updateCartIcon();\n        renderCart();\n        if (typeof updateProductDisplay === 'function') {\n            updateProductDisplay();\n        }\n    } catch (error) {\n        console.error('Error al vaciar el carrito:', error);\n        showErrorMessage('Error al vaciar el carrito. Por favor, int\u00E9ntelo de nuevo.');\n    }\n};\n\n// Global error handling: be conservative during initial render\nif (typeof window !== 'undefined') {\n    window.__APP_READY__ = false;\n\n    window.addEventListener('error', (event) => {\n        const target = event.target || event.srcElement;\n        const isResourceError = !!(target && (\n            target.tagName === 'IMG' ||\n            target.tagName === 'SCRIPT' ||\n            target.tagName === 'LINK'\n        ));\n        const hasRuntimeError = !!event.error;\n\n        // Ignore resource errors and non-runtime errors\n        if (isResourceError || !hasRuntimeError) {\n            console.warn('Ignored non-fatal error:', {\n                tag: target && target.tagName,\n                src: target && (target.src || target.href || target.currentSrc)\n            });\n            return;\n        }\n\n        // Only show banner after the app is ready; otherwise just log\n        if (!window.__APP_READY__) {\n            console.error('Runtime error before app ready:', event.error);\n            return;\n        }\n        console.error('Unhandled JS error:', event.error);\n        showErrorMessage('Ocurri\u00F3 un error inesperado. Por favor, recarga la p\u00E1gina.');\n    });\n\n    // Avoid noisy CSP warnings breaking UX\n    window.addEventListener('securitypolicyviolation', (e) => {\n        console.warn('CSP violation (logged only):', {\n            blockedURI: e.blockedURI,\n            violatedDirective: e.violatedDirective,\n            sourceFile: e.sourceFile,\n        });\n    });\n}\n\n// Main function to initialize the application\nconst initApp = async () => {\n    console.log('Initializing app...');\n\n    const productContainer = document.getElementById('product-container');\n    const sortOptions = document.getElementById('sort-options');\n    const filterKeyword = document.getElementById('filter-keyword');\n    const cartCountElement = document.getElementById('cart-count');\n    const cartItemsElement = document.getElementById('cart-items');\n    const cartTotalElement = document.getElementById('cart-total');\n\n    const essentialElements = {\n        '#product-container': productContainer,\n        '#sort-options': sortOptions,\n        '#filter-keyword': filterKeyword,\n        '#cart-count': cartCountElement,\n        '#cart-items': cartItemsElement,\n        '#cart-total': cartTotalElement\n    };\n\n    const missingSelectors = Object.entries(essentialElements)\n        .filter(([, element]) => !element)\n        .map(([selector]) => selector);\n\n    if (missingSelectors.length) {\n        log('warn', 'init_app_missing_dom', {\n            missingSelectors,\n            location: typeof window !== 'undefined' ? window.location?.pathname : 'unknown'\n        });\n        return;\n    }\n\n    // Ensure discount-only toggle exists in the filter UI\n    const ensureDiscountToggle = () => {\n        let toggle = document.getElementById('filter-discount');\n        if (toggle) return toggle;\n\n        const filterSection = document.querySelector('section[aria-label*=\"filtrado\"], section[aria-label*=\"Opciones de filtrado\"]');\n        const filterSectionRow = filterSection ? filterSection.querySelector('.row') : null;\n        if (!filterSectionRow) return null;\n\n        const col = createSafeElement('div', { class: 'col-12 mt-2' });\n        const formCheck = createSafeElement('div', { class: 'form-check form-switch' });\n        const input = createSafeElement('input', {\n            class: 'form-check-input',\n            type: 'checkbox',\n            id: 'filter-discount',\n            'aria-label': 'Mostrar solo productos con descuento'\n        });\n        const label = createSafeElement('label', { class: 'form-check-label', for: 'filter-discount' }, ['Solo productos con descuento']);\n        formCheck.appendChild(input);\n        formCheck.appendChild(label);\n        col.appendChild(formCheck);\n        filterSectionRow.appendChild(col);\n        return input;\n    };\n\n    const INITIAL_BATCH_FALLBACK = 12;\n    const SUBSEQUENT_BATCH_SIZE = 12;\n\n    let products = [];\n    let filteredProducts = [];\n    let visibleCount = 0;\n    let initialBatchSize = INITIAL_BATCH_FALLBACK;\n    let loadMoreButton = null;\n    let catalogSentinel = null;\n    let sentinelObserver = null;\n    let userHasInteracted = false;\n    let cart = JSON.parse(localStorage.getItem('cart')) || [];\n\n    const updateOnlineStatus = () => {\n        const offlineIndicator = document.getElementById('offline-indicator');\n        if (offlineIndicator) {\n            const hidden = navigator.onLine;\n            offlineIndicator.classList.toggle(UTILITY_CLASSES.hidden, hidden);\n            offlineIndicator.classList.toggle(UTILITY_CLASSES.block, !hidden);\n        }\n        if (!navigator.onLine) {\n            console.log('App is offline. Using cached data if available.');\n        }\n    };\n\n    function initFooter() {\n        const yearSpan = document.getElementById('current-year');\n        if (yearSpan) {\n            yearSpan.textContent = new Date().getFullYear();\n        }\n    }\n\n    const DEFAULT_CURRENCY_CODE = 'CLP';\n    let hasLoggedCurrencyFallback = false;\n\n    const normalizeCurrencyCode = (currencyCode) => {\n        if (typeof currencyCode !== 'string') {\n            return DEFAULT_CURRENCY_CODE;\n        }\n        const trimmed = currencyCode.trim().toUpperCase();\n        if (/^[A-Z]{3}$/.test(trimmed)) {\n            return trimmed;\n        }\n        return DEFAULT_CURRENCY_CODE;\n    };\n\n    const createCurrencyFormatter = (currencyCode) => {\n        const fallbackCode = normalizeCurrencyCode(currencyCode);\n        try {\n            return new Intl.NumberFormat('es-CL', {\n                style: 'currency',\n                currency: fallbackCode,\n                minimumFractionDigits: 0\n            });\n        } catch (error) {\n            if (!hasLoggedCurrencyFallback) {\n                console.warn('Falling back to CLP currency formatter', { error, currencyCode });\n                hasLoggedCurrencyFallback = true;\n            }\n            return new Intl.NumberFormat('es-CL', {\n                style: 'currency',\n                currency: DEFAULT_CURRENCY_CODE,\n                minimumFractionDigits: 0\n            });\n        }\n    };\n\n    const renderPriceHtml = (price, discount, currencyCode = DEFAULT_CURRENCY_CODE) => {\n        const numericPrice = Number(price) || 0;\n        const numericDiscount = Number(discount) || 0;\n        const formatter = createCurrencyFormatter(currencyCode);\n\n        const formattedPrice = formatter.format(numericPrice);\n\n        if (numericDiscount) {\n            const discountedPrice = Math.max(numericPrice - numericDiscount, 0);\n            const formattedDiscountedPrice = formatter.format(discountedPrice);\n\n            return createSafeElement('div', { class: 'precio-container' }, [\n                createSafeElement(\n                    'span',\n                    { class: 'precio-descuento', 'aria-label': 'Precio con descuento' },\n                    [formattedDiscountedPrice]\n                ),\n                createSafeElement(\n                    'span',\n                    { class: 'precio-original', 'aria-label': 'Precio original' },\n                    [\n                        createSafeElement(\n                            'span',\n                            { class: 'tachado' },\n                            [formattedPrice]\n                        )\n                    ]\n                )\n            ]);\n        }\n\n        return createSafeElement('div', { class: 'precio-container' }, [\n            createSafeElement(\n                'span',\n                { class: 'precio', 'aria-label': 'Precio' },\n                [formattedPrice]\n            )\n        ]);\n    };\n\n\nconst renderQuantityControl = (product) => {\n        const quantityControl = createSafeElement('div', {\n            class: `quantity-control ${UTILITY_CLASSES.hidden}`,\n            role: 'group',\n            'aria-label': 'Seleccionar cantidad',\n            'aria-live': 'polite'\n        });\n        const minusBtn = createSafeElement('button', {\n            class: 'quantity-btn',\n            type: 'button',\n            'data-action': 'decrease',\n            'aria-label': 'Decrease quantity'\n        }, ['-']);\n        const plusBtn = createSafeElement('button', {\n            class: 'quantity-btn',\n            type: 'button',\n            'data-action': 'increase',\n            'aria-label': 'Increase quantity'\n        }, ['+']);\n        const input = createSafeElement('input', {\n            type: 'number',\n            class: 'quantity-input',\n            value: Math.max(getCartItemQuantity(product.id), 1),\n            min: '1',\n            max: '50',\n            'aria-label': 'Quantity',\n            'data-id': product.id\n        });\n\n        quantityControl.appendChild(minusBtn);\n        quantityControl.appendChild(input);\n        quantityControl.appendChild(plusBtn);\n\n        return quantityControl;\n    };\n\n    function setupActionArea(actionArea, product) {\n        if (!actionArea) {\n            return;\n        }\n        const addToCartBtn = actionArea.querySelector('.add-to-cart-btn');\n        const quantityControl = actionArea.querySelector('.quantity-control');\n        const quantityInput = quantityControl?.querySelector('.quantity-input');\n        const minusBtn = quantityControl?.querySelector('.quantity-btn[data-action=\"decrease\"]') || quantityControl?.querySelector('.quantity-btn');\n        const plusBtn = quantityControl?.querySelector('.quantity-btn[data-action=\"increase\"]') || quantityControl?.querySelectorAll('.quantity-btn')?.[1];\n\n        const bind = (element, event, handler) => {\n            if (!element) {\n                return;\n            }\n            if (element.dataset.listenerAttached === 'true') {\n                return;\n            }\n            element.addEventListener(event, handler);\n            element.dataset.listenerAttached = 'true';\n        };\n\n        bind(addToCartBtn, 'click', () => {\n            addToCart(product, 1);\n            toggleActionArea(addToCartBtn, quantityControl, true);\n        });\n\n        bind(minusBtn, 'click', () => updateQuantity(product, -1));\n        bind(plusBtn, 'click', () => updateQuantity(product, 1));\n        bind(quantityInput, 'change', (event) => {\n            const newQuantity = parseInt(event.target.value, 10);\n            if (!Number.isFinite(newQuantity)) {\n                event.target.value = Math.max(getCartItemQuantity(product.id), 1);\n                return;\n            }\n            const currentQuantity = getCartItemQuantity(product.id);\n            updateQuantity(product, newQuantity - currentQuantity);\n        });\n\n        const currentQuantity = getCartItemQuantity(product.id);\n        if (quantityInput) {\n            quantityInput.value = currentQuantity > 0 ? currentQuantity : 1;\n        }\n        toggleActionArea(addToCartBtn, quantityControl, currentQuantity > 0);\n    }\n\n    const getCartItemQuantity = (productId) => {\n        const item = cart.find(item => item.id === productId);\n        return item ? item.quantity : 0;\n    };\n\n    const renderProducts = (productsToRender, { reset = false } = {}) => {\n        if (!productContainer) {\n            return 0;\n        }\n        if (reset) {\n            productContainer.innerHTML = '';\n        }\n\n        const fragment = document.createDocumentFragment();\n\n        productsToRender.forEach(product => {\n            const { id, name, description, image_path, image_avif_path, price, discount, stock } = product;\n\n            const productClasses = [\n                'producto',\n                'col-12',\n                'col-sm-6',\n                'col-md-4',\n                'col-lg-3',\n                'mb-4',\n                !stock ? 'agotado' : '',\n                UTILITY_CLASSES.contentVisible,\n                UTILITY_CLASSES.containIntrinsic\n            ].filter(Boolean).join(' ');\n\n            const titleId = `product-title-${id}`;\n            const productElement = createSafeElement('article', {\n                class: productClasses,\n                'data-product-id': id,\n                'aria-labelledby': titleId\n            });\n\n            const cardElement = createSafeElement('div', { class: 'card h-100' });\n\n            if (discount && Number(discount) > 0) {\n                const pct = Math.round((Number(discount) / Number(price)) * 100);\n                const badge = createSafeElement('span', { class: 'discount-badge badge bg-danger', 'aria-label': 'Producto en oferta' }, [`-${isFinite(pct) ? pct : 0}%`]);\n                cardElement.appendChild(badge);\n            }\n\n            const pictureElement = createProductPicture({\n                imagePath: image_path,\n                avifPath: image_avif_path,\n                alt: name,\n                eager: false\n            });\n            cardElement.appendChild(pictureElement);\n\n            const cardBody = createSafeElement('div', { class: 'card-body d-flex flex-column' });\n            cardBody.appendChild(createSafeElement('h3', { class: 'card-title mb-2', id: titleId }, [name]));\n            cardBody.appendChild(createSafeElement('p', { class: 'card-text mb-3' }, [description]));\n            const priceContainer = renderPriceHtml(price, discount);\n            priceContainer.classList.add('mb-3');\n            cardBody.appendChild(priceContainer);\n\n            const actionArea = createSafeElement('div', {\n                class: 'action-area mt-auto',\n                'data-pid': id,\n                role: 'group',\n                'aria-label': `Acciones de compra para ${name}`\n            });\n            const addToCartBtn = createSafeElement('button', {\n                class: 'btn btn-primary add-to-cart-btn mt-2',\n                type: 'button',\n                'data-id': id,\n                'aria-label': `Add ${name} to cart`\n            }, ['Agregar al carrito']);\n            const quantityControl = renderQuantityControl(product);\n\n            actionArea.appendChild(addToCartBtn);\n            actionArea.appendChild(quantityControl);\n            cardBody.appendChild(actionArea);\n\n            setupActionArea(actionArea, product);\n\n            cardElement.appendChild(cardBody);\n            productElement.appendChild(cardElement);\n            fragment.appendChild(productElement);\n        });\n\n        productContainer.appendChild(fragment);\n        lazyLoadImages();\n        return productsToRender.length;\n    };\n\n    const hydratePreRenderedProducts = (productList) => {\n        if (!productContainer) {\n            return 0;\n        }\n        const cards = productContainer.querySelectorAll('[data-product-id]');\n        if (!cards.length) {\n            return 0;\n        }\n        const map = new Map(productList.map(item => [item.id, item]));\n        let hydrated = 0;\n        cards.forEach(card => {\n            const productId = card.getAttribute('data-product-id');\n            if (!productId || !map.has(productId)) {\n                return;\n            }\n            const product = map.get(productId);\n            card.classList.add(UTILITY_CLASSES.contentVisible, UTILITY_CLASSES.containIntrinsic);\n            const actionArea = card.querySelector('.action-area');\n            setupActionArea(actionArea, product);\n            hydrated += 1;\n        });\n        return hydrated;\n    };\n\n    const resetProductList = () => {\n        if (productContainer) {\n            productContainer.innerHTML = '';\n        }\n        visibleCount = 0;\n    };\n\n    const applyFilters = () => {\n        const criterion = sortOptions?.value || 'original';\n        const keyword = filterKeyword?.value?.trim?.() || '';\n        const discountOnly = document.getElementById('filter-discount')?.checked || false;\n        filteredProducts = memoizedFilterProducts(products, keyword, criterion, discountOnly);\n    };\n\n    const appendBatch = (size) => {\n        if (!Array.isArray(filteredProducts) || filteredProducts.length === 0) {\n            updateLoadMoreVisibility();\n            return false;\n        }\n        const start = visibleCount;\n        if (start >= filteredProducts.length) {\n            updateLoadMoreVisibility();\n            return false;\n        }\n        const nextProducts = filteredProducts.slice(start, start + size);\n        if (!nextProducts.length) {\n            updateLoadMoreVisibility();\n            return false;\n        }\n        renderProducts(nextProducts);\n        visibleCount += nextProducts.length;\n        updateLoadMoreVisibility();\n        return true;\n    };\n\n    const appendInitialBatch = () => {\n        const batchSize = initialBatchSize || INITIAL_BATCH_FALLBACK;\n        return appendBatch(batchSize);\n    };\n\n    const appendNextBatch = () => appendBatch(SUBSEQUENT_BATCH_SIZE);\n\n    const updateLoadMoreVisibility = () => {\n        const hasMore = visibleCount < filteredProducts.length;\n        if (loadMoreButton) {\n            loadMoreButton.classList.toggle('d-none', !hasMore);\n            loadMoreButton.disabled = !hasMore;\n        }\n        if (sentinelObserver && catalogSentinel) {\n            sentinelObserver.disconnect();\n            if (hasMore) {\n                sentinelObserver.observe(catalogSentinel);\n            }\n        }\n    };\n\n    const setupDeferredLoading = () => {\n        loadMoreButton = document.getElementById('catalog-load-more');\n        catalogSentinel = document.getElementById('catalog-sentinel');\n        if (loadMoreButton) {\n            loadMoreButton.addEventListener('click', () => {\n                appendNextBatch();\n            });\n        }\n        // Guard: some test/browser environments may lack IntersectionObserver\n        if (catalogSentinel && typeof window !== 'undefined' && 'IntersectionObserver' in window) {\n            sentinelObserver = new IntersectionObserver(entries => {\n                entries.forEach(entry => {\n                    if (entry.isIntersecting) {\n                        appendNextBatch();\n                    }\n                });\n            }, { rootMargin: '200px' });\n        }\n        updateLoadMoreVisibility();\n    };\n\n    const lazyLoadImages = () => {\n        if (typeof window !== 'undefined' && 'IntersectionObserver' in window) {\n            const imageObserver = new IntersectionObserver((entries, observer) => {\n                entries.forEach(entry => {\n                    if (entry.isIntersecting) {\n                        const img = entry.target;\n                        img.src = img.dataset.src;\n                        if (img.dataset.srcset) img.srcset = img.dataset.srcset;\n                        if (img.dataset.sizes) img.sizes = img.dataset.sizes;\n                        img.classList.remove('lazyload');\n                        observer.unobserve(img);\n                    }\n                });\n            }, { rootMargin: '100px' });\n\n            document.querySelectorAll('img.lazyload').forEach(img => imageObserver.observe(img));\n        } else {\n            // Fallback: eagerly set sources without observing (avoids runtime errors)\n            document.querySelectorAll('img.lazyload').forEach(img => {\n                if (img.dataset.src) img.src = img.dataset.src;\n                if (img.dataset.srcset) img.srcset = img.dataset.srcset;\n                if (img.dataset.sizes) img.sizes = img.dataset.sizes;\n                img.classList.remove('lazyload');\n            });\n        }\n    };\n\n    // MUCH MORE CONSERVATIVE fuzzy matching - only for obvious typos\n    function simpleTypoFix(query, text) {\n    if (!query || !text || query.length < 3) return false;\n    \n    const normalizeText = (str) => str.toLowerCase()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '') // Remove accents only\n        .trim();\n    \n    const normalizedQuery = normalizeText(query);\n    const normalizedText = normalizeText(text);\n    \n    // First try exact match (same as original)\n    if (normalizedText.includes(normalizedQuery)) {\n        return true;\n    }\n    \n    // ONLY try typo correction if query is 4+ characters\n    // and the difference is just 1-2 characters\n    if (normalizedQuery.length >= 4) {\n        // Check if it's a simple 1-character typo\n        // Like \"choclate\" vs \"chocolate\" or \"galetas\" vs \"galletas\"\n        return isSimpleTypo(normalizedQuery, normalizedText);\n    }\n    \n    return false;\n    }\n\n    // Very strict typo detection - only catches obvious single-character mistakes\n    function isSimpleTypo(query, text) {\n    const words = text.split(/\\s+/);\n    \n    return words.some(word => {\n        if (Math.abs(word.length - query.length) > 1) return false;\n        \n        // Count character differences\n        let differences = 0;\n        const maxLen = Math.max(word.length, query.length);\n        const minLen = Math.min(word.length, query.length);\n        \n        // Too short to safely compare\n        if (minLen < 4) return false;\n        \n        // Check for single character insertion/deletion\n        if (word.length === query.length) {\n        // Same length - check for substitution\n        for (let i = 0; i < word.length; i++) {\n            if (word[i] !== query[i]) differences++;\n            if (differences > 1) return false; // More than 1 difference\n        }\n        return differences === 1;\n        } else {\n        // Different length - check for insertion/deletion\n        return isOneCharacterDifference(query, word);\n        }\n    });\n    }\n\n    // Check if two words differ by exactly one character (insertion/deletion)\n    function isOneCharacterDifference(str1, str2) {\n    const longer = str1.length > str2.length ? str1 : str2;\n    const shorter = str1.length > str2.length ? str2 : str1;\n    \n    if (longer.length - shorter.length !== 1) return false;\n    \n    let shifts = 0;\n    let i = 0, j = 0;\n    \n    while (i < shorter.length && j < longer.length) {\n        if (shorter[i] === longer[j]) {\n        i++;\n        j++;\n        } else {\n        shifts++;\n        if (shifts > 1) return false; // More than one shift needed\n        j++; // Skip the extra character in longer string\n        }\n    }\n    \n    return true;\n    }\n\n    // REPLACE your filterProducts function with this CONSERVATIVE version:\n    const filterProducts = (products, keyword, sortCriterion, discountOnly = false) => {\n    const trimmedKeyword = keyword.trim();\n    \n    return products\n        .filter(product => {\n        if (!product.stock) return false;\n        if (discountOnly && !(product.discount && Number(product.discount) > 0)) return false;\n        \n        // If no keyword, show all (same as original behavior)\n        if (!trimmedKeyword) return true;\n        \n        // Try EXACT matching first (exactly like original)\n        const exactMatch = product.name.toLowerCase().includes(trimmedKeyword.toLowerCase()) ||\n                            product.description.toLowerCase().includes(trimmedKeyword.toLowerCase());\n        \n        if (exactMatch) return true;\n        \n        // ONLY try typo fix for longer queries and only for name field\n        if (trimmedKeyword.length >= 4) {\n            return simpleTypoFix(trimmedKeyword, product.name);\n        }\n        \n        return false;\n        })\n        .sort((a, b) => sortProducts(a, b, sortCriterion));\n    };\n\n    const sortProducts = (a, b, criterion) => {\n        if (!criterion || criterion === 'original') {\n            return a.originalIndex - b.originalIndex;\n        }\n        const [property, order] = criterion.split('-');\n        const valueA = property === 'price' ? a.price - (a.discount || 0) : a.name.toLowerCase();\n        const valueB = property === 'price' ? b.price - (b.discount || 0) : b.name.toLowerCase();\n        return order === 'asc' ?\n            (valueA < valueB ? -1 : valueA > valueB ? 1 : 0) :\n            (valueB < valueA ? -1 : valueB > valueA ? 1 : 0);\n    };\n\n    const memoizedFilterProducts = memoize(filterProducts);\n\n    const updateProductDisplay = () => {\n        try {\n            applyFilters();\n            resetProductList();\n            if (!filteredProducts.length) {\n                updateLoadMoreVisibility();\n                return;\n            }\n            appendInitialBatch();\n        } catch (error) {\n            console.error('Error al actualizar visualizaci\u00F3n de productos:', error);\n            showErrorMessage('Error al actualizar la visualizaci\u00F3n de productos. Por favor, intenta m\u00E1s tarde.');\n        }\n    };\n\n    let pendingIdleUpdate = null;\n    const debouncedUpdateProductDisplay = debounce(() => {\n        cancelScheduledIdle(pendingIdleUpdate);\n        pendingIdleUpdate = scheduleIdle(() => {\n            updateProductDisplay();\n            pendingIdleUpdate = null;\n        }, 400);\n    }, 150);\n\n    const updateCartIcon = () => {\n        const cartCount = document.getElementById('cart-count');\n        const totalItems = cart.reduce((total, item) => total + item.quantity, 0);\n        cartCount.textContent = totalItems;\n        cartCount.setAttribute('aria-label', `${totalItems} items in cart`);\n    };\n\n    const addToCart = (product, quantity) => {\n        try {\n            const existingItem = cart.find(item => item.id === product.id);\n            if (existingItem) {\n                existingItem.quantity = Math.min(existingItem.quantity + quantity, 50);\n            } else {\n                // Store complete product information\n                cart.push({\n                    id: product.id,\n                    name: product.name,\n                    description: product.description,\n                    price: product.price,\n                    discount: product.discount,\n                    image_path: product.image_path,\n                    image_avif_path: product.image_avif_path,\n                    quantity: Math.min(quantity, 50),\n                    category: product.category,\n                    stock: product.stock\n                });\n            }\n            saveCart();\n            updateCartIcon();\n            renderCart();\n\n            const quantityInput = document.querySelector(`[data-id=\"${product.id}\"].quantity-input`);\n            if (quantityInput) {\n                quantityInput.value = Math.max(getCartItemQuantity(product.id), 1);\n            }\n        } catch (error) {\n            console.error('Error al agregar al carrito:', error);\n            showErrorMessage('Error al agregar el art\u00EDculo al carrito. Por favor, intenta nuevamente.');\n        }\n    };\n\n    const removeFromCart = (productId) => {\n        try {\n            cart = cart.filter(item => item.id !== productId);\n            saveCart();\n            updateCartIcon();\n            renderCart();\n            // Toggle card back to add state without re-rendering\n            const actionArea = document.querySelector(`.action-area[data-pid=\"${productId}\"]`);\n            if (actionArea) {\n                const btn = actionArea.querySelector('.add-to-cart-btn');\n                const qc = actionArea.querySelector('.quantity-control');\n                toggleActionArea(btn, qc, false);\n            }\n        }\n        catch (error) {\n            console.error('Error al eliminar del carrito:', error);\n            showErrorMessage('Error al eliminar el art\u00EDculo del carrito. Por favor, intenta nuevamente.');\n        }\n    };\n\n    const updateQuantity = (product, change) => {\n        try {\n            const item = cart.find(item => item.id === product.id);\n            const newQuantity = item ? item.quantity + change : 1;\n\n            const actionArea = document.querySelector(`.action-area[data-pid=\"${product.id}\"]`);\n            const btn = actionArea?.querySelector('.add-to-cart-btn');\n            const qc = actionArea?.querySelector('.quantity-control');\n\n            if (newQuantity <= 0) {\n                removeFromCart(product.id);\n                toggleActionArea(btn, qc, false);\n            } else if (newQuantity <= 50) {\n                if (item) {\n                    item.quantity = newQuantity;\n                } else {\n                    addToCart(product, 1);\n                    toggleActionArea(btn, qc, true);\n                }\n                saveCart();\n                updateCartIcon();\n                renderCart();\n\n                const quantityInput = document.querySelector(`[data-id=\"${product.id}\"].quantity-input`);\n                if (quantityInput) {\n                    quantityInput.value = newQuantity;\n                    quantityInput.classList.add('quantity-changed');\n                    setTimeout(() => quantityInput.classList.remove('quantity-changed'), 300);\n                }\n            }\n        } catch (error) {\n            console.error('Error al actualizar cantidad:', error);\n            showErrorMessage('Error al actualizar la cantidad. Por favor, intenta nuevamente.');\n        }\n    };\n\n    const emptyCart = () => {\n        try {\n            cart = [];\n            saveCart();\n            updateCartIcon();\n            renderCart();\n            updateProductDisplay();\n        } catch (error) {\n            console.error('Error al vaciar el carrito:', error);\n            showErrorMessage('Error al vaciar el carrito. Por favor, int\u00E9ntelo de nuevo.');\n        }\n    };\n\n    // Toggle action area in a specific card without re-rendering the grid\n    const toggleActionArea = (btn, quantityControl, showQuantity) => {\n        if (!btn || !quantityControl) return;\n        const showButton = !showQuantity;\n        btn.classList.toggle(UTILITY_CLASSES.hidden, !showButton);\n        btn.classList.toggle(UTILITY_CLASSES.flex, showButton);\n\n        quantityControl.classList.toggle(UTILITY_CLASSES.hidden, !showQuantity);\n        quantityControl.classList.toggle(UTILITY_CLASSES.flex, showQuantity);\n    };\n\n    const saveCart = () => {\n        try {\n            localStorage.setItem('cart', JSON.stringify(cart));\n        } catch (error) {\n            console.error('Error al guardar el carrito:', error);\n            showErrorMessage('Error al guardar el carrito. Tus cambios podr\u00EDan no persistir.');\n        }\n    };\n\n    // Find the renderCart function (around line 485) and modify it like this:\n\n    const renderCart = () => {\n        const cartItems = document.getElementById('cart-items');\n        const cartTotal = document.getElementById('cart-total');\n        cartItems.innerHTML = '';\n\n        let total = 0;\n\n        cart.forEach(item => {\n            const discountedPrice = item.price - (item.discount || 0);\n\n            // Contenedor principal: usar flex de Bootstrap (con fallback CSS para thumbnail)\n            const itemElement = createSafeElement('div', {\n                class: 'cart-item mb-3 d-flex align-items-start',\n                'aria-label': `Cart item: ${item.name}`\n            });\n\n            // Contenedor de datos del producto (nombre, controles, precio, subtotal, bot\u00F3n)\n            const contentContainer = createSafeElement('div', {\n                class: 'cart-item-content flex-grow-1'\n            });\n\n            // Nombre\n            contentContainer.appendChild(\n                createSafeElement('div', { class: 'fw-bold mb-1' }, [item.name])\n            );\n\n            // Controles de cantidad\n            const quantityContainer = createSafeElement('div', { class: 'mb-2' });\n            const decreaseBtn = createSafeElement('button', {\n                class: 'btn btn-sm btn-secondary decrease-quantity',\n                'data-id': item.id,\n                'aria-label': `Disminuir cantidad de ${item.name}`\n            }, ['-']);\n            const increaseBtn = createSafeElement('button', {\n                class: 'btn btn-sm btn-secondary increase-quantity',\n                'data-id': item.id,\n                'aria-label': `Aumentar cantidad de ${item.name}`\n            }, ['+']);\n            const quantitySpan = createSafeElement('span', {\n                class: 'mx-2 item-quantity',\n                'aria-label': `Cantidad de ${item.name}`\n            }, [item.quantity.toString()]);\n            quantityContainer.appendChild(decreaseBtn);\n            quantityContainer.appendChild(quantitySpan);\n            quantityContainer.appendChild(increaseBtn);\n            contentContainer.appendChild(quantityContainer);\n\n            // Precio y subtotal\n            contentContainer.appendChild(\n                createSafeElement('div', { class: 'text-muted small' },\n                    [`Precio: $${discountedPrice.toLocaleString('es-CL')}`]\n                )\n            );\n            contentContainer.appendChild(\n                createSafeElement('div', { class: 'fw-bold' },\n                    [`Subtotal: $${(discountedPrice * item.quantity).toLocaleString('es-CL')}`]\n                )\n            );\n\n            // Bot\u00F3n \"Eliminar\"\n            const removeBtn = createSafeElement('button', {\n                class: 'btn btn-sm btn-danger remove-item mt-2',\n                'data-id': item.id,\n                'aria-label': `Eliminar ${item.name} del carrito`\n            }, ['Eliminar']);\n            contentContainer.appendChild(removeBtn);\n\n            // Determinar ruta de la imagen (igual que en renderProducts)\n            const isSubcategoryPage = window.location.pathname.includes('/pages/');\n            let adjustedImagePath;\n            if (isSubcategoryPage) {\n                adjustedImagePath = `../${item.image_path.replace(/^\\//, '')}`;\n            } else {\n                adjustedImagePath = item.image_path;\n            }\n\n            // Miniatura a la derecha (CSP-safe), contenido a la izquierda\n            const thumbnailContainer = createSafeElement('div', {\n                class: 'cart-item-thumb ms-3 flex-shrink-0'\n            });\n            const thumbSrc = item.thumbnail_path || adjustedImagePath;\n            const thumbnailPicture = createCartThumbnail({\n                imagePath: item.thumbnail_path || item.image_path,\n                avifPath: item.image_avif_path,\n                alt: item.name\n            });\n            const fallbackImg = thumbnailPicture.querySelector('img');\n            if (fallbackImg) {\n                if (!fallbackImg.getAttribute('src') && thumbSrc) {\n                    fallbackImg.setAttribute('src', thumbSrc);\n                }\n                if (Array.isArray(item.thumbnail_variants)) {\n                    const parts = item.thumbnail_variants\n                        .filter(v => v && v.url && v.width)\n                        .map(v => `${v.url} ${v.width}w`);\n                    if (parts.length) {\n                        fallbackImg.setAttribute('srcset', parts.join(', '));\n                        fallbackImg.setAttribute('sizes', '100px');\n                    }\n                } else if (!fallbackImg.getAttribute('sizes')) {\n                    fallbackImg.setAttribute('sizes', '100px');\n                }\n            }\n            thumbnailContainer.appendChild(thumbnailPicture);\n\n            // A\u00F1adir primero el contenido (izquierda) y luego la miniatura (derecha)\n            itemElement.appendChild(contentContainer);\n            itemElement.appendChild(thumbnailContainer);\n\n            // Insertar en el DOM\n            cartItems.appendChild(itemElement);\n\n            // Debug (opt-in): inspect computed styles and rectangles\n            if (window.__DEBUG_CART__) {\n                try {\n                    const cs = window.getComputedStyle(itemElement);\n                    const csThumb = window.getComputedStyle(thumbnailContainer);\n                    const csContent = window.getComputedStyle(contentContainer);\n                    const rectThumb = thumbnailContainer.getBoundingClientRect();\n                    const rectContent = contentContainer.getBoundingClientRect();\n                    console.debug('[cart] item', {\n                        name: item.name,\n                        order: {\n                            firstIsContent: itemElement.firstChild === contentContainer,\n                            lastIsThumb: itemElement.lastChild === thumbnailContainer,\n                        },\n                        container: { display: cs.display, flexDirection: cs.flexDirection, flexWrap: cs.flexWrap },\n                        thumb: { width: csThumb.width, height: csThumb.height, rect: { w: rectThumb.width, h: rectThumb.height } },\n                        content: { rect: { w: rectContent.width, h: rectContent.height } },\n                    });\n                } catch (e) { /* ignore */ }\n            }\n\n            // Calcular total\n            total += discountedPrice * item.quantity;\n        });\n\n        // Mostrar total\n        cartTotal.textContent = `Total: $${total.toLocaleString('es-CL')}`;\n        cartTotal.setAttribute('aria-label', `Total: $${total.toLocaleString('es-CL')}`);\n\n        // Mostrar u ocultar la opci\u00F3n de pago con tarjeta de cr\u00E9dito seg\u00FAn el total\n        const creditOption = document.getElementById('payment-credit-container');\n        if (creditOption) {\n            if (total >= 30000) {\n                creditOption.classList.remove('d-none');\n            } else {\n                creditOption.classList.add('d-none');\n                const creditInput = creditOption.querySelector('input');\n                if (creditInput) {\n                    creditInput.checked = false;\n                }\n            }\n        }\n    };\n\n\n    const submitCart = () => {\n        const selectedPayment = document.querySelector('input[name=\"paymentMethod\"]:checked');\n        if (!selectedPayment) {\n            alert('Por favor seleccione un m\u00E9todo de pago');\n            return;\n        }\n\n        let message = \"Mi pedido:\\n\\n\";\n        cart.forEach(item => {\n            const discountedPrice = item.price - (item.discount || 0);\n            message += `${item.name}\\n`;\n            message += `Cantidad: ${item.quantity}\\n`;\n            message += `Precio unitario: $${discountedPrice.toLocaleString('es-CL')}\\n`;\n            message += `Subtotal: $${(discountedPrice * item.quantity).toLocaleString('es-CL')}\\n\\n`;\n        });\n\n        const total = cart.reduce((sum, item) => sum + (item.price - (item.discount || 0)) * item.quantity, 0);\n        message += `Total: $${total.toLocaleString('es-CL')}\\n`;\n        message += `M\u00E9todo de pago: ${selectedPayment.value}`;\n\n        const encodedMessage = encodeURIComponent(message);\n        window.open(`https://wa.me/56951118901?text=${encodedMessage}`, '_blank');\n    };\n\n    try {\n        initFooter();\n\n        const bootstrapPayload = getSharedProductData();\n        if (bootstrapPayload?.products?.length) {\n            products = bootstrapPayload.products.map((product, index) => ({\n                ...product,\n                originalIndex: typeof product.originalIndex === 'number' ? product.originalIndex : index,\n                categoryKey: product.categoryKey || normalizeString(product.category)\n            }));\n        }\n\n        const mainElement = document.querySelector('main');\n        const currentCategory = mainElement?.dataset?.category || '';\n        if (currentCategory) {\n            const normCurrent = normalizeString(currentCategory);\n            products = products\n                .filter(product => (product.categoryKey || normalizeString(product.category)) === normCurrent)\n                .map((product, index) => ({\n                    ...product,\n                    originalIndex: typeof product.originalIndex === 'number' ? product.originalIndex : index\n                }));\n        }\n\n        const hydratedCount = hydratePreRenderedProducts(products);\n        if (hydratedCount > 0) {\n            visibleCount = hydratedCount;\n            initialBatchSize = hydratedCount;\n        } else {\n            visibleCount = 0;\n        }\n\n        setupDeferredLoading();\n        applyFilters();\n        updateLoadMoreVisibility();\n        if (visibleCount === 0 && filteredProducts.length) {\n            appendInitialBatch();\n        }\n\n        const fetchPromise = fetchProducts();\n\n        sortOptions.addEventListener('change', () => {\n            userHasInteracted = true;\n            debouncedUpdateProductDisplay();\n        });\n        filterKeyword.addEventListener('input', () => {\n            userHasInteracted = true;\n            debouncedUpdateProductDisplay();\n        });\n\n        const discountToggle = ensureDiscountToggle();\n        if (discountToggle) {\n            discountToggle.addEventListener('change', () => {\n                userHasInteracted = true;\n                debouncedUpdateProductDisplay();\n            });\n        }\n\n        const networkProducts = await fetchPromise;\n\n        if (!Array.isArray(networkProducts) || networkProducts.length === 0) {\n            if (!products.length) {\n                showErrorMessage('No hay productos disponibles. Por favor, intenta m\u00E1s tarde.');\n                return;\n            }\n        } else {\n            products = networkProducts.map((product, index) => ({\n                ...product,\n                originalIndex: typeof product.originalIndex === 'number' ? product.originalIndex : index,\n                categoryKey: product.categoryKey || normalizeString(product.category)\n            }));\n            if (currentCategory) {\n                const normCurrent = normalizeString(currentCategory);\n                products = products\n                    .filter(product => (product.categoryKey || normalizeString(product.category)) === normCurrent)\n                    .map((product, index) => ({\n                        ...product,\n                        originalIndex: typeof product.originalIndex === 'number' ? product.originalIndex : index\n                    }));\n            }\n        }\n\n        applyFilters();\n        if (userHasInteracted || visibleCount === 0) {\n            resetProductList();\n            if (filteredProducts.length) {\n                appendInitialBatch();\n            } else {\n                updateLoadMoreVisibility();\n            }\n        } else {\n            updateLoadMoreVisibility();\n        }\n\n        if (typeof window !== 'undefined') window.__APP_READY__ = true;\n\n        window.addEventListener('online', updateOnlineStatus);\n        window.addEventListener('offline', updateOnlineStatus);\n        updateOnlineStatus();\n\n        const cartIcon = document.getElementById('cart-icon');\n        const emptyCartBtn = document.getElementById('empty-cart');\n        const submitCartBtn = document.getElementById('submit-cart');\n\n        if (cartIcon) {\n            cartIcon.addEventListener('click', async () => {\n                renderCart();\n                const cartOffcanvasElement = document.getElementById('cartOffcanvas');\n                try {\n                    await showOffcanvas('#cartOffcanvas');\n                    if (cartOffcanvasElement) {\n                        cartOffcanvasElement.dataset.bsFallback = '0';\n                    }\n                } catch (error) {\n                    console.error('Bootstrap Offcanvas no est\u00E1 disponible', error);\n                    if (cartOffcanvasElement) {\n                        cartOffcanvasElement.dataset.bsFallback = '1';\n                        cartOffcanvasElement.classList.add('show');\n                        cartOffcanvasElement.removeAttribute('aria-hidden');\n                    }\n                }\n            });\n        }\n\n        if (emptyCartBtn) {\n            emptyCartBtn.addEventListener('click', emptyCart);\n        }\n        if (submitCartBtn) {\n            submitCartBtn.addEventListener('click', submitCart);\n        }\n\n        if (cartItemsElement) {\n            cartItemsElement.addEventListener('click', (e) => {\n                const target = e.target;\n                const productId = target.closest('[data-id]')?.dataset.id;\n\n                if (!productId) return;\n\n                if (target.classList.contains('decrease-quantity')) {\n                    updateQuantity({ id: productId }, -1);\n                } else if (target.classList.contains('increase-quantity')) {\n                    updateQuantity({ id: productId }, 1);\n                } else if (target.classList.contains('remove-item')) {\n                    removeFromCart(productId);\n                }\n            });\n        }\n\n        updateCartIcon();\n\n        if ('performance' in window) {\n            window.addEventListener('load', () => {\n                logPerformanceMetrics();\n            });\n        }\n\n    } catch (error) {\n        console.error(\"Error al inicializar productos:\", error);\n        showErrorMessage('Error al cargar productos. Por favor, int\u00E9ntelo m\u00E1s tarde.');\n    }\n};\n\n// Run the application when the DOM is ready\nif (typeof document !== 'undefined') {\n    document.addEventListener('DOMContentLoaded', function () {\n        // Register service worker first\n        registerServiceWorker();\n\n        // Then initialize the app\n        initApp().catch(error => {\n            console.error('Error al inicializar la aplicaci\u00F3n:', error);\n            showErrorMessage('Error al inicializar la aplicaci\u00F3n. Por favor, actualice la p\u00E1gina.');\n        });\n    });\n}\nfunction __getCart() {\n    return cart;\n}\n\nfunction __resetCart() {\n    cart = [];\n}\n\nexport {\n    generateStableId,\n    fetchProducts,\n    fetchWithRetry,\n    initApp,\n    addToCart,\n    removeFromCart,\n    updateQuantity,\n    updateCartIcon,\n    showUpdateNotification,\n    showServiceWorkerError,\n    showConnectivityNotification,\n    registerServiceWorker as __registerServiceWorkerForTest,\n    shouldRegisterServiceWorker as __shouldRegisterServiceWorkerForTest,\n    __resetServiceWorkerRegistrationForTest,\n    memoize as __memoizeForTest,\n    resolveAvifSrcset as __resolveAvifSrcsetForTest,\n    buildStaticSrcset as __buildStaticSrcsetForTest,\n    __getCart,\n    __resetCart,\n    logPerformanceMetrics\n};\n\n\n\n\n", "// ESM entry point to compose site enhancements and core app\n\nimport { injectEnhancementStyles } from './modules/enhancements.js';\nimport { setupNavigationAccessibility, setupCartOffcanvasAccessibility } from './modules/a11y.js';\nimport { setupPerformanceOptimizations } from './modules/perf.js';\nimport { injectSeoMetadata, injectStructuredData } from './modules/seo.js';\nimport { injectPwaManifest } from './modules/pwa.js';\nimport { setupCheckoutProgress } from './modules/checkout.js';\nimport { initializeBootstrapUI } from './modules/bootstrap.mjs';\n\n// Import the core app for side effects when bundling.\n// Note: When bundling via esbuild, this pulls in the main application logic.\nimport './script.mjs';\n\n\nfunction initEnhancementsOnce() {\n  const root = document.documentElement;\n  // Always enable deferred styles first (idempotent)\n  try {\n    document\n      .querySelectorAll('link[rel=\"stylesheet\"][media=\"print\"][data-defer]')\n      .forEach((link) => {\n        link.media = 'all';\n        link.removeAttribute('data-defer');\n      });\n  } catch {}\n\n  if (root.dataset.enhancementsInit === '1') return;\n  root.dataset.enhancementsInit = '1';\n\n  injectEnhancementStyles();\n  setupCheckoutProgress();\n  setupNavigationAccessibility();\n  setupCartOffcanvasAccessibility();\n  setupPerformanceOptimizations();\n  injectSeoMetadata();\n  injectStructuredData();\n  injectPwaManifest();\n  initializeBootstrapUI();\n}\n\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initEnhancementsOnce);\n} else {\n  initEnhancementsOnce();\n}\n\n// Test hook: expose the initializer to allow unit tests to verify\n// the deferred CSS swap logic and one-time initialization behavior.\n// This export has no effect on runtime behavior.\nexport { initEnhancementsOnce as __initEnhancementsOnceForTest };\n\n// Optional analytics (fully opt-in via global flag to avoid any startup cost)\ntry {\n  if (typeof window !== 'undefined' && window.__ANALYTICS_ENABLE__ === true) {\n    import('./modules/analytics.mjs').then((m) => {\n      m.initAnalytics({ enabled: true, consentRequired: true, sampleRate: 1.0 });\n      window.__analyticsTrack = (name, props) => { try { return m.track(name, props); } catch { return false; } };\n      m.track('page_view', { path: location.pathname });\n    }).catch(() => {});\n  }\n} catch {}\n"],
  "mappings": "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",
  "names": ["injectEnhancementStyles", "styleEl", "setupNavigationAccessibility", "e", "style", "getFocusableElements", "container", "selectors", "el", "setupCartOffcanvasAccessibility", "handleHide", "detachKeydown", "lastFocusedElement", "triggerButton", "cartOffcanvas", "heading", "keydownAttached", "handleKeydown", "event", "focusable", "first", "last", "active", "attachKeydown", "focusInitial", "target", "setupPerformanceOptimizations", "img", "PRODUCT_DATA_GLOBAL_KEY", "getSharedProducts", "payload", "persistSharedProducts", "products", "metadata", "_a", "_b", "existing", "createProductMap", "map", "p", "key", "markStructuredDataInjected", "loadProductData", "sharedProducts", "version", "url", "response", "data", "arr", "injectStructuredData", "sharedPayload", "structuredProducts", "structuredData", "scriptEl", "injectSeoMetadata", "link", "meta", "injectPwaManifest", "link", "setupCheckoutProgress", "_a", "e", "controllerRegistry", "controllerContainers", "activeControllers", "raf", "cb", "caf", "id", "composedPath", "event", "path", "current", "ensureId", "baseElement", "prefix", "index", "_a", "datasetId", "generated", "setExpanded", "entry", "isExpanded", "toggle", "menu", "dropdownNode", "closeAll", "state", "ensureOutsideListener", "listenerAttached", "attach", "handleTogglePointerDown", "handleToggleKeyDown", "key", "now", "createEntry", "createController", "nav", "pointerHandler", "clickHandler", "keyHandler", "destroyController", "setupUnifiedMenuController", "container", "navContainers", "preferred", "bootstrapInitialized", "loaderOverrides", "collapseModulePromise", "offcanvasModulePromise", "getModuleExport", "module", "keys", "getOrCreateInstance", "Component", "element", "resolveElement", "target", "loadWithOverride", "name", "importer", "loadCollapse", "loadOffcanvas", "setupCollapseToggles", "toggle", "event", "shouldPreventNavigation", "activateCollapse", "_a", "targetSelector", "Collapse", "instance", "error", "href", "initializeBootstrapUI", "setupUnifiedMenuController", "showOffcanvas", "Offcanvas", "cfimg", "path", "opts", "p", "params", "k", "v", "encoded", "CFIMG_THUMB", "PRODUCT_DATA_GLOBAL_KEY", "sharedProductData", "UTILITY_CLASSES", "PRODUCT_IMAGE_WIDTHS", "PRODUCT_IMAGE_SIZES", "CART_IMAGE_WIDTHS", "normaliseAssetPath", "value", "buildCfSrc", "assetPath", "extraOpts", "normalised", "cfimg", "CFIMG_THUMB", "buildCfSrcset", "widths", "width", "STATIC_SRC_DESCRIPTOR_KEYS", "encodeStaticPath", "path", "_err", "buildStaticSrcset", "normaliseDescriptor", "descriptorCandidate", "trimmed", "buildEntry", "entry", "srcCandidate", "src", "descriptorKey", "key", "descriptor", "encodedSrc", "isAvifAsset", "resolveAvifSrcset", "staticSrcset", "srcsetFromObject", "getSharedProductData", "payload", "writeSharedProductData", "products", "metadata", "force", "existing", "existingVersion", "payloadVersion", "ensureSharedProductData", "overwriteSharedProductData", "SERVICE_WORKER_CONFIG", "LOCALHOST_HOSTNAMES", "safeReadLocalStorage", "_a", "_b", "storage", "error", "shouldRegisterServiceWorker", "_c", "_d", "hostname", "enableLocalFlag", "query", "queryEnables", "serviceWorkerRegistrationSetup", "registerServiceWorker", "startRegistration", "initializeServiceWorker", "showServiceWorkerError", "initializeServiceWorker", "registration", "SERVICE_WORKER_CONFIG", "setupUpdateHandling", "setupPeriodicUpdateCheck", "setupControllerChangeHandling", "setupConnectivityHandling", "error", "newWorker", "checkForUpdates", "_a", "response", "currentVersion", "storedVersion", "showUpdateNotification", "refreshing", "offlineIndicator", "updateOnlineStatus", "hidden", "UTILITY_CLASSES", "showConnectivityNotification", "__notificationsModulePromise", "__loadNotifications", "serviceWorker", "message", "m", "showServiceWorkerError", "registerServiceWorker", "isCacheableObject", "value", "createCacheNode", "memoize", "fn", "cacheSize", "root", "lru", "touch", "node", "index", "evictIfNeeded", "oldest", "getChildNode", "arg", "next", "args", "i", "result", "debounce", "func", "delay", "timeoutId", "scheduleIdle", "timeout", "cancelScheduledIdle", "token", "normalizeString", "str", "e", "DEFAULT_CATEGORY", "DEFAULT_PRODUCT_NAME_PREFIX", "generateStableId", "product", "hasValidShape", "rawName", "rawCategory", "safeName", "safeCategory", "baseString", "hash", "charCode", "suffix", "sanitizeHTML", "unsafe", "element", "INLINE_PRODUCT_SCRIPT_ID", "getStoredProductVersion", "setStoredProductVersion", "version", "parseInlineProductData", "script", "payload", "parsed", "log", "transformProduct", "id", "originalIndex", "safeDescription", "safeImagePath", "safeImageAvifPath", "transformProducts", "products", "hydrateSharedProductDataFromInline", "existing", "getSharedProductData", "inlineData", "transformed", "ensureSharedProductData", "ProductDataError", "cause", "correlationId", "fetchWithRetry", "url", "opts", "retries", "backoffMs", "sanitizedUrl", "attempt", "lastError", "start", "durationMs", "err", "resolve", "fetchProducts", "createCorrelationId", "inlineSource", "inlineVersion", "inlineTotal", "inlineProducts", "hasInlineProducts", "versionForUrl", "data", "overwriteSharedProductData", "showErrorMessage", "createSafeElement", "tag", "attributes", "children", "key", "child", "createProductPicture", "imagePath", "avifPath", "alt", "eager", "sizes", "PRODUCT_IMAGE_SIZES", "pictureChildren", "avifSrcset", "resolveAvifSrcset", "fallbackSrc", "buildCfSrc", "normaliseAssetPath", "fallbackSrcset", "buildCfSrcset", "imgAttrs", "imgElement", "createCartThumbnail", "sources", "CART_IMAGE_WIDTHS", "errorMessage", "productContainer", "initApp", "cart", "logPerformanceMetrics", "perf", "fcpValue", "domContentLoadedValue", "loadTimeValue", "paintEntries", "navigationEntries", "fcpEntry", "entry", "navigationEntry", "error", "event", "target", "isResourceError", "hasRuntimeError", "showErrorMessage", "initApp", "_a", "_b", "_c", "productContainer", "sortOptions", "filterKeyword", "cartCountElement", "cartItemsElement", "cartTotalElement", "missingSelectors", "element", "selector", "log", "ensureDiscountToggle", "toggle", "filterSection", "filterSectionRow", "col", "createSafeElement", "formCheck", "input", "label", "INITIAL_BATCH_FALLBACK", "SUBSEQUENT_BATCH_SIZE", "products", "filteredProducts", "visibleCount", "initialBatchSize", "loadMoreButton", "catalogSentinel", "sentinelObserver", "userHasInteracted", "cart", "updateOnlineStatus", "offlineIndicator", "hidden", "UTILITY_CLASSES", "initFooter", "yearSpan", "DEFAULT_CURRENCY_CODE", "hasLoggedCurrencyFallback", "normalizeCurrencyCode", "currencyCode", "trimmed", "createCurrencyFormatter", "fallbackCode", "error", "renderPriceHtml", "price", "discount", "numericPrice", "numericDiscount", "formatter", "formattedPrice", "discountedPrice", "formattedDiscountedPrice", "renderQuantityControl", "product", "quantityControl", "minusBtn", "plusBtn", "getCartItemQuantity", "setupActionArea", "actionArea", "addToCartBtn", "quantityInput", "bind", "handler", "addToCart", "toggleActionArea", "updateQuantity", "newQuantity", "currentQuantity", "productId", "item", "renderProducts", "productsToRender", "reset", "fragment", "id", "name", "description", "image_path", "image_avif_path", "stock", "productClasses", "titleId", "productElement", "cardElement", "pct", "badge", "pictureElement", "createProductPicture", "cardBody", "priceContainer", "lazyLoadImages", "hydratePreRenderedProducts", "productList", "cards", "map", "hydrated", "card", "resetProductList", "applyFilters", "criterion", "keyword", "discountOnly", "memoizedFilterProducts", "appendBatch", "size", "updateLoadMoreVisibility", "start", "nextProducts", "appendInitialBatch", "appendNextBatch", "hasMore", "setupDeferredLoading", "entries", "entry", "imageObserver", "observer", "img", "simpleTypoFix", "query", "text", "normalizeText", "str", "normalizedQuery", "normalizedText", "isSimpleTypo", "word", "differences", "maxLen", "i", "isOneCharacterDifference", "str1", "str2", "longer", "shorter", "shifts", "j", "filterProducts", "sortCriterion", "trimmedKeyword", "a", "sortProducts", "b", "property", "order", "valueA", "valueB", "memoize", "updateProductDisplay", "pendingIdleUpdate", "debouncedUpdateProductDisplay", "debounce", "cancelScheduledIdle", "scheduleIdle", "updateCartIcon", "cartCount", "totalItems", "total", "quantity", "existingItem", "saveCart", "renderCart", "removeFromCart", "btn", "qc", "change", "emptyCart", "showQuantity", "showButton", "cartItems", "cartTotal", "itemElement", "contentContainer", "quantityContainer", "decreaseBtn", "increaseBtn", "quantitySpan", "removeBtn", "isSubcategoryPage", "adjustedImagePath", "thumbnailContainer", "thumbSrc", "thumbnailPicture", "createCartThumbnail", "fallbackImg", "parts", "v", "cs", "csThumb", "csContent", "rectThumb", "rectContent", "e", "creditOption", "creditInput", "submitCart", "selectedPayment", "message", "sum", "encodedMessage", "bootstrapPayload", "getSharedProductData", "index", "normalizeString", "mainElement", "currentCategory", "normCurrent", "hydratedCount", "fetchPromise", "fetchProducts", "discountToggle", "networkProducts", "cartIcon", "emptyCartBtn", "submitCartBtn", "cartOffcanvasElement", "showOffcanvas", "logPerformanceMetrics", "registerServiceWorker", "initEnhancementsOnce", "root", "link", "e", "injectEnhancementStyles", "setupCheckoutProgress", "setupNavigationAccessibility", "setupCartOffcanvasAccessibility", "setupPerformanceOptimizations", "injectSeoMetadata", "injectStructuredData", "injectPwaManifest", "initializeBootstrapUI", "m", "name", "props", "e"]
}
