(()=>{var Ft=Object.create;var it=Object.defineProperty;var Ut=Object.getOwnPropertyDescriptor;var Wt=Object.getOwnPropertyNames;var Ht=Object.getPrototypeOf,Qt=Object.prototype.hasOwnProperty;var x=(t,e)=>()=>(t&&(e=t(t=0)),e);var ct=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Kt=(t,e,o,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of Wt(e))!Qt.call(t,c)&&c!==o&&it(t,c,{get:()=>e[c],enumerable:!(s=Ut(e,c))||s.enumerable});return t};var Vt=(t,e,o)=>(o=t!=null?Ft(Ht(t)):{},Kt(e||!t||!t.__esModule?it(o,"default",{value:t,enumerable:!0}):o,t));function st(){try{let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=`
      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */
      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }
      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }

      /* Contornos de enfoque claros para accesibilidad */
      .navbar .nav-link:focus,
      .navbar .dropdown-item:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* Espaciado entre botones en el offcanvas del carrito */
      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }
    `,document.head.appendChild(t)}catch(t){console.warn("[modules/enhancements] injectEnhancementStyles error:",t)}}var dt=x(()=>{});function lt(){try{document.addEventListener("keydown",e=>{e.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=".keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }",document.head.appendChild(t)}catch(t){console.warn("[modules/a11y] setupNavigationAccessibility error:",t)}}var ut=x(()=>{});function mt(){try{"loading"in HTMLImageElement.prototype&&document.querySelectorAll("img:not([loading])").forEach(t=>{t.loading="lazy"})}catch(t){console.warn("[modules/perf] setupPerformanceOptimizations error:",t)}}var pt=x(()=>{});async function Gt(){try{let t=localStorage.getItem("productDataVersion"),e=t?`/_products/product_data.json?v=${encodeURIComponent(t)}`:"/_products/product_data.json",o=await fetch(e,{cache:"no-store",headers:{Accept:"application/json"}});if(!o.ok)return null;let s=await o.json(),c=Array.isArray(s?.products)?s.products:Array.isArray(s)?s:[],f={};return c.forEach(v=>{let y=v.id||String(v.name)+"-"+String(v.category);f[y]=v}),f}catch(t){return console.error("[modules/seo] Error loading product data:",t),null}}async function ft(){try{if(document.querySelector('script[type="application/ld+json"]'))return;let t=await Gt();if(!t)return;let o=Object.values(t).slice(0,20).map(f=>({"@type":"Product",name:f.name,image:f.image_path,description:f.description,brand:f.brand||"Gen\xE9rico",offers:{"@type":"Offer",price:f.price,priceCurrency:"CLP",availability:f.stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}})),s={"@context":"https://schema.org","@graph":[{"@type":"Store",name:"El Rinc\xF3n de \xC9bano",image:"https://elrincondeebano.com/assets/images/web/logo.webp",description:"Un minimarket en la puerta de tu departamento",address:{"@type":"PostalAddress",addressCountry:"CL"},telephone:"+56951118901",url:"http://www.elrincondeebano.com/",contactPoint:{"@type":"ContactPoint",telephone:"+56-951118901",contactType:"customer service"}},...o]},c=document.createElement("script");c.type="application/ld+json",window&&window.__CSP_NONCE__&&c.setAttribute("nonce",window.__CSP_NONCE__),c.textContent=JSON.stringify(s),document.head.appendChild(c)}catch(t){console.error("[modules/seo] Error generating structured data:",t)}}function yt(){try{if(!document.querySelector('link[rel="canonical"]')){let t=document.createElement("link");t.rel="canonical",t.href=location.origin+location.pathname,document.head.appendChild(t)}if(!document.querySelector('meta[name="description"]')){let t=document.createElement("meta");t.name="description",t.content="El Rinc\xF3n de \xC9bano - Minimarket con delivery instant\xE1neo.",document.head.appendChild(t)}}catch(t){console.warn("[modules/seo] injectSeoMetadata error:",t)}}var gt=x(()=>{});function ht(){try{if(!document.querySelector('link[rel="manifest"]')){let t=document.createElement("link");t.rel="manifest",t.href="/app.webmanifest",document.head.appendChild(t)}}catch(t){console.warn("[modules/pwa] injectPwaManifest error:",t)}}var vt=x(()=>{});function wt(){try{window?.console?.debug&&console.debug("[modules/checkout] setupCheckoutProgress: no-op")}catch{}}var bt=x(()=>{});var _t=ct((ge,Y)=>{"use strict";var V={path:"/service-worker.js",scope:"/",updateCheckInterval:3e5};function Et(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}window.addEventListener("load",async()=>{try{Jt()}catch(t){console.error("Service Worker initialization failed:",t),ne("Failed to initialize service worker. Some features may not work offline.")}})}async function Jt(){try{let t=await navigator.serviceWorker.register(V.path,{scope:V.scope});console.log("ServiceWorker registered successfully:",t.scope),Yt(t),Zt(t),Xt(),te()}catch(t){throw console.error("ServiceWorker registration failed:",t),t}}function Yt(t){t.addEventListener("updatefound",()=>{let e=t.installing;e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&e.postMessage({type:"SKIP_WAITING"})})})}function Zt(t){Ct(t),setInterval(()=>{Ct(t)},V.updateCheckInterval)}async function Ct(t){try{await t.update();let e=await fetch("/_products/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(e.ok){let s=(await e.json()).version,c=localStorage.getItem("productDataVersion");s!==c&&(t.active?.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",s),ee(null,"New product data available"))}}catch(e){console.warn("Update check failed:",e)}}function Xt(){let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}function te(){let t=()=>{let e=document.getElementById("offline-indicator");if(e){let o=navigator.onLine;e.classList.toggle("is-hidden",o)}navigator.onLine||ae("You are currently offline. Some features may be limited.")};window.addEventListener("online",t),window.addEventListener("offline",t),t()}function ee(t,e="Una versi\xF3n est\xE1 disponible"){let o=Z(e,"Actualizar ahora","Despu\xE9s",()=>{t?t.postMessage({type:"SKIP_WAITING"}):window.location.reload()});X(o)}function ne(t){let e=Z(t,"Reload","Dismiss",()=>window.location.reload());X(e)}function ae(t){let e=Z(t,"Retry","Dismiss",()=>window.location.reload());X(e)}function Z(t,e,o,s){let c=document.createElement("div");return c.className="notification-toast",c.setAttribute("role","alert"),c.setAttribute("aria-live","polite"),c.innerHTML=`
        <div class="notification-content">
            <p>${t}</p>
            <div class="notification-actions">
                <button class="primary-action">${e}</button>
                <button class="secondary-action">${o}</button>
            </div>
        </div>
    `,c.querySelector(".primary-action").addEventListener("click",()=>{s(),c.remove()}),c.querySelector(".secondary-action").addEventListener("click",()=>{c.remove()}),c}function X(t){let e=document.querySelector(".notification-toast");e&&e.remove(),document.body.appendChild(t),setTimeout(()=>{document.body.contains(t)&&t.remove()},300*1e3)}typeof navigator<"u"&&"serviceWorker"in navigator&&Et();var oe=(t,e=100)=>{let o=new Map;return(...s)=>{let c=JSON.stringify(s);if(o.has(c))return o.get(c);let f=t(...s);if(o.size>=e){let v=o.keys().next().value;o.delete(v)}return o.set(c,f),f}},re=(t,e)=>{let o;return(...s)=>{clearTimeout(o),o=setTimeout(()=>t(...s),e)}},G=t=>{if(!t)return"";try{return String(t).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}catch{return String(t).toLowerCase()}},St=t=>{let e=`${t.name}-${t.category}`.toLowerCase(),o=0;for(let s=0;s<e.length;s++){let c=e.charCodeAt(s);o=(o<<5)-o+c,o=o&o}return`pid-${Math.abs(o)}`},K=t=>{let e=document.createElement("div");return e.textContent=t,e.innerHTML},Lt=async()=>{try{let t=localStorage.getItem("productDataVersion"),e=t?`/_products/product_data.json?v=${encodeURIComponent(t)}`:"/_products/product_data.json",o=await fetch(e,{cache:"no-store",headers:{Accept:"application/json"}});if(!o.ok)throw new Error(`HTTP error. Status: ${o.status}`);return(await o.json()).products.map(c=>({...c,id:St(c),name:K(c.name),description:K(c.description),category:K(c.category),categoryKey:G(c.category)}))}catch(t){throw console.error("Error al obtener productos:",t),h(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${t.message})`),t}},u=(t,e={},o=[])=>{let s=document.createElement(t);return Object.entries(e).forEach(([c,f])=>{c==="text"?s.textContent=f:s.setAttribute(c,f)}),o.forEach(c=>{typeof c=="string"?s.appendChild(document.createTextNode(c)):s.appendChild(c)}),s},h=t=>{let e=u("div",{class:"error-message",role:"alert"},[u("p",{},[t]),u("button",{class:"retry-button"},["Intentar nuevamente"])]),o=document.getElementById("product-container");o?(o.innerHTML="",o.appendChild(e),e.querySelector(".retry-button").addEventListener("click",Pt)):console.error("Contenedor de productos no encontrado")},b=[];try{b=JSON.parse(globalThis.localStorage?.getItem("cart"))||[]}catch{b=[]}var ie=t=>{let e=b.find(o=>o.id===t);return e?e.quantity:0},j=()=>{let t=document.getElementById("cart-count"),e=b.reduce((o,s)=>o+s.quantity,0);t&&(t.textContent=e,t.setAttribute("aria-label",`${e} items in cart`))},tt=()=>{try{globalThis.localStorage?.setItem("cart",JSON.stringify(b))}catch(t){console.error("Error al guardar el carrito:",t),h("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},J=(t,e,o)=>{!t||!e||(o?(t.style.display="none",e.style.display="flex"):(e.style.display="none",t.style.display="flex"))},et=()=>{let t=document.getElementById("cart-items"),e=document.getElementById("cart-total");if(!t||!e)return;t.innerHTML="";let o=0;b.forEach(s=>{let c=s.price-(s.discount||0),f=u("div",{class:"cart-item","data-id":s.id});f.appendChild(u("span",{class:"item-quantity"},[s.quantity.toString()])),t.appendChild(f),o+=c*s.quantity}),e.textContent=`$${o.toLocaleString("es-CL")}`},It=(t,e)=>{try{let o=b.find(c=>c.id===t.id);o?o.quantity=Math.min(o.quantity+e,50):b.push({id:t.id,name:t.name,description:t.description,price:t.price,discount:t.discount,image_path:t.image_path,quantity:Math.min(e,50),category:t.category,stock:t.stock}),tt(),j(),et();let s=document.querySelector(`[data-id="${t.id}"].quantity-input`);s&&(s.value=Math.max(ie(t.id),1))}catch(o){console.error("Error al agregar al carrito:",o),h("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},qt=t=>{try{b=b.filter(o=>o.id!==t),tt(),j(),et();let e=document.querySelector(`.action-area[data-pid="${t}"]`);if(e){let o=e.querySelector(".add-to-cart-btn"),s=e.querySelector(".quantity-control");J(o,s,!1)}}catch(e){console.error("Error al eliminar del carrito:",e),h("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},ce=(t,e)=>{try{let o=b.find(y=>y.id===t.id),s=o?o.quantity+e:1,c=document.querySelector(`.action-area[data-pid="${t.id}"]`),f=c?.querySelector(".add-to-cart-btn"),v=c?.querySelector(".quantity-control");if(s<=0)qt(t.id),J(f,v,!1);else if(s<=50){o?o.quantity=s:(It(t,1),J(f,v,!0)),tt(),j(),et();let y=document.querySelector(`[data-id="${t.id}"].quantity-input`);y&&(y.value=s,y.classList.add("quantity-changed"),setTimeout(()=>y.classList.remove("quantity-changed"),300))}}catch(o){console.error("Error al actualizar cantidad:",o),h("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}};typeof window<"u"&&(window.__APP_READY__=!1,window.addEventListener("error",t=>{let e=t.target||t.srcElement,o=!!(e&&(e.tagName==="IMG"||e.tagName==="SCRIPT"||e.tagName==="LINK")),s=!!t.error;if(o||!s){console.warn("Ignored non-fatal error:",{tag:e&&e.tagName,src:e&&(e.src||e.href||e.currentSrc)});return}if(!window.__APP_READY__){console.error("Runtime error before app ready:",t.error);return}console.error("Unhandled JS error:",t.error),h("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")}),window.addEventListener("securitypolicyviolation",t=>{console.warn("CSP violation (logged only):",{blockedURI:t.blockedURI,violatedDirective:t.violatedDirective,sourceFile:t.sourceFile})}));var Pt=async()=>{if(console.log("Initializing app..."),typeof DOMPurify>"u")try{await new Promise((n,r)=>{let i=document.createElement("script");i.src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.8/purify.min.js",i.onload=n,i.onerror=r,document.head.appendChild(i)})}catch{console.warn("DOMPurify CDN blocked; using noop sanitizer"),window.DOMPurify={sanitize:r=>r}}let t=document.getElementById("navbar-container"),e=document.getElementById("footer-container"),o=document.getElementById("product-container"),s=document.getElementById("sort-options"),c=document.getElementById("filter-keyword"),f=()=>{let n=document.getElementById("filter-discount");if(n)return n;let r=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),i=r?r.querySelector(".row"):null;if(!i)return null;let d=u("div",{class:"col-12 mt-2"}),a=u("div",{class:"form-check form-switch"}),l=u("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),m=u("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return a.appendChild(l),a.appendChild(m),d.appendChild(a),i.appendChild(d),l},v=[],y=JSON.parse(localStorage.getItem("cart"))||[],R=()=>{let n=document.getElementById("offline-indicator");n&&n.classList.toggle("is-hidden",navigator.onLine),navigator.onLine||console.log("App is offline. Using cached data if available.")},nt=async(n,r)=>{if(!n){console.warn(`Contenedor no encontrado para el componente: ${r}`);return}try{let i=await fetch(r);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);let d=await i.text(),a=DOMPurify.sanitize(d,{USE_PROFILES:{html:!0},ALLOWED_TAGS:["div","span","p","h1","h2","h3","h4","h5","h6","ul","ol","li","a","img","br","strong","em","button","nav","footer","header","main","section"],ALLOWED_ATTR:["href","src","alt","class","id","style","aria-label","role","type","data-bs-toggle","data-bs-target","aria-controls","aria-expanded"]});n.innerHTML="";let m=new DOMParser().parseFromString(a,"text/html");Array.from(m.body.children).forEach(p=>{n.appendChild(p.cloneNode(!0))})}catch(i){throw console.error("Error al cargar componente:",{component:r,message:i.message}),i}};function xt(){let n=document.getElementById("current-year");n&&(n.textContent=new Date().getFullYear())}let At=async()=>{try{await Promise.all([nt(t,"/pages/navbar.html"),nt(e,"/pages/footer.html")]),console.log("Components loaded successfully"),xt()}catch(n){console.error("Error al cargar componentes:",n),h("Error al cargar los componentes de la p\xE1gina. Por favor, actualice la p\xE1gina o verifique su conexi\xF3n a internet.")}},$t=(n,r,i="CLP")=>{let d=new Intl.NumberFormat("es-CL",{style:"currency",currency:i,minimumFractionDigits:0}),a=d.format(n);if(r){let l=n-r,m=d.format(l);return u("div",{class:"precio-container"},[u("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[m]),u("span",{class:"precio-original","aria-label":"Precio original"},[u("span",{class:"tachado"},[a])])])}return u("div",{class:"precio-container"},[u("span",{class:"precio","aria-label":"Precio"},[a])])},Tt=n=>{let r=u("div",{class:"quantity-control"}),i=u("button",{class:"quantity-btn","aria-label":"Decrease quantity"},["-"]),d=u("button",{class:"quantity-btn","aria-label":"Increase quantity"},["+"]),a=u("input",{type:"number",class:"quantity-input",value:Math.max(F(n.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":n.id});return i.addEventListener("click",()=>$(n,-1)),d.addEventListener("click",()=>$(n,1)),a.addEventListener("change",l=>{let m=parseInt(l.target.value,10),p=F(n.id);$(n,m-p)}),r.appendChild(i),r.appendChild(a),r.appendChild(d),r},F=n=>{let r=y.find(i=>i.id===n);return r?r.quantity:0},Ot=n=>{let r=document.createDocumentFragment(),i=window.location.pathname.includes("/pages/");n.forEach(a=>{let{id:l,name:m,description:p,image_path:L,price:z,discount:_,stock:H}=a,B=u("div",{class:`producto col-12 col-sm-6 col-md-4 col-lg-3 mb-4 ${H?"":"agotado"}`,"aria-label":`Product: ${m}`}),k=u("div",{class:"card"});if(_&&Number(_)>0){let q=Math.round(Number(_)/Number(z)*100),C=u("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(q)?q:0}%`]);k.appendChild(C)}let I;i?I=`../${L.replace(/^\//,"")}`:I=L;let E={"data-src":I,alt:m,class:"card-img-top lazyload",loading:"lazy",decoding:"async",width:"400",height:"400"};if(Array.isArray(a.image_variants)){let q=a.image_variants.filter(C=>C&&C.url&&C.width).sort((C,Rt)=>C.width-Rt.width).map(C=>`${i?`../${String(C.url).replace(/^\//,"")}`:C.url} ${C.width}w`);q.length&&(E["data-srcset"]=q.join(", "),E["data-sizes"]="(max-width: 576px) 45vw, (max-width: 992px) 30vw, 25vw")}let rt=u("img",E);k.appendChild(rt);let S=u("div",{class:"card-body"});S.appendChild(u("h3",{class:"card-title"},[m])),S.appendChild(u("p",{class:"card-text"},[p])),S.appendChild($t(z,_));let T=u("div",{class:"action-area","data-pid":l}),w=u("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":l,"aria-label":`Add ${m} to cart`},["Agregar al carrito"]),g=Tt(a);g.style.display="none",w.addEventListener("click",()=>{at(a,1),N(w,g,!0)}),T.appendChild(w),T.appendChild(g),S.appendChild(T);let Q=y.find(q=>q.id===l),O=Q?Q.quantity:0,M=g.querySelector(".quantity-input");O>0?(M&&(M.value=O),w.style.display="none",g.style.display="flex"):(w.style.display="flex",g.style.display="none"),k.appendChild(S),B.appendChild(k),r.appendChild(B)});let d=document.getElementById("product-container");d.innerHTML="",d.appendChild(r),Mt()},Mt=()=>{let n=new IntersectionObserver((r,i)=>{r.forEach(d=>{if(d.isIntersecting){let a=d.target;a.src=a.dataset.src,a.dataset.srcset&&(a.srcset=a.dataset.srcset),a.dataset.sizes&&(a.sizes=a.dataset.sizes),a.classList.remove("lazyload"),i.unobserve(a)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(r=>n.observe(r))},Nt=(n,r,i,d=!1)=>n.filter(a=>(a.name.toLowerCase().includes(r.toLowerCase())||a.description.toLowerCase().includes(r.toLowerCase()))&&a.stock&&(!d||a.discount&&Number(a.discount)>0)).sort((a,l)=>Dt(a,l,i)),Dt=(n,r,i)=>{if(!i||i==="original")return n.originalIndex-r.originalIndex;let[d,a]=i.split("-"),l=d==="price"?n.price-(n.discount||0):n.name.toLowerCase(),m=d==="price"?r.price-(r.discount||0):r.name.toLowerCase();return a==="asc"?l<m?-1:l>m?1:0:m<l?-1:m>l?1:0},zt=oe(Nt),U=()=>{try{let n=s.value||"original",r=c.value.trim(),i=document.getElementById("filter-discount")?.checked||!1,d=zt(v,r,n,i);Ot(d)}catch(n){console.error("Error al actualizar visualizaci\xF3n de productos:",n),h("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},W=re(U,300),A=()=>{let n=document.getElementById("cart-count"),r=y.reduce((i,d)=>i+d.quantity,0);n.textContent=r,n.setAttribute("aria-label",`${r} items in cart`)},at=(n,r)=>{try{let i=y.find(a=>a.id===n.id);i?i.quantity=Math.min(i.quantity+r,50):y.push({id:n.id,name:n.name,description:n.description,price:n.price,discount:n.discount,image_path:n.image_path,quantity:Math.min(r,50),category:n.category,stock:n.stock}),D(),A(),P();let d=document.querySelector(`[data-id="${n.id}"].quantity-input`);d&&(d.value=Math.max(F(n.id),1))}catch(i){console.error("Error al agregar al carrito:",i),h("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},ot=n=>{try{y=y.filter(i=>i.id!==n),D(),A(),P();let r=document.querySelector(`.action-area[data-pid="${n}"]`);if(r){let i=r.querySelector(".add-to-cart-btn"),d=r.querySelector(".quantity-control");N(i,d,!1)}}catch(r){console.error("Error al eliminar del carrito:",r),h("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},$=(n,r)=>{try{let i=y.find(p=>p.id===n.id),d=i?i.quantity+r:1,a=document.querySelector(`.action-area[data-pid="${n.id}"]`),l=a?.querySelector(".add-to-cart-btn"),m=a?.querySelector(".quantity-control");if(d<=0)ot(n.id),N(l,m,!1);else if(d<=50){i?i.quantity=d:(at(n,1),N(l,m,!0)),D(),A(),P();let p=document.querySelector(`[data-id="${n.id}"].quantity-input`);p&&(p.value=d,p.classList.add("quantity-changed"),setTimeout(()=>p.classList.remove("quantity-changed"),300))}}catch(i){console.error("Error al actualizar cantidad:",i),h("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},Bt=()=>{try{y=[],D(),A(),P(),U()}catch(n){console.error("Error al vaciar el carrito:",n),h("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},N=(n,r,i)=>{!n||!r||(i?(n.style.display="none",r.style.display="flex"):(r.style.display="none",n.style.display="flex"))},D=()=>{try{localStorage.setItem("cart",JSON.stringify(y))}catch(n){console.error("Error al guardar el carrito:",n),h("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},P=()=>{let n=document.getElementById("cart-items"),r=document.getElementById("cart-total");n.innerHTML="";let i=0;y.forEach(a=>{let l=a.price-(a.discount||0),m=u("div",{class:"cart-item mb-3 d-flex align-items-start","aria-label":`Cart item: ${a.name}`}),p=u("div",{class:"cart-item-content flex-grow-1"});p.appendChild(u("div",{class:"fw-bold mb-1"},[a.name]));let L=u("div",{class:"mb-2"}),z=u("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":a.id,"aria-label":`Disminuir cantidad de ${a.name}`},["-"]),_=u("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":a.id,"aria-label":`Aumentar cantidad de ${a.name}`},["+"]),H=u("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${a.name}`},[a.quantity.toString()]);L.appendChild(z),L.appendChild(H),L.appendChild(_),p.appendChild(L),p.appendChild(u("div",{class:"text-muted small"},[`Precio: $${l.toLocaleString("es-CL")}`])),p.appendChild(u("div",{class:"fw-bold"},[`Subtotal: $${(l*a.quantity).toLocaleString("es-CL")}`]));let B=u("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":a.id,"aria-label":`Eliminar ${a.name} del carrito`},["Eliminar"]);p.appendChild(B);let k=window.location.pathname.includes("/pages/"),I;k?I=`../${a.image_path.replace(/^\//,"")}`:I=a.image_path;let E=u("div",{class:"cart-item-thumb ms-3 flex-shrink-0"}),S={src:a.thumbnail_path||I,alt:a.name,class:"cart-item-thumb-img",loading:"lazy",decoding:"async",width:"100",height:"100"};if(Array.isArray(a.thumbnail_variants)){let w=a.thumbnail_variants.filter(g=>g&&g.url&&g.width).map(g=>`${g.url} ${g.width}w`);w.length&&(S.srcset=w.join(", "),S.sizes="100px")}let T=u("img",S);if(E.appendChild(T),m.appendChild(p),m.appendChild(E),n.appendChild(m),window.__DEBUG_CART__)try{let w=window.getComputedStyle(m),g=window.getComputedStyle(E),Q=window.getComputedStyle(p),O=E.getBoundingClientRect(),M=p.getBoundingClientRect();console.debug("[cart] item",{name:a.name,order:{firstIsContent:m.firstChild===p,lastIsThumb:m.lastChild===E},container:{display:w.display,flexDirection:w.flexDirection,flexWrap:w.flexWrap},thumb:{width:g.width,height:g.height,rect:{w:O.width,h:O.height}},content:{rect:{w:M.width,h:M.height}}})}catch{}i+=l*a.quantity}),r.textContent=`Total: $${i.toLocaleString("es-CL")}`,r.setAttribute("aria-label",`Total: $${i.toLocaleString("es-CL")}`);let d=document.getElementById("payment-credit-container");if(d)if(i>=3e4)d.classList.remove("d-none");else{d.classList.add("d-none");let a=d.querySelector("input");a&&(a.checked=!1)}},jt=()=>{let n=document.querySelector('input[name="paymentMethod"]:checked');if(!n){alert("Por favor seleccione un m\xE9todo de pago");return}let r=`Mi pedido:

`;y.forEach(a=>{let l=a.price-(a.discount||0);r+=`${a.name}
`,r+=`Cantidad: ${a.quantity}
`,r+=`Precio unitario: $${l.toLocaleString("es-CL")}
`,r+=`Subtotal: $${(l*a.quantity).toLocaleString("es-CL")}

`});let i=y.reduce((a,l)=>a+(l.price-(l.discount||0))*l.quantity,0);r+=`Total: $${i.toLocaleString("es-CL")}
`,r+=`M\xE9todo de pago: ${n.value}`;let d=encodeURIComponent(r);window.open(`https://wa.me/56951118901?text=${d}`,"_blank")};try{if(await At(),v=await Lt(),v.length===0){h("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}let n=document.querySelector("main").dataset.category;if(n){let l=G(n);v=v.filter(m=>(m.categoryKey||G(m.category))===l)}s.addEventListener("change",W),c.addEventListener("input",W);let r=f();r&&r.addEventListener("change",W),U(),typeof window<"u"&&(window.__APP_READY__=!0),window.addEventListener("online",R),window.addEventListener("offline",R),R();let i=document.getElementById("cart-icon"),d=document.getElementById("empty-cart"),a=document.getElementById("submit-cart");i.addEventListener("click",()=>{if(typeof window.bootstrap<"u"&&window.bootstrap.Offcanvas){let l=new window.bootstrap.Offcanvas(document.getElementById("cartOffcanvas"));P(),l.show()}else{console.error("Bootstrap Offcanvas no est\xE1 disponible"),P();let l=document.getElementById("cartOffcanvas");l&&l.classList.add("show")}}),d.addEventListener("click",Bt),a.addEventListener("click",jt),document.getElementById("cart-items").addEventListener("click",l=>{let m=l.target,p=m.closest("[data-id]")?.dataset.id;p&&(m.classList.contains("decrease-quantity")?$({id:p},-1):m.classList.contains("increase-quantity")?$({id:p},1):m.classList.contains("remove-item")&&ot(p))}),A(),"performance"in window&&window.addEventListener("load",()=>{let l=performance.getEntriesByType("paint"),m=performance.getEntriesByType("navigation")[0];console.log("First Contentful Paint:",l[0].startTime),console.log("DOM Content Loaded:",m.domContentLoadedEventEnd),console.log("Load Time:",m.loadEventEnd)})}catch(n){console.error("Error al inicializar productos:",n),h("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document<"u"&&document.addEventListener("DOMContentLoaded",function(){Et(),Pt().catch(t=>{console.error("Error al inicializar la aplicaci\xF3n:",t),h("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})});typeof Y<"u"&&(Y.exports={generateStableId:St,fetchProducts:Lt,addToCart:It,removeFromCart:qt,updateQuantity:ce,updateCartIcon:j,__getCart:()=>b})});var se=ct(()=>{dt();ut();pt();gt();vt();bt();var Se=Vt(_t());function kt(){let t=document.documentElement;try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-defer]').forEach(e=>{e.media="all",e.removeAttribute("data-defer")})}catch{}t.dataset.enhancementsInit!=="1"&&(t.dataset.enhancementsInit="1",st(),wt(),lt(),mt(),yt(),ft(),ht())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",kt):kt()});se();})();
