"use strict";(()=>{var se=(n,i)=>()=>(i||n((i={exports:{}}).exports,i),i.exports);var Ce=se((we,H)=>{var _={path:"/service-worker.js",scope:"/",updateCheckInterval:3e5};function J(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}window.addEventListener("load",async()=>{try{de()}catch(n){console.error("Service Worker initialization failed:",n),ye("Failed to initialize service worker. Some features may not work offline.")}})}async function de(){try{let n=await navigator.serviceWorker.register(_.path,{scope:_.scope});console.log("ServiceWorker registered successfully:",n.scope),le(n),ue(n),pe(),me()}catch(n){throw console.error("ServiceWorker registration failed:",n),n}}function le(n){n.addEventListener("updatefound",()=>{let i=n.installing;i.addEventListener("statechange",()=>{i.state==="installed"&&navigator.serviceWorker.controller&&i.postMessage({type:"SKIP_WAITING"})})})}function ue(n){G(n),setInterval(()=>{G(n)},_.updateCheckInterval)}async function G(n){try{await n.update();let i=await fetch("/_products/product_data.json",{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(i.ok){let p=(await i.json()).version,u=localStorage.getItem("productDataVersion");p!==u&&(n.active?.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",p),fe(null,"New product data available"))}}catch(i){console.warn("Update check failed:",i)}}function pe(){let n=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{n||(n=!0,window.location.reload())})}function me(){let n=()=>{let i=document.getElementById("offline-indicator");i&&(i.style.display=navigator.onLine?"none":"block"),navigator.onLine||ge("You are currently offline. Some features may be limited.")};window.addEventListener("online",n),window.addEventListener("offline",n),n()}function fe(n,i="Una versi\xF3n est\xE1 disponible"){let l=j(i,"Actualizar ahora","Despu\xE9s",()=>{n?n.postMessage({type:"SKIP_WAITING"}):window.location.reload()});F(l)}function ye(n){let i=j(n,"Reload","Dismiss",()=>window.location.reload());F(i)}function ge(n){let i=j(n,"Retry","Dismiss",()=>window.location.reload());F(i)}function j(n,i,l,p){let u=document.createElement("div");return u.className="notification-toast",u.setAttribute("role","alert"),u.setAttribute("aria-live","polite"),u.innerHTML=`
        <div class="notification-content">
            <p>${n}</p>
            <div class="notification-actions">
                <button class="primary-action">${i}</button>
                <button class="secondary-action">${l}</button>
            </div>
        </div>
    `,u.querySelector(".primary-action").addEventListener("click",()=>{p(),u.remove()}),u.querySelector(".secondary-action").addEventListener("click",()=>{u.remove()}),u}function F(n){let i=document.querySelector(".notification-toast");i&&i.remove(),document.body.appendChild(n),setTimeout(()=>{document.body.contains(n)&&n.remove()},300*1e3)}typeof navigator<"u"&&"serviceWorker"in navigator&&J();var he=(n,i=100)=>{let l=new Map;return(...p)=>{let u=JSON.stringify(p);if(l.has(u))return l.get(u);let b=n(...p);if(l.size>=i){let h=l.keys().next().value;l.delete(h)}return l.set(u,b),b}},ve=(n,i)=>{let l;return(...p)=>{clearTimeout(l),l=setTimeout(()=>n(...p),i)}},X=n=>{let i=`${n.name}-${n.category}`.toLowerCase(),l=0;for(let p=0;p<i.length;p++){let u=i.charCodeAt(p);l=(l<<5)-l+u,l=l&l}return`pid-${Math.abs(l)}`},W=n=>{let i=document.createElement("div");return i.textContent=n,i.innerHTML},be=async()=>{try{let n=await fetch("/_products/product_data.json",{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!n.ok)throw new Error(`HTTP error. Status: ${n.status}`);return(await n.json()).products.map(l=>({...l,id:X(l),name:W(l.name),description:W(l.description),category:W(l.category)}))}catch(n){throw console.error("Error al obtener productos:",n),y(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${n.message})`),n}},s=(n,i={},l=[])=>{let p=document.createElement(n);return Object.entries(i).forEach(([u,b])=>{u==="text"?p.textContent=b:p.setAttribute(u,b)}),l.forEach(u=>{typeof u=="string"?p.appendChild(document.createTextNode(u)):p.appendChild(u)}),p},y=n=>{let i=s("div",{class:"error-message",role:"alert"},[s("p",{},[n]),s("button",{class:"retry-button"},["Intentar nuevamente"])]),l=document.getElementById("product-container");l?(l.innerHTML="",l.appendChild(i),i.querySelector(".retry-button").addEventListener("click",Y)):console.error("Contenedor de productos no encontrado")};typeof window<"u"&&window.addEventListener("error",n=>{console.error("Error global:",n.error),y("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")});var Y=async()=>{if(console.log("Initializing app..."),typeof DOMPurify>"u")try{await new Promise((e,a)=>{let o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.8/purify.min.js",o.onload=e,o.onerror=a,document.head.appendChild(o)})}catch(e){console.error("Failed to load DOMPurify:",e),y("Failed to load required dependencies. Please refresh the page.");return}let n=document.getElementById("navbar-container"),i=document.getElementById("footer-container"),l=document.getElementById("product-container"),p=document.getElementById("sort-options"),u=document.getElementById("filter-keyword"),b=()=>{let e=document.getElementById("filter-discount");if(e)return e;let a=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),o=a?a.querySelector(".row"):null;if(!o)return null;let r=s("div",{class:"col-12 mt-2"}),t=s("div",{class:"form-check form-switch"}),c=s("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),d=s("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return t.appendChild(c),t.appendChild(d),r.appendChild(t),o.appendChild(r),c},h=[],f=JSON.parse(localStorage.getItem("cart"))||[],x=()=>{let e=document.getElementById("offline-indicator");e&&(e.style.display=navigator.onLine?"none":"block"),navigator.onLine||console.log("App is offline. Using cached data if available.")},R=async(e,a)=>{if(!e){console.warn(`Contenedor no encontrado para el componente: ${a}`);return}try{let o=await fetch(a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let r=await o.text(),t=DOMPurify.sanitize(r,{USE_PROFILES:{html:!0},ALLOWED_TAGS:["div","span","p","h1","h2","h3","h4","h5","h6","ul","ol","li","a","img","br","strong","em","button","nav","footer","header","main","section"],ALLOWED_ATTR:["href","src","alt","class","id","style","aria-label","role","type","data-bs-toggle","data-bs-target","aria-controls","aria-expanded"]});e.innerHTML="";let d=new DOMParser().parseFromString(t,"text/html");Array.from(d.body.children).forEach(m=>{e.appendChild(m.cloneNode(!0))})}catch(o){throw console.error("Error al cargar componente:",{component:a,message:o.message}),o}},Z=async()=>{try{await Promise.all([R(n,"/pages/navbar.html"),R(i,"/pages/footer.html")]),console.log("Components loaded successfully")}catch(e){console.error("Error al cargar componentes:",e),y("Error al cargar los componentes de la p\xE1gina. Por favor, actualice la p\xE1gina o verifique su conexi\xF3n a internet.")}},ee=(e,a,o="CLP")=>{let r=new Intl.NumberFormat("es-CL",{style:"currency",currency:o,minimumFractionDigits:0}),t=r.format(e);if(a){let c=e-a,d=r.format(c);return s("div",{class:"precio-container"},[s("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[d]),s("span",{class:"precio-original","aria-label":"Precio original"},[s("span",{class:"tachado"},[t])])])}return s("div",{class:"precio-container"},[s("span",{class:"precio","aria-label":"Precio"},[t])])},M=e=>{let a=s("div",{class:"quantity-control"}),o=s("button",{class:"quantity-btn","aria-label":"Decrease quantity"},["-"]),r=s("button",{class:"quantity-btn","aria-label":"Increase quantity"},["+"]),t=s("input",{type:"number",class:"quantity-input",value:Math.max(O(e.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":e.id});return o.addEventListener("click",()=>P(e,-1)),r.addEventListener("click",()=>P(e,1)),t.addEventListener("change",c=>{let d=parseInt(c.target.value,10),m=O(e.id);P(e,d-m)}),a.appendChild(o),a.appendChild(t),a.appendChild(r),a},O=e=>{let a=f.find(o=>o.id===e);return a?a.quantity:0},te=e=>{let a=document.createDocumentFragment(),o=window.location.pathname.includes("/pages/");e.forEach(t=>{let{id:c,name:d,description:m,image_path:C,price:$,discount:I,stock:N}=t,T=s("div",{class:`producto col-12 col-sm-6 col-md-4 col-lg-3 mb-4 ${N?"":"agotado"}`,"aria-label":`Product: ${d}`}),q=s("div",{class:"card"});if(I&&Number(I)>0){let g=Math.round(Number(I)/Number($)*100),w=s("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(g)?g:0}%`]);q.appendChild(w)}let E;o?E=`../${C.replace(/^\//,"")}`:E=C;let B=s("img",{"data-src":E,alt:d,class:"card-img-top lazyload"});q.appendChild(B);let v=s("div",{class:"card-body"});v.appendChild(s("h3",{class:"card-title"},[d])),v.appendChild(s("p",{class:"card-text"},[m])),v.appendChild(ee($,I));let V=f.find(g=>g.id===c),K=V?V.quantity:0;if(K>0){let g=M(t);v.appendChild(g);let w=g.querySelector(".quantity-input");w&&(w.value=K)}else{let g=s("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":c,"aria-label":`Add ${d} to cart`},["Agregar al carrito"]);g.addEventListener("click",()=>{D(t,1);let w=M(t);g.replaceWith(w),w.classList.add("fade-in-up")}),v.appendChild(g)}q.appendChild(v),T.appendChild(q),a.appendChild(T)});let r=document.getElementById("product-container");r.innerHTML="",r.appendChild(a),ne()},ne=()=>{let e=new IntersectionObserver((a,o)=>{a.forEach(r=>{if(r.isIntersecting){let t=r.target;t.src=t.dataset.src,t.classList.remove("lazyload"),o.unobserve(t)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(a=>e.observe(a))},ae=(e,a,o,r=!1)=>e.filter(t=>(t.name.toLowerCase().includes(a.toLowerCase())||t.description.toLowerCase().includes(a.toLowerCase()))&&t.stock&&(!r||t.discount&&Number(t.discount)>0)).sort((t,c)=>oe(t,c,o)),oe=(e,a,o)=>{if(!o||o==="original")return e.originalIndex-a.originalIndex;let[r,t]=o.split("-"),c=r==="price"?e.price-(e.discount||0):e.name.toLowerCase(),d=r==="price"?a.price-(a.discount||0):a.name.toLowerCase();return t==="asc"?c<d?-1:c>d?1:0:d<c?-1:d>c?1:0},re=he(ae),A=()=>{try{let e=p.value||"original",a=u.value.trim(),o=document.getElementById("filter-discount")?.checked||!1,r=re(h,a,e,o);te(r)}catch(e){console.error("Error al actualizar visualizaci\xF3n de productos:",e),y("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},z=ve(A,300),S=()=>{let e=document.getElementById("cart-count"),a=f.reduce((o,r)=>o+r.quantity,0);e.textContent=a,e.setAttribute("aria-label",`${a} items in cart`)},D=(e,a)=>{try{let o=f.find(t=>t.id===e.id);o?o.quantity=Math.min(o.quantity+a,50):f.push({id:e.id,name:e.name,description:e.description,price:e.price,discount:e.discount,image_path:e.image_path,quantity:Math.min(a,50),category:e.category,stock:e.stock}),k(),S(),L();let r=document.querySelector(`[data-id="${e.id}"].quantity-input`);r&&(r.value=Math.max(O(e.id),1))}catch(o){console.error("Error al agregar al carrito:",o),y("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},U=e=>{try{f=f.filter(a=>a.id!==e),k(),S(),L(),Q(e)}catch(a){console.error("Error al eliminar del carrito:",a),y("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},P=(e,a)=>{try{let o=f.find(t=>t.id===e.id),r=o?o.quantity+a:1;if(r<=0)U(e.id),Q(e.id);else if(r<=50){o?o.quantity=r:D(e,1),k(),S(),L();let t=document.querySelector(`[data-id="${e.id}"].quantity-input`);t&&(t.value=r,t.classList.add("quantity-changed"),setTimeout(()=>t.classList.remove("quantity-changed"),300))}}catch(o){console.error("Error al actualizar cantidad:",o),y("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},ie=()=>{try{f=[],k(),S(),L(),A()}catch(e){console.error("Error al vaciar el carrito:",e),y("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},Q=e=>{try{let a=document.querySelector(`input.quantity-input[data-id="${e}"]`);if(!a||!a.closest(".card-body"))return;let r=h.find(d=>d.id===e);if(!r){let d=a.closest(".quantity-control");d&&d.remove();return}let t=s("button",{class:"btn btn-primary mt-2","data-id":r.id,"aria-label":`Add ${r.name} to cart`},["Agregar"]);t.addEventListener("click",()=>{D(r,1);let d=M(r);t.replaceWith(d)});let c=a.closest(".quantity-control");c&&c.replaceWith(t)}catch(a){console.warn("updateProductCardToAdd failed:",a)}},k=()=>{try{localStorage.setItem("cart",JSON.stringify(f))}catch(e){console.error("Error al guardar el carrito:",e),y("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},L=()=>{let e=document.getElementById("cart-items"),a=document.getElementById("cart-total");e.innerHTML="";let o=0;f.forEach(t=>{let c=t.price-(t.discount||0),d=s("div",{class:"cart-item mb-3 d-flex align-items-center","aria-label":`Cart item: ${t.name}`,style:"flex-direction: row; align-items: center;"}),m=s("div",{class:"cart-item-content flex-grow-1"});m.appendChild(s("div",{class:"fw-bold mb-1"},[t.name]));let C=s("div",{class:"mb-2"}),$=s("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":t.id,"aria-label":`Disminuir cantidad de ${t.name}`},["-"]),I=s("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":t.id,"aria-label":`Aumentar cantidad de ${t.name}`},["+"]),N=s("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${t.name}`},[t.quantity.toString()]);C.appendChild($),C.appendChild(N),C.appendChild(I),m.appendChild(C),m.appendChild(s("div",{class:"text-muted small"},[`Precio: $${c.toLocaleString("es-CL")}`])),m.appendChild(s("div",{class:"fw-bold"},[`Subtotal: $${(c*t.quantity).toLocaleString("es-CL")}`]));let T=s("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":t.id,"aria-label":`Eliminar ${t.name} del carrito`},["Eliminar"]);m.appendChild(T);let q=window.location.pathname.includes("/pages/"),E;q?E=`../${t.image_path.replace(/^\//,"")}`:E=t.image_path;let B=s("div",{class:"cart-item-thumbnail",style:"width: 60px; height: 60px; flex-shrink: 0; margin-left: auto;"}),v=s("img",{src:E,alt:t.name,class:"img-fluid rounded",style:"width: 100%; height: 100%; object-fit: cover;"});B.appendChild(v),d.appendChild(m),d.appendChild(B),e.appendChild(d),o+=c*t.quantity}),a.textContent=`Total: $${o.toLocaleString("es-CL")}`,a.setAttribute("aria-label",`Total: $${o.toLocaleString("es-CL")}`);let r=document.getElementById("payment-credit-container");if(r)if(o>=3e4)r.classList.remove("d-none");else{r.classList.add("d-none");let t=r.querySelector("input");t&&(t.checked=!1)}},ce=()=>{let e=document.querySelector('input[name="paymentMethod"]:checked');if(!e){alert("Por favor seleccione un m\xE9todo de pago");return}let a=`Mi pedido:

`;f.forEach(t=>{let c=t.price-(t.discount||0);a+=`${t.name}
`,a+=`Cantidad: ${t.quantity}
`,a+=`Precio unitario: $${c.toLocaleString("es-CL")}
`,a+=`Subtotal: $${(c*t.quantity).toLocaleString("es-CL")}

`});let o=f.reduce((t,c)=>t+(c.price-(c.discount||0))*c.quantity,0);a+=`Total: $${o.toLocaleString("es-CL")}
`,a+=`M\xE9todo de pago: ${e.value}`;let r=encodeURIComponent(a);window.open(`https://wa.me/56951118901?text=${r}`,"_blank")};try{if(await Z(),h=await be(),h.length===0){y("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}let e=document.querySelector("main").dataset.category;e&&(h=h.filter(c=>c.category===e)),p.addEventListener("change",z),u.addEventListener("input",z);let a=b();a&&a.addEventListener("change",z),A(),window.addEventListener("online",x),window.addEventListener("offline",x),x();let o=document.getElementById("cart-icon"),r=document.getElementById("empty-cart"),t=document.getElementById("submit-cart");o.addEventListener("click",()=>{if(typeof window.bootstrap<"u"&&window.bootstrap.Offcanvas){let c=new window.bootstrap.Offcanvas(document.getElementById("cartOffcanvas"));L(),c.show()}else{console.error("Bootstrap Offcanvas no est\xE1 disponible"),L();let c=document.getElementById("cartOffcanvas");c&&c.classList.add("show")}}),r.addEventListener("click",ie),t.addEventListener("click",ce),document.getElementById("cart-items").addEventListener("click",c=>{let d=c.target,m=d.closest("[data-id]")?.dataset.id;m&&(d.classList.contains("decrease-quantity")?P({id:m},-1):d.classList.contains("increase-quantity")?P({id:m},1):d.classList.contains("remove-item")&&U(m))}),S(),"performance"in window&&window.addEventListener("load",()=>{let c=performance.getEntriesByType("paint"),d=performance.getEntriesByType("navigation")[0];console.log("First Contentful Paint:",c[0].startTime),console.log("DOM Content Loaded:",d.domContentLoadedEventEnd),console.log("Load Time:",d.loadEventEnd)})}catch(e){console.error("Error al inicializar productos:",e),y("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document<"u"&&document.addEventListener("DOMContentLoaded",function(){J(),Y().catch(n=>{console.error("Error al inicializar la aplicaci\xF3n:",n),y("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})});typeof H<"u"&&(H.exports={generateStableId:X});typeof document<"u"&&document.addEventListener("DOMContentLoaded",function(){var n=document.createElement("script");n.src="assets/js/cart-enhancements.js",document.body.appendChild(n)})});Ce();})();
