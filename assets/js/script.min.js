"use strict";(()=>{var ue=(n,i)=>()=>(i||n((i={exports:{}}).exports,i),i.exports);var Le=ue((Se,F)=>{var W={path:"/service-worker.js",scope:"/",updateCheckInterval:3e5};function Y(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}window.addEventListener("load",async()=>{try{pe()}catch(n){console.error("Service Worker initialization failed:",n),ve("Failed to initialize service worker. Some features may not work offline.")}})}async function pe(){try{let n=await navigator.serviceWorker.register(W.path,{scope:W.scope});console.log("ServiceWorker registered successfully:",n.scope),me(n),fe(n),ye(),ge()}catch(n){throw console.error("ServiceWorker registration failed:",n),n}}function me(n){n.addEventListener("updatefound",()=>{let i=n.installing;i.addEventListener("statechange",()=>{i.state==="installed"&&navigator.serviceWorker.controller&&i.postMessage({type:"SKIP_WAITING"})})})}function fe(n){J(n),setInterval(()=>{J(n)},W.updateCheckInterval)}async function J(n){try{await n.update();let i=await fetch("/_products/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(i.ok){let p=(await i.json()).version,d=localStorage.getItem("productDataVersion");p!==d&&(n.active?.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",p),he(null,"New product data available"))}}catch(i){console.warn("Update check failed:",i)}}function ye(){let n=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{n||(n=!0,window.location.reload())})}function ge(){let n=()=>{let i=document.getElementById("offline-indicator");i&&(i.style.display=navigator.onLine?"none":"block"),navigator.onLine||be("You are currently offline. Some features may be limited.")};window.addEventListener("online",n),window.addEventListener("offline",n),n()}function he(n,i="Una versi\xF3n est\xE1 disponible"){let l=H(i,"Actualizar ahora","Despu\xE9s",()=>{n?n.postMessage({type:"SKIP_WAITING"}):window.location.reload()});j(l)}function ve(n){let i=H(n,"Reload","Dismiss",()=>window.location.reload());j(i)}function be(n){let i=H(n,"Retry","Dismiss",()=>window.location.reload());j(i)}function H(n,i,l,p){let d=document.createElement("div");return d.className="notification-toast",d.setAttribute("role","alert"),d.setAttribute("aria-live","polite"),d.innerHTML=`
        <div class="notification-content">
            <p>${n}</p>
            <div class="notification-actions">
                <button class="primary-action">${i}</button>
                <button class="secondary-action">${l}</button>
            </div>
        </div>
    `,d.querySelector(".primary-action").addEventListener("click",()=>{p(),d.remove()}),d.querySelector(".secondary-action").addEventListener("click",()=>{d.remove()}),d}function j(n){let i=document.querySelector(".notification-toast");i&&i.remove(),document.body.appendChild(n),setTimeout(()=>{document.body.contains(n)&&n.remove()},300*1e3)}typeof navigator<"u"&&"serviceWorker"in navigator&&Y();var Ce=(n,i=100)=>{let l=new Map;return(...p)=>{let d=JSON.stringify(p);if(l.has(d))return l.get(d);let g=n(...p);if(l.size>=i){let h=l.keys().next().value;l.delete(h)}return l.set(d,g),g}},Ee=(n,i)=>{let l;return(...d)=>{clearTimeout(l),l=setTimeout(()=>n(...d),i)}},Z=n=>{let i=`${n.name}-${n.category}`.toLowerCase(),l=0;for(let p=0;p<i.length;p++){let d=i.charCodeAt(p);l=(l<<5)-l+d,l=l&l}return`pid-${Math.abs(l)}`},_=n=>{let i=document.createElement("div");return i.textContent=n,i.innerHTML},we=async()=>{try{let n=await fetch("/_products/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(!n.ok)throw new Error(`HTTP error. Status: ${n.status}`);return(await n.json()).products.map(l=>({...l,id:Z(l),name:_(l.name),description:_(l.description),category:_(l.category),categoryKey:normalizeString(l.category)}))}catch(n){throw console.error("Error al obtener productos:",n),y(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${n.message})`),n}},s=(n,i={},l=[])=>{let p=document.createElement(n);return Object.entries(i).forEach(([d,g])=>{d==="text"?p.textContent=g:p.setAttribute(d,g)}),l.forEach(d=>{typeof d=="string"?p.appendChild(document.createTextNode(d)):p.appendChild(d)}),p},y=n=>{let i=s("div",{class:"error-message",role:"alert"},[s("p",{},[n]),s("button",{class:"retry-button"},["Intentar nuevamente"])]),l=document.getElementById("product-container");l?(l.innerHTML="",l.appendChild(i),i.querySelector(".retry-button").addEventListener("click",X)):console.error("Contenedor de productos no encontrado")};typeof window<"u"&&window.addEventListener("error",n=>{console.error("Error global:",n.error),y("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")});var X=async()=>{if(console.log("Initializing app..."),typeof DOMPurify>"u")try{await new Promise((e,a)=>{let o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.8/purify.min.js",o.onload=e,o.onerror=a,document.head.appendChild(o)})}catch(e){console.error("Failed to load DOMPurify:",e),y("Failed to load required dependencies. Please refresh the page.");return}let n=document.getElementById("navbar-container"),i=document.getElementById("footer-container"),l=document.getElementById("product-container"),p=document.getElementById("sort-options"),d=document.getElementById("filter-keyword"),g=()=>{let e=document.getElementById("filter-discount");if(e)return e;let a=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),o=a?a.querySelector(".row"):null;if(!o)return null;let r=s("div",{class:"col-12 mt-2"}),t=s("div",{class:"form-check form-switch"}),c=s("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),u=s("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return t.appendChild(c),t.appendChild(u),r.appendChild(t),o.appendChild(r),c},h=[],f=JSON.parse(localStorage.getItem("cart"))||[],B=()=>{let e=document.getElementById("offline-indicator");e&&(e.style.display=navigator.onLine?"none":"block"),navigator.onLine||console.log("App is offline. Using cached data if available.")},U=async(e,a)=>{if(!e){console.warn(`Contenedor no encontrado para el componente: ${a}`);return}try{let o=await fetch(a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let r=await o.text(),t=DOMPurify.sanitize(r,{USE_PROFILES:{html:!0},ALLOWED_TAGS:["div","span","p","h1","h2","h3","h4","h5","h6","ul","ol","li","a","img","br","strong","em","button","nav","footer","header","main","section"],ALLOWED_ATTR:["href","src","alt","class","id","style","aria-label","role","type","data-bs-toggle","data-bs-target","aria-controls","aria-expanded"]});e.innerHTML="";let u=new DOMParser().parseFromString(t,"text/html");Array.from(u.body.children).forEach(m=>{e.appendChild(m.cloneNode(!0))})}catch(o){throw console.error("Error al cargar componente:",{component:a,message:o.message}),o}},ee=async()=>{try{await Promise.all([U(n,"/pages/navbar.html"),U(i,"/pages/footer.html")]),console.log("Components loaded successfully")}catch(e){console.error("Error al cargar componentes:",e),y("Error al cargar los componentes de la p\xE1gina. Por favor, actualice la p\xE1gina o verifique su conexi\xF3n a internet.")}},te=(e,a,o="CLP")=>{let r=new Intl.NumberFormat("es-CL",{style:"currency",currency:o,minimumFractionDigits:0}),t=r.format(e);if(a){let c=e-a,u=r.format(c);return s("div",{class:"precio-container"},[s("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[u]),s("span",{class:"precio-original","aria-label":"Precio original"},[s("span",{class:"tachado"},[t])])])}return s("div",{class:"precio-container"},[s("span",{class:"precio","aria-label":"Precio"},[t])])},ne=e=>{let a=s("div",{class:"quantity-control"}),o=s("button",{class:"quantity-btn","aria-label":"Decrease quantity"},["-"]),r=s("button",{class:"quantity-btn","aria-label":"Increase quantity"},["+"]),t=s("input",{type:"number",class:"quantity-input",value:Math.max(O(e.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":e.id});return o.addEventListener("click",()=>P(e,-1)),r.addEventListener("click",()=>P(e,1)),t.addEventListener("change",c=>{let u=parseInt(c.target.value,10),m=O(e.id);P(e,u-m)}),a.appendChild(o),a.appendChild(t),a.appendChild(r),a},O=e=>{let a=f.find(o=>o.id===e);return a?a.quantity:0},ae=e=>{let a=document.createDocumentFragment(),o=window.location.pathname.includes("/pages/");e.forEach(t=>{let{id:c,name:u,description:m,image_path:v,price:$,discount:I,stock:z}=t,T=s("div",{class:`producto col-12 col-sm-6 col-md-4 col-lg-3 mb-4 ${z?"":"agotado"}`,"aria-label":`Product: ${u}`}),S=s("div",{class:"card"});if(I&&Number(I)>0){let E=Math.round(Number(I)/Number($)*100),de=s("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(E)?E:0}%`]);S.appendChild(de)}let b;o?b=`../${v.replace(/^\//,"")}`:b=v;let x=s("img",{"data-src":b,alt:u,class:"card-img-top lazyload"});S.appendChild(x);let C=s("div",{class:"card-body"});C.appendChild(s("h3",{class:"card-title"},[u])),C.appendChild(s("p",{class:"card-text"},[m])),C.appendChild(te($,I));let D=s("div",{class:"action-area","data-pid":c}),K=s("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":c,"aria-label":`Add ${u} to cart`},["Agregar al carrito"]);K.addEventListener("click",()=>{R(t,1),w(c,!0)});let N=ne(t);N.style.display="none",D.appendChild(K),D.appendChild(N),C.appendChild(D);let V=f.find(E=>E.id===c),G=V?V.quantity:0;if(G>0){let E=N.querySelector(".quantity-input");E&&(E.value=G),w(c,!0)}else w(c,!1);S.appendChild(C),T.appendChild(S),a.appendChild(T)});let r=document.getElementById("product-container");r.innerHTML="",r.appendChild(a),oe()},oe=()=>{let e=new IntersectionObserver((a,o)=>{a.forEach(r=>{if(r.isIntersecting){let t=r.target;t.src=t.dataset.src,t.classList.remove("lazyload"),o.unobserve(t)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(a=>e.observe(a))},re=(e,a,o,r=!1)=>e.filter(t=>(t.name.toLowerCase().includes(a.toLowerCase())||t.description.toLowerCase().includes(a.toLowerCase()))&&t.stock&&(!r||t.discount&&Number(t.discount)>0)).sort((t,c)=>ie(t,c,o)),ie=(e,a,o)=>{if(!o||o==="original")return e.originalIndex-a.originalIndex;let[r,t]=o.split("-"),c=r==="price"?e.price-(e.discount||0):e.name.toLowerCase(),u=r==="price"?a.price-(a.discount||0):a.name.toLowerCase();return t==="asc"?c<u?-1:c>u?1:0:u<c?-1:u>c?1:0},ce=Ce(re),A=()=>{try{let e=p.value||"original",a=d.value.trim(),o=document.getElementById("filter-discount")?.checked||!1,r=ce(h,a,e,o);ae(r)}catch(e){console.error("Error al actualizar visualizaci\xF3n de productos:",e),y("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},M=Ee(A,300),q=()=>{let e=document.getElementById("cart-count"),a=f.reduce((o,r)=>o+r.quantity,0);e.textContent=a,e.setAttribute("aria-label",`${a} items in cart`)},R=(e,a)=>{try{let o=f.find(t=>t.id===e.id);o?o.quantity=Math.min(o.quantity+a,50):f.push({id:e.id,name:e.name,description:e.description,price:e.price,discount:e.discount,image_path:e.image_path,quantity:Math.min(a,50),category:e.category,stock:e.stock}),k(),q(),L();let r=document.querySelector(`[data-id="${e.id}"].quantity-input`);r&&(r.value=Math.max(O(e.id),1))}catch(o){console.error("Error al agregar al carrito:",o),y("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},Q=e=>{try{f=f.filter(a=>a.id!==e),k(),q(),L(),w(e,!1)}catch(a){console.error("Error al eliminar del carrito:",a),y("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},P=(e,a)=>{try{let o=f.find(t=>t.id===e.id),r=o?o.quantity+a:1;if(r<=0)Q(e.id),w(e.id,!1);else if(r<=50){o?o.quantity=r:(R(e,1),w(e.id,!0)),k(),q(),L();let t=document.querySelector(`[data-id="${e.id}"].quantity-input`);t&&(t.value=r,t.classList.add("quantity-changed"),setTimeout(()=>t.classList.remove("quantity-changed"),300))}}catch(o){console.error("Error al actualizar cantidad:",o),y("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},se=()=>{try{f=[],k(),q(),L(),A()}catch(e){console.error("Error al vaciar el carrito:",e),y("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},w=(e,a)=>{let o=document.querySelector(`.action-area[data-pid="${e}"]`);if(!o)return;let r=o.querySelector(".btn.btn-primary"),t=o.querySelector(".quantity-control");!r||!t||(a?(r.style.display="none",t.style.display="flex"):(t.style.display="none",r.style.display="flex"))},k=()=>{try{localStorage.setItem("cart",JSON.stringify(f))}catch(e){console.error("Error al guardar el carrito:",e),y("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},L=()=>{let e=document.getElementById("cart-items"),a=document.getElementById("cart-total");e.innerHTML="";let o=0;f.forEach(t=>{let c=t.price-(t.discount||0),u=s("div",{class:"cart-item mb-3 d-flex align-items-center","aria-label":`Cart item: ${t.name}`,style:"flex-direction: row; align-items: center;"}),m=s("div",{class:"cart-item-content flex-grow-1"});m.appendChild(s("div",{class:"fw-bold mb-1"},[t.name]));let v=s("div",{class:"mb-2"}),$=s("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":t.id,"aria-label":`Disminuir cantidad de ${t.name}`},["-"]),I=s("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":t.id,"aria-label":`Aumentar cantidad de ${t.name}`},["+"]),z=s("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${t.name}`},[t.quantity.toString()]);v.appendChild($),v.appendChild(z),v.appendChild(I),m.appendChild(v),m.appendChild(s("div",{class:"text-muted small"},[`Precio: $${c.toLocaleString("es-CL")}`])),m.appendChild(s("div",{class:"fw-bold"},[`Subtotal: $${(c*t.quantity).toLocaleString("es-CL")}`]));let T=s("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":t.id,"aria-label":`Eliminar ${t.name} del carrito`},["Eliminar"]);m.appendChild(T);let S=window.location.pathname.includes("/pages/"),b;S?b=`../${t.image_path.replace(/^\//,"")}`:b=t.image_path;let x=s("div",{class:"cart-item-thumbnail",style:"width: 60px; height: 60px; flex-shrink: 0; margin-left: auto;"}),C=s("img",{src:b,alt:t.name,class:"img-fluid rounded",style:"width: 100%; height: 100%; object-fit: cover;"});x.appendChild(C),u.appendChild(m),u.appendChild(x),e.appendChild(u),o+=c*t.quantity}),a.textContent=`Total: $${o.toLocaleString("es-CL")}`,a.setAttribute("aria-label",`Total: $${o.toLocaleString("es-CL")}`);let r=document.getElementById("payment-credit-container");if(r)if(o>=3e4)r.classList.remove("d-none");else{r.classList.add("d-none");let t=r.querySelector("input");t&&(t.checked=!1)}},le=()=>{let e=document.querySelector('input[name="paymentMethod"]:checked');if(!e){alert("Por favor seleccione un m\xE9todo de pago");return}let a=`Mi pedido:

`;f.forEach(t=>{let c=t.price-(t.discount||0);a+=`${t.name}
`,a+=`Cantidad: ${t.quantity}
`,a+=`Precio unitario: $${c.toLocaleString("es-CL")}
`,a+=`Subtotal: $${(c*t.quantity).toLocaleString("es-CL")}

`});let o=f.reduce((t,c)=>t+(c.price-(c.discount||0))*c.quantity,0);a+=`Total: $${o.toLocaleString("es-CL")}
`,a+=`M\xE9todo de pago: ${e.value}`;let r=encodeURIComponent(a);window.open(`https://wa.me/56951118901?text=${r}`,"_blank")};try{if(await ee(),h=await we(),h.length===0){y("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}let e=document.querySelector("main").dataset.category;if(e){let c=normalizeString(e);h=h.filter(u=>(u.categoryKey||normalizeString(u.category))===c)}p.addEventListener("change",M),d.addEventListener("input",M);let a=g();a&&a.addEventListener("change",M),A(),window.addEventListener("online",B),window.addEventListener("offline",B),B();let o=document.getElementById("cart-icon"),r=document.getElementById("empty-cart"),t=document.getElementById("submit-cart");o.addEventListener("click",()=>{if(typeof window.bootstrap<"u"&&window.bootstrap.Offcanvas){let c=new window.bootstrap.Offcanvas(document.getElementById("cartOffcanvas"));L(),c.show()}else{console.error("Bootstrap Offcanvas no est\xE1 disponible"),L();let c=document.getElementById("cartOffcanvas");c&&c.classList.add("show")}}),r.addEventListener("click",se),t.addEventListener("click",le),document.getElementById("cart-items").addEventListener("click",c=>{let u=c.target,m=u.closest("[data-id]")?.dataset.id;m&&(u.classList.contains("decrease-quantity")?P({id:m},-1):u.classList.contains("increase-quantity")?P({id:m},1):u.classList.contains("remove-item")&&Q(m))}),q(),"performance"in window&&window.addEventListener("load",()=>{let c=performance.getEntriesByType("paint"),u=performance.getEntriesByType("navigation")[0];console.log("First Contentful Paint:",c[0].startTime),console.log("DOM Content Loaded:",u.domContentLoadedEventEnd),console.log("Load Time:",u.loadEventEnd)})}catch(e){console.error("Error al inicializar productos:",e),y("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document<"u"&&document.addEventListener("DOMContentLoaded",function(){Y(),X().catch(n=>{console.error("Error al inicializar la aplicaci\xF3n:",n),y("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})});typeof F<"u"&&(F.exports={generateStableId:Z})});Le();})();
