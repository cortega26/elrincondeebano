"use strict";(()=>{var ie=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports);var he=ie((Ce,z)=>{var x={path:"/service-worker.js",scope:"/",updateCheckInterval:3e5};function V(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}window.addEventListener("load",async()=>{try{ce()}catch(n){console.error("Service Worker initialization failed:",n),me("Failed to initialize service worker. Some features may not work offline.")}})}async function ce(){try{let n=await navigator.serviceWorker.register(x.path,{scope:x.scope});console.log("ServiceWorker registered successfully:",n.scope),se(n),de(n),le(),ue()}catch(n){throw console.error("ServiceWorker registration failed:",n),n}}function se(n){n.addEventListener("updatefound",()=>{let r=n.installing;r.addEventListener("statechange",()=>{r.state==="installed"&&navigator.serviceWorker.controller&&r.postMessage({type:"SKIP_WAITING"})})})}function de(n){Q(n),setInterval(()=>{Q(n)},x.updateCheckInterval)}async function Q(n){try{await n.update();let r=await fetch("/_products/product_data.json",{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(r.ok){let p=(await r.json()).version,l=localStorage.getItem("productDataVersion");p!==l&&(n.active?.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",p),pe(null,"New product data available"))}}catch(r){console.warn("Update check failed:",r)}}function le(){let n=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{n||(n=!0,window.location.reload())})}function ue(){let n=()=>{let r=document.getElementById("offline-indicator");r&&(r.style.display=navigator.onLine?"none":"block"),navigator.onLine||fe("You are currently offline. Some features may be limited.")};window.addEventListener("online",n),window.addEventListener("offline",n),n()}function pe(n,r="Una versi\xF3n est\xE1 disponible"){let c=A(r,"Actualizar ahora","Despu\xE9s",()=>{n?n.postMessage({type:"SKIP_WAITING"}):window.location.reload()});D(c)}function me(n){let r=A(n,"Reload","Dismiss",()=>window.location.reload());D(r)}function fe(n){let r=A(n,"Retry","Dismiss",()=>window.location.reload());D(r)}function A(n,r,c,p){let l=document.createElement("div");return l.className="notification-toast",l.setAttribute("role","alert"),l.setAttribute("aria-live","polite"),l.innerHTML=`
        <div class="notification-content">
            <p>${n}</p>
            <div class="notification-actions">
                <button class="primary-action">${r}</button>
                <button class="secondary-action">${c}</button>
            </div>
        </div>
    `,l.querySelector(".primary-action").addEventListener("click",()=>{p(),l.remove()}),l.querySelector(".secondary-action").addEventListener("click",()=>{l.remove()}),l}function D(n){let r=document.querySelector(".notification-toast");r&&r.remove(),document.body.appendChild(n),setTimeout(()=>{document.body.contains(n)&&n.remove()},5*60*1e3)}typeof navigator<"u"&&"serviceWorker"in navigator&&V();var ye=(n,r=100)=>{let c=new Map;return(...p)=>{let l=JSON.stringify(p);if(c.has(l))return c.get(l);let y=n(...p);if(c.size>=r){let m=c.keys().next().value;c.delete(m)}return c.set(l,y),y}},ge=(n,r)=>{let c;return(...p)=>{clearTimeout(c),c=setTimeout(()=>n(...p),r)}},K=n=>{let r=`${n.name}-${n.category}`.toLowerCase(),c=0;for(let p=0;p<r.length;p++){let l=r.charCodeAt(p);c=(c<<5)-c+l,c=c&c}return`pid-${Math.abs(c)}`},O=n=>{let r=document.createElement("div");return r.textContent=n,r.innerHTML},ve=async()=>{try{let n=await fetch("/_products/product_data.json",{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});if(!n.ok)throw new Error(`HTTP error. Status: ${n.status}`);return(await n.json()).products.map(c=>({...c,id:K(c),name:O(c.name),description:O(c.description),category:O(c.category)}))}catch(n){throw console.error("Error al obtener productos:",n),f(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${n.message})`),n}},d=(n,r={},c=[])=>{let p=document.createElement(n);return Object.entries(r).forEach(([l,y])=>{l==="text"?p.textContent=y:p.setAttribute(l,y)}),c.forEach(l=>{typeof l=="string"?p.appendChild(document.createTextNode(l)):p.appendChild(l)}),p},f=n=>{let r=d("div",{class:"error-message",role:"alert"},[d("p",{},[n]),d("button",{class:"retry-button"},["Intentar nuevamente"])]),c=document.getElementById("product-container");c?(c.innerHTML="",c.appendChild(r),r.querySelector(".retry-button").addEventListener("click",G)):console.error("Contenedor de productos no encontrado")};typeof window<"u"&&window.addEventListener("error",n=>{console.error("Error global:",n.error),f("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")});var G=async()=>{if(console.log("Initializing app..."),typeof DOMPurify>"u")try{await new Promise((e,a)=>{let o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.8/purify.min.js",o.onload=e,o.onerror=a,document.head.appendChild(o)})}catch(e){console.error("Failed to load DOMPurify:",e),f("Failed to load required dependencies. Please refresh the page.");return}let n=document.getElementById("navbar-container"),r=document.getElementById("footer-container"),c=document.getElementById("product-container"),p=document.getElementById("sort-options"),l=document.getElementById("filter-keyword"),y=[],m=JSON.parse(localStorage.getItem("cart"))||[],S=()=>{let e=document.getElementById("offline-indicator");e&&(e.style.display=navigator.onLine?"none":"block"),navigator.onLine||console.log("App is offline. Using cached data if available.")},N=async(e,a)=>{if(!e){console.warn(`Contenedor no encontrado para el componente: ${a}`);return}try{let o=await fetch(a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let i=await o.text(),t=DOMPurify.sanitize(i,{USE_PROFILES:{html:!0},ALLOWED_TAGS:["div","span","p","h1","h2","h3","h4","h5","h6","ul","ol","li","a","img","br","strong","em","button","nav","footer","header","main","section"],ALLOWED_ATTR:["href","src","alt","class","id","style","aria-label","role","type","data-bs-toggle","data-bs-target","aria-controls","aria-expanded"]});e.innerHTML="";let u=new DOMParser().parseFromString(t,"text/html");Array.from(u.body.children).forEach(g=>{e.appendChild(g.cloneNode(!0))})}catch(o){throw console.error("Error al cargar componente:",{component:a,message:o.message}),o}},J=async()=>{try{await Promise.all([N(n,"/pages/navbar.html"),N(r,"/pages/footer.html")]),console.log("Components loaded successfully")}catch(e){console.error("Error al cargar componentes:",e),f("Error al cargar los componentes de la p\xE1gina. Por favor, actualice la p\xE1gina o verifique su conexi\xF3n a internet.")}},X=(e,a,o="CLP")=>{let i=new Intl.NumberFormat("es-CL",{style:"currency",currency:o,minimumFractionDigits:0}),t=i.format(e);if(a){let s=e-a,u=i.format(s);return d("div",{class:"precio-container"},[d("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[u]),d("span",{class:"precio-original","aria-label":"Precio original"},[d("span",{class:"tachado"},[t])])])}return d("div",{class:"precio-container"},[d("span",{class:"precio","aria-label":"Precio"},[t])])},W=e=>{let a=d("div",{class:"quantity-control"}),o=d("button",{class:"quantity-btn","aria-label":"Decrease quantity"},["-"]),i=d("button",{class:"quantity-btn","aria-label":"Increase quantity"},["+"]),t=d("input",{type:"number",class:"quantity-input",value:Math.max(P(e.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":e.id});return o.addEventListener("click",()=>w(e,-1)),i.addEventListener("click",()=>w(e,1)),t.addEventListener("change",s=>{let u=parseInt(s.target.value,10),g=P(e.id);w(e,u-g)}),a.appendChild(o),a.appendChild(t),a.appendChild(i),a},P=e=>{let a=m.find(o=>o.id===e);return a?a.quantity:0},Y=e=>{let a=document.createDocumentFragment(),o=window.location.pathname.includes("/pages/");e.forEach(t=>{let{id:s,name:u,description:g,image_path:q,price:k,discount:$,stock:T}=t,R=d("div",{class:`producto col-12 col-sm-6 col-md-4 col-lg-3 mb-4 ${T?"":"agotado"}`,"aria-label":`Product: ${u}`}),B=d("div",{class:"card"}),M;o?M=`../${q.replace(/^\//,"")}`:M=q;let re=d("img",{"data-src":M,alt:u,class:"card-img-top lazyload"});B.appendChild(re);let E=d("div",{class:"card-body"});E.appendChild(d("h3",{class:"card-title"},[u])),E.appendChild(d("p",{class:"card-text"},[g])),E.appendChild(X(k,$));let j=m.find(v=>v.id===s),U=j?j.quantity:0;if(U>0){let v=W(t);E.appendChild(v);let L=v.querySelector(".quantity-input");L&&(L.value=U)}else{let v=d("button",{class:"btn btn-primary mt-2","data-id":s,"aria-label":`Add ${u} to cart`},["Agregar"]);v.addEventListener("click",()=>{H(t,1);let L=W(t);v.replaceWith(L),L.classList.add("fade-in-up")}),E.appendChild(v)}B.appendChild(E),R.appendChild(B),a.appendChild(R)});let i=document.getElementById("product-container");i.innerHTML="",i.appendChild(a),Z()},Z=()=>{let e=new IntersectionObserver((a,o)=>{a.forEach(i=>{if(i.isIntersecting){let t=i.target;t.src=t.dataset.src,t.classList.remove("lazyload"),o.unobserve(t)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(a=>e.observe(a))},ee=(e,a,o)=>e.filter(i=>(i.name.toLowerCase().includes(a.toLowerCase())||i.description.toLowerCase().includes(a.toLowerCase()))&&i.stock).sort((i,t)=>te(i,t,o)),te=(e,a,o)=>{if(!o||o==="original")return e.originalIndex-a.originalIndex;let[i,t]=o.split("-"),s=i==="price"?e.price-(e.discount||0):e.name.toLowerCase(),u=i==="price"?a.price-(a.discount||0):a.name.toLowerCase();return t==="asc"?s<u?-1:s>u?1:0:u<s?-1:u>s?1:0},ne=ye(ee),C=()=>{try{let e=p.value||"original",a=l.value.trim(),o=ne(y,a,e);Y(o)}catch(e){console.error("Error al actualizar visualizaci\xF3n de productos:",e),f("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},_=ge(C,300),b=()=>{let e=document.getElementById("cart-count"),a=m.reduce((o,i)=>o+i.quantity,0);e.textContent=a,e.setAttribute("aria-label",`${a} items in cart`)},H=(e,a)=>{try{let o=m.find(t=>t.id===e.id);o?o.quantity=Math.min(o.quantity+a,50):m.push({id:e.id,name:e.name,description:e.description,price:e.price,discount:e.discount,image_path:e.image_path,quantity:Math.min(a,50),category:e.category,stock:e.stock}),I(),b(),h();let i=document.querySelector(`[data-id="${e.id}"].quantity-input`);i&&(i.value=Math.max(P(e.id),1))}catch(o){console.error("Error al agregar al carrito:",o),f("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},F=e=>{try{m=m.filter(a=>a.id!==e),I(),b(),h(),C()}catch(a){console.error("Error al eliminar del carrito:",a),f("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},w=(e,a)=>{try{let o=m.find(t=>t.id===e.id),i=o?o.quantity+a:1;if(i<=0)F(e.id),C();else if(i<=50){o?o.quantity=i:H(e,1),I(),b(),h();let t=document.querySelector(`[data-id="${e.id}"].quantity-input`);t&&(t.value=i,t.classList.add("quantity-changed"),setTimeout(()=>t.classList.remove("quantity-changed"),300))}}catch(o){console.error("Error al actualizar cantidad:",o),f("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},ae=()=>{try{m=[],I(),b(),h(),C()}catch(e){console.error("Error al vaciar el carrito:",e),f("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},I=()=>{try{localStorage.setItem("cart",JSON.stringify(m))}catch(e){console.error("Error al guardar el carrito:",e),f("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},h=()=>{let e=document.getElementById("cart-items"),a=document.getElementById("cart-total");e.innerHTML="";let o=0;m.forEach(t=>{let s=t.price-(t.discount||0),u=d("div",{class:"cart-item mb-3","aria-label":`Cart item: ${t.name}`});u.appendChild(d("div",{},[t.name]));let g=d("div"),q=d("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":t.id,"aria-label":`Decrease quantity of ${t.name}`},["-"]),k=d("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":t.id,"aria-label":`Increase quantity of ${t.name}`},["+"]),$=d("span",{class:"mx-2 item-quantity","aria-label":`Quantity of ${t.name}`},[t.quantity.toString()]);g.appendChild(q),g.appendChild($),g.appendChild(k),u.appendChild(g),u.appendChild(d("div",{},[`Precio: $${s.toLocaleString("es-CL")}`])),u.appendChild(d("div",{},[`Subtotal: $${(s*t.quantity).toLocaleString("es-CL")}`]));let T=d("button",{class:"btn btn-sm btn-danger remove-item","data-id":t.id,"aria-label":`Remove ${t.name} from cart`},["Eliminar"]);u.appendChild(T),e.appendChild(u),o+=s*t.quantity}),a.textContent=`Total: $${o.toLocaleString("es-CL")}`,a.setAttribute("aria-label",`Total cart value: $${o.toLocaleString("es-CL")}`);let i=document.getElementById("payment-credit-container");if(i)if(o>=3e4)i.classList.remove("d-none");else{i.classList.add("d-none");let t=i.querySelector("input");t&&(t.checked=!1)}},oe=()=>{let e=document.querySelector('input[name="paymentMethod"]:checked');if(!e){alert("Por favor seleccione un m\xE9todo de pago");return}let a=`Mi pedido:

`;m.forEach(t=>{let s=t.price-(t.discount||0);a+=`${t.name}
`,a+=`Cantidad: ${t.quantity}
`,a+=`Precio unitario: $${s.toLocaleString("es-CL")}
`,a+=`Subtotal: $${(s*t.quantity).toLocaleString("es-CL")}

`});let o=m.reduce((t,s)=>t+(s.price-(s.discount||0))*s.quantity,0);a+=`Total: $${o.toLocaleString("es-CL")}
`,a+=`M\xE9todo de pago: ${e.value}`;let i=encodeURIComponent(a);window.open(`https://wa.me/56951118901?text=${i}`,"_blank")};try{if(await J(),y=await ve(),y.length===0){f("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}let e=document.querySelector("main").dataset.category;e&&(y=y.filter(t=>t.category===e)),p.addEventListener("change",_),l.addEventListener("input",_),C(),window.addEventListener("online",S),window.addEventListener("offline",S),S();let a=document.getElementById("cart-icon"),o=document.getElementById("empty-cart"),i=document.getElementById("submit-cart");a.addEventListener("click",()=>{if(typeof window.bootstrap<"u"&&window.bootstrap.Offcanvas){let t=new window.bootstrap.Offcanvas(document.getElementById("cartOffcanvas"));h(),t.show()}else{console.error("Bootstrap Offcanvas no est\xE1 disponible"),h();let t=document.getElementById("cartOffcanvas");t&&t.classList.add("show")}}),o.addEventListener("click",ae),i.addEventListener("click",oe),document.getElementById("cart-items").addEventListener("click",t=>{let s=t.target,u=s.closest("[data-id]")?.dataset.id;u&&(s.classList.contains("decrease-quantity")?w({id:u},-1):s.classList.contains("increase-quantity")?w({id:u},1):s.classList.contains("remove-item")&&F(u))}),b(),"performance"in window&&window.addEventListener("load",()=>{let t=performance.getEntriesByType("paint"),s=performance.getEntriesByType("navigation")[0];console.log("First Contentful Paint:",t[0].startTime),console.log("DOM Content Loaded:",s.domContentLoadedEventEnd),console.log("Load Time:",s.loadEventEnd)})}catch(e){console.error("Error al inicializar productos:",e),f("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document<"u"&&document.addEventListener("DOMContentLoaded",function(){V(),G().catch(n=>{console.error("Error al inicializar la aplicaci\xF3n:",n),f("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})});typeof z<"u"&&(z.exports={generateStableId:K})});he();})();
