(()=>{var Wt=Object.create;var it=Object.defineProperty;var Qt=Object.getOwnPropertyDescriptor;var Kt=Object.getOwnPropertyNames;var Vt=Object.getPrototypeOf,Jt=Object.prototype.hasOwnProperty;var x=(t,n)=>()=>(t&&(n=t(t=0)),n);var ct=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var Gt=(t,n,r,d)=>{if(n&&typeof n=="object"||typeof n=="function")for(let l of Kt(n))!Jt.call(t,l)&&l!==r&&it(t,l,{get:()=>n[l],enumerable:!(d=Qt(n,l))||d.enumerable});return t};var Yt=(t,n,r)=>(r=t!=null?Wt(Vt(t)):{},Gt(n||!t||!t.__esModule?it(r,"default",{value:t,enumerable:!0}):r,t));function st(){try{let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=`
      /* Miniatura del carrito (mantener consistente con base/enhanced CSS) */
      .cart-item-thumb { width: 100px; height: 100px; flex-shrink: 0; }
      .cart-item-thumb img, .cart-item-thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 0.25rem; }

      /* Contornos de enfoque claros para accesibilidad */
      .navbar .nav-link:focus,
      .navbar .dropdown-item:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* Espaciado entre botones en el offcanvas del carrito */
      #cartOffcanvas .offcanvas-body > .btn + .btn { margin-top: 0.5rem !important; }
    `,document.head.appendChild(t)}catch(t){console.warn("[modules/enhancements] injectEnhancementStyles error:",t)}}var lt=x(()=>{});function dt(){try{document.addEventListener("keydown",n=>{n.key==="Tab"&&document.body.classList.add("keyboard-navigation")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-navigation")});let t=document.createElement("style");window&&window.__CSP_NONCE__&&t.setAttribute("nonce",window.__CSP_NONCE__),t.textContent=".keyboard-navigation *:focus { outline: 2px solid var(--primary-color); outline-offset: 2px; }",document.head.appendChild(t)}catch(t){console.warn("[modules/a11y] setupNavigationAccessibility error:",t)}}var ut=x(()=>{});function mt(){try{"loading"in HTMLImageElement.prototype&&document.querySelectorAll("img:not([loading])").forEach(t=>{t.loading="lazy"})}catch(t){console.warn("[modules/perf] setupPerformanceOptimizations error:",t)}}var pt=x(()=>{});async function Zt(){try{let t=localStorage.getItem("productDataVersion"),n=t?`/_products/product_data.json?v=${encodeURIComponent(t)}`:"/_products/product_data.json",r=await fetch(n,{cache:"no-store",headers:{Accept:"application/json"}});if(!r.ok)return null;let d=await r.json(),l=Array.isArray(d?.products)?d.products:Array.isArray(d)?d:[],f={};return l.forEach(v=>{let y=v.id||String(v.name)+"-"+String(v.category);f[y]=v}),f}catch(t){return console.error("[modules/seo] Error loading product data:",t),null}}async function ft(){try{if(document.querySelector('script[type="application/ld+json"]'))return;let t=await Zt();if(!t)return;let r=Object.values(t).slice(0,20).map(f=>({"@type":"Product",name:f.name,image:f.image_path,description:f.description,brand:f.brand||"Gen\xE9rico",offers:{"@type":"Offer",price:f.price,priceCurrency:"CLP",availability:f.stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}})),d={"@context":"https://schema.org","@graph":[{"@type":"Store",name:"El Rinc\xF3n de \xC9bano",image:"https://elrincondeebano.com/assets/images/web/logo.webp",description:"Un minimarket en la puerta de tu departamento",address:{"@type":"PostalAddress",addressCountry:"CL"},telephone:"+56951118901",url:"http://www.elrincondeebano.com/",contactPoint:{"@type":"ContactPoint",telephone:"+56-951118901",contactType:"customer service"}},...r]},l=document.createElement("script");l.type="application/ld+json",window&&window.__CSP_NONCE__&&l.setAttribute("nonce",window.__CSP_NONCE__),l.textContent=JSON.stringify(d),document.head.appendChild(l)}catch(t){console.error("[modules/seo] Error generating structured data:",t)}}function yt(){try{if(!document.querySelector('link[rel="canonical"]')){let t=document.createElement("link");t.rel="canonical",t.href=location.origin+location.pathname,document.head.appendChild(t)}if(!document.querySelector('meta[name="description"]')){let t=document.createElement("meta");t.name="description",t.content="El Rinc\xF3n de \xC9bano - Minimarket con delivery instant\xE1neo.",document.head.appendChild(t)}}catch(t){console.warn("[modules/seo] injectSeoMetadata error:",t)}}var gt=x(()=>{});function ht(){try{if(!document.querySelector('link[rel="manifest"]')){let t=document.createElement("link");t.rel="manifest",t.href="/app.webmanifest",document.head.appendChild(t)}}catch(t){console.warn("[modules/pwa] injectPwaManifest error:",t)}}var vt=x(()=>{});function wt(){try{window?.console?.debug&&console.debug("[modules/checkout] setupCheckoutProgress: no-op")}catch{}}var bt=x(()=>{});var _t=ct((we,Y)=>{"use strict";var V={path:"/service-worker.js",scope:"/",updateCheckInterval:3e5};function Et(){if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser");return}window.addEventListener("load",async()=>{try{Xt()}catch(t){console.error("Service Worker initialization failed:",t),re("Failed to initialize service worker. Some features may not work offline.")}})}async function Xt(){try{let t=await navigator.serviceWorker.register(V.path,{scope:V.scope});console.log("ServiceWorker registered successfully:",t.scope),te(t),ee(t),ne(),ae()}catch(t){throw console.error("ServiceWorker registration failed:",t),t}}function te(t){t.addEventListener("updatefound",()=>{let n=t.installing;n.addEventListener("statechange",()=>{n.state==="installed"&&navigator.serviceWorker.controller&&n.postMessage({type:"SKIP_WAITING"})})})}function ee(t){Ct(t),setInterval(()=>{Ct(t)},V.updateCheckInterval)}async function Ct(t){try{await t.update();let n=await fetch("/_products/product_data.json",{cache:"no-store",headers:{Accept:"application/json"}});if(n.ok){let d=(await n.json()).version,l=localStorage.getItem("productDataVersion");d!==l&&(t.active?.postMessage({type:"INVALIDATE_PRODUCT_CACHE"}),localStorage.setItem("productDataVersion",d),oe(null,"New product data available"))}}catch(n){console.warn("Update check failed:",n)}}function ne(){let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}function ae(){let t=document.getElementById("offline-indicator");if(!t)return;let n=()=>{let r=navigator.onLine;t.classList.toggle("is-hidden",r),t.style.display=r?"none":"block",r||ie("You are currently offline. Some features may be limited.")};window.addEventListener("online",n),window.addEventListener("offline",n),hidden||n()}function oe(t,n="Una versi\xF3n est\xE1 disponible"){let r=Z(n,"Actualizar ahora","Despu\xE9s",()=>{t?t.postMessage({type:"SKIP_WAITING"}):window.location.reload()});X(r)}function re(t){let n=Z(t,"Reload","Dismiss",()=>window.location.reload());X(n)}function ie(t){let n=Z(t,"Retry","Dismiss",()=>window.location.reload());X(n)}function Z(t,n,r,d){let l=document.createElement("div");return l.className="notification-toast",l.setAttribute("role","alert"),l.setAttribute("aria-live","polite"),l.innerHTML=`
        <div class="notification-content">
            <p>${t}</p>
            <div class="notification-actions">
                <button class="primary-action">${n}</button>
                <button class="secondary-action">${r}</button>
            </div>
        </div>
    `,l.querySelector(".primary-action").addEventListener("click",()=>{d(),l.remove()}),l.querySelector(".secondary-action").addEventListener("click",()=>{l.remove()}),l}function X(t){let n=document.querySelector(".notification-toast");n&&n.remove(),document.body.appendChild(t),setTimeout(()=>{document.body.contains(t)&&t.remove()},300*1e3)}typeof navigator<"u"&&"serviceWorker"in navigator&&Et();var ce=(t,n=100)=>{let r=new Map;return(...d)=>{let l=JSON.stringify(d);if(r.has(l))return r.get(l);let f=t(...d);if(r.size>=n){let v=r.keys().next().value;r.delete(v)}return r.set(l,f),f}},se=(t,n)=>{let r;return(...d)=>{clearTimeout(r),r=setTimeout(()=>t(...d),n)}},J=t=>{if(!t)return"";try{return String(t).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}catch{return String(t).toLowerCase()}},St=t=>{let n=`${t.name}-${t.category}`.toLowerCase(),r=0;for(let d=0;d<n.length;d++){let l=n.charCodeAt(d);r=(r<<5)-r+l,r=r&r}return`pid-${Math.abs(r)}`},K=t=>{let n=document.createElement("div");return n.textContent=t,n.innerHTML},Lt=async()=>{try{let t=localStorage.getItem("productDataVersion"),n=t?`/_products/product_data.json?v=${encodeURIComponent(t)}`:"/_products/product_data.json",r=await fetch(n,{cache:"no-store",headers:{Accept:"application/json"}});if(!r.ok)throw new Error(`HTTP error. Status: ${r.status}`);return(await r.json()).products.map(l=>({...l,id:St(l),name:K(l.name),description:K(l.description),category:K(l.category),categoryKey:J(l.category)}))}catch(t){throw console.error("Error al obtener productos:",t),h(`Error al cargar los productos. Por favor, verifique su conexi\xF3n a internet e int\xE9ntelo de nuevo. (Error: ${t.message})`),t}},m=(t,n={},r=[])=>{let d=document.createElement(t);return Object.entries(n).forEach(([l,f])=>{l==="text"?d.textContent=f:d.setAttribute(l,f)}),r.forEach(l=>{typeof l=="string"?d.appendChild(document.createTextNode(l)):d.appendChild(l)}),d},h=t=>{let n=m("div",{class:"error-message",role:"alert"},[m("p",{},[t]),m("button",{class:"retry-button"},["Intentar nuevamente"])]),r=document.getElementById("product-container");r?(r.innerHTML="",r.appendChild(n),n.querySelector(".retry-button").addEventListener("click",qt)):console.error("Contenedor de productos no encontrado")},b=[];try{b=JSON.parse(globalThis.localStorage?.getItem("cart"))||[]}catch{b=[]}var le=t=>{let n=b.find(r=>r.id===t);return n?n.quantity:0},j=()=>{let t=document.getElementById("cart-count"),n=b.reduce((r,d)=>r+d.quantity,0);t&&(t.textContent=n,t.setAttribute("aria-label",`${n} items in cart`))},tt=()=>{try{globalThis.localStorage?.setItem("cart",JSON.stringify(b))}catch(t){console.error("Error al guardar el carrito:",t),h("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},G=(t,n,r)=>{!t||!n||(r?(t.style.display="none",n.style.display="flex"):(n.style.display="none",t.style.display="flex"))},et=()=>{let t=document.getElementById("cart-items"),n=document.getElementById("cart-total");if(!t||!n)return;t.innerHTML="";let r=0;b.forEach(d=>{let l=d.price-(d.discount||0),f=m("div",{class:"cart-item","data-id":d.id});f.appendChild(m("span",{class:"item-quantity"},[d.quantity.toString()])),t.appendChild(f),r+=l*d.quantity}),n.textContent=`$${r.toLocaleString("es-CL")}`},It=(t,n)=>{try{let r=b.find(l=>l.id===t.id);r?r.quantity=Math.min(r.quantity+n,50):b.push({id:t.id,name:t.name,description:t.description,price:t.price,discount:t.discount,image_path:t.image_path,quantity:Math.min(n,50),category:t.category,stock:t.stock}),tt(),j(),et();let d=document.querySelector(`[data-id="${t.id}"].quantity-input`);d&&(d.value=Math.max(le(t.id),1))}catch(r){console.error("Error al agregar al carrito:",r),h("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},Pt=t=>{try{b=b.filter(r=>r.id!==t),tt(),j(),et();let n=document.querySelector(`.action-area[data-pid="${t}"]`);if(n){let r=n.querySelector(".add-to-cart-btn"),d=n.querySelector(".quantity-control");G(r,d,!1)}}catch(n){console.error("Error al eliminar del carrito:",n),h("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},de=(t,n)=>{try{let r=b.find(y=>y.id===t.id),d=r?r.quantity+n:1,l=document.querySelector(`.action-area[data-pid="${t.id}"]`),f=l?.querySelector(".add-to-cart-btn"),v=l?.querySelector(".quantity-control");if(d<=0)Pt(t.id),G(f,v,!1);else if(d<=50){r?r.quantity=d:(It(t,1),G(f,v,!0)),tt(),j(),et();let y=document.querySelector(`[data-id="${t.id}"].quantity-input`);y&&(y.value=d,y.classList.add("quantity-changed"),setTimeout(()=>y.classList.remove("quantity-changed"),300))}}catch(r){console.error("Error al actualizar cantidad:",r),h("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}};typeof window<"u"&&(window.__APP_READY__=!1,window.addEventListener("error",t=>{let n=t.target||t.srcElement,r=!!(n&&(n.tagName==="IMG"||n.tagName==="SCRIPT"||n.tagName==="LINK")),d=!!t.error;if(r||!d){console.warn("Ignored non-fatal error:",{tag:n&&n.tagName,src:n&&(n.src||n.href||n.currentSrc)});return}if(!window.__APP_READY__){console.error("Runtime error before app ready:",t.error);return}console.error("Unhandled JS error:",t.error),h("Ocurri\xF3 un error inesperado. Por favor, recarga la p\xE1gina.")}),window.addEventListener("securitypolicyviolation",t=>{console.warn("CSP violation (logged only):",{blockedURI:t.blockedURI,violatedDirective:t.violatedDirective,sourceFile:t.sourceFile})}));var qt=async()=>{if(console.log("Initializing app..."),typeof DOMPurify>"u")try{await new Promise((e,o)=>{let i=document.createElement("script");i.src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.8/purify.min.js",i.integrity="sha384-AsiVBlzbaNOq8OOKcXm2ZVjjKJwiQ9UmzLwfetDjC74OMQdkb6vBHH5QRJH3x1SE",i.crossOrigin="anonymous",i.onload=e,i.onerror=o,document.head.appendChild(i)})}catch{console.warn("DOMPurify CDN blocked; using noop sanitizer"),window.DOMPurify={sanitize:o=>o}}let t=document.getElementById("navbar-container"),n=document.getElementById("footer-container"),r=document.getElementById("product-container"),d=document.getElementById("sort-options"),l=document.getElementById("filter-keyword"),f=()=>{let e=document.getElementById("filter-discount");if(e)return e;let o=document.querySelector('section[aria-label*="filtrado"], section[aria-label*="Opciones de filtrado"]'),i=o?o.querySelector(".row"):null;if(!i)return null;let c=m("div",{class:"col-12 mt-2"}),a=m("div",{class:"form-check form-switch"}),s=m("input",{class:"form-check-input",type:"checkbox",id:"filter-discount","aria-label":"Mostrar solo productos con descuento"}),u=m("label",{class:"form-check-label",for:"filter-discount"},["Solo productos con descuento"]);return a.appendChild(s),a.appendChild(u),c.appendChild(a),i.appendChild(c),s},v=[],y=JSON.parse(localStorage.getItem("cart"))||[],R=()=>{let e=document.getElementById("offline-indicator");if(e){let o=navigator.onLine;e.classList.toggle("is-hidden",o),e.style.display=o?"none":"block"}navigator.onLine||console.log("App is offline. Using cached data if available.")},nt=async(e,o)=>{if(!e){console.warn(`Contenedor no encontrado para el componente: ${o}`);return}try{let i=await fetch(o);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);let c=await i.text(),a=DOMPurify.sanitize(c,{USE_PROFILES:{html:!0},ALLOWED_TAGS:["div","span","p","h1","h2","h3","h4","h5","h6","ul","ol","li","a","img","br","strong","em","button","nav","footer","header","main","section"],ALLOWED_ATTR:["href","src","alt","class","id","style","aria-label","role","type","data-bs-toggle","data-bs-target","aria-controls","aria-expanded"]});e.innerHTML="";let u=new DOMParser().parseFromString(a,"text/html");Array.from(u.body.children).forEach(p=>{e.appendChild(p.cloneNode(!0))})}catch(i){throw console.error("Error al cargar componente:",{component:o,message:i.message}),i}};function xt(){let e=document.getElementById("current-year");e&&(e.textContent=new Date().getFullYear())}let At=async()=>{try{await Promise.all([nt(t,"/pages/navbar.html"),nt(n,"/pages/footer.html")]),console.log("Components loaded successfully"),xt()}catch(e){console.error("Error al cargar componentes:",e),h("Error al cargar los componentes de la p\xE1gina. Por favor, actualice la p\xE1gina o verifique su conexi\xF3n a internet.")}},Ot=(e,o,i="CLP")=>{let c=new Intl.NumberFormat("es-CL",{style:"currency",currency:i,minimumFractionDigits:0}),a=c.format(e);if(o){let s=e-o,u=c.format(s);return m("div",{class:"precio-container"},[m("span",{class:"precio-descuento","aria-label":"Precio con descuento"},[u]),m("span",{class:"precio-original","aria-label":"Precio original"},[m("span",{class:"tachado"},[a])])])}return m("div",{class:"precio-container"},[m("span",{class:"precio","aria-label":"Precio"},[a])])},$t=e=>{let o=m("div",{class:"quantity-control"}),i=m("button",{class:"quantity-btn","aria-label":"Decrease quantity"},["-"]),c=m("button",{class:"quantity-btn","aria-label":"Increase quantity"},["+"]),a=m("input",{type:"number",class:"quantity-input",value:Math.max(F(e.id),1),min:"1",max:"50","aria-label":"Quantity","data-id":e.id});return i.addEventListener("click",()=>O(e,-1)),c.addEventListener("click",()=>O(e,1)),a.addEventListener("change",s=>{let u=parseInt(s.target.value,10),p=F(e.id);O(e,u-p)}),o.appendChild(i),o.appendChild(a),o.appendChild(c),o},F=e=>{let o=y.find(i=>i.id===e);return o?o.quantity:0},Tt=e=>{let o=document.createDocumentFragment(),i=window.location.pathname.includes("/pages/");e.forEach(a=>{let{id:s,name:u,description:p,image_path:L,price:D,discount:_,stock:W}=a,B=m("div",{class:`producto col-12 col-sm-6 col-md-4 col-lg-3 mb-4 ${W?"":"agotado"}`,"aria-label":`Product: ${u}`}),k=m("div",{class:"card"});if(_&&Number(_)>0){let P=Math.round(Number(_)/Number(D)*100),C=m("span",{class:"discount-badge badge bg-danger","aria-label":"Producto en oferta"},[`-${isFinite(P)?P:0}%`]);k.appendChild(C)}let I;i?I=`../${L.replace(/^\//,"")}`:I=L;let E={"data-src":I,alt:u,class:"card-img-top lazyload",loading:"lazy",decoding:"async",width:"400",height:"400"};if(Array.isArray(a.image_variants)){let P=a.image_variants.filter(C=>C&&C.url&&C.width).sort((C,Ut)=>C.width-Ut.width).map(C=>`${i?`../${String(C.url).replace(/^\//,"")}`:C.url} ${C.width}w`);P.length&&(E["data-srcset"]=P.join(", "),E["data-sizes"]="(max-width: 576px) 45vw, (max-width: 992px) 30vw, 25vw")}let rt=m("img",E);k.appendChild(rt);let S=m("div",{class:"card-body"});S.appendChild(m("h3",{class:"card-title"},[u])),S.appendChild(m("p",{class:"card-text"},[p])),S.appendChild(Ot(D,_));let $=m("div",{class:"action-area","data-pid":s}),w=m("button",{class:"btn btn-primary add-to-cart-btn mt-2","data-id":s,"aria-label":`Add ${u} to cart`},["Agregar al carrito"]),g=$t(a);g.style.display="none",w.addEventListener("click",()=>{at(a,1),N(w,g,!0)}),$.appendChild(w),$.appendChild(g),S.appendChild($);let Q=y.find(P=>P.id===s),T=Q?Q.quantity:0,M=g.querySelector(".quantity-input");T>0?(M&&(M.value=T),w.style.display="none",g.style.display="flex"):(w.style.display="flex",g.style.display="none"),k.appendChild(S),B.appendChild(k),o.appendChild(B)});let c=document.getElementById("product-container");c.innerHTML="",c.appendChild(o),Mt()},Mt=()=>{let e=new IntersectionObserver((o,i)=>{o.forEach(c=>{if(c.isIntersecting){let a=c.target;a.src=a.dataset.src,a.dataset.srcset&&(a.srcset=a.dataset.srcset),a.dataset.sizes&&(a.sizes=a.dataset.sizes),a.classList.remove("lazyload"),i.unobserve(a)}})},{rootMargin:"100px"});document.querySelectorAll("img.lazyload").forEach(o=>e.observe(o))};function Nt(e,o){if(!e||!o||e.length<3)return!1;let i=s=>s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),c=i(e),a=i(o);return a.includes(c)?!0:c.length>=4?zt(c,a):!1}function zt(e,o){return o.split(/\s+/).some(c=>{if(Math.abs(c.length-e.length)>1)return!1;let a=0,s=Math.max(c.length,e.length);if(Math.min(c.length,e.length)<4)return!1;if(c.length===e.length){for(let p=0;p<c.length;p++)if(c[p]!==e[p]&&a++,a>1)return!1;return a===1}else return Dt(e,c)})}function Dt(e,o){let i=e.length>o.length?e:o,c=e.length>o.length?o:e;if(i.length-c.length!==1)return!1;let a=0,s=0,u=0;for(;s<c.length&&u<i.length;)if(c[s]===i[u])s++,u++;else{if(a++,a>1)return!1;u++}return!0}let Bt=(e,o,i,c=!1)=>{let a=o.trim();return e.filter(s=>!s.stock||c&&!(s.discount&&Number(s.discount)>0)?!1:!a||s.name.toLowerCase().includes(a.toLowerCase())||s.description.toLowerCase().includes(a.toLowerCase())?!0:a.length>=4?Nt(a,s.name):!1).sort((s,u)=>jt(s,u,i))},jt=(e,o,i)=>{if(!i||i==="original")return e.originalIndex-o.originalIndex;let[c,a]=i.split("-"),s=c==="price"?e.price-(e.discount||0):e.name.toLowerCase(),u=c==="price"?o.price-(o.discount||0):o.name.toLowerCase();return a==="asc"?s<u?-1:s>u?1:0:u<s?-1:u>s?1:0},Rt=ce(Bt),H=()=>{try{let e=d.value||"original",o=l.value.trim(),i=document.getElementById("filter-discount")?.checked||!1,c=Rt(v,o,e,i);Tt(c)}catch(e){console.error("Error al actualizar visualizaci\xF3n de productos:",e),h("Error al actualizar la visualizaci\xF3n de productos. Por favor, intenta m\xE1s tarde.")}},U=se(H,300),A=()=>{let e=document.getElementById("cart-count"),o=y.reduce((i,c)=>i+c.quantity,0);e.textContent=o,e.setAttribute("aria-label",`${o} items in cart`)},at=(e,o)=>{try{let i=y.find(a=>a.id===e.id);i?i.quantity=Math.min(i.quantity+o,50):y.push({id:e.id,name:e.name,description:e.description,price:e.price,discount:e.discount,image_path:e.image_path,quantity:Math.min(o,50),category:e.category,stock:e.stock}),z(),A(),q();let c=document.querySelector(`[data-id="${e.id}"].quantity-input`);c&&(c.value=Math.max(F(e.id),1))}catch(i){console.error("Error al agregar al carrito:",i),h("Error al agregar el art\xEDculo al carrito. Por favor, intenta nuevamente.")}},ot=e=>{try{y=y.filter(i=>i.id!==e),z(),A(),q();let o=document.querySelector(`.action-area[data-pid="${e}"]`);if(o){let i=o.querySelector(".add-to-cart-btn"),c=o.querySelector(".quantity-control");N(i,c,!1)}}catch(o){console.error("Error al eliminar del carrito:",o),h("Error al eliminar el art\xEDculo del carrito. Por favor, intenta nuevamente.")}},O=(e,o)=>{try{let i=y.find(p=>p.id===e.id),c=i?i.quantity+o:1,a=document.querySelector(`.action-area[data-pid="${e.id}"]`),s=a?.querySelector(".add-to-cart-btn"),u=a?.querySelector(".quantity-control");if(c<=0)ot(e.id),N(s,u,!1);else if(c<=50){i?i.quantity=c:(at(e,1),N(s,u,!0)),z(),A(),q();let p=document.querySelector(`[data-id="${e.id}"].quantity-input`);p&&(p.value=c,p.classList.add("quantity-changed"),setTimeout(()=>p.classList.remove("quantity-changed"),300))}}catch(i){console.error("Error al actualizar cantidad:",i),h("Error al actualizar la cantidad. Por favor, intenta nuevamente.")}},Ft=()=>{try{y=[],z(),A(),q(),H()}catch(e){console.error("Error al vaciar el carrito:",e),h("Error al vaciar el carrito. Por favor, int\xE9ntelo de nuevo.")}},N=(e,o,i)=>{!e||!o||(i?(e.style.display="none",o.style.display="flex"):(o.style.display="none",e.style.display="flex"))},z=()=>{try{localStorage.setItem("cart",JSON.stringify(y))}catch(e){console.error("Error al guardar el carrito:",e),h("Error al guardar el carrito. Tus cambios podr\xEDan no persistir.")}},q=()=>{let e=document.getElementById("cart-items"),o=document.getElementById("cart-total");e.innerHTML="";let i=0;y.forEach(a=>{let s=a.price-(a.discount||0),u=m("div",{class:"cart-item mb-3 d-flex align-items-start","aria-label":`Cart item: ${a.name}`}),p=m("div",{class:"cart-item-content flex-grow-1"});p.appendChild(m("div",{class:"fw-bold mb-1"},[a.name]));let L=m("div",{class:"mb-2"}),D=m("button",{class:"btn btn-sm btn-secondary decrease-quantity","data-id":a.id,"aria-label":`Disminuir cantidad de ${a.name}`},["-"]),_=m("button",{class:"btn btn-sm btn-secondary increase-quantity","data-id":a.id,"aria-label":`Aumentar cantidad de ${a.name}`},["+"]),W=m("span",{class:"mx-2 item-quantity","aria-label":`Cantidad de ${a.name}`},[a.quantity.toString()]);L.appendChild(D),L.appendChild(W),L.appendChild(_),p.appendChild(L),p.appendChild(m("div",{class:"text-muted small"},[`Precio: $${s.toLocaleString("es-CL")}`])),p.appendChild(m("div",{class:"fw-bold"},[`Subtotal: $${(s*a.quantity).toLocaleString("es-CL")}`]));let B=m("button",{class:"btn btn-sm btn-danger remove-item mt-2","data-id":a.id,"aria-label":`Eliminar ${a.name} del carrito`},["Eliminar"]);p.appendChild(B);let k=window.location.pathname.includes("/pages/"),I;k?I=`../${a.image_path.replace(/^\//,"")}`:I=a.image_path;let E=m("div",{class:"cart-item-thumb ms-3 flex-shrink-0"}),S={src:a.thumbnail_path||I,alt:a.name,class:"cart-item-thumb-img",loading:"lazy",decoding:"async",width:"100",height:"100"};if(Array.isArray(a.thumbnail_variants)){let w=a.thumbnail_variants.filter(g=>g&&g.url&&g.width).map(g=>`${g.url} ${g.width}w`);w.length&&(S.srcset=w.join(", "),S.sizes="100px")}let $=m("img",S);if(E.appendChild($),u.appendChild(p),u.appendChild(E),e.appendChild(u),window.__DEBUG_CART__)try{let w=window.getComputedStyle(u),g=window.getComputedStyle(E),Q=window.getComputedStyle(p),T=E.getBoundingClientRect(),M=p.getBoundingClientRect();console.debug("[cart] item",{name:a.name,order:{firstIsContent:u.firstChild===p,lastIsThumb:u.lastChild===E},container:{display:w.display,flexDirection:w.flexDirection,flexWrap:w.flexWrap},thumb:{width:g.width,height:g.height,rect:{w:T.width,h:T.height}},content:{rect:{w:M.width,h:M.height}}})}catch{}i+=s*a.quantity}),o.textContent=`Total: $${i.toLocaleString("es-CL")}`,o.setAttribute("aria-label",`Total: $${i.toLocaleString("es-CL")}`);let c=document.getElementById("payment-credit-container");if(c)if(i>=3e4)c.classList.remove("d-none");else{c.classList.add("d-none");let a=c.querySelector("input");a&&(a.checked=!1)}},Ht=()=>{let e=document.querySelector('input[name="paymentMethod"]:checked');if(!e){alert("Por favor seleccione un m\xE9todo de pago");return}let o=`Mi pedido:

`;y.forEach(a=>{let s=a.price-(a.discount||0);o+=`${a.name}
`,o+=`Cantidad: ${a.quantity}
`,o+=`Precio unitario: $${s.toLocaleString("es-CL")}
`,o+=`Subtotal: $${(s*a.quantity).toLocaleString("es-CL")}

`});let i=y.reduce((a,s)=>a+(s.price-(s.discount||0))*s.quantity,0);o+=`Total: $${i.toLocaleString("es-CL")}
`,o+=`M\xE9todo de pago: ${e.value}`;let c=encodeURIComponent(o);window.open(`https://wa.me/56951118901?text=${c}`,"_blank")};try{if(await At(),v=await Lt(),v.length===0){h("No hay productos disponibles. Por favor, intenta m\xE1s tarde.");return}let e=document.querySelector("main").dataset.category;if(e){let s=J(e);v=v.filter(u=>(u.categoryKey||J(u.category))===s)}d.addEventListener("change",U),l.addEventListener("input",U);let o=f();o&&o.addEventListener("change",U),H(),typeof window<"u"&&(window.__APP_READY__=!0),window.addEventListener("online",R),window.addEventListener("offline",R),R();let i=document.getElementById("cart-icon"),c=document.getElementById("empty-cart"),a=document.getElementById("submit-cart");i.addEventListener("click",()=>{if(typeof window.bootstrap<"u"&&window.bootstrap.Offcanvas){let s=new window.bootstrap.Offcanvas(document.getElementById("cartOffcanvas"));q(),s.show()}else{console.error("Bootstrap Offcanvas no est\xE1 disponible"),q();let s=document.getElementById("cartOffcanvas");s&&s.classList.add("show")}}),c.addEventListener("click",Ft),a.addEventListener("click",Ht),document.getElementById("cart-items").addEventListener("click",s=>{let u=s.target,p=u.closest("[data-id]")?.dataset.id;p&&(u.classList.contains("decrease-quantity")?O({id:p},-1):u.classList.contains("increase-quantity")?O({id:p},1):u.classList.contains("remove-item")&&ot(p))}),A(),"performance"in window&&window.addEventListener("load",()=>{let s=performance.getEntriesByType("paint"),u=performance.getEntriesByType("navigation")[0];console.log("First Contentful Paint:",s[0].startTime),console.log("DOM Content Loaded:",u.domContentLoadedEventEnd),console.log("Load Time:",u.loadEventEnd)})}catch(e){console.error("Error al inicializar productos:",e),h("Error al cargar productos. Por favor, int\xE9ntelo m\xE1s tarde.")}};typeof document<"u"&&document.addEventListener("DOMContentLoaded",function(){Et(),qt().catch(t=>{console.error("Error al inicializar la aplicaci\xF3n:",t),h("Error al inicializar la aplicaci\xF3n. Por favor, actualice la p\xE1gina.")})});typeof Y<"u"&&(Y.exports={generateStableId:St,fetchProducts:Lt,addToCart:It,removeFromCart:Pt,updateQuantity:de,updateCartIcon:j,__getCart:()=>b})});var ue=ct(()=>{lt();ut();pt();gt();vt();bt();var Pe=Yt(_t());function kt(){let t=document.documentElement;try{document.querySelectorAll('link[rel="stylesheet"][media="print"][data-defer]').forEach(n=>{n.media="all",n.removeAttribute("data-defer")})}catch{}t.dataset.enhancementsInit!=="1"&&(t.dataset.enhancementsInit="1",st(),wt(),dt(),mt(),yt(),ft(),ht())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",kt):kt()});ue();})();
