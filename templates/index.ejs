<!DOCTYPE html>
<html lang="es">

<head>
  <!-- Essential Meta Tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes">
  <meta name="description" content="El Rincón de Ébano">

  <link rel="canonical" href="https://elrincondeebano.com/">
  <link rel="manifest" href="/app.webmanifest">

  <!-- Security -->
  <script src="dist/js/csp.js?v=2" async></script>

  <!-- Title and Favicon -->
  <title>El Rincón de Ébano</title>
  <link rel="icon" href="assets/images/web/favicon.ico" type="image/x-icon">

  <!-- Preconnect to External Domains -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <!-- Self-hosted fonts: preload above-the-fold weights -->
  <!-- No font preloads for Variant C -->

  <!-- Performance Resource Hints -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">

  <% const lcpImage=Array.isArray(products) && products.length> 0 ? products[0].image : null; %>
    <% const currencyFormatter=new Intl.NumberFormat('es-CL', { style: 'currency' , currency: 'CLP' ,
      minimumFractionDigits: 0 }); %>
      <!-- Preload critical assets -->
      <link rel="preload" href="/dist/css/critical.min.css" as="style" fetchpriority="high">
      <link rel="preload" href="/assets/images/web/logo.webp"
        as="image" type="image/webp" fetchpriority="high">
      <% if (Array.isArray(preloadFonts) && preloadFonts.length) { %>
        <% preloadFonts.forEach(function(fontHref) { %>
          <link rel="preload" href="<%= fontHref %>" as="font" type="font/woff2" crossorigin>
          <% }); %>
            <% } else { %>
              <link rel="preload" href="/dist/css/playfair-400-4OM7HYDI.woff2" as="font" type="font/woff2" crossorigin>
              <link rel="preload" href="/dist/css/inter-400-NRMW37G5.woff2" as="font" type="font/woff2" crossorigin>
              <link rel="preload" href="/dist/css/inter-700-NRMW37G5.woff2" as="font" type="font/woff2" crossorigin>
              <% } %>
                <% if (lcpImage) { const preloadHref=lcpImage.avif ? lcpImage.avif.src : lcpImage.src; const
                  preloadSrcset=lcpImage.avif ? lcpImage.avif.srcset : lcpImage.srcset; const preloadType=lcpImage.avif
                  ? 'image/avif' : null; %>
                  <link rel="preload" href="<%= preloadHref %>" as="image" imagesrcset="<%= preloadSrcset %>"
                    imagesizes="<%= lcpImage.sizes || '(max-width: 575px) 50vw, (max-width: 991px) 45vw, 280px' %>"
                    fetchpriority="high" <%=preloadType ? ` type=\"${preloadType}\"` : '' %>>
                  <% } %>
                    <!-- Critical CSS -->
                    <link rel="stylesheet" href="/dist/css/critical.min.css">

                    <!-- Preload Critical Assets -->
                    <link rel="modulepreload" href="/dist/js/script.min.js">

                    <!-- Load shared styles in a consistent order to avoid first-paint flicker -->
                    <link rel="stylesheet" href="/dist/css/style.min.css?v=100">

                    <!-- Fallback for No JavaScript -->
                    <noscript>
                      <link rel="stylesheet" href="/dist/css/style.min.css?v=100">
                    </noscript>

                    <!-- Open Graph Tags -->
                    <meta property="og:title" content="El Rincón de Ébano">
                    <meta property="og:description" content="Un minimarket en la puerta de tu departamento">
                    <meta property="og:image" content="https://elrincondeebano.com/assets/images/web/logo.webp">
                    <meta property="og:url" content="https://elrincondeebano.com/">
                    <meta property="og:type" content="website">
</head>

<body>
  <a href="#main-content" class="skip-link">Saltar al contenido principal</a>

  <%- include('partials/navbar', { navGroups: typeof navGroups !=='undefined' ? navGroups : [] }) %>

    <main id="main-content" data-category="" role="main" tabindex="-1">
      <div class="container mt-1 mt-md-2 mb-4">
        <section class="hero-section text-center mb-3 mb-md-5" aria-labelledby="main-heading">
          <h1 id="main-heading">Productos frescos directo a tu puerta</h1>
          <p class="lead text-muted mb-4">Compra en línea y recibe en minutos</p>
        </section>
        <section aria-label="Opciones de filtrado y ordenación">
          <div class="row mb-3">
            <div class="col-md-6">
              <select id="sort-options" class="form-select" aria-label="Ordenar productos">
                <option value="original" selected>Orden por defecto</option>
                <option value="name-asc">Nombre (A-Z)</option>
                <option value="name-desc">Nombre (Z-A)</option>
                <option value="price-asc">Precio (menor a mayor)</option>
                <option value="price-desc">Precio (mayor a menor)</option>
              </select>
            </div>
            <div class="col-md-6">
              <input type="text" id="filter-keyword" class="form-control" placeholder="Filtrar por nombre"
                aria-label="Filtrar productos por nombre">
            </div>
            <div class="col-12 mt-2">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="filter-discount"
                  aria-label="Mostrar solo productos con descuento">
                <label class="form-check-label" for="filter-discount">Solo productos con descuento</label>
              </div>
            </div>
          </div>
        </section>
        <section aria-labelledby="products-heading">
          <h2 id="products-heading" class="visually-hidden">Productos disponibles</h2>
          <div class="row" id="product-container" aria-live="polite" data-total-products="<%= totalProducts %>">
            <% products.forEach((product, index)=> { %>
              <article
                class="producto col-6 col-sm-6 col-md-4 col-lg-3 mb-4 <%= product.stock ? '' : 'agotado' %> has-content-visibility has-contain-intrinsic"
                data-product-id="<%= product.id %>" aria-labelledby="product-title-<%= product.id %>">
                <div class="card h-100">
                  <% if (product.isDiscounted) { %>
                    <span class="discount-badge badge bg-danger" aria-label="Producto en oferta">-<%=
                        product.discountPercent %>%</span>
                    <% } %>
                      <picture>
                        <% if (product.image.avif) { %>
                          <source type="image/avif" srcset="<%= product.image.avif.srcset %>"
                            sizes="<%= product.image.sizes %>">
                          <% } %>
                            <img src="<%= product.image.src %>" srcset="<%= product.image.srcset %>"
                              sizes="<%= product.image.sizes %>" alt="<%= product.name %>"
                              class="card-img-top product-thumb is-loading"
                              loading="<%= index === 0 ? 'eager' : 'lazy' %>"
                              fetchpriority="<%= index === 0 ? 'high' : 'auto' %>" decoding="async" width="400"
                              height="400">
                      </picture>
                      <div class="card-body d-flex flex-column">
                        <h3 class="card-title mb-2" id="product-title-<%= product.id %>">
                          <%= product.name %>
                        </h3>
                        <p class="card-text mb-3">
                          <%= product.description %>
                        </p>
                        <div class="precio-container mb-3">
                          <% if (product.isDiscounted) { %>
                            <span class="precio-descuento" aria-label="Precio con descuento">
                              <%= currencyFormatter.format(product.discountedPrice) %>
                            </span>
                            <span class="precio-original" aria-label="Precio original">
                              <span class="tachado">
                                <%= currencyFormatter.format(product.price) %>
                              </span>
                            </span>
                            <% } else { %>
                              <span class="precio" aria-label="Precio">
                                <%= currencyFormatter.format(product.price) %>
                              </span>
                              <% } %>
                        </div>
                        <div class="action-area mt-auto" data-pid="<%= product.id %>" role="group"
                          aria-label="Acciones de compra para <%= product.name %>">
                          <button class="btn btn-primary add-to-cart-btn mt-2" type="button" data-id="<%= product.id %>"
                            aria-label="Agregar <%= product.name %> al carrito">Agregar</button>
                          <div class="quantity-control is-hidden" aria-live="polite" role="group"
                            aria-label="Seleccionar cantidad">
                            <button class="quantity-btn" type="button" data-action="decrease"
                              aria-label="Disminuir cantidad">-</button>
                            <input type="number" class="quantity-input" value="1" min="1" max="50" aria-label="Cantidad"
                              data-id="<%= product.id %>">
                            <button class="quantity-btn" type="button" data-action="increase"
                              aria-label="Aumentar cantidad">+</button>
                          </div>
                        </div>
                      </div>
                </div>
              </article>
              <% }); %>
          </div>
          <div id="catalog-controls" class="text-center my-4">
            <button type="button" id="catalog-load-more" class="btn btn-outline-primary d-none">Cargar más
              productos</button>
          </div>
          <div id="catalog-sentinel" aria-hidden="true"></div>
          <noscript>
            <div class="alert alert-info mt-4" role="status">Explora nuestras categorías mientras JavaScript está
              deshabilitado:</div>
            <ul class="list-unstyled row g-2 mt-3">
              <li class="col-12 col-sm-6 col-md-4"><a href="/pages/aguas.html">Aguas</a></li>
              <li class="col-12 col-sm-6 col-md-4"><a href="/pages/bebidas.html">Bebidas</a></li>
              <li class="col-12 col-sm-6 col-md-4"><a href="/pages/despensa.html">Despensa</a></li>
              <li class="col-12 col-sm-6 col-md-4"><a href="/pages/snacksdulces.html">Snacks dulces</a></li>
              <li class="col-12 col-sm-6 col-md-4"><a href="/pages/snackssalados.html">Snacks salados</a></li>
              <li class="col-12 col-sm-6 col-md-4"><a href="/pages/vinos.html">Vinos</a></li>
            </ul>
          </noscript>
        </section>
      </div>
      <div id="offline-indicator" aria-live="assertive" class="alert alert-warning is-hidden" role="alert">Actualmente
        estás sin conexión</div>
    </main>

    <%- include('partials/footer') %>

      <script type="application/json" id="product-data"><%- inlinePayload %></script>

      <script type="module" src="/dist/js/script.min.js" crossorigin="anonymous"></script>
      <!-- Service Worker registration handled in dist/js/script.min.js -->
</body>

</html>
